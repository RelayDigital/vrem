"use strict";exports.id=2880,exports.ids=[2880],exports.modules={17585:(a,b,c)=>{c.d(b,{d:()=>g});var d=c(21124);c(38301);var e=c(75441),f=c(15514);function g({className:a,...b}){return(0,d.jsx)(e.bL,{"data-slot":"switch",className:(0,f.cn)("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",a),...b,children:(0,d.jsx)(e.zi,{"data-slot":"switch-thumb",className:(0,f.cn)("bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}},17751:(a,b,c)=>{c.d(b,{$m:()=>j,As:()=>i,nD:()=>h,ub:()=>k});var d=c(21124);c(38301);var e=c(62225),f=c(85351),g=c(67442);function h({...a}){return(0,d.jsx)(e.bL,{"data-slot":"accordion",...a})}function i({className:a,...b}){return(0,d.jsx)(e.q7,{"data-slot":"accordion-item",className:(0,g.cn)("border-b last:border-b-0",a),...b})}function j({className:a,children:b,...c}){return(0,d.jsx)(e.Y9,{className:"flex",children:(0,d.jsxs)(e.l9,{"data-slot":"accordion-trigger",className:(0,g.cn)("focus-visible:border-ring focus-visible:ring-ring/50 flex flex-1 items-start justify-between gap-4 rounded-md py-4 text-left text-sm font-medium transition-all outline-none hover:underline focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 [&[data-state=open]>svg]:rotate-180",a),...c,children:[b,(0,d.jsx)(f.A,{className:"text-muted-foreground pointer-events-none size-4 shrink-0 translate-y-0.5 transition-transform duration-200"})]})})}function k({className:a,children:b,...c}){return(0,d.jsx)(e.UC,{"data-slot":"accordion-content",className:"data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down overflow-hidden text-sm",...c,children:(0,d.jsx)("div",{className:(0,g.cn)("pt-0 pb-4",a),children:b})})}},68877:(a,b,c)=>{c.d(b,{Xi:()=>i,av:()=>j,j7:()=>h,tU:()=>g});var d=c(21124);c(38301);var e=c(89989),f=c(67442);function g({className:a,...b}){return(0,d.jsx)(e.bL,{"data-slot":"tabs",className:(0,f.cn)("flex flex-col gap-2",a),...b})}function h({className:a,...b}){return(0,d.jsx)(e.B8,{"data-slot":"tabs-list",className:(0,f.cn)("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-md p-[3px] flex",a),...b})}function i({className:a,...b}){return(0,d.jsx)(e.l9,{"data-slot":"tabs-trigger",className:(0,f.cn)("data-[state=active]:bg-card dark:data-[state=active]:text-foreground focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:bg-background text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 hover:bg-secondary cursor-pointer",a),...b})}function j({className:a,...b}){return(0,d.jsx)(e.UC,{"data-slot":"tabs-content",className:(0,f.cn)("flex-1 outline-none",a),...b})}},92880:(a,b,c)=>{c.d(b,{m:()=>aQ});var d=c(21124),e=c(38301),f=c(53603),g=c(40727),h=c(93130),i=c(22509),j=c(72576),k=c(97201),l=c(86276),m=c(33305),n=c(22544),o=c(19217),p=c(55224),q=c(8044),r=c(674),s=c(47089),t=c(36734),u=c(87278),v=c(52647),w=c(39983),x=c(46148),y=c(3663),z=c(80196),A=c(57759),B=c(14263),C=c(50117),D=c(78660),E=c(40284),F=c(16636),G=c(38882),H=c(86865),I=c(46710),J=c(82788),K=c(65893),L=c(44688),M=c(10578),N=c(76180),O=c(59405),P=c(69957),Q=c(78583),R=c(59268),S=c(76744),T=c(91994),U=c(26369),V=c(96545),W=c(83718),X=c(55705),Y=c(70949),Z=c(87649),$=c(33204),_=c(9825),aa=c(72567),ab=c(15303),ac=c(31115),ad=c(42830),ae=c(99042),af=c(36736),ag=c(88226),ah=c(9188),ai=c(61010),aj=c(72966),ak=c(57991),al=c(67442),am=c(52769);c(1752);var an=c(96425),ao=c(26691),ap=c(15514);let aq=(0,ao.F)("group/item flex items-center border border-transparent text-sm rounded-md transition-colors [a]:hover:bg-accent/50 [a]:transition-colors duration-100 flex-wrap outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]",{variants:{variant:{default:"bg-transparent",outline:"border-border",muted:"bg-muted/50"},size:{default:"p-4 gap-4 ",sm:"py-3 px-4 gap-2.5"}},defaultVariants:{variant:"default",size:"default"}});function ar({className:a,variant:b="default",size:c="default",asChild:e=!1,...f}){let g=e?an.DX:"div";return(0,d.jsx)(g,{"data-slot":"item","data-variant":b,"data-size":c,className:(0,ap.cn)(aq({variant:b,size:c,className:a})),...f})}let as=(0,ao.F)("flex shrink-0 items-center justify-center gap-2 group-has-[[data-slot=item-description]]/item:self-start [&_svg]:pointer-events-none group-has-[[data-slot=item-description]]/item:translate-y-0.5",{variants:{variant:{default:"bg-transparent",icon:"size-8 border rounded-sm bg-muted [&_svg:not([class*='size-'])]:size-4",image:"size-10 rounded-sm overflow-hidden [&_img]:size-full [&_img]:object-cover"}},defaultVariants:{variant:"default"}});function at({className:a,variant:b="default",...c}){return(0,d.jsx)("div",{"data-slot":"item-media","data-variant":b,className:(0,ap.cn)(as({variant:b,className:a})),...c})}function au({className:a,...b}){return(0,d.jsx)("div",{"data-slot":"item-content",className:(0,ap.cn)("flex flex-1 flex-col gap-1 [&+[data-slot=item-content]]:flex-none",a),...b})}function av({className:a,...b}){return(0,d.jsx)("div",{"data-slot":"item-title",className:(0,ap.cn)("flex w-fit items-center gap-2 text-sm leading-snug font-medium",a),...b})}function aw({className:a,...b}){return(0,d.jsx)("p",{"data-slot":"item-description",className:(0,ap.cn)("text-muted-foreground line-clamp-2 text-sm leading-normal font-normal text-balance","[&>a:hover]:text-primary [&>a]:underline [&>a]:underline-offset-4",a),...b})}function ax({className:a,...b}){return(0,d.jsx)("div",{"data-slot":"item-actions",className:(0,ap.cn)("flex items-center gap-2",a),...b})}var ay=c(68877),az=c(17751),aA=c(7629),aB=c(79347);c(61848);var aC=c(17585),aD=c(18310),aE=c(71613),aF=c(10708),aG=c(38442),aH=c(25345),aI=c(99458);let aJ={PENDING_REVIEW:{label:"Pending Review",color:"text-amber-600",icon:ab.A},APPROVED:{label:"Approved",color:"text-green-600",icon:R.A},CHANGES_REQUESTED:{label:"Changes Requested",color:"text-red-600",icon:aD.A}};function aK({projectId:a,projectStatus:b,canManageDelivery:c,variant:f="inline"}){let[g,h]=(0,e.useState)(null),[i,j]=(0,e.useState)(!0),[k,l]=(0,e.useState)(!1),[m,q]=(0,e.useState)(!1),[r,s]=(0,e.useState)(!1),[t,u]=(0,e.useState)(!1),[v,w]=(0,e.useState)(!1),x=async()=>{if(g){l(!0);try{let b=await aB.F.projectDelivery.enable(a);h(a=>a?{...a,...b}:null),ad.oR.success("Delivery link enabled")}catch(a){console.error("Failed to enable delivery:",a),ad.oR.error("Failed to enable delivery")}finally{l(!1)}}},y=async()=>{if(g){l(!0);try{let b=await aB.F.projectDelivery.disable(a);h(a=>a?{...a,...b}:null),ad.oR.success("Delivery link disabled"),u(!1)}catch(a){console.error("Failed to disable delivery:",a),ad.oR.error("Failed to disable delivery")}finally{l(!1)}}},z=async()=>{if(g){q(!0);try{let b=await aB.F.projectDelivery.regenerateToken(a);h(a=>a?{...a,...b}:null),ad.oR.success("Delivery link regenerated. Previous links are now invalid."),w(!1)}catch(a){console.error("Failed to regenerate token:",a),ad.oR.error("Failed to regenerate delivery link")}finally{q(!1)}}},A=async()=>{g&&(g.enabled?u(!0):await x())},C=async()=>{if(!g?.deliveryToken)return;let a=aB.F.projectDelivery.getDeliveryUrl(g.deliveryToken);try{await navigator.clipboard.writeText(a),s(!0),ad.oR.success("Delivery link copied to clipboard"),setTimeout(()=>s(!1),2e3)}catch(a){console.error("Failed to copy:",a),ad.oR.error("Failed to copy link")}},D=()=>{if(!g?.deliveryToken)return;let a=aB.F.projectDelivery.getDeliveryUrl(g.deliveryToken);window.open(a,"_blank")};if(i)return"inline"===f?(0,d.jsx)(p.E,{className:"h-5 w-24"}):(0,d.jsxs)("div",{className:"rounded-lg border p-4 space-y-3",children:[(0,d.jsx)(p.E,{className:"h-5 w-32"}),(0,d.jsx)(p.E,{className:"h-8 w-full"})]});if(!g)return null;let E=aJ[g.clientApprovalStatus],F=E.icon;return"inline"===f?(0,d.jsx)(af.Bc,{children:(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[c&&(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)(aC.d,{checked:g.enabled,onCheckedChange:A,disabled:k,className:"data-[state=checked]:bg-green-600"}),(0,d.jsx)("span",{className:"text-sm text-muted-foreground",children:k?(0,d.jsx)(B.A,{className:"h-3 w-3 animate-spin"}):g.enabled?"Enabled":"Disabled"})]}),g.enabled&&g.deliveryToken&&(0,d.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,d.jsxs)(af.m_,{children:[(0,d.jsx)(af.k$,{asChild:!0,children:(0,d.jsx)(o.$,{variant:"ghost",size:"sm",className:"h-7 px-2",onClick:C,children:r?(0,d.jsx)(aE.A,{className:"h-3.5 w-3.5 text-green-600"}):(0,d.jsx)(aF.A,{className:"h-3.5 w-3.5"})})}),(0,d.jsx)(af.ZI,{children:"Copy delivery link"})]}),(0,d.jsxs)(af.m_,{children:[(0,d.jsx)(af.k$,{asChild:!0,children:(0,d.jsx)(o.$,{variant:"ghost",size:"sm",className:"h-7 px-2",onClick:D,children:(0,d.jsx)(Q.A,{className:"h-3.5 w-3.5"})})}),(0,d.jsx)(af.ZI,{children:"Open delivery page"})]}),(0,d.jsxs)(n.E,{variant:"outline",className:(0,al.cn)("gap-1",E.color),children:[(0,d.jsx)(F,{className:"h-3 w-3"}),(0,d.jsx)("span",{className:"text-xs",children:E.label})]})]}),!g.enabled&&!c&&(0,d.jsx)("span",{className:"text-sm text-muted-foreground",children:"Delivery not enabled"})]})}):(0,d.jsxs)(af.Bc,{children:[(0,d.jsxs)("div",{className:"rounded-lg border p-4 space-y-4",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)(aG.A,{className:"h-4 w-4 text-muted-foreground"}),(0,d.jsx)("span",{className:"font-medium",children:"Client Delivery"})]}),c&&(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)("span",{className:"text-sm text-muted-foreground",children:k?(0,d.jsx)(B.A,{className:"h-3 w-3 animate-spin"}):g.enabled?"Enabled":"Disabled"}),(0,d.jsx)(aC.d,{checked:g.enabled,onCheckedChange:A,disabled:k,className:"data-[state=checked]:bg-green-600"})]})]}),g.enabled&&g.deliveryToken&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)("div",{className:"flex-1 px-3 py-2 bg-muted rounded-md text-sm font-mono truncate",children:aB.F.projectDelivery.getDeliveryUrl(g.deliveryToken)}),(0,d.jsxs)(af.m_,{children:[(0,d.jsx)(af.k$,{asChild:!0,children:(0,d.jsx)(o.$,{variant:"outline",size:"sm",onClick:C,className:"shrink-0",children:r?(0,d.jsx)(aE.A,{className:"h-4 w-4 text-green-600"}):(0,d.jsx)(aF.A,{className:"h-4 w-4"})})}),(0,d.jsx)(af.ZI,{children:"Copy link"})]}),(0,d.jsxs)(af.m_,{children:[(0,d.jsx)(af.k$,{asChild:!0,children:(0,d.jsx)(o.$,{variant:"outline",size:"sm",onClick:D,className:"shrink-0",children:(0,d.jsx)(Q.A,{className:"h-4 w-4"})})}),(0,d.jsx)(af.ZI,{children:"Open delivery page"})]}),c&&(0,d.jsxs)(af.m_,{children:[(0,d.jsx)(af.k$,{asChild:!0,children:(0,d.jsx)(o.$,{variant:"outline",size:"sm",onClick:()=>w(!0),disabled:m,className:"shrink-0",children:m?(0,d.jsx)(B.A,{className:"h-4 w-4 animate-spin"}):(0,d.jsx)(aH.A,{className:"h-4 w-4"})})}),(0,d.jsx)(af.ZI,{children:"Regenerate link"})]})]}),(0,d.jsxs)("div",{className:"flex items-center justify-between pt-2 border-t",children:[(0,d.jsx)("span",{className:"text-sm text-muted-foreground",children:"Client Approval Status"}),(0,d.jsxs)(n.E,{variant:"outline",className:(0,al.cn)("gap-1.5",E.color),children:[(0,d.jsx)(F,{className:"h-3.5 w-3.5"}),E.label]})]}),"APPROVED"===g.clientApprovalStatus&&g.clientApprovedAt&&g.clientApprovedBy&&(0,d.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Approved by ",g.clientApprovedBy.name," on"," ",new Date(g.clientApprovedAt).toLocaleDateString()]}),"CHANGES_REQUESTED"===g.clientApprovalStatus&&(0,d.jsx)("div",{className:"text-xs text-muted-foreground",children:"Client requested changes"}),"PENDING_REVIEW"===g.clientApprovalStatus&&g.deliveryEnabledAt&&(0,d.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Delivery ready since"," ",new Date(g.deliveryEnabledAt).toLocaleDateString()]})]}),!g.enabled&&(0,d.jsx)("div",{className:"text-sm text-muted-foreground",children:c?"Enable delivery to share media with your client.":"Delivery has not been enabled for this project."})]}),(0,d.jsx)(ag.Lt,{open:t,onOpenChange:u,children:(0,d.jsxs)(ag.EO,{children:[(0,d.jsxs)(ag.wd,{children:[(0,d.jsx)(ag.r7,{children:"Disable Delivery Link?"}),(0,d.jsx)(ag.$v,{children:"The client will no longer be able to access this delivery page. You can re-enable it at any time."})]}),(0,d.jsxs)(ag.ck,{children:[(0,d.jsx)(ag.Zr,{disabled:k,children:"Cancel"}),(0,d.jsx)(ag.Rx,{onClick:y,disabled:k,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:k?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(B.A,{className:"h-4 w-4 mr-2 animate-spin"}),"Disabling..."]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(aI.A,{className:"h-4 w-4 mr-2"}),"Disable"]})})]})]})}),(0,d.jsx)(ag.Lt,{open:v,onOpenChange:w,children:(0,d.jsxs)(ag.EO,{children:[(0,d.jsxs)(ag.wd,{children:[(0,d.jsx)(ag.r7,{children:"Regenerate Delivery Link?"}),(0,d.jsx)(ag.$v,{children:"This will create a new delivery link. The previous link will stop working immediately. Anyone with the old link will no longer have access."})]}),(0,d.jsxs)(ag.ck,{children:[(0,d.jsx)(ag.Zr,{disabled:m,children:"Cancel"}),(0,d.jsx)(ag.Rx,{onClick:z,disabled:m,children:m?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(B.A,{className:"h-4 w-4 mr-2 animate-spin"}),"Regenerating..."]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(aH.A,{className:"h-4 w-4 mr-2"}),"Regenerate"]})})]})]})})]})}var aL=c(76577),aM=c(85948),aN=c(52962),aO=c(60127);let aP=()=>(0,d.jsxs)("span",{className:"inline-flex items-center gap-0.5",children:[(0,d.jsx)("span",{className:"w-1.5 h-1.5 rounded-full bg-current animate-bounce [animation-delay:-0.3s]"}),(0,d.jsx)("span",{className:"w-1.5 h-1.5 rounded-full bg-current animate-bounce [animation-delay:-0.15s]"}),(0,d.jsx)("span",{className:"w-1.5 h-1.5 rounded-full bg-current animate-bounce"})]});function aQ({job:a,technician:b,projectManager:c,editor:an,messages:ao,currentUserId:ap,currentUserName:aq,currentUserAvatar:as,isClient:aC=!1,open:aD,onOpenChange:aE,currentUserAccountType:aF,onSendMessage:aG,onEditMessage:aH,onDeleteMessage:aI,onStatusChange:aJ,onAssignTechnician:aQ,onChangeTechnician:aR,onAssignCustomer:aS,onAssignProjectManager:aT,onAssignEditor:aU,variant:aV="sheet",onFullScreen:aW,onOpenInNewPage:aX,initialTab:aY,initialChatTab:aZ}){let{activeOrganizationId:a$,activeMembership:a_}=(0,aL.Q)(),a0=(0,aM.w)(),a1=(0,aN.I)(),a2=as??a1.currentUserAvatar,a3=!!a&&a1.isLoadingMessages(a.id),a4="AGENT"===(aF||"").toUpperCase(),[a5,a6]=(0,e.useState)(aY||"discussion"),a7=(a_?.role||a_?.orgRole||"").toUpperCase(),a8="PERSONAL"===(a_?.organization?.type||a_?.organizationType||"PERSONAL"),a9=(0,e.useMemo)(()=>a7&&""!==a7?a8?"PERSONAL_OWNER":a7:"NONE",[a7,a8]),ba=(0,e.useMemo)(()=>!!a4||(0,aO.nS)(a9),[a9,a4]),bb=(0,e.useMemo)(()=>"PROVIDER"===(aF||"").toUpperCase()&&a8,[aF,a8]),bc=!a4&&!bb,bd=bc&&ba,be=a4||bb||ba?"client":"team",[bf,bg]=(0,e.useState)(aZ||be),bh=(0,e.useMemo)(()=>a4||"client"===bf?"CUSTOMER":"TEAM",[bf,a4]),bi=(0,e.useMemo)(()=>a?a1.getTypingUsers(a.id,bh):[],[a,a1,bh]),[bj,bk]=(0,e.useState)(null),[bl,bm]=(0,e.useState)(null),[bn,bo]=(0,e.useState)(null),[bp,bq]=(0,e.useState)(null),[br,bs]=(0,e.useState)(null),[bt,bu]=(0,e.useState)(!1),[bv,bw]=(0,e.useState)(!1),[bx,by]=(0,e.useState)([]),[bz,bA]=(0,e.useState)(new Set),[bB,bC]=(0,e.useState)(!1),[bD,bE]=(0,e.useState)(!1),[bF,bG]=(0,e.useState)(null),[bH,bI]=(0,e.useState)(""),[bJ,bK]=(0,e.useState)({open:!1,service:""}),[bL,bM]=(0,e.useState)(null),[bN,bO]=(0,e.useState)(!1),[bP,bQ]=(0,e.useState)(!1),[bR,bS]=(0,e.useState)([]),[bT,bU]=(0,e.useState)([]),[bV,bW]=(0,e.useState)([]),[bX,bY]=(0,e.useState)([]),bZ=(0,e.useRef)(new Set),[b$,b_]=(0,e.useState)(""),[b0,b1]=(0,e.useState)(""),[b2,b3]=(0,e.useState)(""),[b4,b5]=(0,e.useState)(!1),b6=(0,e.useRef)(null),b7=(0,e.useRef)(null),b8=(0,e.useRef)(null),b9=(0,e.useRef)(null),ca=(0,e.useRef)(null);(0,e.useRef)(new Set);let cb=(0,ak.a)();(0,e.useMemo)(()=>a?.projectManagerId===ap,[ap,a?.projectManagerId]);let cc=(0,e.useMemo)(()=>{let b=a?{projectManagerId:a.projectManagerId??null}:null;return(0,aO.Kh)(a9,b,ap)},[a9,a?.projectManagerId,ap]),cd=cc&&!bb,ce=(0,e.useMemo)(()=>!bb&&(0,aO.qc)(a9),[a9,bb]),cf=(0,e.useMemo)(()=>(0,aO.aN)(a9),[a9]),cg=(0,e.useMemo)(()=>(0,aO.jC)(a9),[a9]),ch=(0,e.useMemo)(()=>{if(!a4||!a)return{canDelete:!1,canCancel:!1};let b=a.status?.toLowerCase(),c=!!a.assignedTechnicianId;return"delivered"===b?{canDelete:!1,canCancel:!1}:"cancelled"!==b&&("pending"!==b||c)?{canDelete:!1,canCancel:!0}:{canDelete:!0,canCancel:!1}},[a4,a?.status,a?.assignedTechnicianId]),ci=(0,e.useMemo)(()=>{let b=a?{projectManagerId:a.projectManagerId??null,customerId:a.customerId??null}:null;return(0,aO.mR)(a9,b,ap,{userAccountType:aF,customerUserId:a?.customer?.userId})},[a9,a?.projectManagerId,a?.customerId,a?.customer?.userId,ap,aF]),cj=a=>a?a.split(" ").map(a=>a[0]).join("").slice(0,2):"NA",ck=({isAssigned:a,name:b,avatar:c,label:e,onClear:f,canEdit:g,disabled:h,children:i})=>g?(0,d.jsxs)(ah.rI,{children:[(0,d.jsxs)("div",{className:"flex items-center gap-1",children:[(0,d.jsx)(ah.ty,{asChild:!0,disabled:h,children:(0,d.jsxs)("button",{className:(0,al.cn)("flex items-center gap-2 px-2 py-1 -ml-2 rounded-md transition-colors","hover:bg-muted/50 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-1",h&&"opacity-50 cursor-not-allowed"),children:[(0,d.jsx)(r.eu,{className:"h-7 w-7",children:a?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(r.BK,{src:c,alt:b}),(0,d.jsx)(r.q5,{className:"text-xs bg-muted-foreground/20",children:cj(b)})]}):(0,d.jsx)(r.q5,{className:"text-xs bg-transparent border-2 border-secondary border-dashed"})}),(0,d.jsx)("span",{className:(0,al.cn)("text-sm",a?"text-foreground":"text-muted-foreground"),children:a?b:e})]})}),a&&f&&(0,d.jsx)("button",{onClick:a=>{a.stopPropagation(),f()},className:(0,al.cn)("flex items-center justify-center size-5 rounded-full transition-colors","text-muted-foreground hover:text-foreground hover:bg-muted/80","focus:outline-none focus:ring-2 focus:ring-ring"),disabled:h,children:(0,d.jsx)(s.A,{className:"size-3"})})]}),i]}):(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)(r.eu,{className:"h-7 w-7",children:a?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(r.BK,{src:c,alt:b}),(0,d.jsx)(r.q5,{className:"text-xs bg-muted-foreground/20",children:cj(b)})]}):(0,d.jsx)(r.q5,{className:"text-xs bg-transparent border-2 border-secondary border-dashed"})}),(0,d.jsx)("span",{className:"text-sm text-muted-foreground",children:a?b:"Unassigned"})]}),cl=(a,b,c,d)=>{let e=b.trim().toLowerCase();return e?a.filter(a=>{let b=c(a)?.toLowerCase()||"",f=(d?.(a)||"").toLowerCase();return b.includes(e)||f.includes(e)}):a},cm=(0,e.useMemo)(()=>cl(bT,b$,a=>a.name||"",a=>a.email),[bT,b$]),cn=(0,e.useMemo)(()=>cl(bV,b0,a=>a.user?.name||a.personalOrg?.legalName||"",a=>a.user?.email),[bV,b0]),co=(0,e.useMemo)(()=>cl(bX,b2,a=>a.user?.name||a.personalOrg?.legalName||"",a=>a.user?.email),[bX,b2]),cp=(0,e.useMemo)(()=>a?.customerId&&bT.find(b=>b.id===a.customerId)||null,[bT,a]),cq=(0,e.useMemo)(()=>a?.projectManagerId&&bV.find(b=>b.userId===a.projectManagerId||b.user?.id===a.projectManagerId)||null,[bV,a]),cr=(0,e.useMemo)(()=>a?.editorId&&bX.find(b=>b.userId===a.editorId||b.user?.id===a.editorId)||null,[bX,a]),cs=(0,e.useMemo)(()=>a?.assignedTechnicianId&&bR.find(b=>b.id===a.assignedTechnicianId||b.userId===a.assignedTechnicianId)||null,[bR,a?.assignedTechnicianId]),ct=cs?{name:cs.name,avatarUrl:cs.avatar,role:cs.role||"TECHNICIAN"}:b||(a?.technician?{name:a.technician.name,avatarUrl:a.technician.avatarUrl,role:"TECHNICIAN"}:null),cu=cp?.name||a?.clientName||"Unassigned",cv=cq?.user?.name||cq?.personalOrg?.legalName||cq?.user?.email||c?.name||c?.fullName||c?.email||a?.projectManager?.name||a?.projectManager?.fullName||a?.projectManager?.email||(a?.projectManagerId?"Assigned":"Unassigned"),cw=cr?.user?.name||cr?.personalOrg?.legalName||cr?.user?.email||an?.name||an?.fullName||an?.email||a?.editor?.name||a?.editor?.fullName||a?.editor?.email||(a?.editorId?"Assigned":"Unassigned"),cx=cq?.user?.avatarUrl||c?.avatarUrl||a?.projectManager?.avatarUrl||"",cy=cr?.user?.avatarUrl||an?.avatarUrl||a?.editor?.avatarUrl||"",cz=(0,e.useCallback)(a=>{switch((a||"").toUpperCase()){case k.zu.VIDEO:return"video";case k.zu.FLOORPLAN:return"floor-plan";case k.zu.VIRTUAL_TOUR:return"3d-content";case k.zu.DOCUMENT:return"file";case k.zu.PHOTO:default:return"image"}},[]),cA=(0,e.useCallback)(a=>{switch(a){case"video":return k.zu.VIDEO;case"floor-plan":return k.zu.FLOORPLAN;case"3d-content":return k.zu.VIRTUAL_TOUR;case"file":return k.zu.DOCUMENT;default:return k.zu.PHOTO}},[]),cB=(0,e.useCallback)(a=>({id:a.id,name:a.filename,type:cz(a.type),url:a.externalUrl||a.cdnUrl||a.key||"",size:a.size,uploadedAt:new Date(a.createdAt),key:a.key}),[cz]),cC=(0,f.hG)({extensions:[g.A.configure({heading:!1,horizontalRule:!1,underline:!1}),i.A,j.Ay.configure({openOnClick:!1,HTMLAttributes:{class:"text-primary underline"}}),h.A.configure({placeholder:"Type a message..."})],content:"",immediatelyRender:!1,editorProps:{attributes:{class:"prose prose-sm sm:prose-base focus:outline-none max-w-none min-h-[64px] max-h-[200px] overflow-y-auto px-3.5 py-3 text-sm"}}}),cD=async b=>{if(!a||!cf)return;let c=!b;b5(!0);try{if(aS&&b){await aS(b),await a0.refreshJobs();let c=a0.getJobById(a.id);c&&a0.selectJob(c)}else{let c=await aB.F.projects.assignCustomer(a.id,b||null);a0.updateJob(a.id,c),a0.selectJob(aB.F.mapProjectToJobCard(c))}ad.oR.success(c?"Customer unassigned":"Customer assigned")}catch(a){console.error("Failed to assign customer",a)}finally{b5(!1)}},cE=async b=>{if(!a||!ce)return;let c=!b;b5(!0);try{if(aT&&b){await aT(b),await a0.refreshJobs();let c=a0.getJobById(a.id);c&&a0.selectJob(c)}else{let c=await aB.F.projects.assignProjectManager(a.id,b||null);a0.updateJob(a.id,c),a0.selectJob(aB.F.mapProjectToJobCard(c))}ad.oR.success(c?"Project manager unassigned":"Project manager assigned")}catch(a){console.error("Failed to assign project manager",a)}finally{b5(!1)}},cF=async b=>{if(!a||!cd)return;let c=!b;b5(!0);try{if(aU&&b){await aU(b),await a0.refreshJobs();let c=a0.getJobById(a.id);c&&a0.selectJob(c)}else{let c=await aB.F.projects.assignEditor(a.id,b||null);a0.updateJob(a.id,c),a0.selectJob(aB.F.mapProjectToJobCard(c))}ad.oR.success(c?"Editor unassigned":"Editor assigned")}catch(a){console.error("Failed to assign editor",a)}finally{b5(!1)}},cG=(0,f.hG)({extensions:[g.A.configure({heading:!1,horizontalRule:!1,underline:!1}),i.A,j.Ay.configure({openOnClick:!1,HTMLAttributes:{class:"text-primary underline"}})],content:"",immediatelyRender:!1,editorProps:{attributes:{class:"prose prose-sm sm:prose-base focus:outline-none max-w-none min-h-[64px] max-h-[120px] overflow-y-auto px-3.5 py-3 text-sm"}}}),cH=(0,e.useCallback)(a=>{if(!a)return a;let b=a.trim();return(b=b.replace(/(<p><br\s*\/?><\/p>\s*)+$/gi,"")).replace(/(<p>\s*<\/p>\s*)+$/gi,"")},[]),cI=(0,e.useCallback)(()=>{if(!cC||!aG||!a)return;let b=cH(cC.getHTML());if(!cC.getText().trim())return;let c="client"===(a4?"client":bf)?"CUSTOMER":"TEAM";if("CUSTOMER"===c&&!ci)return void ad.oR.error("You don't have permission to send messages in customer chat");let d=bj?bj.threadId||bj.thread||bj.id:void 0;a1.stopTyping(a.id,c),aG(b,c,d),cC.commands.clearContent(),bk(null),bu(!1),cC.commands.focus()},[cC,aG,bf,bj,a4,a,a1,cH,ci]),cJ=(0,e.useCallback)(a=>{bq(a.id)},[]),cK=(0,e.useCallback)(()=>{if(!cG||!bp||!aH)return;let a=cH(cG.getHTML());if(!cG.getText().trim())return void bq(null);aH(bp,a),bq(null),cG.commands.clearContent()},[cG,bp,aH,cH]),cL=(0,e.useCallback)(()=>{bq(null),cG&&cG.commands.clearContent()},[cG]),cM=(0,e.useCallback)(a=>{bs(a)},[]),cN=(0,e.useCallback)(()=>{br&&aI&&(aI(br),bs(null))},[br,aI]),cO=(0,e.useCallback)(()=>{bs(null)},[]),cP=(0,e.useCallback)(async()=>{if(a){bQ(!0);try{await a0.deleteJob(a.id),bO(!1),aE(!1)}catch(a){}finally{bQ(!1)}}},[a,a0,aE]),cQ=a=>{switch(a){case"image":return(0,d.jsx)(x.A,{className:"size-10 text-muted-foreground"});case"video":return(0,d.jsx)(u.A,{className:"size-10 text-muted-foreground"});case"floor-plan":return(0,d.jsx)(y.A,{className:"size-10 text-muted-foreground"});case"3d-content":return(0,d.jsx)(z.A,{className:"size-10 text-muted-foreground"});default:return(0,d.jsx)(A.A,{className:"size-10 text-muted-foreground"})}},cR=async(b,c)=>{if(!b||!b.allEntries||0===b.allEntries.length||!a)return;let d=a$||a.organizationId;d&&aB.F.organizations.setActiveOrganization(d);let e=[];for(let d of b.allEntries){let b={key:d.uuid||d.fileId||d.cdnUrl,cdnUrl:d.cdnUrl,filename:d.name,size:d.size,type:cA(c)};if(!(!b.key||bZ.current.has(b.key)))try{let c=await aB.F.media.addToProject(a.id,b);e.push(cB(c)),bZ.current.add(b.key)}catch(a){console.error("Failed to register media upload",a),ad.oR.error(`Failed to save ${d?.name||"upload"}`)}}e.length>0&&(by(a=>{let b=[...a];return e.forEach(a=>{b.some(b=>b.id===a.id||b.key===a.key)||b.push(a)}),b}),ad.oR.success(`${e.length} media item${e.length>1?"s":""} added`))},cS=a=>bx.filter(b=>b.type===a),cT=(0,e.useMemo)(()=>bx&&bx.length>0,[bx]),cU=(a=>{switch(a){case"urgent":return{label:"Urgent",color:"text-destructive"};case"rush":return{label:"Rush",color:"text-orange-500"};default:return{label:"Standard",color:"text-primary"}}})(a?.priority||"standard"),cV=(a=>{switch(a){case"pending":return{label:"Pending",bgColor:"bg-status-pending",textColor:"text-status-pending",indicatorColor:"bg-status-pending"};case"assigned":return{label:"Assigned",bgColor:"bg-status-assigned",textColor:"text-status-assigned",indicatorColor:"bg-status-assigned"};case"in_progress":return{label:"In Progress",bgColor:"bg-status-in-progress",textColor:"text-status-in-progress",indicatorColor:"bg-status-in-progress"};case"editing":return{label:"Editing",bgColor:"bg-status-editing",textColor:"text-status-editing",indicatorColor:"bg-status-editing"};case"delivered":return{label:"Delivered",bgColor:"bg-status-delivered",textColor:"text-status-delivered",indicatorColor:"bg-status-delivered"};case"cancelled":return{label:"Cancelled",bgColor:"bg-status-cancelled",textColor:"text-status-cancelled",indicatorColor:"bg-status-cancelled"};default:return{label:a,bgColor:"bg-muted",textColor:"text-muted-foreground",indicatorColor:"bg-muted-foreground"}}})(a?.status||"pending"),cW=a=>{switch(a){case"image":case"floor-plan":return"image/*";case"video":return"video/*";default:return"*"}},cX=a=>{window.open(a.url,"_blank")},cY=async b=>{if(!a||a4||bz.has(b))return;let c=a$||a.organizationId;c&&aB.F.organizations.setActiveOrganization(c),bA(a=>new Set(a).add(b));let d=bx.find(a=>a.id===b);by(a=>a.filter(a=>a.id!==b));try{await aB.F.media.deleteFromProject(a.id,b),d&&(d.url.startsWith("blob:")&&URL.revokeObjectURL(d.url),d.key&&bZ.current.delete(d.key)),ad.oR.success("Media deleted")}catch(a){console.error("Failed to delete media",a),d&&by(a=>[...a,d]),ad.oR.error("Failed to delete media")}finally{bA(a=>{let c=new Set(a);return c.delete(b),c})}},cZ=async(b,c)=>{if(!b.trim()||!a||bB)return;try{new URL(b)}catch{ad.oR.error("Please enter a valid URL");return}let d=b.split("/"),e=d[d.length-1]||"Virtual Tour";bC(!0);try{let d=a$||a.organizationId;if(d&&aB.F.organizations.setActiveOrganization(d),bZ.current.has(b)){ad.oR.success("Media already added"),bI("");return}let f=await aB.F.media.addToProject(a.id,{key:b,cdnUrl:b,filename:e,size:0,type:cA(c)});bZ.current.add(b),by(a=>{let b=cB(f);return a.some(a=>a.id===b.id||a.key===b.key)?a:[...a,b]}),ad.oR.success("Media added")}catch(a){console.error("Failed to save media URL",a),ad.oR.error("Failed to save media URL")}finally{bI(""),bC(!1)}},c$=(a,b)=>{let c=cS(a);return a4&&0===c.length?null:("floor-plan"===a||"3d-content"===a||(a.charAt(0).toUpperCase(),a.slice(1)),"3d-content"===a)?(0,d.jsx)("div",{className:"py-4 space-y-4",children:0===c.length?(0,d.jsx)("div",{className:"space-y-4",children:(0,d.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)(aA.p,{type:"url",placeholder:"Enter 3D model URL (e.g., https://example.com/model.glb)",value:bH,onChange:a=>bI(a.target.value),onKeyDown:a=>{"Enter"!==a.key||a4||bB||cZ(bH,"3d-content")},disabled:a4||bB,className:"flex-1"}),(0,d.jsxs)(o.$,{onClick:()=>cZ(bH,"3d-content"),disabled:!bH.trim()||a4||bB,children:[bB?(0,d.jsx)(B.A,{className:"h-4 w-4 mr-2 animate-spin"}):(0,d.jsx)(C.A,{className:"h-4 w-4 mr-2"}),bB?"Adding...":"Add URL"]})]}),(0,d.jsx)(ae.P,{className:"text-xs text-muted-foreground",children:a4?"Media uploads are not available for agent accounts. You’ll see shared media here once it’s added.":"Enter a URL to a 3D model file (GLB, GLTF, OBJ, FBX, etc.)"})]})}):(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)(ae.P,{className:"text-sm font-medium text-foreground",children:[c.length," ",1===c.length?"item":"items"]}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)(aA.p,{type:"url",placeholder:"Enter 3D model URL",value:bH,onChange:a=>bI(a.target.value),onKeyDown:a=>{"Enter"!==a.key||a4||bB||cZ(bH,"3d-content")},disabled:a4||bB,className:"w-[300px]"}),(0,d.jsxs)(o.$,{onClick:()=>cZ(bH,"3d-content"),disabled:!bH.trim()||a4||bB,variant:"outline",size:"sm",children:[bB?(0,d.jsx)(B.A,{className:"h-4 w-4 mr-2 animate-spin"}):(0,d.jsx)(C.A,{className:"h-4 w-4 mr-2"}),bB?"Adding...":"Add URL"]})]})]}),(0,d.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4",children:c.map((a,b)=>(0,d.jsxs)("div",{className:"group relative aspect-square rounded-lg border border-border overflow-hidden bg-muted hover:border-primary transition-colors",children:[(0,d.jsxs)("div",{className:"size-full flex flex-col items-center justify-center bg-muted p-4",children:[cQ(a.type),(0,d.jsx)(ae.P,{className:"text-xs text-muted-foreground mt-2 text-center line-clamp-2",children:a.name})]}),(0,d.jsx)("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/40 transition-colors flex items-center justify-center opacity-0 group-hover:opacity-100",children:(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)(o.$,{variant:"ghost",size:"icon",className:"h-8 w-8 bg-background/90 hover:bg-background",onClick:()=>cX(a),children:(0,d.jsx)(D.A,{className:"h-4 w-4"})}),!a4&&(0,d.jsx)(o.$,{variant:"ghost",size:"icon",className:"h-8 w-8 bg-background/90 hover:bg-background hover:text-destructive",onClick:()=>cY(a.id),children:(0,d.jsx)(E.A,{className:"h-4 w-4"})})]})}),(0,d.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-2",children:(0,d.jsx)(ae.P,{className:"text-xs text-white truncate",children:a.name})})]},a.id||`media-${b}-${a.url}`))})]})}):0===c.length?a4?null:(0,d.jsx)("div",{className:"py-4 space-y-4",children:("image"===a||"video"===a||"floor-plan"===a||"file"===a)&&(0,d.jsx)("div",{className:"flex flex-col items-center gap-2",children:(0,d.jsx)("div",{onClick:a=>a.stopPropagation(),children:(0,d.jsx)(am.vY,{pubkey:"dbf470d49c954f9f6143",classNameUploader:"uc-light uc-gray",sourceList:"local, camera, gdrive, facebook",userAgentIntegration:"llm-nextjs",filesViewMode:"grid",useCloudImageEditor:!1,accept:cW(a),onChange:b=>void cR(b,a),onCommonUploadSuccess:a=>console.log("Uploaded files URL list",a.successEntries.map(a=>a.cdnUrl))})})})}):(0,d.jsxs)("div",{className:"py-4 space-y-4",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between flex-wrap gap-3",children:[(0,d.jsxs)(ae.P,{className:"text-sm font-medium text-foreground",children:[c.length," ",1===c.length?"item":"items"]}),(0,d.jsx)("div",{className:"flex items-center gap-2 flex-wrap",children:!a4&&("image"===a||"video"===a||"floor-plan"===a||"file"===a)&&(0,d.jsx)("div",{onClick:a=>a.stopPropagation(),children:(0,d.jsx)(am.vY,{pubkey:"dbf470d49c954f9f6143",classNameUploader:"uc-light uc-gray",sourceList:"local, camera, gdrive, facebook",userAgentIntegration:"llm-nextjs",filesViewMode:"grid",useCloudImageEditor:!1,accept:cW(a),onChange:b=>void cR(b,a),onCommonUploadSuccess:a=>console.log("Uploaded files URL list",a.successEntries.map(a=>a.cdnUrl))})})})]}),(0,d.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4",children:c.map((a,b)=>(0,d.jsxs)("div",{className:"group relative aspect-square rounded-lg border border-border overflow-hidden bg-muted hover:border-primary transition-colors",children:[("image"===a.type||"floor-plan"===a.type)&&(0,d.jsx)("img",{src:a.url,alt:a.name,className:"size-full object-cover"}),"video"===a.type&&(0,d.jsx)("div",{className:"size-full flex items-center justify-center bg-muted",children:(0,d.jsx)(u.A,{className:"size-12 text-muted-foreground"})}),("3d-content"===a.type||"file"===a.type)&&(0,d.jsxs)("div",{className:"size-full flex flex-col items-center justify-center bg-muted p-4",children:[cQ(a.type),(0,d.jsx)(ae.P,{className:"text-xs text-muted-foreground mt-2 text-center line-clamp-2",children:a.name})]}),(0,d.jsx)("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/40 transition-colors flex items-center justify-center opacity-0 group-hover:opacity-100",children:(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)(o.$,{variant:"ghost",size:"icon",className:"h-8 w-8 bg-background/90 hover:bg-background",onClick:()=>cX(a),children:(0,d.jsx)(D.A,{className:"h-4 w-4"})}),!a4&&(0,d.jsx)(o.$,{variant:"ghost",size:"icon",className:"h-8 w-8 bg-background/90 hover:bg-background hover:text-destructive",onClick:()=>cY(a.id),children:(0,d.jsx)(E.A,{className:"h-4 w-4"})})]})}),(0,d.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/60 to-transparent p-2",children:(0,d.jsx)(ae.P,{className:"text-xs text-white truncate",children:a.name})})]},a.id||`media-${b}-${a.url}`))})]})},c_=(0,e.useMemo)(()=>ao.map(a=>{let b=a?.user?.accountType==="AGENT"||a?.user?.account_type==="AGENT",c=a?.channel||(b||"client"===a.chatType?"CUSTOMER":"TEAM");return{...a,channel:c,chatType:"CUSTOMER"===c?"client":"team",thread:a.thread??a.threadId??null}}),[ao]),c0=c_.filter(a=>"client"===a.chatType),c1=c_.filter(a=>"team"===a.chatType),c2=a=>{let b=new Map,c=[];a.forEach(a=>{b.set(a.id,{...a,replies:[]})}),b.forEach(a=>{a.thread&&b.has(a.thread)?b.get(a.thread).replies.push(a):c.push(a)});let d=a=>{a.sort((a,b)=>new Date(a.createdAt).getTime()-new Date(b.createdAt).getTime()),a.forEach(a=>d(a.replies))};return d(c),c};(0,e.useMemo)(()=>c2(c0),[c0]),(0,e.useMemo)(()=>c2(c1),[c1]);let[c3,c4]=(0,e.useState)({}),c5=(0,e.useMemo)(()=>{let a=new Map;return ao.forEach(b=>a.set(b.id,b)),a},[ao]),c6=(0,e.useMemo)(()=>{let a=new Map;return ao.forEach(b=>{b.userAvatar&&a.set(b.userId,b.userAvatar)}),a},[ao]),c7=(0,e.useCallback)(a=>{let b=c5.get(a);if(!b)return[];let c=ao.filter(b=>b.threadId===a||b.thread===a),d=new Set;return[b,...c].filter(a=>!d.has(a.id)&&(d.add(a.id),!0)).sort((a,b)=>new Date(a.createdAt).getTime()-new Date(b.createdAt).getTime())},[ao,c5]),c8=(0,e.useCallback)(a=>ao.filter(b=>b.threadId===a||b.thread===a).length,[ao]),c9=(0,e.useMemo)(()=>{let a=new Set;return[...c0].filter(b=>!a.has(b.id)&&(a.add(b.id),!0)).sort((a,b)=>new Date(a.createdAt).getTime()-new Date(b.createdAt).getTime())},[c0]),da=(0,e.useMemo)(()=>{let a=new Set;return[...c1].filter(b=>!a.has(b.id)&&(a.add(b.id),!0)).sort((a,b)=>new Date(a.createdAt).getTime()-new Date(b.createdAt).getTime())},[c1]),db=(0,e.useCallback)((a,b)=>{let c=a1.getMessageReadReceipts(a.id).filter(b=>b.userId!==a.userId);if(0===c.length)return(0,d.jsx)("div",{className:"flex items-center gap-2",children:(0,d.jsx)("span",{className:(0,al.cn)("text-xs",b),children:"Not read yet"})});let e=[...c].sort((a,b)=>new Date(b.readAt).getTime()-new Date(a.readAt).getTime());return(0,d.jsx)("div",{className:"flex flex-col gap-2",children:e.map(a=>{let c=c6.get(a.userId);return(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsxs)(r.eu,{className:"h-4 w-4 border border-background",children:[(0,d.jsx)(r.BK,{src:c,alt:a.userName}),(0,d.jsx)(r.q5,{className:"text-[9px] bg-muted",children:cj(a.userName)})]}),(0,d.jsxs)("div",{className:"flex flex-col",children:[(0,d.jsx)("span",{className:(0,al.cn)("text-[11px]",b),children:a.userName}),(0,d.jsxs)("span",{className:(0,al.cn)("text-[10px]",b),children:["Read ",(0,ac.GP)(new Date(a.readAt),"h:mm a")]})]})]},a.userId)})})},[a1,c6]),dc=(a,b=!0,c=!0)=>{let e=a.userId===ap,g=bp===a.id,h=c8(a.id),i=a.threadId||a.thread,j=i?c5.get(i):null,k=!e&&b;return(0,d.jsxs)("div",{className:(0,al.cn)("flex group",e?"justify-end":"justify-start",b?"mt-3":"mt-0.5"),children:[!e&&(0,d.jsx)("div",{className:"w-8 mr-2 flex-shrink-0 self-end",children:c?(0,d.jsxs)(r.eu,{className:"h-8 w-8",children:[(0,d.jsx)(r.BK,{src:a.userAvatar,alt:a.userName}),(0,d.jsx)(r.q5,{className:"text-xs bg-muted",children:a.userName.split(" ").map(a=>a[0]).join("")})]}):(0,d.jsx)("div",{className:"h-8 w-8"})}),(0,d.jsxs)("div",{className:(0,al.cn)("flex flex-col max-w-[80%]",e?"items-end":"items-start"),children:[(0,d.jsxs)("div",{className:(0,al.cn)("flex items-center gap-1",e?"flex-row-reverse":"flex-row"),children:[(0,d.jsxs)("div",{className:(0,al.cn)("relative px-3 py-2 shadow-sm",e?(0,al.cn)("bg-primary text-primary-foreground",b&&c?"rounded-2xl rounded-br-md":b?"rounded-2xl rounded-br-md rounded-br-md":c?"rounded-2xl rounded-tr-md rounded-br-md":"rounded-2xl rounded-r-md"):(0,al.cn)("bg-muted text-foreground",b&&c||b?"rounded-2xl rounded-bl-md":c?"rounded-2xl rounded-tl-md rounded-bl-md":"rounded-2xl rounded-l-md")),children:[k&&(0,d.jsx)("span",{className:"text-xs font-medium text-primary block mb-1",children:a.userName}),j&&(0,d.jsx)("button",{onClick:()=>bm(j),className:(0,al.cn)("w-full mb-2 p-2 rounded-lg text-left transition-colors",e?"bg-primary-foreground/10 hover:bg-primary-foreground/20":"bg-background/50 hover:bg-background/70"),children:(0,d.jsxs)("div",{className:(0,al.cn)("border-l-2 pl-2",e?"border-primary-foreground/50":"border-primary"),children:[(0,d.jsx)("span",{className:(0,al.cn)("text-xs font-medium block",e?"text-primary-foreground/80":"text-primary"),children:j.userName}),(0,d.jsx)("span",{className:(0,al.cn)("text-xs line-clamp-2",e?"text-primary-foreground/70":"text-muted-foreground"),dangerouslySetInnerHTML:{__html:j.content.replace(/<[^>]*>/g,"").slice(0,100)+(j.content.length>100?"...":"")}})]})}),g?(0,d.jsx)("div",{className:"min-w-[200px]",children:(0,d.jsxs)("div",{className:"bg-background/20 rounded-lg overflow-hidden",children:[(0,d.jsx)(f.$Z,{editor:cG,className:"[&_.ProseMirror]:min-h-[40px] [&_.ProseMirror]:max-h-[100px] [&_.ProseMirror]:overflow-y-auto [&_.ProseMirror]:px-2 [&_.ProseMirror]:py-2 [&_.ProseMirror]:text-sm [&_.ProseMirror]:focus:outline-none"}),(0,d.jsxs)("div",{className:"flex items-center justify-end gap-2 px-2 py-1.5 border-t border-white/10",children:[(0,d.jsx)(o.$,{variant:"ghost",size:"sm",className:"h-6 px-2 text-xs",onClick:cL,children:"Cancel"}),(0,d.jsx)(o.$,{size:"sm",className:"h-6 px-2 text-xs",onClick:cK,disabled:!cG||!bv,children:"Save"})]})]})}):(0,d.jsx)("div",{className:(0,al.cn)("text-sm leading-relaxed prose prose-sm max-w-none","[&_p]:mb-1 [&_p:last-child]:mb-0","[&_strong]:font-semibold [&_em]:italic [&_u]:underline","[&_code]:bg-black/10 [&_code]:px-1 [&_code]:py-0.5 [&_code]:rounded [&_code]:text-xs","[&_ul]:list-disc [&_ul]:ml-4 [&_ol]:list-decimal [&_ol]:ml-4","[&_blockquote]:border-l-2 [&_blockquote]:pl-2 [&_blockquote]:italic",e?"[&_a]:text-primary-foreground [&_a]:underline [&_blockquote]:border-primary-foreground/50":"[&_a]:text-primary [&_a]:underline [&_blockquote]:border-border"),dangerouslySetInnerHTML:{__html:a.content}}),!g&&(0,d.jsxs)("div",{className:(0,al.cn)("flex items-center gap-1 mt-1",e?"justify-end":"justify-start"),children:[(0,d.jsxs)(af.m_,{children:[(0,d.jsx)(af.k$,{asChild:!0,children:(0,d.jsx)("span",{className:(0,al.cn)("text-[10px] cursor-default",e?"text-primary-foreground/70":"text-muted-foreground"),children:(0,ac.GP)(new Date(a.createdAt),"h:mm a")})}),(0,d.jsx)(af.ZI,{side:"top",className:"text-xs",children:(0,ac.GP)(new Date(a.createdAt),"EEEE, MMMM d, yyyy 'at' h:mm a")})]}),e&&(0,d.jsx)(F.A,{className:(0,al.cn)("h-3 w-3","text-primary-foreground/70")})]})]}),!g&&(0,d.jsxs)(ah.rI,{children:[(0,d.jsx)(ah.ty,{asChild:!0,children:(0,d.jsx)("button",{className:(0,al.cn)("flex items-center justify-center h-6 w-6 rounded-full text-muted-foreground hover:text-foreground hover:bg-muted opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0"),children:(0,d.jsx)(G.A,{className:"h-4 w-4"})})}),(0,d.jsxs)(ah.SQ,{align:e?"end":"start",className:"w-48",children:[(0,d.jsxs)(ah._2,{onClick:()=>bk(a),children:[(0,d.jsx)(H.A,{className:"h-4 w-4 mr-2"}),"Reply"]}),(0,d.jsxs)(ah._2,{onClick:()=>{ad.oR.info("Reactions coming soon!")},children:[(0,d.jsx)(I.A,{className:"h-4 w-4 mr-2"}),"React"]}),(0,d.jsxs)(ah.lv,{children:[(0,d.jsxs)(ah.nV,{children:[(0,d.jsx)(J.A,{className:"h-4 w-4 mr-2"}),"Forward"]}),(0,d.jsxs)(ah.M5,{className:"w-48",children:[bc&&"team"!==bf&&(0,d.jsxs)(ah._2,{onClick:()=>{aG&&(aG(`<blockquote class="border-l-2 border-primary pl-2 italic"><p class="text-xs text-muted-foreground mb-1">Forwarded from ${a.userName}:</p>${a.content}</blockquote>`,"TEAM"),ad.oR.success("Message forwarded to Team Chat"))},children:[(0,d.jsx)(K.A,{className:"h-4 w-4 mr-2"}),"Team Chat"]}),"client"!==bf&&ci&&(0,d.jsxs)(ah._2,{onClick:()=>{aG&&(aG(`<blockquote class="border-l-2 border-primary pl-2 italic"><p class="text-xs text-muted-foreground mb-1">Forwarded from ${a.userName}:</p>${a.content}</blockquote>`,"CUSTOMER"),ad.oR.success("Message forwarded to Customer Chat"))},children:[(0,d.jsx)(L.A,{className:"h-4 w-4 mr-2"}),"Customer Chat"]}),(0,d.jsxs)(ah._2,{onClick:()=>{bo(a),ad.oR.info("Direct messages coming soon!")},children:[(0,d.jsx)(M.A,{className:"h-4 w-4 mr-2"}),"Direct Message..."]})]})]}),(0,d.jsx)(ah.mB,{}),(0,d.jsx)(ah._2,{disabled:!0,className:"cursor-default focus:bg-transparent",children:(0,d.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,d.jsx)("span",{className:"text-[11px] text-muted-foreground",children:"Read by"}),db(a,"text-muted-foreground")]})}),e&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(ah.mB,{}),(0,d.jsxs)(ah._2,{onClick:()=>cJ(a),children:[(0,d.jsx)(N.A,{className:"h-4 w-4 mr-2"}),"Edit"]}),(0,d.jsxs)(ah._2,{onClick:()=>cM(a.id),className:"text-destructive focus:text-destructive",children:[(0,d.jsx)(E.A,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]})]}),!g&&h>0&&(0,d.jsxs)("button",{onClick:()=>bm(a),className:(0,al.cn)("flex items-center gap-1 text-xs text-primary hover:underline mt-0.5",e?"self-end mr-1":"self-start ml-1"),children:[(0,d.jsx)(L.A,{className:"h-3 w-3"}),h," ",1===h?"reply":"replies",(0,d.jsx)(O.A,{className:"h-3 w-3"})]})]})]},a.id)},dd=b=>(0,d.jsx)("div",{className:(0,al.cn)("flex items-center justify-between gap-4","sheet"===aV?"sticky top-0 z-50 bg-background/95 backdrop-blur supports-backdrop-filter:bg-background/60":"p-4"),children:(0,d.jsxs)(ar,{size:"sm",variant:"outline",className:"size-full",children:[(0,d.jsx)(at,{className:"",children:(0,d.jsx)(P.A,{className:"size-6"})}),(0,d.jsxs)(au,{className:"",children:[(0,d.jsx)(av,{className:"",children:a?.propertyAddress||"Job"}),!a4&&a?.clientName&&(0,d.jsxs)(aw,{className:"",children:["Customer: ",a.clientName]})]}),(0,d.jsxs)(ax,{className:"",children:[(0,d.jsxs)(ah.rI,{children:[(0,d.jsx)(ah.ty,{asChild:!0,children:(0,d.jsx)(o.$,{variant:"ghost",size:"icon",className:"h-8 w-8",children:(0,d.jsx)(G.A,{className:"h-4 w-4"})})}),(0,d.jsxs)(ah.SQ,{align:"end",className:"w-52",children:[aW&&(0,d.jsxs)(ah._2,{onSelect:a=>{a.preventDefault(),aW&&aW()},className:"cursor-pointer",children:[(0,d.jsx)(D.A,{className:"mr-2 h-4 w-4"}),"View full screen"]}),aX&&(0,d.jsxs)(ah._2,{onSelect:a=>{a.preventDefault(),aX()},className:"cursor-pointer",children:[(0,d.jsx)(Q.A,{className:"mr-2 h-4 w-4"}),"Open in new page"]}),(0,d.jsxs)(ah._2,{onSelect:b=>{b.preventDefault(),(()=>{if(!a)return;let b=`${window.location.origin}/jobs/${a.id}`;navigator.clipboard.writeText(b),ad.oR.success("Link copied to clipboard")})()},className:"cursor-pointer",children:[(0,d.jsx)(C.A,{className:"mr-2 h-4 w-4"}),"Copy link"]}),a?.status==="delivered"&&a?.deliveryToken&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsxs)(ah._2,{onSelect:b=>{b.preventDefault(),window.open(`/delivery/${a.deliveryToken}`,"_blank")},className:"cursor-pointer",children:[(0,d.jsx)(Q.A,{className:"mr-2 h-4 w-4"}),"Open delivery page"]}),(0,d.jsxs)(ah._2,{onSelect:b=>{b.preventDefault();let c=`${window.location.origin}/delivery/${a.deliveryToken}`;navigator.clipboard.writeText(c),ad.oR.success("Delivery link copied to clipboard")},className:"cursor-pointer",children:[(0,d.jsx)(C.A,{className:"mr-2 h-4 w-4"}),"Copy delivery link"]})]}),aJ&&a?.status!=="delivered"&&(0,d.jsxs)(ah._2,{onSelect:a=>{a.preventDefault(),aJ&&aJ("delivered")},className:"cursor-pointer",children:[(0,d.jsx)(R.A,{className:"mr-2 h-4 w-4"}),"Mark as complete"]}),cg&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(ah.mB,{}),(0,d.jsxs)(ah._2,{onSelect:a=>{a.preventDefault(),bO(!0)},className:"cursor-pointer text-destructive focus:text-destructive",children:[(0,d.jsx)(E.A,{className:"mr-2 h-4 w-4"}),"Delete job"]})]}),(ch.canDelete||ch.canCancel)&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(ah.mB,{}),(0,d.jsxs)(ah._2,{onSelect:a=>{a.preventDefault(),bO(!0)},className:"cursor-pointer text-destructive focus:text-destructive",children:[(0,d.jsx)(E.A,{className:"mr-2 h-4 w-4"}),ch.canDelete?"Delete order":"Cancel order"]})]})]})]}),(0,d.jsx)(af.Bc,{children:(0,d.jsxs)(af.m_,{children:[(0,d.jsx)(af.k$,{asChild:!0,children:(0,d.jsx)(o.$,{variant:"ghost",size:"icon",onClick:()=>aE(!1),className:"h-8 w-8",children:"sheet"===aV?(0,d.jsx)(S.A,{className:"h-4 w-4"}):(0,d.jsx)(s.A,{className:"h-4 w-4"})})}),(0,d.jsx)(af.ZI,{children:"Close"})]})})]})]})}),de=a=>{let b=(0,d.jsxs)(d.Fragment,{children:["discussion"===a5&&bd&&(0,d.jsxs)("div",{className:"flex items-center gap-6 mb-4","data-tour":"messaging-tabs",children:[ba&&(0,d.jsxs)(o.$,{variant:"ghost",onClick:()=>bg("client"),className:(0,al.cn)("relative h-8 inline-flex items-center gap-1.5 text-[13px] font-medium transition-colors","client"===bf?"text-foreground":"text-muted-foreground hover:text-foreground"),children:[(0,d.jsx)(L.A,{className:"size-3.5"}),"Customer Chat","client"===bf&&(0,d.jsx)("span",{className:"absolute bottom-[-4px] left-0 right-0 h-0.5 bg-primary rounded-full"})]}),bc&&(0,d.jsxs)(o.$,{variant:"ghost",onClick:()=>bg("team"),className:(0,al.cn)("relative h-8 inline-flex items-center gap-1.5 text-[13px] font-medium transition-colors","team"===bf?"text-foreground":"text-muted-foreground hover:text-foreground"),children:[(0,d.jsx)(M.A,{className:"size-3.5"}),"Team Chat",!aC&&(0,d.jsx)(n.E,{variant:"secondary",className:"ml-1 text-xs h-4 px-1.5",children:"Private"}),"team"===bf&&(0,d.jsx)("span",{className:"absolute bottom-[-4px] left-0 right-0 h-0.5 bg-primary rounded-full"})]})]}),bj&&(0,d.jsxs)("div",{className:"flex items-center justify-between bg-muted p-3 rounded-lg text-sm mb-sm",children:[(0,d.jsxs)("span",{className:"text-muted-foreground",children:["Replying to ",bj.userName]}),(0,d.jsx)(o.$,{variant:"ghost",size:"sm",onClick:()=>bk(null),className:"h-6 text-xs",children:"Cancel"})]}),bi.length>0&&(0,d.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground mb-2",children:[(0,d.jsx)(aP,{}),(0,d.jsx)("span",{children:0===bi.length?"":1===bi.length?`${bi[0].userName} is typing...`:2===bi.length?`${bi[0].userName} and ${bi[1].userName} are typing...`:`${bi[0].userName} and ${bi.length-1} others are typing...`})]}),(0,d.jsx)("div",{className:"flex flex-col gap-0","data-tour":"messaging-compose",children:(0,d.jsxs)("div",{className:"flex items-start gap-3",children:[(0,d.jsxs)(r.eu,{className:"h-8 w-8 shrink-0",children:[(0,d.jsx)(r.BK,{src:a2,alt:aq}),(0,d.jsx)(r.q5,{className:"bg-primary text-primary-foreground text-xs",children:aq.split(" ").map(a=>a[0]).join("")})]}),(0,d.jsxs)("div",{className:"flex-1 relative bg-muted/50 border border-border rounded-2xl overflow-hidden flex flex-col",children:[(0,d.jsx)(f.$Z,{editor:cC,className:"[&_.ProseMirror]:min-h-[64px] [&_.ProseMirror]:max-h-[200px] [&_.ProseMirror]:overflow-y-auto [&_.ProseMirror]:px-3.5 [&_.ProseMirror]:py-3 [&_.ProseMirror]:text-sm [&_.ProseMirror]:text-foreground [&_.ProseMirror]:focus:outline-none [&_.ProseMirror]:prose [&_.ProseMirror]:prose-sm [&_.ProseMirror]:max-w-none [&_.ProseMirror_p.is-editor-empty:first-child::before]:content-[attr(data-placeholder)] [&_.ProseMirror_p.is-editor-empty:first-child::before]:text-muted-foreground [&_.ProseMirror_p.is-editor-empty:first-child::before]:float-left [&_.ProseMirror_p.is-editor-empty:first-child::before]:pointer-events-none [&_.ProseMirror_p.is-editor-empty:first-child::before]:h-0 [&_.ProseMirror_strong]:font-semibold [&_.ProseMirror_em]:italic [&_.ProseMirror_u]:underline"}),(0,d.jsxs)("div",{className:"flex items-center justify-between px-3.5 py-2 border-t border-border/40",children:[cb?(0,d.jsxs)(ai.AM,{children:[(0,d.jsx)(ai.Wv,{asChild:!0,children:(0,d.jsx)(o.$,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 hover:bg-muted",disabled:!cC||aC&&"team"===bf,children:(0,d.jsx)(G.A,{className:"size-3.5 text-foreground"})})}),(0,d.jsx)(ai.hl,{className:"w-auto p-2",align:"start",children:(0,d.jsxs)("div",{className:"flex flex-wrap items-center gap-1",children:[(0,d.jsx)(o.$,{variant:"ghost",size:"sm",className:(0,al.cn)("h-7 w-7 p-0 hover:bg-muted",cC?.isActive("bold")&&"bg-muted border border-primary"),onClick:()=>cC?.chain().focus().toggleBold().run(),disabled:!cC||aC&&"team"===bf,children:(0,d.jsx)(T.A,{className:"size-3.5 text-foreground"})}),(0,d.jsx)(o.$,{variant:"ghost",size:"sm",className:(0,al.cn)("h-7 w-7 p-0 hover:bg-muted",cC?.isActive("italic")&&"bg-muted border border-primary"),onClick:()=>cC?.chain().focus().toggleItalic().run(),disabled:!cC||aC&&"team"===bf,children:(0,d.jsx)(U.A,{className:"size-3.5 text-foreground"})}),(0,d.jsx)(o.$,{variant:"ghost",size:"sm",className:(0,al.cn)("h-7 w-7 p-0 hover:bg-muted",cC?.isActive("underline")&&"bg-muted border border-primary"),onClick:()=>cC?.chain().focus().toggleUnderline().run(),disabled:!cC||aC&&"team"===bf,children:(0,d.jsx)(V.A,{className:"size-3.5 text-foreground"})}),(0,d.jsx)(o.$,{variant:"ghost",size:"sm",className:(0,al.cn)("h-7 w-7 p-0 hover:bg-muted",cC?.isActive("strike")&&"bg-muted border border-primary"),onClick:()=>cC?.chain().focus().toggleStrike().run(),disabled:!cC||aC&&"team"===bf,children:(0,d.jsx)(W.A,{className:"size-3.5 text-foreground"})}),(0,d.jsx)("div",{className:"h-4 w-px bg-border mx-0.5"}),(0,d.jsx)(o.$,{variant:"ghost",size:"sm",className:(0,al.cn)("h-7 w-7 p-0 hover:bg-muted",cC?.isActive("bulletList")&&"bg-muted border border-primary"),onClick:()=>cC?.chain().focus().toggleBulletList().run(),disabled:!cC||aC&&"team"===bf,children:(0,d.jsx)(X.A,{className:"size-3.5 text-foreground"})}),(0,d.jsx)(o.$,{variant:"ghost",size:"sm",className:(0,al.cn)("h-7 w-7 p-0 hover:bg-muted",cC?.isActive("orderedList")&&"bg-muted border border-primary"),onClick:()=>cC?.chain().focus().toggleOrderedList().run(),disabled:!cC||aC&&"team"===bf,children:(0,d.jsx)(Y.A,{className:"size-3.5 text-foreground"})}),(0,d.jsx)(o.$,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 hover:bg-muted",onClick:()=>cC?.chain().focus().liftListItem("listItem").run(),disabled:!cC||aC&&"team"===bf,children:(0,d.jsx)(Z.A,{className:"size-3.5 text-foreground"})}),(0,d.jsx)("div",{className:"h-4 w-px bg-border mx-0.5"}),(0,d.jsx)(o.$,{variant:"ghost",size:"sm",className:(0,al.cn)("h-7 w-7 p-0 hover:bg-muted",cC?.isActive("codeBlock")&&"bg-muted border border-primary"),onClick:()=>cC?.chain().focus().toggleCodeBlock().run(),disabled:!cC||aC&&"team"===bf,children:(0,d.jsx)($.A,{className:"size-3.5 text-foreground"})}),(0,d.jsx)(o.$,{variant:"ghost",size:"sm",className:(0,al.cn)("h-7 w-7 p-0 hover:bg-muted",cC?.isActive("blockquote")&&"bg-muted border border-primary"),onClick:()=>cC?.chain().focus().toggleBlockquote().run(),disabled:!cC||aC&&"team"===bf,children:(0,d.jsx)(_.A,{className:"size-3.5 text-foreground"})}),(0,d.jsx)(o.$,{variant:"ghost",size:"sm",className:(0,al.cn)("h-7 w-7 p-0 hover:bg-muted",cC?.isActive("link")&&"bg-muted border border-primary"),onClick:()=>{let a=cC?.getAttributes("link").href,b=window.prompt("Enter URL:",a);if(null!==b){if(""===b)return void cC?.chain().focus().extendMarkRange("link").unsetLink().run();cC?.chain().focus().extendMarkRange("link").setLink({href:b}).run()}},disabled:!cC||aC&&"team"===bf,children:(0,d.jsx)(C.A,{className:"size-3.5 text-foreground"})})]})})]}):(0,d.jsxs)("div",{className:"flex items-center gap-1",children:[(0,d.jsx)(o.$,{variant:"ghost",size:"sm",className:(0,al.cn)("h-7 w-7 p-0 hover:bg-muted",cC?.isActive("bold")&&"bg-muted border border-primary"),onClick:()=>cC?.chain().focus().toggleBold().run(),disabled:!cC||aC&&"team"===bf,children:(0,d.jsx)(T.A,{className:"size-3.5 text-foreground"})}),(0,d.jsx)(o.$,{variant:"ghost",size:"sm",className:(0,al.cn)("h-7 w-7 p-0 hover:bg-muted",cC?.isActive("italic")&&"bg-muted border border-primary"),onClick:()=>cC?.chain().focus().toggleItalic().run(),disabled:!cC||aC&&"team"===bf,children:(0,d.jsx)(U.A,{className:"size-3.5 text-foreground"})}),(0,d.jsx)(o.$,{variant:"ghost",size:"sm",className:(0,al.cn)("h-7 w-7 p-0 hover:bg-muted",cC?.isActive("underline")&&"bg-muted border border-primary"),onClick:()=>cC?.chain().focus().toggleUnderline().run(),disabled:!cC||aC&&"team"===bf,children:(0,d.jsx)(V.A,{className:"size-3.5 text-foreground"})}),(0,d.jsx)(o.$,{variant:"ghost",size:"sm",className:(0,al.cn)("h-7 w-7 p-0 hover:bg-muted",cC?.isActive("strike")&&"bg-muted border border-primary"),onClick:()=>cC?.chain().focus().toggleStrike().run(),disabled:!cC||aC&&"team"===bf,children:(0,d.jsx)(W.A,{className:"size-3.5 text-foreground"})}),(0,d.jsx)("div",{className:"h-4 w-px bg-border mx-0.5"}),(0,d.jsx)(o.$,{variant:"ghost",size:"sm",className:(0,al.cn)("h-7 w-7 p-0 hover:bg-muted",cC?.isActive("bulletList")&&"bg-muted border border-primary"),onClick:()=>cC?.chain().focus().toggleBulletList().run(),disabled:!cC||aC&&"team"===bf,children:(0,d.jsx)(X.A,{className:"size-3.5 text-foreground"})}),(0,d.jsx)(o.$,{variant:"ghost",size:"sm",className:(0,al.cn)("h-7 w-7 p-0 hover:bg-muted",cC?.isActive("orderedList")&&"bg-muted border border-primary"),onClick:()=>cC?.chain().focus().toggleOrderedList().run(),disabled:!cC||aC&&"team"===bf,children:(0,d.jsx)(Y.A,{className:"size-3.5 text-foreground"})}),(0,d.jsx)(o.$,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 hover:bg-muted",onClick:()=>cC?.chain().focus().liftListItem("listItem").run(),disabled:!cC||aC&&"team"===bf,children:(0,d.jsx)(Z.A,{className:"size-3.5 text-foreground"})}),(0,d.jsx)("div",{className:"h-4 w-px bg-border mx-0.5"}),(0,d.jsx)(o.$,{variant:"ghost",size:"sm",className:(0,al.cn)("h-7 w-7 p-0 hover:bg-muted",cC?.isActive("codeBlock")&&"bg-muted border border-primary"),onClick:()=>cC?.chain().focus().toggleCodeBlock().run(),disabled:!cC||aC&&"team"===bf,children:(0,d.jsx)($.A,{className:"size-3.5 text-foreground"})}),(0,d.jsx)(o.$,{variant:"ghost",size:"sm",className:(0,al.cn)("h-7 w-7 p-0 hover:bg-muted",cC?.isActive("blockquote")&&"bg-muted border border-primary"),onClick:()=>cC?.chain().focus().toggleBlockquote().run(),disabled:!cC||aC&&"team"===bf,children:(0,d.jsx)(_.A,{className:"size-3.5 text-foreground"})}),(0,d.jsx)(o.$,{variant:"ghost",size:"sm",className:(0,al.cn)("h-7 w-7 p-0 hover:bg-muted",cC?.isActive("link")&&"bg-muted border border-primary"),onClick:()=>{let a=cC?.getAttributes("link").href,b=window.prompt("Enter URL:",a);if(null!==b){if(""===b)return void cC?.chain().focus().extendMarkRange("link").unsetLink().run();cC?.chain().focus().extendMarkRange("link").setLink({href:b}).run()}},disabled:!cC||aC&&"team"===bf,children:(0,d.jsx)(C.A,{className:"size-3.5 text-foreground"})})]}),(0,d.jsxs)(af.m_,{children:[(0,d.jsx)(af.k$,{asChild:!0,children:(0,d.jsx)("span",{children:(0,d.jsx)(o.$,{onClick:cI,disabled:!cC||!bt||aC&&"team"===bf||"client"===bf&&!ci,className:"h-[34px] px-[18px] rounded-full bg-primary text-primary-foreground hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed",children:(0,d.jsx)("span",{className:"text-sm font-medium",children:"Comment"})})})}),"client"===bf&&!ci&&(0,d.jsx)(af.ZI,{children:(0,d.jsx)("p",{children:"You can only write to customer chat on projects you manage"})})]})]})]})]})})]});return"page"===aV?(0,d.jsx)("div",{className:"flex flex-col border-t p-4 md:p-6 pt-0 gap-0 bg-background",children:b}):(0,d.jsx)(a,{className:"flex flex-col! border-t p-4 md:p-6 pt-0 gap-0",children:b})},df=()=>(0,d.jsx)(d.Fragment,{children:(0,d.jsx)("div",{ref:ca,className:(0,al.cn)("h-full overflow-y-auto","dialog"===aV?"max-h-[calc(90vh-200px)]":"page"===aV?"h-full":"flex-1"),children:(0,d.jsxs)(ay.tU,{defaultValue:"task",className:"gap-0 size-full px-4 md:px-8",children:[(0,d.jsxs)(ay.j7,{className:"grid w-full grid-cols-2 mt-6",children:[(0,d.jsx)(ay.Xi,{value:"task",onClick:()=>a6("discussion"),className:"flex items-center gap-2 cursor-pointer",children:"Task"}),(0,d.jsx)(ay.Xi,{value:"media",onClick:()=>a6("media"),className:"flex items-center gap-2 cursor-pointer",children:"Media"})]}),(0,d.jsx)(ay.av,{value:"task",className:"mt-0",children:(0,d.jsxs)("div",{className:"py-6 space-y-6",children:[(0,d.jsxs)("div",{className:"grid grid-cols-[minmax(0,140px)_1fr] gap-y-3.5",children:[(0,d.jsx)("div",{className:"text-[13px] font-medium text-muted-foreground tracking-wide self-center",children:"Address"}),(0,d.jsx)("div",{className:"text-sm font-medium text-foreground",children:a?.propertyAddress||"—"}),a4&&a?.organizationName&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"text-[13px] font-medium text-muted-foreground tracking-wide self-center",children:"Provider"}),(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[a.organizationLogoUrl&&(0,d.jsxs)(r.eu,{className:"h-6 w-6",children:[(0,d.jsx)(r.BK,{src:a.organizationLogoUrl,alt:a.organizationName}),(0,d.jsx)(r.q5,{className:"text-[10px] bg-muted",children:a.organizationName.charAt(0).toUpperCase()})]}),(0,d.jsx)("span",{className:"text-sm font-medium text-foreground",children:a.organizationName})]})]}),!a4&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"text-[13px] font-medium text-muted-foreground tracking-wide self-center",children:"Customer"}),(0,d.jsx)("div",{className:"flex items-center",children:ck({isAssigned:"Unassigned"!==cu,name:cu,avatar:cp?.avatar??void 0,label:"Assign Customer",onClear:cp?()=>cD(""):void 0,canEdit:cf,disabled:b4,children:(0,d.jsxs)(ah.SQ,{align:"start",className:"w-72 max-h-[300px] overflow-y-auto p-0",children:[(0,d.jsx)("div",{className:"px-2 py-2 sticky top-0 bg-background z-10",children:(0,d.jsx)(aA.p,{placeholder:"Search customers...",value:b$,onChange:a=>b_(a.target.value),autoFocus:!0})}),(0,d.jsx)(ah.mB,{className:"mb-0"}),cm.map(a=>(0,d.jsxs)(ah._2,{onSelect:b=>{b.preventDefault(),cD(a.id)},className:"flex items-center gap-2",children:[(0,d.jsxs)(r.eu,{className:"h-8 w-8",children:[(0,d.jsx)(r.BK,{src:a.avatar??void 0,alt:a.name}),(0,d.jsx)(r.q5,{className:"text-xs bg-muted",children:cj(a.name)})]}),(0,d.jsxs)("div",{className:"flex flex-col",children:[(0,d.jsx)("span",{className:"text-sm font-medium",children:a.name}),a.email&&(0,d.jsx)("span",{className:"text-xs text-muted-foreground",children:a.email})]})]},a.id)),0===cm.length&&(0,d.jsx)(ah._2,{disabled:!0,children:"No customers found"})]})})})]}),!bb&&(!a4||"Unassigned"!==cv)&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"text-[13px] font-medium text-muted-foreground tracking-wide self-center",children:"PM Assigned"}),(0,d.jsx)("div",{className:"flex items-center",children:ck({isAssigned:"Unassigned"!==cv,name:cv,avatar:cx,label:"Assign PM",onClear:cq?()=>cE(""):void 0,canEdit:ce,disabled:b4,children:(0,d.jsxs)(ah.SQ,{align:"start",className:"w-72 max-h-[300px] overflow-y-auto p-0",children:[(0,d.jsx)("div",{className:"px-2 py-2 sticky top-0 bg-background z-10",children:(0,d.jsx)(aA.p,{placeholder:"Search project managers...",value:b0,onChange:a=>b1(a.target.value),autoFocus:!0})}),(0,d.jsx)(ah.mB,{className:"mb-0"}),cn.map(a=>{let b=a.user?.id||a.userId,c=a.user?.name||a.personalOrg?.legalName||a.user?.email||"Assigned",e=a.user?.avatarUrl;return(0,d.jsxs)(ah._2,{onSelect:a=>{a.preventDefault(),b&&cE(b)},className:"flex items-center gap-2",children:[(0,d.jsxs)(r.eu,{className:"h-8 w-8",children:[(0,d.jsx)(r.BK,{src:e,alt:c}),(0,d.jsx)(r.q5,{className:"text-xs bg-muted",children:cj(c)})]}),(0,d.jsxs)("div",{className:"flex flex-col",children:[(0,d.jsx)("span",{className:"text-sm font-medium",children:c}),a.user?.email&&(0,d.jsx)("span",{className:"text-xs text-muted-foreground",children:a.user.email})]})]},a.id)}),0===cn.length&&(0,d.jsx)(ah._2,{disabled:!0,children:"No project managers available"})]})})})]}),!bb&&(!a4||ct)&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"text-[13px] font-medium text-muted-foreground tracking-wide self-center",children:"Tech Assigned"}),(0,d.jsx)("div",{className:"flex items-center",children:cd&&!a4?(0,d.jsxs)("div",{className:"flex items-center gap-1",children:[(0,d.jsxs)("button",{onClick:ct?aR:aQ,className:(0,al.cn)("flex items-center gap-2 px-2 py-1 -ml-2 rounded-md transition-colors","hover:bg-muted/50 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-1"),disabled:ct?a?.status!=="assigned"&&a?.status!=="in_progress":!aQ,children:[(0,d.jsx)(r.eu,{className:"h-7 w-7",children:ct?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(r.BK,{src:ct.avatarUrl,alt:ct.name}),(0,d.jsx)(r.q5,{className:"text-xs bg-muted-foreground/20",children:cj(ct.name)})]}):(0,d.jsx)(r.q5,{className:"text-xs bg-transparent border-2 border-secondary border-dashed"})}),(0,d.jsx)("span",{className:(0,al.cn)("text-sm",ct?"text-foreground":"text-muted-foreground"),children:ct?ct.name:"Assign Technician"})]}),ct&&aR&&(a?.status==="assigned"||a?.status==="in_progress")&&(0,d.jsx)("button",{onClick:a=>{a.stopPropagation(),aR()},className:(0,al.cn)("flex items-center justify-center size-5 rounded-full transition-colors","text-muted-foreground hover:text-foreground hover:bg-muted/80","focus:outline-none focus:ring-2 focus:ring-ring"),children:(0,d.jsx)(s.A,{className:"size-3"})})]}):(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)(r.eu,{className:"h-7 w-7",children:ct?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(r.BK,{src:ct.avatarUrl,alt:ct.name}),(0,d.jsx)(r.q5,{className:"text-xs bg-muted-foreground/20",children:cj(ct.name)})]}):(0,d.jsx)(r.q5,{className:"text-xs bg-transparent border-2 border-secondary border-dashed"})}),(0,d.jsx)("span",{className:"text-sm text-muted-foreground",children:ct?ct.name:"Unassigned"})]})})]}),!a4&&!bb&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"text-[13px] font-medium text-muted-foreground tracking-wide self-center",children:"Editor Assigned"}),(0,d.jsx)("div",{className:"flex items-center",children:ck({isAssigned:"Unassigned"!==cw,name:cw,avatar:cy,label:"Assign Editor",onClear:cr?()=>cF(""):void 0,canEdit:cd,disabled:b4,children:(0,d.jsxs)(ah.SQ,{align:"start",className:"w-72 max-h-[300px] overflow-y-auto p-0",children:[(0,d.jsx)("div",{className:"px-2 py-2 sticky top-0 bg-background z-10",children:(0,d.jsx)(aA.p,{placeholder:"Search editors...",value:b2,onChange:a=>b3(a.target.value),autoFocus:!0})}),(0,d.jsx)(ah.mB,{className:"mb-0"}),co.map(a=>{let b=a.user?.id||a.userId,c=a.user?.name||a.personalOrg?.legalName||"Unassigned",e=a.user?.avatarUrl;return(0,d.jsxs)(ah._2,{onSelect:a=>{a.preventDefault(),b&&cF(b)},className:"flex items-center gap-2",children:[(0,d.jsxs)(r.eu,{className:"h-8 w-8",children:[(0,d.jsx)(r.BK,{src:e,alt:c}),(0,d.jsx)(r.q5,{className:"text-xs bg-muted",children:cj(c)})]}),(0,d.jsxs)("div",{className:"flex flex-col",children:[(0,d.jsx)("span",{className:"text-sm font-medium",children:c}),a.user?.email&&(0,d.jsx)("span",{className:"text-xs text-muted-foreground",children:a.user.email})]})]},a.id)}),0===co.length&&(0,d.jsx)(ah._2,{disabled:!0,children:"No editors available"})]})})})]}),(0,d.jsx)("div",{className:"text-[13px] font-medium text-muted-foreground tracking-wide self-center",children:"Schedule Date"}),(0,d.jsx)("div",{className:"text-sm text-muted-foreground",children:a?.scheduledDate?(0,ac.GP)(new Date(a.scheduledDate),"d MMMM yyyy"):"Not scheduled"}),(0,d.jsx)("div",{className:"text-[13px] font-medium text-muted-foreground tracking-wide self-center","data-tour":"job-status-section",children:"Status"}),(0,d.jsx)("div",{"data-tour":"job-status-section",children:(0,d.jsxs)(n.E,{variant:"flat",className:"flex items-center gap-1.5 mb-1 px-0",children:[(0,d.jsx)("div",{className:(0,al.cn)("size-1.5 rounded-full",cV.indicatorColor)}),(0,d.jsx)("span",{className:(0,al.cn)("text-[13px] font-medium",cV.textColor),children:cV.label})]})}),!a4&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"text-[13px] font-medium text-muted-foreground tracking-wide self-center",children:"Delivery"}),(0,d.jsx)("div",{children:(0,d.jsx)(aK,{projectId:a?.id||"",projectStatus:a?.status||"",canManageDelivery:cc,variant:"inline"})})]}),a4&&a?.status?.toLowerCase()==="delivered"&&a?.deliveryToken&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"text-[13px] font-medium text-muted-foreground tracking-wide self-center",children:"Delivery"}),(0,d.jsx)("div",{className:"flex items-center gap-2",children:(0,d.jsxs)(o.$,{variant:"outline",size:"sm",className:"h-7 gap-1.5",onClick:()=>window.open(`/delivery/${a.deliveryToken}`,"_blank"),children:[(0,d.jsx)(Q.A,{className:"h-3.5 w-3.5"}),"View Delivery"]})})]}),(0,d.jsx)("div",{className:"text-[13px] font-medium text-muted-foreground tracking-wide self-center",children:"Tags"}),(0,d.jsx)("div",{className:"flex flex-wrap items-center gap-2",children:(a?.mediaType||[]).map((a,b)=>{let c=(a=>{switch(a){case"photo":default:return t.A;case"video":return u.A;case"aerial":return v.A;case"twilight":return w.A}})(a);return(0,d.jsxs)(n.E,{variant:"muted",children:[(0,d.jsx)(c,{className:"h-3 w-3"}),a.charAt(0).toUpperCase()+a.slice(1)]},a)})}),(0,d.jsx)("div",{className:"text-[13px] font-medium text-muted-foreground tracking-wide self-center",children:"Priority"}),(0,d.jsx)("div",{className:(0,al.cn)("text-[13px] font-medium",cU.color),children:cU.label})]}),(0,d.jsx)("div",{className:"space-y-4",children:(0,d.jsxs)("div",{className:"flex items-center gap-6 border-b border-border pt-2 pb-1",children:[(0,d.jsxs)(o.$,{variant:"ghost",size:cb?"icon":"default",onClick:()=>a6("description"),className:(0,al.cn)("relative h-8 inline-flex items-center gap-1.5 text-[13px] font-medium transition-colors","description"===a5?"text-foreground":"text-muted-foreground hover:text-foreground"),children:[(0,d.jsx)(y.A,{className:"size-3.5"}),(0,d.jsx)("span",{className:"hidden md:block",children:"Description"}),"description"===a5&&(0,d.jsx)("span",{className:"absolute bottom-[-4px] left-0 right-0 h-0.5 bg-primary rounded-full"})]}),(0,d.jsxs)(o.$,{variant:"ghost",size:cb?"icon":"default",onClick:()=>a6("discussion"),className:(0,al.cn)("relative h-8 inline-flex items-center gap-1.5 text-[13px] font-medium transition-colors","discussion"===a5?"text-foreground":"text-muted-foreground hover:text-foreground"),children:[(0,d.jsx)(L.A,{className:"size-3.5"}),(0,d.jsx)("span",{className:"hidden md:block",children:"Discussion"}),"discussion"===a5&&(0,d.jsx)("span",{className:"absolute bottom-[-4px] left-0 right-0 h-0.5 bg-primary rounded-full"})]})]})}),(0,d.jsxs)("div",{className:"pt-4 space-y-4",children:["description"===a5&&(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)(ae.H4,{className:"text-sm font-semibold text-muted-foreground mb-2",children:"Location"}),(0,d.jsx)(ae.P,{className:"text-sm",children:a?.propertyAddress||"—"})]}),(0,d.jsx)(q.w,{}),(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{children:[(0,d.jsxs)(ae.H4,{className:"text-sm font-semibold text-muted-foreground mb-2 flex items-center gap-2",children:[(0,d.jsx)(aa.A,{className:"h-4 w-4"}),"Date"]}),(0,d.jsx)(ae.P,{className:"text-sm",children:a?.scheduledDate?(()=>{let[b,c,d]=a.scheduledDate.split("-").map(Number),e=new Date(b,c-1,d);return(0,ac.GP)(e,"MMM d, yyyy")})():"Not scheduled"})]}),(0,d.jsxs)("div",{children:[(0,d.jsxs)(ae.H4,{className:"text-sm font-semibold text-muted-foreground mb-2 flex items-center gap-2",children:[(0,d.jsx)(ab.A,{className:"h-4 w-4"}),"Time"]}),(0,d.jsx)(ae.P,{className:"text-sm",children:a?.scheduledTime&&a?.estimatedDuration?(()=>{let b=a.estimatedDuration||60,[c,d,e]=a.scheduledDate.split("-").map(Number),[f,g]=a.scheduledTime.split(":").map(Number),h=new Date(c,d-1,e,f||0,g||0,0,0),i=new Date(h.getTime()+60*b*1e3);Intl.DateTimeFormat().resolvedOptions().timeZone;let j=new Date().toLocaleTimeString("en-US",{timeZoneName:"short"}).split(" ").pop()||"";return`${(0,ac.GP)(h,"h:mm a")} - ${(0,ac.GP)(i,"h:mm a")} ${j}`})():a?.scheduledTime||"Not scheduled"})]})]}),a?.requirements&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(q.w,{}),(0,d.jsxs)("div",{children:[(0,d.jsx)(ae.H4,{className:"text-sm font-semibold text-muted-foreground mb-2",children:"Requirements"}),(0,d.jsx)(ae.P,{className:"text-sm whitespace-pre-wrap",children:a.requirements})]})]})]}),"discussion"===a5&&(0,d.jsx)("div",{className:"flex flex-col gap-4",children:a3?(0,d.jsxs)("div",{className:"flex flex-col gap-4 py-4 min-h-[400px]",children:[(0,d.jsxs)("div",{className:"flex gap-3",children:[(0,d.jsx)(p.E,{className:"size-8 rounded-full shrink-0"}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)(p.E,{className:"h-4 w-24"}),(0,d.jsx)(p.E,{className:"h-16 w-64 rounded-xl"})]})]}),(0,d.jsx)("div",{className:"flex gap-3 justify-end",children:(0,d.jsxs)("div",{className:"space-y-2 flex flex-col items-end",children:[(0,d.jsx)(p.E,{className:"h-4 w-20"}),(0,d.jsx)(p.E,{className:"h-12 w-48 rounded-xl"})]})}),(0,d.jsxs)("div",{className:"flex gap-3",children:[(0,d.jsx)(p.E,{className:"size-8 rounded-full shrink-0"}),(0,d.jsxs)("div",{className:"space-y-2",children:[(0,d.jsx)(p.E,{className:"h-4 w-28"}),(0,d.jsx)(p.E,{className:"h-20 w-72 rounded-xl"})]})]}),(0,d.jsx)("div",{className:"flex gap-3 justify-end",children:(0,d.jsxs)("div",{className:"space-y-2 flex flex-col items-end",children:[(0,d.jsx)(p.E,{className:"h-4 w-16"}),(0,d.jsx)(p.E,{className:"h-10 w-40 rounded-xl"})]})})]}):"client"===bf?(0,d.jsx)(aj.F,{className:"flex-1 pr-2 min-h-[400px]",children:(0,d.jsx)("div",{children:0===c9.length?(0,d.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,d.jsx)(L.A,{className:"h-12 w-12 text-muted-foreground/30 mb-3"}),(0,d.jsx)("p",{className:"text-sm text-muted-foreground",children:a4?"No messages yet":"No messages in customer chat yet"}),(0,d.jsx)("p",{className:"text-xs text-muted-foreground/70 mt-1",children:"Start the conversation below"})]}):c9.map((a,b,c)=>{let d=b>0?c[b-1]:null,e=b<c.length-1?c[b+1]:null,f=!d||d.userId!==a.userId,g=!e||e.userId!==a.userId;return dc(a,f,g)})})}):(0,d.jsx)(aj.F,{className:"flex-1 pr-2 min-h-[400px]",children:(0,d.jsx)("div",{children:0===da.length?(0,d.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[(0,d.jsx)(L.A,{className:"h-12 w-12 text-muted-foreground/30 mb-3"}),(0,d.jsx)("p",{className:"text-sm text-muted-foreground",children:"No messages in team chat yet"}),(0,d.jsx)("p",{className:"text-xs text-muted-foreground/70 mt-1",children:"Start the conversation below"})]}):da.map((a,b,c)=>{let d=b>0?c[b-1]:null,e=b<c.length-1?c[b+1]:null,f=!d||d.userId!==a.userId,g=!e||e.userId!==a.userId;return dc(a,f,g)})})})}),"attachments"===a5&&(0,d.jsx)("div",{className:"text-center py-12 text-muted-foreground text-sm",children:"No attachments yet"})]})]})}),(0,d.jsx)(ay.av,{value:"media",className:"mt-0",children:(0,d.jsx)("div",{className:"py-6",children:bD?(0,d.jsxs)("div",{className:"flex items-center justify-center gap-2 text-sm text-muted-foreground py-12",children:[(0,d.jsx)(B.A,{className:"h-4 w-4 animate-spin"}),"Loading media..."]}):a4&&!cT?(0,d.jsx)("div",{className:"text-sm text-muted-foreground text-center py-12",children:"No media has been uploaded yet. You’ll see photos, videos, and files here once they’re added."}):(0,d.jsxs)(az.nD,{type:"multiple",className:"w-full space-y-2",children:[(!a4||cS("image").length>0)&&(0,d.jsxs)(az.As,{value:"images",className:"border rounded-lg px-4",children:[(0,d.jsx)(az.$m,{className:"hover:no-underline",children:(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[(0,d.jsx)(x.A,{className:"h-5 w-5 text-muted-foreground"}),(0,d.jsx)("span",{className:"font-medium",children:"Images"}),cS("image").length>0&&(0,d.jsx)(n.E,{variant:"secondary",className:"ml-2",children:cS("image").length})]})}),(0,d.jsx)(az.ub,{children:c$("image",b6)})]}),(!a4||cS("video").length>0)&&(0,d.jsxs)(az.As,{value:"videos",className:"border rounded-lg px-4",children:[(0,d.jsx)(az.$m,{className:"hover:no-underline",children:(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[(0,d.jsx)(u.A,{className:"h-5 w-5 text-muted-foreground"}),(0,d.jsx)("span",{className:"font-medium",children:"Videos"}),cS("video").length>0&&(0,d.jsx)(n.E,{variant:"secondary",className:"ml-2",children:cS("video").length})]})}),(0,d.jsx)(az.ub,{children:c$("video",b7)})]}),(!a4||cS("floor-plan").length>0)&&(0,d.jsxs)(az.As,{value:"floor-plans",className:"border rounded-lg px-4",children:[(0,d.jsx)(az.$m,{className:"hover:no-underline",children:(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[(0,d.jsx)(y.A,{className:"h-5 w-5 text-muted-foreground"}),(0,d.jsx)("span",{className:"font-medium",children:"Floor Plans"}),cS("floor-plan").length>0&&(0,d.jsx)(n.E,{variant:"secondary",className:"ml-2",children:cS("floor-plan").length})]})}),(0,d.jsx)(az.ub,{children:c$("floor-plan",b8)})]}),(!a4||cS("3d-content").length>0)&&(0,d.jsxs)(az.As,{value:"3d-content",className:"border rounded-lg px-4",children:[(0,d.jsx)(az.$m,{className:"hover:no-underline",children:(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[(0,d.jsx)(z.A,{className:"h-5 w-5 text-muted-foreground"}),(0,d.jsx)("span",{className:"font-medium",children:"Virtual Tours"}),cS("3d-content").length>0&&(0,d.jsx)(n.E,{variant:"secondary",className:"ml-2",children:cS("3d-content").length})]})}),(0,d.jsx)(az.ub,{children:c$("3d-content",b9)})]}),(!a4||cS("file").length>0)&&(0,d.jsxs)(az.As,{value:"files",className:"border rounded-lg px-4",children:[(0,d.jsx)(az.$m,{className:"hover:no-underline",children:(0,d.jsxs)("div",{className:"flex items-center gap-3",children:[(0,d.jsx)(A.A,{className:"h-5 w-5 text-muted-foreground"}),(0,d.jsx)("span",{className:"font-medium",children:"Files"}),cS("file").length>0&&(0,d.jsx)(n.E,{variant:"secondary",className:"ml-2",children:cS("file").length})]})}),(0,d.jsx)(az.ub,{children:c$("file",b9)})]})]})})})]})})}),dg=a?"page"===aV?(0,d.jsxs)("div",{className:"size-full flex flex-col overflow-hidden h-[calc(100vh-var(--header-h))]",children:[(0,d.jsx)("div",{className:"border-b flex-shrink-0",children:dd(l.qp)}),(0,d.jsx)("div",{className:"flex-1 overflow-hidden",children:df()}),"discussion"===a5&&(0,d.jsx)("div",{className:"flex-shrink-0",children:de(()=>null)})]}):"dialog"===aV?(0,d.jsx)(m.lG,{open:aD,onOpenChange:aE,children:(0,d.jsxs)(m.Cf,{"data-tour":"job-task-view",className:"md:min-w-[90vw] min-w-[calc(100vw-1rem)] md:max-w-[90vw] md:h-[90vh] h-[calc(100vh-1rem)] md:max-h-[90vh] p-0 gap-0 overflow-hidden flex flex-col [&>button]:hidden",children:[(0,d.jsxs)(m.L3,{className:"sr-only",children:[a.propertyAddress," - ",a.clientName]}),(0,d.jsx)(m.c7,{className:"border-b",children:dd(m.L3)}),df(),"discussion"===a5&&de(m.Es)]})}):(0,d.jsx)(l.cj,{open:aD,onOpenChange:aE,children:(0,d.jsxs)(l.h,{side:"right",className:"w-full sm:max-w-[40vw] md:min-w-[600px] flex flex-col p-0 gap-0","data-tour":"job-task-view",children:[(0,d.jsxs)(l.qp,{className:"sr-only",children:[a.propertyAddress," - ",a.clientName]}),(0,d.jsx)(l.Fm,{className:"border-b",children:dd(l.qp)}),df(),"discussion"===a5&&de(l.XW)]})}):null;return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(ag.Lt,{open:bN,onOpenChange:bO,children:(0,d.jsxs)(ag.EO,{children:[(0,d.jsxs)(ag.wd,{children:[(0,d.jsx)(ag.r7,{children:a4?ch.canDelete?"Delete order":"Cancel order":"Delete job"}),(0,d.jsx)(ag.$v,{children:a4?ch.canDelete?"This will permanently remove this order. Are you sure you want to continue?":"This will cancel your order. The provider will be notified. Are you sure you want to continue?":"This will permanently remove the job and its data. Are you sure you want to continue?"})]}),(0,d.jsxs)(ag.ck,{children:[(0,d.jsx)(ag.Zr,{onClick:()=>bO(!1),disabled:bP,children:"Go back"}),(0,d.jsxs)(ag.Rx,{onClick:cP,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",disabled:bP,children:[bP&&(0,d.jsx)(B.A,{className:"mr-2 h-4 w-4 animate-spin"}),a4?ch.canDelete?"Delete order":"Cancel order":"Delete job"]})]})]})}),(0,d.jsx)(ag.Lt,{open:null!==br,onOpenChange:a=>!a&&cO(),children:(0,d.jsxs)(ag.EO,{children:[(0,d.jsxs)(ag.wd,{children:[(0,d.jsx)(ag.r7,{children:"Delete Message"}),(0,d.jsx)(ag.$v,{children:br&&(ao.some(a=>a.threadId===br)?"This message has replies. Only the message will be deleted, replies will remain.":"Are you sure you want to delete this message? This action cannot be undone.")})]}),(0,d.jsxs)(ag.ck,{children:[(0,d.jsx)(ag.Zr,{onClick:cO,children:"Cancel"}),(0,d.jsx)(ag.Rx,{onClick:cN,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})}),(0,d.jsx)(ag.Lt,{open:bJ.open,onOpenChange:a=>bK({open:a,service:""}),children:(0,d.jsxs)(ag.EO,{children:[(0,d.jsxs)(ag.wd,{children:[(0,d.jsxs)(ag.r7,{children:[bJ.service," Integration"]}),(0,d.jsxs)(ag.$v,{children:[bJ.service," integration is coming soon! This feature will allow you to directly attach files from your"," ",bJ.service," account."]})]}),(0,d.jsx)(ag.ck,{children:(0,d.jsx)(ag.Rx,{onClick:()=>{bK({open:!1,service:""}),bM(null)},children:"Got it"})})]})}),dg,(()=>{if(!bl)return null;let a=c7(bl.id);return(0,d.jsx)(l.cj,{open:!!bl,onOpenChange:()=>bm(null),children:(0,d.jsxs)(l.h,{side:"right",className:"w-full sm:max-w-md p-0 flex flex-col",children:[(0,d.jsx)(l.Fm,{className:"px-4 py-3 border-b",children:(0,d.jsx)(l.qp,{className:"text-base",children:"Thread"})}),(0,d.jsx)(aj.F,{className:"flex-1 px-4",children:(0,d.jsx)("div",{className:"py-4 space-y-1",children:a.map((a,b)=>{let c=a.userId===ap,e=0===b;return(0,d.jsxs)("div",{className:(0,al.cn)("flex mb-2",c?"justify-end":"justify-start"),children:[!c&&(0,d.jsxs)(r.eu,{className:"h-7 w-7 mr-2 mt-auto mb-1 flex-shrink-0",children:[(0,d.jsx)(r.BK,{src:a.userAvatar,alt:a.userName}),(0,d.jsx)(r.q5,{className:"text-xs bg-muted",children:a.userName.split(" ").map(a=>a[0]).join("")})]}),(0,d.jsxs)("div",{className:(0,al.cn)("flex flex-col max-w-[80%]",c?"items-end":"items-start"),children:[!c&&(0,d.jsx)("span",{className:"text-xs text-muted-foreground ml-1 mb-0.5",children:a.userName}),(0,d.jsxs)("div",{className:(0,al.cn)("relative px-3 py-2 rounded-2xl shadow-sm",c?"bg-primary text-primary-foreground rounded-br-md":"bg-muted text-foreground rounded-bl-md",e&&"ring-2 ring-primary/20"),children:[e&&(0,d.jsx)("div",{className:"text-[10px] font-medium mb-1 opacity-70",children:"Original message"}),(0,d.jsx)("div",{className:(0,al.cn)("text-sm leading-relaxed prose prose-sm max-w-none","[&_p]:mb-1 [&_p:last-child]:mb-0",c?"[&_a]:text-primary-foreground":"[&_a]:text-primary"),dangerouslySetInnerHTML:{__html:a.content}}),(0,d.jsx)("div",{className:(0,al.cn)("flex items-center gap-1 mt-1",c?"justify-end":"justify-start"),children:(0,d.jsxs)(af.m_,{children:[(0,d.jsx)(af.k$,{asChild:!0,children:(0,d.jsx)("span",{className:(0,al.cn)("text-[10px] cursor-default",c?"text-primary-foreground/70":"text-muted-foreground"),children:(0,ac.GP)(new Date(a.createdAt),"h:mm a")})}),(0,d.jsx)(af.ZI,{side:"top",className:"text-xs",children:(0,ac.GP)(new Date(a.createdAt),"EEEE, MMMM d, yyyy 'at' h:mm a")})]})})]})]})]},a.id)})})})]})})})()]})}}};