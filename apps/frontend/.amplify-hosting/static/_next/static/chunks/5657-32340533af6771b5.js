"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5657],{61771:(e,t,a)=>{a.d(t,{Ks:()=>n,bk:()=>o,ob:()=>s,xw:()=>i,zu:()=>r});var n=function(e){return e.BOOKED="BOOKED",e.SHOOTING="SHOOTING",e.EDITING="EDITING",e.DELIVERED="DELIVERED",e}({}),r=function(e){return e.PHOTO="PHOTO",e.VIDEO="VIDEO",e.FLOORPLAN="FLOORPLAN",e.DOCUMENT="DOCUMENT",e.VIRTUAL_TOUR="VIRTUAL_TOUR",e}({}),s=function(e){return e.MONDAY="MONDAY",e.TUESDAY="TUESDAY",e.WEDNESDAY="WEDNESDAY",e.THURSDAY="THURSDAY",e.FRIDAY="FRIDAY",e.SATURDAY="SATURDAY",e.SUNDAY="SUNDAY",e}({}),i=function(e){return e.AERIAL="AERIAL",e.TWILIGHT="TWILIGHT",e.VIRTUAL_TOUR="VIRTUAL_TOUR",e.FLOORPLAN="FLOORPLAN",e.RUSH="RUSH",e.OTHER="OTHER",e}({}),o=function(e){return e.PENDING_REVIEW="PENDING_REVIEW",e.APPROVED="APPROVED",e.CHANGES_REQUESTED="CHANGES_REQUESTED",e}({})},95657:(e,t,a)=>{a.d(t,{F:()=>d});var n=a(61771);let r={id:"user-001",name:"Sarah Chen",email:"sarah@vxmedia.com",accountType:"COMPANY",organizationId:"org-vx-001"};var s=a(95704);let i="http://localhost:3001",o=s.env.NEXT_PUBLIC_API_PREFIX||"";class c{notifyOrgContextError(e,t){window.dispatchEvent(new CustomEvent("org-context-error",{detail:{status:e,orgId:t}}))}waitForTokenRefresh(){return this.tokenRefreshPromise||(this.isRefreshingToken=!0,this.tokenRefreshPromise=new Promise(e=>{let t=()=>{let t=localStorage.getItem("token");n(),e(t)},a=setTimeout(()=>{n(),e(null)},5e3),n=()=>{window.removeEventListener("auth-token-refreshed",t),clearTimeout(a),this.isRefreshingToken=!1,this.tokenRefreshPromise=null};window.addEventListener("auth-token-refreshed",t,{once:!0})}),window.dispatchEvent(new CustomEvent("auth-token-expired"))),this.tokenRefreshPromise}normalizeProject(e){var t,a,n,r,s,i,o,c,d,l,u,h,m;let g=e.address||{},p={...g,street_name:null!=(r=null!=(n=g.street_name)?n:e.addressLine1)?r:g.unparsed_address,unit_number:null!=(s=g.unit_number)?s:e.addressLine2,postal_code:null!=(i=g.postal_code)?i:e.postalCode,city:null!=(o=g.city)?o:e.city,state_or_province:null!=(c=g.state_or_province)?c:e.region,country:null!=(d=g.country)?d:e.countryCode,latitude:null!=(l=g.latitude)?l:e.lat,longitude:null!=(u=g.longitude)?u:e.lng,unparsed_address:g.unparsed_address||[e.addressLine1,e.addressLine2,e.city,e.region,e.postalCode,e.countryCode].filter(Boolean).join(", ")};return{...e,address:p,lat:null!=(h=p.latitude)?h:void 0,lng:null!=(m=p.longitude)?m:void 0,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt),scheduledTime:new Date(e.scheduledTime),calendarEvent:e.calendarEvent?{...e.calendarEvent,createdAt:new Date(e.calendarEvent.createdAt)}:e.calendarEvent,media:null==(t=e.media)?void 0:t.map(e=>({...e,createdAt:new Date(e.createdAt)})),messages:null==(a=e.messages)?void 0:a.map(e=>({...e,timestamp:new Date(e.timestamp||e.createdAt)}))}}mapJobCardToProject(e){var t,a,n,r;let s=e.scheduledDate&&e.scheduledTime?new Date("".concat(e.scheduledDate,"T").concat(e.scheduledTime)):new Date,i=e.requirements||"",o={unparsed_address:e.propertyAddress,latitude:null==(t=e.location)?void 0:t.lat,longitude:null==(a=e.location)?void 0:a.lng};return{id:e.id,projectManagerId:e.createdBy,address:o,addressLine1:e.propertyAddress,city:void 0,region:void 0,postalCode:void 0,countryCode:void 0,lat:null==(n=e.location)?void 0:n.lat,lng:null==(r=e.location)?void 0:r.lng,notes:i,scheduledTime:s,status:this.jobStatusToProjectStatus(e.status),technicianId:e.assignedTechnicianId,editorId:void 0,createdAt:e.createdAt?new Date(e.createdAt):new Date,updatedAt:new Date(e.assignedAt?e.assignedAt:e.createdAt||new Date),orgId:e.organizationId,media:[],messages:[]}}jobStatusToProjectStatus(e){switch(e){case"in_progress":return n.Ks.SHOOTING;case"editing":return n.Ks.EDITING;case"delivered":return n.Ks.DELIVERED;default:return n.Ks.BOOKED}}projectStatusToJobStatus(e,t){switch(e){case n.Ks.BOOKED:return t?"assigned":"pending";case n.Ks.SHOOTING:return"in_progress";case n.Ks.EDITING:return"editing";case n.Ks.DELIVERED:return"delivered";default:return"pending"}}withLocationNotes(e,t){return[t?"__LOCATION__:".concat(JSON.stringify(t),"__"):"",e].filter(Boolean).join(" ").trim()||void 0}buildAddressFields(e){var t,a,n,r,s,i;let o="object"==typeof(null==e?void 0:e.address)?e.address:{},c=null==e?void 0:e.location,d=(null==e?void 0:e.addressLine1)||("string"==typeof(null==e?void 0:e.propertyAddress)?e.propertyAddress:void 0)||("string"==typeof(null==e?void 0:e.address)?e.address:void 0)||o.street_name;return{addressLine1:"string"==typeof d?d:void 0,addressLine2:(null==e?void 0:e.addressLine2)||o.unit_number,city:(null==e?void 0:e.city)||o.city,region:(null==e?void 0:e.region)||o.state_or_province,postalCode:(null==e?void 0:e.postalCode)||o.postal_code,countryCode:(null==e?void 0:e.countryCode)||o.country,lat:null!=(n=null!=(a=null!=(t=null==e?void 0:e.lat)?t:o.latitude)?a:null==c?void 0:c.lat)?n:"number"==typeof o.latitude?o.latitude:void 0,lng:null!=(i=null!=(s=null!=(r=null==e?void 0:e.lng)?r:o.longitude)?s:null==c?void 0:c.lng)?i:"number"==typeof o.longitude?o.longitude:void 0}}async request(e){let t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=localStorage.getItem("token"),s=localStorage.getItem("organizationId"),i={"Content-Type":"application/json",...a.headers};r&&(i.Authorization="Bearer ".concat(r)),s&&(i["x-org-id"]=s);let c="".concat(this.baseUrl).concat(o).concat(e),d=a.method||"GET",l=!!r,u=!!s;console.log("[API Request]",{endpoint:e,fullUrl:c,method:d,hasAuthorization:l,hasOrgId:u,orgId:s||"none"});try{t=await fetch(c,{...a,headers:i})}catch(r){let t=r.message||"Network request failed",a=t.includes("Failed to fetch")||t.includes("ERR_CONNECTION_REFUSED"),n=e.includes("/auth/")||e.includes("/me");throw n||(a?console.warn("[API] Backend unreachable"):console.warn("[API Network Error]",{endpoint:e,method:d,error:t})),n||window.dispatchEvent(new CustomEvent("backend-api-error",{detail:{message:"".concat(d," ").concat(e," failed: ").concat(t)}})),Error("Network Error: ".concat(t))}if(!t.ok){let r,i=t.headers.get("content-type");try{r=i&&i.includes("application/json")?await t.json():await t.text()}catch(e){r="Failed to parse response body: ".concat(e)}if(401===t.status&&!n){if(console.debug("[API] 401 received, attempting token refresh..."),await this.waitForTokenRefresh())return console.debug("[API] Token refreshed, retrying request..."),this.request(e,a,!0);console.warn("[API] Token refresh failed or timed out")}if(console.error("[API Error]",{endpoint:e,fullUrl:c,method:d,status:t.status,statusText:t.statusText,responseBody:r,hasAuthorization:l,hasOrgId:u,orgId:s||"none",wasRetry:n}),401!==t.status){let a="object"==typeof r&&(null==r?void 0:r.message)?r.message:"string"==typeof r&&r?r:t.statusText,n="".concat(d," ").concat(e," failed: ").concat(t.status," ").concat(a);window.dispatchEvent(new CustomEvent("backend-api-error",{detail:{message:n}}))}if((403===t.status||404===t.status)&&s){let e="object"==typeof r&&(null==r?void 0:r.message)?r.message.toLowerCase():"";(e.includes("organization")||e.includes("org")||e.includes("access")||e.includes("belong")||e.includes("member"))&&this.notifyOrgContextError(t.status,s)}let o="object"==typeof r&&(null==r?void 0:r.message)?r.message:"string"==typeof r&&r?r:t.statusText,h=Error("API Error [".concat(t.status,"]: ").concat(o));throw h.status=t.status,h.responseBody=r,h}return window.dispatchEvent(new CustomEvent("backend-api-success")),t.json()}mapBackendMetricsToLegacy(e){var t,a,n,r,s,i,o,c,d,l,u,h,m,g;return e?{organizationId:e.organizationId||"",period:e.period||"week",jobs:{total:(null==(t=e.jobs)?void 0:t.total)||0,pending:(null==(a=e.jobs)?void 0:a.pending)||0,assigned:(null==(n=e.jobs)?void 0:n.booked)||0,completed:(null==(r=e.jobs)?void 0:r.delivered)||0,cancelled:(null==(s=e.jobs)?void 0:s.cancelled)||0},technicians:{active:(null==(i=e.staff)?void 0:i.active)||0,available:(null==(o=e.staff)?void 0:o.available)||0,utilization:(null==(c=e.staff)?void 0:c.utilization)||0},performance:{averageAssignmentTime:(null==(d=e.performance)?void 0:d.averageAssignmentTime)||0,averageDeliveryTime:(null==(l=e.performance)?void 0:l.averageDeliveryTime)||0,onTimeRate:(null==(u=e.performance)?void 0:u.onTimeRate)||0,clientSatisfaction:(null==(h=e.performance)?void 0:h.clientApprovalRate)||0},revenue:{total:(null==(m=e.revenue)?void 0:m.total)||0,perJob:(null==(g=e.revenue)?void 0:g.perJob)||0}}:{organizationId:"",period:"week",jobs:{total:0,pending:0,assigned:0,completed:0,cancelled:0},technicians:{active:0,available:0,utilization:0},performance:{averageAssignmentTime:0,averageDeliveryTime:0,onTimeRate:0,clientSatisfaction:0},revenue:{total:0,perJob:0}}}extractLocationFromNotes(e){if(!e)return null;try{let t=e.match(/__LOCATION__:({[^}]+})__/);if(t){let e=JSON.parse(t[1]);if(e.lat&&e.lng)return{lat:e.lat,lng:e.lng}}}catch(e){}return null}buildAddressString(e){if(!e)return"";let t=[e.street_number,e.street_name,e.unit_number,e.city,e.state_or_province,e.postal_code,e.country].filter(Boolean);return t.length?t.join(", "):e.unparsed_address||""}extractRequirementsFromNotes(e){return e?e.replace(/__LOCATION__:{[^}]+}__\s*/,"").trim():""}mapProjectToJobCard(e){var t,a,n,r,s,i;let o=e.scheduledTime?new Date(e.scheduledTime):new Date,c=e.address||{};c.latitude||void 0===e.lat||(c.latitude=e.lat),c.longitude||void 0===e.lng||(c.longitude=e.lng);let d=(void 0!==c.latitude&&void 0!==c.longitude?{lat:c.latitude,lng:c.longitude}:null)||(null==e?void 0:e.location)||this.extractLocationFromNotes(e.notes)||{lat:51.0447,lng:-114.0719},l=this.buildAddressString(c)||"",u=this.extractRequirementsFromNotes(e.notes);return{id:e.id,orderNumber:e.id.substring(0,8),organizationId:e.orgId,organizationName:null==(t=e.organization)?void 0:t.name,organizationLogoUrl:null==(a=e.organization)?void 0:a.logoUrl,clientName:(null==(n=e.customer)?void 0:n.name)||"Unassigned",customerId:e.customerId||void 0,customer:e.customer||null,projectManagerId:e.projectManagerId||null,projectManager:e.projectManager?{id:e.projectManager.id,name:e.projectManager.name,avatarUrl:null==(r=e.projectManager)?void 0:r.avatarUrl,email:e.projectManager.email}:null,editorId:e.editorId||null,editor:e.editor?{id:e.editor.id,name:e.editor.name,avatarUrl:null==(s=e.editor)?void 0:s.avatarUrl,email:e.editor.email}:null,propertyAddress:l,location:d,scheduledDate:o.toISOString().split("T")[0],scheduledTime:o.toTimeString().substring(0,5),mediaType:["photo"],priority:"standard",status:this.projectStatusToJobStatus(e.status,e.technicianId),assignedTechnicianId:e.technicianId,technician:e.technician?{id:e.technician.id,name:e.technician.name,avatarUrl:null==(i=e.technician)?void 0:i.avatarUrl,email:e.technician.email}:null,estimatedDuration:120,requirements:u,createdBy:e.projectManagerId||"system",createdAt:new Date(e.createdAt),assignedAt:e.technicianId?new Date(e.updatedAt):void 0,propertyImage:"https://images.unsplash.com/photo-1706808849780-7a04fbac83ef?w=800",media:e.media||[],deliveryToken:e.deliveryToken||null}}mockUserFromEmail(e){let t=e.toLowerCase(),a={company:"COMPANY",technician:"PROVIDER",agent:"AGENT"},n=Object.keys(a).find(e=>t.includes(e)),s=n?a[n]:r.accountType,i=(null==s?void 0:s.toUpperCase())==="COMPANY"?"COMPANY":s;return{...r,email:e,accountType:i,name:"".concat(i," User")}}constructor(e){var t=this;this.isRefreshingToken=!1,this.tokenRefreshPromise=null,this.auth={bootstrap:async()=>this.request("/auth/me/bootstrap"),login:async e=>this.request("/auth/login",{method:"POST",body:JSON.stringify(e)}),register:async e=>{let t={...e,accountType:((null==e?void 0:e.accountType)||"AGENT").toUpperCase()};return this.request("/auth/register",{method:"POST",body:JSON.stringify(t)})},oauthLogin:async(e,t)=>{let a={...t,accountType:(t.accountType||"AGENT").toUpperCase()};return this.request("/auth/oauth/".concat(e),{method:"POST",body:JSON.stringify(a)})},me:async()=>this.request("/auth/me"),registerOnboarding:async e=>{let t={...e,accountType:(e.accountType||"AGENT").toUpperCase()};return this.request("/auth/register/onboarding",{method:"POST",body:JSON.stringify(t)})}},this.otp={send:async e=>{let t=await this.request("/auth/otp/send",{method:"POST",body:JSON.stringify({email:e})});return{...t,expiresAt:new Date(t.expiresAt)}},verify:async(e,t)=>this.request("/auth/otp/verify",{method:"POST",body:JSON.stringify({email:e,code:t})}),checkEmail:async e=>this.request("/auth/otp/check-email/".concat(encodeURIComponent(e)))},this.me={customerOrganizations:async()=>(await this.request("/me/customer-organizations")).map(e=>({...e,createdAt:new Date(e.createdAt)})),orgContext:async()=>{let e=await this.request("/users/me/org-context");return{...e,memberships:e.memberships.map(e=>({...e,createdAt:new Date(e.createdAt)})),customerOfOrgs:e.customerOfOrgs.map(e=>({...e,createdAt:new Date(e.createdAt)}))}}},this.users={update:async(e,t)=>await this.request("/users/me",{method:"PATCH",body:JSON.stringify(t)}),deactivateAccount:async e=>this.request("/users/me/deactivate",{method:"POST",body:JSON.stringify({password:e})}),reactivateAccount:async()=>this.request("/users/me/reactivate",{method:"POST"}),deleteAccount:async e=>this.request("/users/me",{method:"DELETE",body:JSON.stringify({password:e})}),getUseCases:async()=>this.request("/users/me/use-cases"),updateUseCases:async e=>this.request("/users/me/use-cases",{method:"PATCH",body:JSON.stringify({useCases:e})})},this.organizations={listMine:async()=>{try{return(await this.request("/organizations")).map(e=>{var t;return{...e,createdAt:new Date(e.createdAt),organization:{...e.organization,createdAt:(null==(t=e.organization)?void 0:t.createdAt)?new Date(e.organization.createdAt):void 0}}})}catch(e){return[]}},getById:async e=>{let t=await this.request("/organizations/".concat(e));return{...t,createdAt:new Date(t.createdAt)}},listMembers:async()=>{let e=this.organizations.getActiveOrganization();return e?(await this.request("/organizations/".concat(e,"/members"))).map(e=>({...e,createdAt:new Date(e.createdAt),personalOrg:e.personalOrg?{...e.personalOrg,createdAt:e.personalOrg.createdAt?new Date(e.personalOrg.createdAt):void 0}:null})):[]},createInvite:async function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"TECHNICIAN",n=t.organizations.getActiveOrganization();if(!n)throw Error("No active organization selected");let r=await t.request("/organizations/".concat(n,"/invite"),{method:"POST",body:JSON.stringify({email:e,role:a})});return{...r,createdAt:(null==r?void 0:r.createdAt)?new Date(r.createdAt):new Date}},updateSettings:async(e,t)=>{let a=await this.request("/organizations/".concat(e,"/settings"),{method:"PATCH",headers:{"x-org-id":e},body:JSON.stringify(t)});return{...a,createdAt:new Date(a.createdAt)}},updateMemberRole:async(e,t)=>{let a=this.organizations.getActiveOrganization();if(!a)throw Error("No active organization selected");let n=await this.request("/organizations/".concat(a,"/members/").concat(e,"/role"),{method:"PATCH",body:JSON.stringify({role:t})});return{...n,createdAt:new Date(n.createdAt)}},setActiveOrganization:e=>{e?localStorage.setItem("organizationId",e):localStorage.removeItem("organizationId")},getActiveOrganization:()=>localStorage.getItem("organizationId"),validateInviteCode:async e=>this.request("/organizations/invite/validate/".concat(encodeURIComponent(e))),getPendingInvitationsByEmail:async e=>this.request("/organizations/invitations/by-email/".concat(encodeURIComponent(e)))},this.customers={list:async e=>{let t=e?"?search=".concat(encodeURIComponent(e)):"";return(await this.request("/customers".concat(t))).map(e=>({...e,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)}))},create:async e=>{let t=await this.request("/customers",{method:"POST",body:JSON.stringify({name:e.name,email:e.email,phone:e.phone,notes:e.notes,userId:e.userId})});return t.customer&&(t.customer={...t.customer,createdAt:new Date(t.customer.createdAt),updatedAt:new Date(t.customer.updatedAt)}),t},update:async(e,t)=>{let a=await this.request("/customers/".concat(e),{method:"PATCH",body:JSON.stringify({name:t.name,email:t.email,phone:t.phone,notes:t.notes})});return{...a,createdAt:new Date(a.createdAt),updatedAt:new Date(a.updatedAt)}},delete:async e=>{await this.request("/customers/".concat(e),{method:"DELETE"})}},this.projects={listForCurrentUser:async()=>(await this.request("/projects/mine")).map(e=>this.normalizeProject(e)),listForOrg:async()=>(await this.request("/projects")).map(e=>this.normalizeProject(e)),getById:async e=>{let t=await this.request("/projects/".concat(e));return this.normalizeProject(t)},create:async e=>{var t;e.orgId&&this.organizations.setActiveOrganization(e.orgId);let a={...this.buildAddressFields(e),notes:e.notes,scheduledTime:(null==(t=e.scheduledTime)?void 0:t.toISOString())||new Date().toISOString(),customerId:e.customerId,projectManagerId:e.projectManagerId,technicianId:e.technicianId,editorId:e.editorId},n=await this.request("/projects/create",{method:"POST",body:JSON.stringify(a)});return this.normalizeProject(n)},update:async(e,t)=>{var a;let n={...this.buildAddressFields(t),notes:t.notes,scheduledTime:null==(a=t.scheduledTime)?void 0:a.toISOString()},r=await this.request("/projects/".concat(e),{method:"PATCH",body:JSON.stringify(n)});return this.normalizeProject(r)},updateStatus:async(e,t)=>{let a=await this.request("/projects/".concat(e,"/status"),{method:"PATCH",body:JSON.stringify({status:t})});return this.normalizeProject(a)},assignTechnician:async(e,t)=>{let a=await this.request("/projects/".concat(e,"/assign-technician"),{method:"PATCH",body:JSON.stringify({technicianId:t})});return this.normalizeProject(a)},assignCustomer:async(e,t)=>{let a=await this.request("/projects/".concat(e,"/assign-customer"),{method:"PATCH",body:JSON.stringify({customerId:t||null})});return this.normalizeProject(a)},assignProjectManager:async(e,t)=>{let a=await this.request("/projects/".concat(e,"/assign-project-manager"),{method:"PATCH",body:JSON.stringify({projectManagerId:t||null})});return this.normalizeProject(a)},assignEditor:async(e,t)=>{let a=await this.request("/projects/".concat(e,"/assign-editor"),{method:"PATCH",body:JSON.stringify({editorId:t||null})});return this.normalizeProject(a)},schedule:async(e,t)=>{let a=await this.request("/projects/".concat(e,"/schedule"),{method:"PATCH",body:JSON.stringify({scheduledTime:t.toISOString()})});return this.normalizeProject(a)},delete:async e=>{await this.request("/projects/".concat(e),{method:"DELETE"})},getMessages:async e=>(await this.request("/projects/".concat(e,"/messages"))).map(e=>({...e,timestamp:new Date(e.timestamp||e.createdAt)})),addMessage:async(e,t)=>{let a=await this.request("/projects/".concat(e,"/messages"),{method:"POST",body:JSON.stringify({content:t})});return{...a,timestamp:new Date(a.timestamp||a.createdAt)}}},this.tasks={updateStatus:async(e,t,a)=>{throw Error("Task endpoints are not implemented on the backend.")},assign:async(e,t)=>{throw Error("Task endpoints are not implemented on the backend.")}},this.payments={initiateProjectPayment:async(e,t)=>{throw Error("Payment endpoints are not implemented on the backend.")}},this.media={listForProject:async e=>(await this.request("/projects/".concat(e,"/media"))).map(e=>({...e,createdAt:new Date(e.createdAt)})),addToProject:async(e,t)=>{let a=await this.request("/projects/".concat(e,"/media"),{method:"POST",body:JSON.stringify(t)});return{...a,createdAt:new Date(a.createdAt)}},deleteFromProject:async(e,t)=>this.request("/projects/".concat(e,"/media/").concat(t),{method:"DELETE"}),getForProject:async e=>this.media.listForProject(e),confirmUpload:async e=>this.media.addToProject(e.projectId,{key:e.key,cdnUrl:e.cdnUrl,filename:e.filename,size:e.size,type:e.type}),delete:async(e,t)=>t?this.media.deleteFromProject(t,e):this.request("/media/".concat(e),{method:"DELETE"})},this.jobs={getAll:()=>this.projects.listForCurrentUser(),getById:e=>this.projects.getById(e)},this.calendar={getEvents:async()=>(await this.projects.listForCurrentUser()).map(e=>{let t=this.mapProjectToJobCard(e);return{id:t.id,title:"".concat(t.clientName," - ").concat(t.propertyAddress),start:new Date("".concat(t.scheduledDate,"T").concat(t.scheduledTime)),end:new Date(new Date("".concat(t.scheduledDate,"T").concat(t.scheduledTime)).getTime()+6e4*t.estimatedDuration),resourceId:t.assignedTechnicianId}})},this.dashboard={get:async()=>{try{let e=await this.request("/dashboard"),t=(e.projects||[]).map(e=>this.normalizeProject(e)),a=this.mapBackendMetricsToLegacy(e.metrics);return{projects:t,jobCards:t.map(e=>this.mapProjectToJobCard(e)),technicians:e.technicians||[],auditLog:e.auditLog||[],metrics:a,role:e.role||"COMPANY",stats:e.stats||null,counts:e.counts||null,upcomingShoots:(e.upcomingShoots||[]).map(e=>this.normalizeProject(e)),completedProjects:(e.completedProjects||e.deliveredProjects||[]).map(e=>this.normalizeProject(e)),assignedShoots:(e.assignedShoots||[]).map(e=>this.normalizeProject(e)),readyForEditing:(e.readyForEditing||[]).map(e=>this.normalizeProject(e))}}catch(t){console.error("Dashboard fetch error:",t);let e=await this.projects.listForCurrentUser();return{projects:e,jobCards:e.map(e=>this.mapProjectToJobCard(e)),technicians:[],auditLog:[],metrics:this.mapBackendMetricsToLegacy(null),role:"COMPANY",stats:null,counts:null,upcomingShoots:[],completedProjects:[],assignedShoots:[],readyForEditing:[]}}}},this.chat={getMessages:async function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"TEAM";return(await t.request("/projects/".concat(e,"/messages?channel=").concat(a))).map(e=>{var t,a,n,r,s,i;return{id:e.id,jobId:e.projectId,userId:e.userId,userName:(null==(t=e.user)?void 0:t.name)||"Unknown User",userAvatar:null==(a=e.user)?void 0:a.avatarUrl,content:e.content,createdAt:e.timestamp||e.createdAt,channel:e.channel||"TEAM",thread:null!=(r=null!=(n=e.thread)?n:e.threadId)?r:null,threadId:null!=(i=null!=(s=e.thread)?s:e.threadId)?i:null,chatType:"CUSTOMER"===(e.channel||"TEAM")?"client":"team"}})},sendMessage:async function(e,a){var n,r,s,i,o,c;let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"TEAM",l=arguments.length>3?arguments[3]:void 0,u=await t.request("/projects/".concat(e,"/messages"),{method:"POST",body:JSON.stringify({content:a,channel:d,thread:l})});return{id:u.id,jobId:u.projectId,userId:u.userId,userName:(null==(n=u.user)?void 0:n.name)||"Unknown User",userAvatar:null==(r=u.user)?void 0:r.avatarUrl,content:u.content,createdAt:u.timestamp||u.createdAt,channel:u.channel||d,thread:null!=(i=null!=(s=u.thread)?s:l)?i:null,threadId:null!=(c=null!=(o=u.thread)?o:l)?c:null,chatType:"CUSTOMER"===(u.channel||d)?"client":"team"}}},this.messages={delete:async e=>this.request("/messages/".concat(e),{method:"DELETE"})},this.analytics={getSummary:async function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];throw Error("Analytics endpoints are not implemented on the backend.")}},this.orders={create:async e=>{let t=await this.request("/orders/create",{method:"POST",body:JSON.stringify(e)});return{...t,project:this.normalizeProject(t.project)}},list:async()=>(await this.request("/orders")).map(e=>this.normalizeProject(e)),createCheckout:async e=>this.request("/orders/checkout",{method:"POST",body:JSON.stringify(e)}),getOrderStatus:async e=>this.request("/orders/status/".concat(e)),cancel:async e=>this.request("/orders/".concat(e,"/cancel"),{method:"DELETE"})},this.availability={check:async e=>{let t=new URLSearchParams({startDate:e.startDate,endDate:e.endDate,duration:(e.duration||60).toString()});return e.technicianIds&&e.technicianIds.length>0&&t.append("technicianIds",e.technicianIds.join(",")),(await this.request("/availability?".concat(t))).map(e=>({...e,slots:e.slots.map(e=>({...e,start:new Date(e.start),end:new Date(e.end)}))}))},checkSlot:async e=>{let t=new URLSearchParams({technicianId:e.technicianId,scheduledTime:e.scheduledTime,duration:(e.duration||60).toString()});return this.request("/availability/check?".concat(t))},get:async()=>this.request("/user-availability"),updateStatus:async e=>this.request("/user-availability/status",{method:"PATCH",body:JSON.stringify(e)}),updateWorkHours:async e=>this.request("/user-availability/work-hours",{method:"PUT",body:JSON.stringify(e)})},this.marketplace={listJobs:async()=>{throw Error("Marketplace endpoints are not implemented on the backend.")},getJob:async e=>{throw Error("Marketplace endpoints are not implemented on the backend.")},apply:async(e,t)=>{throw Error("Marketplace endpoints are not implemented on the backend.")},listTransactions:async()=>{throw Error("Marketplace endpoints are not implemented on the backend.")}},this.notifications={list:async()=>(await this.request("/me/notifications")).map(e=>({...e,createdAt:new Date(e.createdAt),readAt:e.readAt?new Date(e.readAt):null})),markRead:async e=>{await this.request("/notifications/".concat(e,"/read"),{method:"POST"})},markAllRead:async()=>this.request("/notifications/read-all",{method:"POST"}),getUnreadCount:async()=>this.request("/notifications/count")},this.delivery={getByToken:async e=>{let t=await this.request("/delivery/".concat(e));return{...t,project:{...t.project,scheduledTime:new Date(t.project.scheduledTime),clientApprovedAt:t.project.clientApprovedAt?new Date(t.project.clientApprovedAt):null,deliveryEnabledAt:t.project.deliveryEnabledAt?new Date(t.project.deliveryEnabledAt):null},media:t.media.map(e=>({...e,createdAt:new Date(e.createdAt)})),comments:t.comments.map(e=>({...e,timestamp:new Date(e.timestamp)}))}},getComments:async e=>(await this.request("/delivery/".concat(e,"/comments"))).map(e=>({...e,timestamp:new Date(e.timestamp)})),approve:async e=>{await this.request("/delivery/".concat(e,"/approve"),{method:"POST"})},requestChanges:async(e,t)=>{await this.request("/delivery/".concat(e,"/request-changes"),{method:"POST",body:JSON.stringify({feedback:t})})},addComment:async(e,t)=>{let a=await this.request("/delivery/".concat(e,"/comments"),{method:"POST",body:JSON.stringify({content:t})});return{...a,timestamp:new Date(a.timestamp)}},requestDownload:async(e,t)=>{let a=await fetch("".concat(i).concat(o,"/delivery/").concat(e,"/download-request"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mediaTypes:t})});if(!a.ok)throw Error("Failed to request download");return a.json()},getDownloadStatus:async(e,t)=>{let a=await fetch("".concat(i).concat(o,"/delivery/").concat(e,"/download-status/").concat(t));if(!a.ok)throw Error("Failed to get download status");return a.json()},retryArtifact:async e=>{let t=await fetch("".concat(i).concat(o,"/delivery/admin/retry-artifact"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token")),"x-org-id":localStorage.getItem("orgId")||""},body:JSON.stringify({artifactId:e})});if(!t.ok)throw Error((await t.json().catch(()=>({}))).message||"Failed to retry artifact");return t.json()}},this.projectDelivery={getStatus:async e=>{let t=await this.request("/projects/".concat(e,"/delivery"));return{...t,deliveryEnabledAt:t.deliveryEnabledAt?new Date(t.deliveryEnabledAt):null,clientApprovedAt:t.clientApprovedAt?new Date(t.clientApprovedAt):null}},enable:async e=>{let t=await this.request("/projects/".concat(e,"/delivery/enable"),{method:"POST"});return{...t,deliveryEnabledAt:new Date(t.deliveryEnabledAt)}},disable:async e=>this.request("/projects/".concat(e,"/delivery/disable"),{method:"POST"}),regenerateToken:async e=>{let t=await this.request("/projects/".concat(e,"/delivery/regenerate-token"),{method:"POST"});return{...t,deliveryEnabledAt:t.deliveryEnabledAt?new Date(t.deliveryEnabledAt):null}},rotateToken:async e=>{let t=await this.request("/projects/".concat(e,"/delivery/rotate-token"),{method:"POST"});return{...t,deliveryEnabledAt:t.deliveryEnabledAt?new Date(t.deliveryEnabledAt):null}},getDeliveryUrl:e=>{let t=window.location.origin;return"".concat(t,"/delivery/").concat(e)}},this.packages={getForOrg:async e=>(await this.request("/packages/org/".concat(e))).map(e=>({...e,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)})),getAddOnsForOrg:async e=>(await this.request("/packages/org/".concat(e,"/addons"))).map(e=>({...e,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)})),calculateTotal:async(e,t)=>this.request("/packages/calculate",{method:"POST",body:JSON.stringify({packageId:e,addOnIds:t})}),list:async()=>(await this.request("/packages")).map(e=>({...e,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)})),listAddOns:async()=>(await this.request("/packages/addons")).map(e=>({...e,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)})),create:async e=>{let t=await this.request("/packages",{method:"POST",body:JSON.stringify(e)});return{...t,createdAt:new Date(t.createdAt),updatedAt:new Date(t.updatedAt)}},update:async(e,t)=>{let a=await this.request("/packages/".concat(e),{method:"PUT",body:JSON.stringify(t)});return{...a,createdAt:new Date(a.createdAt),updatedAt:new Date(a.updatedAt)}},delete:async e=>{await this.request("/packages/".concat(e),{method:"DELETE"})},createAddOn:async e=>{let t=await this.request("/packages/addons",{method:"POST",body:JSON.stringify(e)});return{...t,createdAt:new Date(t.createdAt),updatedAt:new Date(t.updatedAt)}},updateAddOn:async(e,t)=>{let a=await this.request("/packages/addons/".concat(e),{method:"PUT",body:JSON.stringify(t)});return{...a,createdAt:new Date(a.createdAt),updatedAt:new Date(a.updatedAt)}},deleteAddOn:async e=>{await this.request("/packages/addons/".concat(e),{method:"DELETE"})}},this.calendarIntegrations={getIcsFeed:async()=>{let e=await this.request("/calendar-integrations/ics-feed");return{...e,createdAt:new Date(e.createdAt),lastAccessAt:e.lastAccessAt?new Date(e.lastAccessAt):null}},regenerateIcsFeed:async()=>{let e=await this.request("/calendar-integrations/ics-feed/regenerate",{method:"POST"});return{...e,createdAt:new Date(e.createdAt),lastAccessAt:e.lastAccessAt?new Date(e.lastAccessAt):null}}},this.nylas={isConfigured:async()=>this.request("/nylas/configured"),getConnectionStatus:async()=>this.request("/nylas/connection"),startOAuth:async(e,t)=>{let a=new URLSearchParams({provider:e});return t&&a.set("returnTo",t),this.request("/nylas/oauth/start?".concat(a.toString()))},disconnect:async e=>this.request("/nylas/connection/".concat(e),{method:"DELETE"}),getCalendars:async()=>this.request("/nylas/calendars"),setWriteTarget:async(e,t)=>this.request("/nylas/calendars/".concat(e,"/write-target"),{method:"PATCH",body:JSON.stringify({calendarId:t})}),getAvailability:async e=>{let t=new URLSearchParams({start:e.start,end:e.end,durationMins:String(e.durationMins||60),timezone:e.timezone||Intl.DateTimeFormat().resolvedOptions().timeZone});return e.technicianId&&t.set("technicianId",e.technicianId),this.request("/nylas/availability?".concat(t.toString()))},getProjectSyncStatus:async e=>this.request("/nylas/projects/".concat(e,"/sync-status")),reconcileProject:async e=>this.request("/nylas/projects/".concat(e,"/reconcile"),{method:"POST"}),syncAllProjects:async()=>this.request("/nylas/sync-all",{method:"POST"})},this.invitations={accept:async e=>{await this.request("/invitations/".concat(e,"/accept"),{method:"POST"})},decline:async e=>{await this.request("/invitations/".concat(e,"/decline"),{method:"POST"})},getOrganizationPublic:async e=>this.request("/organizations/".concat(e,"/public"))},this.tours={getStatus:async()=>this.request("/tours/status"),getTrackProgress:async e=>this.request("/tours/progress/".concat(e)),updateProgress:async e=>this.request("/tours/progress",{method:"PATCH",body:JSON.stringify(e)}),completeTrack:async e=>this.request("/tours/complete/".concat(e),{method:"POST"}),skipTrack:async e=>this.request("/tours/skip/".concat(e),{method:"POST"}),dismissGuide:async()=>this.request("/tours/dismiss-guide",{method:"POST"}),resetProgress:async()=>this.request("/tours/reset",{method:"POST"}),createDemoProject:async()=>this.request("/tours/demo-project",{method:"POST"}),getDemoProject:async()=>this.request("/tours/demo-project"),deleteDemoProject:async()=>this.request("/tours/demo-project",{method:"DELETE"})},this.baseUrl=e}}let d=new c(i)}}]);