(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2892,6043],{7415:(e,s,t)=>{"use strict";t.d(s,{c:()=>g});var a=t(95155),r=t(12115),n=t(64936);function l(e){let{event:s,technicianColor:t,onClick:r,className:l}=e,i=t||("External"===s.type?"#8b5cf6":"#6b7280");return(0,a.jsxs)("div",{onClick:r,className:(0,n.cn)("flex items-center gap-1.5 px-2 py-1 rounded text-xs cursor-pointer hover:opacity-80 transition-opacity truncate",l),style:{backgroundColor:"".concat(i,"20"),color:i},children:[(0,a.jsx)("div",{className:"w-2 h-2 rounded-full flex-shrink-0",style:{backgroundColor:i}}),(0,a.jsx)("span",{className:"truncate",children:s.title})]})}var i=t(27806),c=t(78674),d=t(88901),o=t(82192),m=t(51321),h=t(6180),u=t(47141),x=t(35405),f=t(71163),p=t(12725),j=t(97003);function g(e){let{currentDate:s,events:t,technicians:g,technicianColors:v,onEventClick:N,onDayClick:b,compact:w=!1}=e,y=(0,r.useMemo)(()=>(0,c.w)(s),[s]),E=(0,r.useMemo)(()=>(0,d.p)(s),[s]),C=(0,r.useMemo)(()=>(0,o.k)(y,{weekStartsOn:0}),[y]),k=(0,r.useMemo)(()=>(0,m.$)(E,{weekStartsOn:0}),[E]),T=(0,r.useMemo)(()=>(0,h.k)({start:C,end:k}),[C,k]);return(0,a.jsxs)("div",{className:(0,n.cn)("flex-1 flex flex-col",w?"h-auto":"h-full overflow-hidden"),children:[(0,a.jsx)("div",{className:(0,n.cn)("grid grid-cols-7 border-b bg-muted",w&&"text-xs"),children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(e=>(0,a.jsx)("div",{className:(0,n.cn)("text-center font-semibold border-r last:border-r-0",w?"p-3 text-sm":"p-2 text-sm"),children:e},e))}),(0,a.jsx)("div",{className:(0,n.cn)("grid grid-cols-7",w?"":"flex-1 auto-rows-fr"),children:T.map((e,r)=>{let c=(0,p.Jm)(t,e).sort((e,s)=>new Date(e.start).getTime()-new Date(s.start).getTime()),d=c.slice(0,3),o=c.length-3,m=(0,u.t)(e,s),h=(0,x.r)(e,new Date),y=r%7==6;return(0,a.jsxs)("div",{className:(0,n.cn)("border-b flex flex-col",!y&&"border-r",!m&&"bg-muted/20",h&&"bg-muted/50 ring-1 ring-primary ring-inset",w?"p-1 min-h-[90px]":"p-2 min-h-[120px]"),children:[(0,a.jsx)(j.$,{variant:"ghost",size:"sm",className:(0,n.cn)("p-0 font-semibold mb-1 self-start",w?"h-5 w-5 text-xs":"h-6 w-6",h&&"bg-primary text-primary-foreground"),onClick:()=>b(e),children:(0,f.GP)(e,"d")}),(0,a.jsxs)("div",{className:(0,n.cn)("flex-1 space-y-0.5 overflow-hidden",w&&"space-y-0"),children:[d.map(e=>{let s=(e=>{if(e)return g.find(s=>s.id===e)})(e.technicianId),t=(e=>{var s;if(e)return null==(s=v.find(s=>s.technicianId===e))?void 0:s.color})(e.technicianId);return"External"===e.type||"Unscheduled"===e.type?(0,a.jsx)(i.Y,{event:e,technician:s,technicianColor:t,onOpenJob:()=>e.jobId&&N(e),onAssignTechnician:()=>e.jobId&&N(e),children:(0,a.jsx)("div",{children:(0,a.jsx)(l,{event:e,technicianColor:t,onClick:()=>N(e),className:w?"text-[10px] px-1 py-0.5":void 0})})},e.id):(0,a.jsx)(l,{event:e,technicianColor:t,onClick:()=>N(e),className:w?"text-[10px] px-1 py-0.5":void 0},e.id)}),o>0&&(0,a.jsxs)(j.$,{variant:"ghost",size:"sm",className:(0,n.cn)("text-muted-foreground hover:text-foreground",w?"h-4 text-[10px]":"h-6 text-xs"),onClick:()=>b(e),children:["+",o," more"]})]})]},r)})})]})}},12725:(e,s,t)=>{"use strict";t.d(s,{A1:()=>x,Jm:()=>h,Ve:()=>m,WA:()=>u,XE:()=>p,sH:()=>f});var a=t(71163),r=t(93366),n=t(26467),l=t(82192),i=t(51321),c=t(78674),d=t(88901);function o(e){let s=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0"),r=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0"),l=String(e.getSeconds()).padStart(2,"0"),i=-e.getTimezoneOffset(),c=String(Math.floor(Math.abs(i)/60)).padStart(2,"0"),d=String(Math.abs(i)%60).padStart(2,"0"),o=i>=0?"+":"-";return"".concat(s,"-").concat(t,"-").concat(a,"T").concat(r,":").concat(n,":").concat(l).concat(o).concat(c,":").concat(d)}function m(e){let[s,t,r]=(e.scheduledDate||(0,a.GP)(new Date,"yyyy-MM-dd")).split("-").map(Number);if(!e.scheduledTime){let a=new Date(s,t-1,r,0,0,0,0),n=new Date(s,t-1,r+1,0,0,0,0);return{id:e.id,title:e.propertyAddress||e.clientName,start:o(a),end:o(n),jobId:e.id,orderNumber:e.orderNumber,technicianId:e.assignedTechnicianId,type:"Unscheduled",allDay:!0,description:"".concat(e.clientName," - ").concat(e.propertyAddress)}}let[n,l]=e.scheduledTime.split(":").map(Number),i=new Date(s,t-1,r,n||0,l||0,0,0),c=e.estimatedDuration||60,d=new Date(i.getTime()+60*c*1e3);return{id:e.id,title:e.propertyAddress||e.clientName,start:o(i),end:o(d),jobId:e.id,orderNumber:e.orderNumber,technicianId:e.assignedTechnicianId,type:"Scheduled",allDay:!1,description:"".concat(e.clientName," - ").concat(e.propertyAddress)}}function h(e,s){let t=(0,r.o)(s),a=t.getFullYear(),l=t.getMonth(),i=t.getDate();return e.filter(e=>{let s=(0,n.H)(e.start),t=(0,n.H)(e.end),r=s.getFullYear(),c=s.getMonth(),d=s.getDate(),o=t.getFullYear(),m=t.getMonth(),h=t.getDate(),u=new Date(r,c,d),x=new Date(o,m,h),f=new Date(a,l,i);return r===a&&c===l&&d===i||o===a&&m===l&&h===i||u<=f&&x>=f})}function u(e){return{start:(0,l.k)(e,{weekStartsOn:0}),end:(0,i.$)(e,{weekStartsOn:0})}}function x(e){return{start:(0,c.w)(e),end:(0,d.p)(e)}}function f(e,s){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=(0,n.H)(e),l=(0,n.H)(s),i="".concat((0,a.GP)(r,"h:mm a")," - ").concat((0,a.GP)(l,"h:mm a"));if(t){let e=new Date().toLocaleTimeString("en-US",{timeZoneName:"short"}).split(" ").pop()||"";return"".concat(i," ").concat(e)}return i}function p(e){let s=new Map,t=[...e].sort((e,s)=>{let t=(0,n.H)(e.start).getTime()-(0,n.H)(s.start).getTime();return 0!==t?t:(0,n.H)(s.end).getTime()-(0,n.H)(e.end).getTime()}),a=[],r=[],l=0;return t.forEach(e=>{let s=(0,n.H)(e.start).getTime(),t=(0,n.H)(e.end).getTime();0===r.length?(r.push(e),l=t):s<l?(r.push(e),l=Math.max(l,t)):(a.push(r),r=[e],l=t)}),r.length>0&&a.push(r),a.forEach(e=>{let t=[];e.forEach(e=>{let s=!1;for(let a=0;a<t.length;a++){let r=t[a],l=r[r.length-1];if((0,n.H)(e.start).getTime()>=(0,n.H)(l.end).getTime()){r.push(e),s=!0;break}}s||t.push([e])});let a=100/t.length;t.forEach((e,t)=>{e.forEach(e=>{s.set(e.id,{left:t*a,width:a})})})}),s}},22623:(e,s,t)=>{"use strict";function a(e){let s=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899","#06b6d4","#84cc16","#f97316","#6366f1"];return e.map((e,t)=>({technicianId:e.id,color:s[t%s.length]}))}t.d(s,{q:()=>a})},27806:(e,s,t)=>{"use strict";t.d(s,{Y:()=>u});var a=t(95155),r=t(97450),n=t(97003),l=t(67812),i=t(12725),c=t(26983),d=t(20508),o=t(21873),m=t(93499),h=t(73344);function u(e){let{event:s,technician:t,technicianColor:u,children:x,onOpenJob:f,onAssignTechnician:p}=e,j="Unscheduled"===s.type,g="External"===s.type;return(0,a.jsxs)(r.AM,{children:[(0,a.jsx)(r.Wv,{asChild:!0,children:x}),(0,a.jsx)(r.hl,{className:"w-80",align:"start",children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-semibold text-sm",children:s.title}),s.orderNumber&&(0,a.jsxs)(h.P,{className:"text-xs text-muted-foreground font-mono mt-1",children:["Order #",s.orderNumber]}),s.description&&(0,a.jsx)(h.P,{className:"text-xs text-muted-foreground mt-1",children:s.description})]}),(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[!s.allDay&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,a.jsx)(c.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:(0,i.sH)(s.start,s.end,!0)})]}),t&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(d.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{children:t.name}),u&&(0,a.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:u}})]}),s.territory&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,a.jsx)(o.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:s.territory})]}),g&&s.externalSource&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,a.jsx)(m.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:s.externalSource})]})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(l.E,{variant:"External"===s.type?"outline":"default",children:s.type}),s.hasConflict&&(0,a.jsx)(l.E,{variant:"destructive",children:"Conflict"})]}),!g&&(0,a.jsxs)("div",{className:"flex gap-2 pt-2 border-t",children:[j&&p&&(0,a.jsx)(n.$,{size:"sm",variant:"outline",onClick:p,className:"flex-1",children:"Assign Technician"}),f&&(0,a.jsx)(n.$,{size:"sm",onClick:f,className:j&&p?"flex-1":"w-full",children:"Open Job"})]})]})})]})}},32580:(e,s,t)=>{"use strict";t.d(s,{U:()=>i,_:()=>c});var a=t(95155),r=t(12115),n=t(18720);let l=(0,r.createContext)(void 0);function i(e){let{children:s,defaultUserId:t,defaultOrganizationId:i,createJobHandler:c}=e,[d,o]=(0,r.useState)(!1),[m,h]=(0,r.useState)(),[u,x]=(0,r.useState)(null),f=(0,r.useCallback)(()=>{o(!1),h(void 0)},[]),p=(0,r.useCallback)(async e=>{if(!e)return void n.oR.error("Invalid job data");if(c){await c(e),n.oR.success("Job created successfully"),f();return}let s=localStorage.getItem("dispatcherJobs"),a=s?JSON.parse(s):[],r=a.length,l={id:"job-".concat(Date.now()),orderNumber:(r+1).toString().padStart(4,"0"),organizationId:i||"org-vx-001",clientName:e.clientName,propertyAddress:e.propertyAddress,location:e.location||{lat:51.0447,lng:-114.0719},scheduledDate:e.scheduledDate,scheduledTime:e.scheduledTime,mediaType:e.mediaType,priority:e.priority||"standard",status:"pending",estimatedDuration:e.estimatedDuration||120,requirements:e.requirements||"",createdBy:t||"user-001",createdAt:new Date,propertyImage:e.propertyImage||"https://images.unsplash.com/photo-1706808849780-7a04fbac83ef?w=800"},d=[l,...a];localStorage.setItem("dispatcherJobs",JSON.stringify(d)),window.dispatchEvent(new CustomEvent("jobCreated",{detail:l})),n.oR.success("Job created successfully"),f()},[t,i,c,f]),j=(0,r.useCallback)(async e=>{let s=u&&"function"==typeof u?u:p;await s(e)},[u,p]);return(0,a.jsx)(l.Provider,{value:{openJobCreationDialog:e=>{h(e),o(!0)},closeJobCreationDialog:f,setOnSubmit:x,handleJobCreate:j,isOpen:d,initialValues:m,onSubmit:u},children:s})}function c(){let e=(0,r.useContext)(l);if(void 0===e)throw Error("useJobCreation must be used within a JobCreationProvider");return e}},36722:(e,s,t)=>{Promise.resolve().then(t.bind(t,49130))},42892:(e,s,t)=>{"use strict";t.d(s,{Eg:()=>n,N3:()=>d,a1:()=>i,is:()=>l,jw:()=>c});var a=t(95155),r=t(68122);function n(){return(0,a.jsx)("main",{className:"container relative mx-auto",children:(0,a.jsxs)("article",{className:"flex flex-col gap-2xl md:gap-3xl px-md",children:[(0,a.jsx)("div",{className:"@container w-full mt-md",children:(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:Array.from({length:4}).map((e,s)=>(0,a.jsxs)("div",{className:"p-4 border rounded-md",children:[(0,a.jsx)(r.E,{className:"h-4 w-24 mb-2"}),(0,a.jsx)(r.E,{className:"h-8 w-32"})]},s))})}),(0,a.jsxs)("div",{className:"@container w-full",children:[(0,a.jsxs)("div",{className:"mb-md flex items-baseline justify-between",children:[(0,a.jsx)(r.E,{className:"h-6 w-32"}),(0,a.jsx)(r.E,{className:"h-8 w-28"})]}),(0,a.jsxs)("div",{className:"border rounded-md overflow-hidden p-4",children:[(0,a.jsx)("div",{className:"grid grid-cols-7 gap-2 mb-2",children:Array.from({length:7}).map((e,s)=>(0,a.jsx)(r.E,{className:"h-8 w-full"},s))}),(0,a.jsx)("div",{className:"grid grid-cols-7 gap-2",children:Array.from({length:35}).map((e,s)=>(0,a.jsx)(r.E,{className:"h-16 w-full"},s))})]})]}),(0,a.jsxs)("div",{className:"@container w-full",children:[(0,a.jsxs)("div",{className:"mb-md flex items-baseline justify-between",children:[(0,a.jsx)(r.E,{className:"h-6 w-32"}),(0,a.jsx)(r.E,{className:"h-8 w-28"})]}),(0,a.jsx)("div",{className:"border rounded-md overflow-hidden",children:(0,a.jsx)(r.E,{className:"h-96 w-full"})})]}),(0,a.jsxs)("div",{className:"@container w-full mb-md",children:[(0,a.jsxs)("div",{className:"mb-md flex items-baseline justify-between",children:[(0,a.jsx)(r.E,{className:"h-6 w-32"}),(0,a.jsx)(r.E,{className:"h-8 w-24"})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:Array.from({length:4}).map((e,s)=>(0,a.jsxs)("div",{className:"border rounded-md p-4 space-y-3",children:[(0,a.jsx)(r.E,{className:"h-32 w-full rounded"}),(0,a.jsx)(r.E,{className:"h-4 w-3/4"}),(0,a.jsx)(r.E,{className:"h-4 w-1/2"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(r.E,{className:"h-6 w-16"}),(0,a.jsx)(r.E,{className:"h-6 w-20"})]})]},s))})]})]})})}function l(){return(0,a.jsxs)("main",{className:"fixed inset-0 overflow-hidden",children:[(0,a.jsx)("div",{className:"absolute inset-0",children:(0,a.jsx)(r.E,{className:"h-full w-full"})}),(0,a.jsxs)("div",{className:"absolute right-0 top-0 bottom-0 w-80 border-l bg-background p-4",children:[(0,a.jsx)(r.E,{className:"h-8 w-32 mb-4"}),(0,a.jsx)("div",{className:"space-y-3",children:Array.from({length:5}).map((e,s)=>(0,a.jsxs)("div",{className:"border rounded-md p-3 space-y-2",children:[(0,a.jsx)(r.E,{className:"h-4 w-3/4"}),(0,a.jsx)(r.E,{className:"h-4 w-1/2"}),(0,a.jsx)(r.E,{className:"h-6 w-20"})]},s))})]})]})}function i(){return(0,a.jsxs)("div",{className:"flex flex-col size-full",children:[(0,a.jsx)("div",{className:"border-b p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(r.E,{className:"h-8 w-8"}),(0,a.jsx)(r.E,{className:"h-8 w-8"}),(0,a.jsx)(r.E,{className:"h-6 w-32"}),(0,a.jsx)(r.E,{className:"h-8 w-8"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(r.E,{className:"h-8 w-24"}),(0,a.jsx)(r.E,{className:"h-8 w-24"}),(0,a.jsx)(r.E,{className:"h-8 w-24"})]})]})}),(0,a.jsx)("div",{className:"flex-1 p-4",children:(0,a.jsxs)("div",{className:"grid grid-cols-7 gap-2 h-full",children:[(0,a.jsx)("div",{className:"space-y-2",children:Array.from({length:24}).map((e,s)=>(0,a.jsx)(r.E,{className:"h-12 w-full"},s))}),Array.from({length:6}).map((e,s)=>(0,a.jsx)("div",{className:"space-y-2",children:Array.from({length:24}).map((e,s)=>(0,a.jsx)(r.E,{className:"h-12 w-full"},s))},s))]})})]})}function c(){return(0,a.jsx)("main",{className:"container relative mx-auto",children:(0,a.jsx)("article",{className:"flex flex-col gap-2xl md:gap-3xl px-md",children:(0,a.jsxs)("div",{className:"@container w-full mt-md mb-md",children:[(0,a.jsx)(r.E,{className:"h-10 w-32 mb-6"}),(0,a.jsxs)("div",{className:"flex gap-3 mb-6",children:[(0,a.jsx)(r.E,{className:"h-10 flex-1"}),(0,a.jsx)(r.E,{className:"h-10 w-32"})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Array.from({length:6}).map((e,s)=>(0,a.jsxs)("div",{className:"border rounded-md p-4 space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(r.E,{className:"size-12 rounded-full"}),(0,a.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,a.jsx)(r.E,{className:"h-4 w-32"}),(0,a.jsx)(r.E,{className:"h-3 w-24"})]})]}),(0,a.jsx)(r.E,{className:"h-4 w-full"}),(0,a.jsx)(r.E,{className:"h-4 w-3/4"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(r.E,{className:"h-6 w-16"}),(0,a.jsx)(r.E,{className:"h-6 w-16"})]})]},s))})]})})})}function d(){return(0,a.jsxs)("div",{className:"flex size-full",children:[(0,a.jsx)("div",{className:"w-64 border-r p-4 space-y-2",children:Array.from({length:8}).map((e,s)=>(0,a.jsx)(r.E,{className:"h-10 w-full"},s))}),(0,a.jsxs)("div",{className:"flex-1 p-6 space-y-6",children:[(0,a.jsx)(r.E,{className:"h-8 w-48"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(r.E,{className:"h-4 w-full"}),(0,a.jsx)(r.E,{className:"h-4 w-3/4"}),(0,a.jsx)(r.E,{className:"h-32 w-full"}),(0,a.jsx)(r.E,{className:"h-10 w-32"})]})]})]})}},49130:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>ei});var a=t(95155),r=t(12115),n=t(20063),l=t(24632),i=t(22623),c=t(12725),d=t(97003),o=t(75417),m=t(90368),h=t(27937),u=t(71163),x=t(73344);function f(e){let{currentDate:s,view:t,onPrev:r,onNext:n,onToday:l,onViewChange:i,onCreateJob:c}=e;return(0,a.jsxs)("div",{className:"flex md:flex-row flex-col items-center justify-between space-y-4 md:space-y-0 p-4 border-b bg-background",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between md:items-center w-full md:w-auto gap-2",children:[(0,a.jsxs)(o.e2,{children:[(0,a.jsx)(d.$,{variant:"outline",size:"sm",onClick:r,children:(0,a.jsx)(m.A,{className:"h-4 w-4"})}),(0,a.jsx)(d.$,{variant:"outline",size:"sm",onClick:l,children:"Today"}),(0,a.jsx)(d.$,{variant:"outline",size:"sm",onClick:n,children:(0,a.jsx)(h.A,{className:"h-4 w-4"})})]}),(0,a.jsxs)("div",{className:"flex justify-end items-center w-full md:w-auto  md:gap-2",children:[(0,a.jsx)(x.H2,{className:"text-lg font-semibold ml-4",children:(()=>{switch(t){case"day":default:return(0,u.GP)(s,"MMM d, yyyy");case"week":{let e=new Date(s);e.setDate(s.getDate()-s.getDay());let t=new Date(e);return t.setDate(e.getDate()+6),"".concat((0,u.GP)(e,"MMM d")," â€“ ").concat((0,u.GP)(t,"MMM d, yyyy"))}case"month":case"list":return(0,u.GP)(s,"MMMM yyyy")}})()}),(0,a.jsxs)("span",{className:"text-xs text-muted-foreground ml-2",children:["(",new Date().toLocaleTimeString("en-US",{timeZoneName:"short"}).split(" ").pop()||"Local",")"]})]})]}),(0,a.jsx)("div",{className:"flex items-start justify-between md:items-center w-full md:w-auto gap-2",children:(0,a.jsxs)(o.e2,{children:[(0,a.jsx)(d.$,{variant:"day"===t?"default":"outline",size:"sm",onClick:()=>i("day"),children:"Day"}),(0,a.jsx)(d.$,{variant:"week"===t?"default":"outline",size:"sm",onClick:()=>i("week"),children:"Week"}),(0,a.jsx)(d.$,{variant:"month"===t?"default":"outline",size:"sm",onClick:()=>i("month"),children:"Month"}),(0,a.jsx)(d.$,{variant:"list"===t?"default":"outline",size:"sm",onClick:()=>i("list"),children:"List"})]})})]})}var p=t(55725),j=t(84916),g=t(90235),v=t(47507),N=t(27346),b=t(54664),w=t(35299),y=t(35405);function E(e){let{canSeeTechnicians:s,currentDate:t,view:n,onDateSelect:l,filters:i,onFiltersChange:o,technicians:m,techniciansLoading:h=!1,technicianColors:u,territories:f,timezone:E,onTimezoneChange:C}=e,[k,T]=(0,r.useState)(!0),M=(0,r.useMemo)(()=>"week"===n?(0,c.WA)(t):"month"===n?(0,c.A1)(t):"list"===n?(0,c.WA)(t):null,[t,n]),S=(e,s)=>{o({...i,eventTypes:{...i.eventTypes,[e]:s}})};return(0,a.jsx)(N.F,{className:"size-full",children:(0,a.jsxs)("div",{className:"p-4 space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(x.H3,{className:"mb-3 hidden md:block",children:"Mini Calendar"}),M?(0,a.jsx)(p.V,{mode:"range",selected:{from:M.start,to:M.end},onSelect:e=>{let s;e&&(e.from&&((0,y.r)(e.from,M.start)||(s=e.from)),!s&&e.to&&((0,y.r)(e.to,M.end)||(s=e.to)),!s&&e.from&&(s=e.from),s&&l(s))},className:"rounded-md border w-full"}):(0,a.jsx)(p.V,{mode:"single",selected:t,onSelect:e=>e&&l(e),className:"rounded-md border w-full"})]}),(0,a.jsx)(b.w,{}),(0,a.jsxs)("div",{children:[(0,a.jsx)(g.J,{className:"text-sm font-semibold mb-2 block",children:"Timezone"}),(0,a.jsxs)(v.l6,{value:E,onValueChange:C,children:[(0,a.jsx)(v.bq,{children:(0,a.jsx)(v.yv,{})}),(0,a.jsxs)(v.gC,{children:[(0,a.jsx)(v.eb,{value:"America/Edmonton",children:"Mountain Time (MT)"}),(0,a.jsx)(v.eb,{value:"America/Los_Angeles",children:"Pacific Time (PT)"}),(0,a.jsx)(v.eb,{value:"America/Chicago",children:"Central Time (CT)"}),(0,a.jsx)(v.eb,{value:"America/New_York",children:"Eastern Time (ET)"}),(0,a.jsx)(v.eb,{value:"UTC",children:"UTC"})]})]})]}),(0,a.jsx)(b.w,{}),(0,a.jsxs)("div",{children:[(0,a.jsx)(g.J,{className:"text-sm font-semibold mb-3 block",children:"Event Types"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(j.S,{id:"filter-scheduled",checked:i.eventTypes.Scheduled,onCheckedChange:e=>S("Scheduled",e)}),(0,a.jsx)(g.J,{htmlFor:"filter-scheduled",className:"text-sm font-normal cursor-pointer",children:"Scheduled"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(j.S,{id:"filter-unscheduled",checked:i.eventTypes.Unscheduled,onCheckedChange:e=>S("Unscheduled",e)}),(0,a.jsx)(g.J,{htmlFor:"filter-unscheduled",className:"text-sm font-normal cursor-pointer",children:"Unscheduled"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(j.S,{id:"filter-external",checked:i.eventTypes.External,onCheckedChange:e=>S("External",e)}),(0,a.jsx)(g.J,{htmlFor:"filter-external",className:"text-sm font-normal cursor-pointer",children:"External"})]})]})]}),(0,a.jsx)(b.w,{}),f.length>0&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(g.J,{className:"text-sm font-semibold mb-3 block",children:"Territories"}),(0,a.jsx)("div",{className:"space-y-2",children:f.map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(j.S,{id:"filter-territory-".concat(e),checked:i.territories.includes(e),onCheckedChange:s=>{s?o({...i,territories:[...i.territories,e]}):o({...i,territories:i.territories.filter(s=>s!==e)})}}),(0,a.jsx)(g.J,{htmlFor:"filter-territory-".concat(e),className:"text-sm font-normal cursor-pointer",children:e})]},e))})]}),(0,a.jsx)(b.w,{})]}),s&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)(g.J,{className:"text-sm font-semibold",children:"Technicians"}),(0,a.jsx)(d.$,{variant:"ghost",size:"sm",onClick:()=>{k?o({...i,technicians:[]}):o({...i,technicians:m.map(e=>e.id)}),T(!k)},className:"h-6 text-xs",disabled:h||0===m.length,children:k?"Hide All":"Show All"})]}),h&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-2",children:[(0,a.jsx)(w.A,{className:"h-4 w-4 animate-spin"}),"Loading technicians..."]}),(0,a.jsx)("div",{className:"space-y-2",children:m.map(e=>{var s,t;let r=(s=e.id,(null==(t=u.find(e=>e.technicianId===s))?void 0:t.color)||"#6b7280"),n=i.technicians.includes(e.id);return(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(j.S,{id:"filter-technician-".concat(e.id),checked:n,onCheckedChange:s=>{var t;return t=e.id,void(s?o({...i,technicians:[...i.technicians,t]}):o({...i,technicians:i.technicians.filter(e=>e!==t)}))}}),(0,a.jsxs)(g.J,{htmlFor:"filter-technician-".concat(e.id),className:"text-sm font-normal cursor-pointer flex items-center gap-2 flex-1",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full flex-shrink-0",style:{backgroundColor:r}}),(0,a.jsx)("span",{className:"truncate",children:e.name})]})]},e.id)})})]})]})})}var C=t(67812),k=t(64936),T=t(26983),M=t(21873);function S(e){let{event:s,technician:t,technicianColor:r,onClick:n,className:l}=e,i=r||("External"===s.type?"#8b5cf6":void 0),d=i?"".concat(i,"15"):void 0;return(0,a.jsx)("div",{onClick:n,className:(0,k.cn)("p-3 rounded-lg border-2 cursor-pointer transition-all hover:shadow-md flex flex-col bg-muted/80!",s.hasConflict&&"border-red-500 border-dashed",l),style:{borderColor:i,backgroundColor:d},children:(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsx)("div",{className:"font-medium text-sm",children:s.title}),s.orderNumber&&(0,a.jsxs)("div",{className:"text-xs text-muted-foreground font-mono",children:["Order #",s.orderNumber]}),s.start&&s.end&&(0,a.jsxs)("div",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:[(0,a.jsx)(T.A,{className:"h-3 w-3"}),(0,a.jsx)("span",{children:(0,c.sH)(s.start,s.end,!0)})]}),s.description&&(0,a.jsx)("div",{className:"text-xs text-muted-foreground line-clamp-2",children:s.description}),(0,a.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[t&&(0,a.jsx)(C.E,{variant:"secondary",className:"text-xs",children:t.name}),(0,a.jsx)(C.E,{variant:"External"===s.type?"outline":"default",className:"text-xs",children:s.type}),s.territory&&(0,a.jsxs)(C.E,{variant:"outline",className:"text-xs",children:[(0,a.jsx)(M.A,{className:"h-3 w-3 mr-1"}),s.territory]})]})]})})}var D=t(27806),A=t(26467);function I(e){let{currentDate:s,events:t,technicians:n,technicianColors:l,onEventClick:i,onEventDrag:d}=e,o=(0,r.useMemo)(()=>(0,c.WA)(s),[s]),m=(0,r.useMemo)(()=>{let e=[],s=new Date(o.start);for(let t=0;t<7;t++){let a=new Date(s);a.setDate(s.getDate()+t),e.push(a)}return e},[o]);return(0,a.jsx)(N.F,{className:"flex-1 relative",children:(0,a.jsx)("div",{className:"absolute w-full",children:(0,a.jsx)("div",{className:"flex-1 flex flex-col overflow-x-auto",children:(0,a.jsxs)("div",{className:"min-w-[980px] flex flex-col h-full",children:[(0,a.jsx)("div",{className:"sticky top-0 z-10 grid grid-cols-7 border-b bg-muted shrink-0",children:m.map((e,s)=>(0,a.jsxs)("div",{className:(0,k.cn)("p-3 text-center border-r last:border-r-0",(0,u.GP)(e,"yyyy-MM-dd")===(0,u.GP)(new Date,"yyyy-MM-dd")&&"bg-primary/10"),children:[(0,a.jsx)("div",{className:"text-xs text-muted-foreground mb-1",children:(0,u.GP)(e,"EEE")}),(0,a.jsx)("div",{className:"text-sm font-semibold",children:(0,u.GP)(e,"d")})]},s))}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,a.jsx)("div",{className:"grid grid-cols-7 min-h-screen",children:m.map((e,s)=>{let r=(0,c.Jm)(t,e).sort((e,s)=>(0,A.H)(e.start).getTime()-(0,A.H)(s.start).getTime());return(0,a.jsx)("div",{className:(0,k.cn)("border-r last:border-r-0 p-2 space-y-2",(0,u.GP)(e,"yyyy-MM-dd")===(0,u.GP)(new Date,"yyyy-MM-dd")&&"bg-primary/5"),children:r.map(e=>{let s=(e=>{if(e)return n.find(s=>s.id===e)})(e.technicianId),t=(e=>{var s;if(e)return null==(s=l.find(s=>s.technicianId===e))?void 0:s.color})(e.technicianId);return"External"===e.type||"Unscheduled"===e.type?(0,a.jsx)(D.Y,{event:e,technician:s,technicianColor:t,onOpenJob:()=>e.jobId&&i(e),onAssignTechnician:()=>e.jobId&&i(e),children:(0,a.jsx)("div",{children:(0,a.jsx)(S,{event:e,technician:s,technicianColor:t,onClick:()=>i(e)})})},e.id):(0,a.jsx)(S,{event:e,technician:s,technicianColor:t,onClick:()=>i(e)},e.id)})},s)})})})]})})})})}var J=t(35504),z=t(33884),O=t(3166),H=t(33738);let P=Array.from({length:24},(e,s)=>s);function U(e){let{canSeeTechnicians:s,currentDate:t,events:n,technicians:l,technicianColors:i,onEventClick:d,onEventDrag:o,onCreateJob:m}=e,[h,x]=(0,r.useState)(!1),[f,p]=(0,r.useState)(null),[j,g]=(0,r.useState)(null),[v,b]=(0,r.useState)(new Date),w=(0,r.useRef)(null);(0,r.useEffect)(()=>{let e=setInterval(()=>{b(new Date)},6e4);return()=>clearInterval(e)},[]);let y=(0,J.c)(t)?60*v.getHours()+v.getMinutes():null,E=()=>{if(h&&null!==f&&null!==j){if(x(!1),m){let e=Math.floor(f/60),s="".concat(e.toString().padStart(2,"0"),":").concat((f%60).toString().padStart(2,"0")),a=j-f;a>=15&&m({scheduledDate:(0,u.GP)(t,"yyyy-MM-dd"),scheduledTime:s,estimatedDuration:a})}p(null),g(null)}},C=(0,r.useMemo)(()=>(0,c.Jm)(n,t),[n,t]),k=(0,r.useMemo)(()=>{let e=new Set(C.map(e=>e.technicianId).filter(e=>!!e));return 0===e.size?l.slice(0,5):l.filter(s=>e.has(s.id))},[C,l]),T=e=>{var s;if(e)return null==(s=i.find(s=>s.technicianId===e))?void 0:s.color},M=s||l.length>0;return(0,a.jsxs)("div",{className:M?"grid grid-cols-1 md:grid-cols-5 h-full":"grid grid-cols-1 h-full",children:[M&&(0,a.jsxs)("div",{className:"col-span-1 border-r bg-muted shrink-0 h-full hidden md:block",children:[(0,a.jsx)("div",{className:"h-12 border-b flex items-center px-4 font-semibold text-sm",children:"Technician"}),k.map(e=>{let s=T(e.id),r=e.availability.some(e=>e.date===(0,u.GP)(t,"yyyy-MM-dd")&&e.available);return(0,a.jsxs)("div",{className:"h-24 border-b p-3 flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-1 h-full rounded-full shrink-0",style:{backgroundColor:s||"#6b7280"}}),(0,a.jsxs)(z.eu,{className:"size-10 shrink-0",children:[(0,a.jsx)(z.BK,{src:e.avatar}),(0,a.jsx)(z.q5,{children:e.name.split(" ").map(e=>e[0]).join("").toUpperCase()})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("div",{className:"font-medium text-sm truncate",children:e.name}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground truncate",children:e.companyName||"Independent"}),(0,a.jsxs)("div",{className:"flex items-center gap-1 mt-1",children:[r?(0,a.jsx)(O.A,{className:"h-3 w-3 text-green-500"}):(0,a.jsx)(H.A,{className:"h-3 w-3 text-muted-foreground"}),(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:r?"Available":"Unavailable"})]})]})]},e.id)})]}),(0,a.jsx)(N.F,{className:M?"col-span-4 relative overflow-y-auto":"col-span-1 relative overflow-y-auto",children:(0,a.jsxs)("div",{className:" absolute flex w-full",children:[(0,a.jsx)("div",{className:"w-16 border-r bg-muted shrink-0",style:{height:"".concat(96*P.length,"px")},children:P.map(e=>(0,a.jsx)("div",{className:"h-24 border-b flex items-start justify-end pr-2 pt-1",children:(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:(0,u.GP)(new Date().setHours(e,0,0,0),"h:mm a")})},e))}),(0,a.jsx)("div",{className:"flex-1 relative select-none",ref:w,onMouseDown:e=>{if(!m||!w.current||e.target.closest("[data-event-card]"))return;let s=w.current.getBoundingClientRect(),t=15*Math.round(Math.floor((e.clientY-s.top+w.current.scrollTop)/1.6)/15);x(!0),p(t),g(t+30)},onMouseMove:e=>{if(!h||null===f||!w.current)return;let s=w.current.getBoundingClientRect(),t=15*Math.round(Math.floor((e.clientY-s.top+w.current.scrollTop)/1.6)/15);t>f&&g(t)},onMouseUp:E,onMouseLeave:E,children:(0,a.jsxs)("div",{className:"absolute inset-0",style:{display:"grid",gridTemplateColumns:"1fr",height:"".concat(96*P.length,"px")},children:[P.map(e=>(0,a.jsx)("div",{className:"col-span-full border-b border-muted absolute w-full",style:{top:"".concat(96*e,"px")}},e)),(0,a.jsxs)("div",{className:"relative size-full",children:[(()=>{let e=(0,c.XE)(C);return C.map(s=>{let t=e.get(s.id);if(!t)return null;let r=(0,A.H)(s.start),n=(0,A.H)(s.end),i=60*r.getHours()+r.getMinutes(),c=Math.max(1.6*((n.getTime()-r.getTime())/6e4),24),o=(e=>{if(e)return l.find(s=>s.id===e)})(s.technicianId),m=T(s.technicianId);return(0,a.jsx)("div",{className:"absolute px-1 py-1","data-event-card":!0,style:{top:"".concat(1.6*i,"px"),height:"".concat(c,"px"),left:"".concat(t.left,"%"),width:"".concat(t.width,"%"),zIndex:20},children:"External"===s.type||"Unscheduled"===s.type?(0,a.jsx)(D.Y,{event:s,technician:o,technicianColor:m,onOpenJob:()=>s.jobId&&d(s),onAssignTechnician:()=>s.jobId&&d(s),children:(0,a.jsx)("div",{className:"h-full",children:(0,a.jsx)(S,{event:s,technician:o,technicianColor:m,onClick:()=>d(s),className:"text-xs h-full"})})}):(0,a.jsx)(S,{event:s,technician:o,technicianColor:m,onClick:()=>d(s),className:"text-xs h-full"})},s.id)})})(),null!==y&&(0,a.jsxs)("div",{className:"absolute left-0 right-0 z-30 pointer-events-none",style:{top:"".concat(1.6*y,"px")},children:[(0,a.jsx)("div",{className:"h-0.5 bg-red-500 w-full"}),(0,a.jsx)("div",{className:"absolute left-0 top-1/2 -translate-y-1/2 w-2 h-2 bg-red-500 rounded-full -translate-x-1/2"})]}),h&&null!==f&&null!==j&&(0,a.jsx)("div",{className:"absolute left-0 right-0 bg-primary/20 border-2 border-primary rounded z-50 pointer-events-none",style:{top:"".concat(1.6*f,"px"),height:"".concat((j-f)*1.6,"px")},children:(0,a.jsxs)("div",{className:"text-xs font-medium text-primary p-1",children:[Math.floor(f/60),":",String(f%60).padStart(2,"0")," - ",Math.floor(j/60),":",String(j%60).padStart(2,"0"),(0,a.jsxs)("span",{className:"ml-1",children:["(",j-f," min)"]})]})})]})]})})]})})]})}var G=t(7415);function R(e){let{currentDate:s,events:t,technicians:n,technicianColors:l,onEventClick:i}=e,d=(0,r.useMemo)(()=>(0,c.WA)(s),[s]),o=(0,r.useMemo)(()=>{let e={},s=[],a=new Date(d.start);for(;a<=d.end;)s.push(new Date(a)),a.setDate(a.getDate()+1);return s.forEach(s=>{let a=(0,u.GP)(s,"yyyy-MM-dd"),r=t.filter(e=>{let t=(0,A.H)(e.start),a=(0,A.H)(e.end);return(0,y.r)(t,s)||(0,y.r)(a,s)||t<=s&&a>=s});r.length>0&&(r.sort((e,s)=>(0,A.H)(e.start).getTime()-(0,A.H)(s.start).getTime()),e[a]=r)}),e},[t,d]),m=Object.keys(o).sort();return(0,a.jsx)(N.F,{className:"flex-1 relative",children:(0,a.jsx)("div",{className:"p-4 space-y-6 absolute w-full",children:0===m.length?(0,a.jsx)("div",{className:"text-center text-muted-foreground py-12",children:"No events in this period"}):m.map(e=>{let s=o[e],t=(0,A.H)(e),r=(0,y.r)(t,new Date);return(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:(0,k.cn)("sticky top-0 bg-background z-10 py-2 border-b",r&&"text-primary font-semibold"),children:(0,a.jsx)("h3",{className:"text-lg font-semibold",children:(0,u.GP)(t,"EEEE, MMMM d, yyyy")})}),(0,a.jsx)("div",{className:"space-y-2",children:s.map(e=>{let s=(e=>{if(e)return n.find(s=>s.id===e)})(e.technicianId),t=(e=>{var s;if(e)return null==(s=l.find(s=>s.technicianId===e))?void 0:s.color})(e.technicianId);return(0,a.jsx)(D.Y,{event:e,technician:s,technicianColor:t,onOpenJob:()=>e.jobId&&i(e),onAssignTechnician:()=>e.jobId&&i(e),children:(0,a.jsx)("div",{className:(0,k.cn)("p-4 border rounded-lg cursor-pointer hover:bg-muted/50 transition-colors",e.hasConflict&&"border-red-500 border-dashed"),children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row items-start justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-start md:items-center gap-2",children:[(0,a.jsx)("h4",{className:"font-semibold",children:e.title}),t&&(0,a.jsx)("div",{className:"w-3 h-3 rounded-full shrink-0",style:{backgroundColor:t}})]}),e.orderNumber&&(0,a.jsxs)("div",{className:"text-xs text-muted-foreground font-mono",children:["Order #",e.orderNumber]}),e.description&&(0,a.jsx)(x.P,{className:"text-sm text-muted-foreground",children:e.description}),(0,a.jsxs)("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[!e.allDay&&(0,a.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,a.jsx)(T.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:(0,c.sH)(e.start,e.end,!0)})]}),e.territory&&(0,a.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,a.jsx)(M.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:e.territory})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 shrink-0",children:[s&&(0,a.jsx)(C.E,{variant:"secondary",className:"text-xs",children:s.name}),(0,a.jsx)(C.E,{variant:"External"===e.type?"outline":"default",className:"text-xs",children:e.type}),e.hasConflict&&(0,a.jsx)(C.E,{variant:"destructive",className:"text-xs",children:"Conflict"})]})]})})},e.id)})})]},e)})})})}var _=t(79956),F=t(33796),$=t(99228),L=t(92381),Y=t(20851),K=t(75513),V=t(93366),W=t(30275),B=t(90908),q=t(66955);function X(e){let{canSeeTechnicians:s=!1,jobs:t=[],technicians:n=[],techniciansLoading:l=!1,onJobClick:o,onCreateJob:m}=e,h=s&&n||[],[u,x]=(0,r.useState)(new Date),[p,j]=(0,r.useState)("week"),[g,v]=(0,r.useState)("America/Edmonton"),[N,b]=(0,r.useState)({eventTypes:{Scheduled:!0,Unscheduled:!0,External:!0},territories:[],technicians:[]}),[w,y]=(0,r.useState)(!1),C=(0,r.useMemo)(()=>(0,i.q)(h),[h]),k=(0,r.useMemo)(()=>t.map(e=>(0,c.Ve)(e)),[t]),T=(0,r.useMemo)(()=>k.filter(e=>!!N.eventTypes[e.type]&&(!(N.technicians.length>0)||!!e.technicianId&&!!N.technicians.includes(e.technicianId))&&(!(N.territories.length>0)||!!e.territory&&!!N.territories.includes(e.territory))),[k,N]),M=(0,r.useMemo)(()=>T.map(e=>{if(!e.technicianId)return e;let s=T.some(s=>{if(s.technicianId===e.technicianId&&s.id!==e.id){let t=(0,A.H)(e.start),a=(0,A.H)(e.end),r=(0,A.H)(s.start);return t<(0,A.H)(s.end)&&r<a}return!1});return{...e,hasConflict:s}}),[T]),S=(0,r.useMemo)(()=>{let e=new Set;return k.forEach(s=>{s.territory&&e.add(s.territory)}),Array.from(e)},[k]),D=e=>{if(e.jobId&&o){let s=t.find(s=>s.id===e.jobId);s&&o(s)}},J=e=>{x(e),j("day")},z=(0,a.jsx)(E,{canSeeTechnicians:s,currentDate:u,view:p,onDateSelect:e=>{x(e),(0,W.a)()&&y(!1)},filters:N,onFiltersChange:b,technicians:h,techniciansLoading:l,technicianColors:C,territories:S,timezone:g,onTimezoneChange:v});return(0,a.jsxs)("div",{className:"flex flex-col size-full",children:[(0,a.jsx)(f,{currentDate:u,view:p,onPrev:()=>{switch(p){case"day":x((0,_.e)(u,1));break;case"week":case"list":x((0,F.k)(u,1));break;case"month":x((0,$.a)(u,1))}},onNext:()=>{switch(p){case"day":x((0,L.f)(u,1));break;case"week":case"list":x((0,Y.J)(u,1));break;case"month":x((0,K.P)(u,1))}},onToday:()=>{x((0,V.o)(new Date))},onViewChange:j,onCreateJob:m}),(0,a.jsxs)("div",{className:"flex overflow-hidden relative h-full",children:[(0,a.jsx)("div",{className:"flex-1 min-w-0 overflow-auto",children:(()=>{let e={currentDate:u,events:M,technicians:h,technicianColors:C,onEventClick:D};switch(p){case"day":return(0,a.jsx)(U,{...e,onCreateJob:m,canSeeTechnicians:s});case"week":default:return(0,a.jsx)(I,{...e});case"month":return(0,a.jsx)(G.c,{...e,onDayClick:J});case"list":return(0,a.jsx)(R,{...e})}})()}),(0,W.a)()?(0,a.jsxs)(B._s,{open:w,onOpenChange:y,children:[(0,a.jsx)(B.Uz,{asChild:!0,children:(0,a.jsx)(d.$,{variant:"default",size:"icon",className:"fixed bottom-[calc(var(--dock-h)+0.5rem)] right-2 z-50 rounded-full size-12 p-0",children:(0,a.jsx)(q.A,{className:"size-5"})})}),(0,a.jsxs)(B.zj,{children:[(0,a.jsx)(B.BE,{className:"sr-only",children:(0,a.jsx)(B.gk,{children:"Filters"})}),(0,a.jsx)("div",{className:"overflow-y-scroll size-full",children:z})]})]}):(0,a.jsx)("div",{className:"w-72 xl:w-80 shrink-0 border-l bg-background overflow-hidden",children:z})]})]})}var Z=t(61771),Q=t(42892),ee=t(55678),es=t(69802),et=t(32580),ea=t(37119),er=t(62816),en=t(80408),el=t(35722);function ei(){var e,s;let t=(0,n.useRouter)(),{user:i,isLoading:c,organizationId:d,memberships:o}=(0,l.l)(["COMPANY","AGENT","TECHNICIAN","EDITOR","PROJECT_MANAGER"]),m=(0,ee.w)(),h=(0,es.I)(),u=(0,et._)(),[x,f]=(0,r.useState)([]),[p,j]=(0,r.useState)(!1),g=(0,r.useRef)(new Set),v=(0,r.useMemo)(()=>{if(!i)return[];let e=o.find(e=>e.orgId===d),s=((null==e?void 0:e.role)||(null==e?void 0:e.orgRole)||"").toUpperCase();return"TECHNICIAN"===s?m.jobs.filter(e=>e.assignedTechnicianId===i.id):"EDITOR"===s?m.jobs.filter(e=>e.editorId===i.id):m.jobs},[m.jobs,o,d,i]),N="AGENT"===((null==i?void 0:i.accountType)||"").toUpperCase();if((0,r.useEffect)(()=>{if(m.selectedJob){var e;let s=m.selectedJob.id;if(g.current.has(s))return;g.current.add(s);let t=null==(e=m.selectedJob)?void 0:e.organizationId;N||h.fetchMessages(s,"TEAM",t);let a=o.find(e=>e.orgId===d),r=((null==a?void 0:a.role)||(null==a?void 0:a.orgRole)||"").toUpperCase();(N||["OWNER","ADMIN","PROJECT_MANAGER"].includes(r))&&h.fetchMessages(s,"CUSTOMER",t)}},[null==(e=m.selectedJob)?void 0:e.id,o,d,N]),!i)return null;let b=(0,en.aJ)(i,o,d),w=o.find(e=>e.orgId===d),y=(null==w||null==(s=w.organization)?void 0:s.type)==="PERSONAL"||(null==w?void 0:w.organizationType)==="PERSONAL",E=((null==w?void 0:w.role)||(null==w?void 0:w.orgRole)||"").toUpperCase(),C=(0,en.UD)(b)&&!("PROJECT_MANAGER"===E&&!y)&&!("EDITOR"===E&&!y),k=(0,en.UD)(b)&&!y;(0,r.useEffect)(()=>{let e=!1;return(async()=>{if(!k){f([]),j(!1);return}j(!0);try{let s=(await (0,el.NV)()).filter(e=>"TECHNICIAN"===(e.role||"").toUpperCase());e||f(s)}catch(s){console.error("Failed to load technicians for calendar",s),e||f([])}finally{e||j(!1)}})(),()=>{e=!0}},[k,d]);let T=m.openTaskView,M=m.openTaskDialog,S=m.handleTaskDialogClose,D=m.handleTaskViewClose,A=(e,s)=>{let t={pending:Z.Ks.BOOKED,assigned:Z.Ks.SHOOTING,in_progress:Z.Ks.SHOOTING,editing:Z.Ks.EDITING,delivered:Z.Ks.DELIVERED,cancelled:Z.Ks.BOOKED};m.changeJobStatus(e,t[s]||Z.Ks.BOOKED)};return(0,a.jsxs)("div",{className:"size-full overflow-x-hidden space-y-6",children:[(0,a.jsx)(er.WT,{fallback:(0,a.jsx)(Q.a1,{}),children:(0,a.jsx)(X,{canSeeTechnicians:k,jobs:v,technicians:x,techniciansLoading:p,onJobClick:T,onCreateJob:C?e=>{C&&u.openJobCreationDialog(e)}:void 0})}),(0,a.jsx)(ea.m,{job:m.selectedJob,messages:m.selectedJob?h.getMessagesForJob(m.selectedJob.id):[],currentUserId:(null==i?void 0:i.id)||"current-user-id",currentUserName:(null==i?void 0:i.name)||"Current User",currentUserAccountType:null==i?void 0:i.accountType,isClient:!1,open:m.showTaskView,onOpenChange:D,onSendMessage:(e,s,t)=>{var a;return h.sendMessage((null==(a=m.selectedJob)?void 0:a.id)||"",e,s,t)},onEditMessage:(e,s)=>h.editMessage(e,s),onDeleteMessage:e=>h.deleteMessage(e),onStatusChange:e=>{m.selectedJob&&A(m.selectedJob.id,e)},onAssignTechnician:m.handleAssignTechnician,onChangeTechnician:m.handleChangeTechnician,variant:"sheet",onFullScreen:M,onOpenInNewPage:()=>{m.selectedJob&&t.push("/jobs/".concat(m.selectedJob.id))}}),(0,a.jsx)(ea.m,{job:m.selectedJob,messages:m.selectedJob?h.getMessagesForJob(m.selectedJob.id):[],currentUserId:(null==i?void 0:i.id)||"current-user-id",currentUserName:(null==i?void 0:i.name)||"Current User",currentUserAccountType:null==i?void 0:i.accountType,isClient:!1,open:m.showTaskDialog,onOpenChange:S,onSendMessage:(e,s,t)=>{var a;return h.sendMessage((null==(a=m.selectedJob)?void 0:a.id)||"",e,s,t)},onEditMessage:(e,s)=>h.editMessage(e,s),onDeleteMessage:e=>h.deleteMessage(e),onStatusChange:e=>{m.selectedJob&&A(m.selectedJob.id,e)},onAssignTechnician:m.handleAssignTechnician,onChangeTechnician:m.handleChangeTechnician,variant:"dialog"})]})}},84916:(e,s,t)=>{"use strict";t.d(s,{S:()=>i});var a=t(95155);t(12115);var r=t(38162),n=t(5917),l=t(25016);function i(e){let{className:s,...t}=e;return(0,a.jsx)(r.bL,{"data-slot":"checkbox",className:(0,l.cn)("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",s),...t,children:(0,a.jsx)(r.C1,{"data-slot":"checkbox-indicator",className:"grid place-content-center text-current transition-none",children:(0,a.jsx)(n.A,{className:"size-3.5"})})})}},90908:(e,s,t)=>{"use strict";t.d(s,{BE:()=>m,Uz:()=>i,_s:()=>l,gk:()=>h,zj:()=>o});var a=t(95155);t(12115);var r=t(83161),n=t(64936);function l(e){let{direction:s="bottom",...t}=e;return(0,a.jsx)(r._s.Root,{"data-slot":"drawer",...t})}function i(e){let{...s}=e;return(0,a.jsx)(r._s.Trigger,{"data-slot":"drawer-trigger",...s})}function c(e){let{...s}=e;return(0,a.jsx)(r._s.Portal,{"data-slot":"drawer-portal",...s})}function d(e){let{className:s,...t}=e;return(0,a.jsx)(r._s.Overlay,{"data-slot":"drawer-overlay",className:(0,n.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",s),...t})}function o(e){let{className:s,children:t,...l}=e;return(0,a.jsxs)(c,{"data-slot":"drawer-portal",children:[(0,a.jsx)(d,{}),(0,a.jsxs)(r._s.Content,{"data-slot":"drawer-content",className:(0,n.cn)("group/drawer-content bg-background fixed z-50 flex h-auto flex-col","data-[vaul-drawer-direction=top]:inset-x-0 data-[vaul-drawer-direction=top]:top-0 data-[vaul-drawer-direction=top]:mb-24 data-[vaul-drawer-direction=top]:max-h-[80vh] data-[vaul-drawer-direction=top]:rounded-b-lg data-[vaul-drawer-direction=top]:border-b","data-[vaul-drawer-direction=bottom]:inset-x-0 data-[vaul-drawer-direction=bottom]:bottom-0 data-[vaul-drawer-direction=bottom]:mt-24 data-[vaul-drawer-direction=bottom]:max-h-[80vh] data-[vaul-drawer-direction=bottom]:rounded-t-lg data-[vaul-drawer-direction=bottom]:border-t","data-[vaul-drawer-direction=right]:inset-y-0 data-[vaul-drawer-direction=right]:right-0 data-[vaul-drawer-direction=right]:w-3/4 data-[vaul-drawer-direction=right]:border-l data-[vaul-drawer-direction=right]:sm:max-w-sm","data-[vaul-drawer-direction=left]:inset-y-0 data-[vaul-drawer-direction=left]:left-0 data-[vaul-drawer-direction=left]:w-3/4 data-[vaul-drawer-direction=left]:border-r data-[vaul-drawer-direction=left]:sm:max-w-sm",s),...l,children:[(0,a.jsx)("div",{className:"bg-muted mx-auto mt-4 hidden h-2 w-[100px] shrink-0 rounded-full group-data-[vaul-drawer-direction=bottom]/drawer-content:block"}),t]})]})}function m(e){let{className:s,...t}=e;return(0,a.jsx)("div",{"data-slot":"drawer-header",className:(0,n.cn)("flex flex-col gap-1.5 p-4",s),...t})}function h(e){let{className:s,...t}=e;return(0,a.jsx)(r._s.Title,{"data-slot":"drawer-title",className:(0,n.cn)("text-foreground font-semibold",s),...t})}}},e=>{e.O(0,[541,5004,277,547,5707,2110,8234,2619,4001,3409,1204,9360,1163,550,1130,7117,2303,7770,9829,3161,5181,1587,5657,5939,4802,4729,2816,1382,8441,1255,7358],()=>e(e.s=36722)),_N_E=e.O()}]);