(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7177],{5379:(e,t,n)=>{"use strict";n.d(t,{D:()=>l,N:()=>d});var r=n(12115),o=(e,t,n,r,o,a,s,i)=>{let c=document.documentElement,l=["light","dark"];function d(t){var n;(Array.isArray(e)?e:[e]).forEach(e=>{let n="class"===e,r=n&&a?o.map(e=>a[e]||e):o;n?(c.classList.remove(...r),c.classList.add(a&&a[t]?a[t]:t)):c.setAttribute(e,t)}),n=t,i&&l.includes(n)&&(c.style.colorScheme=n)}if(r)d(r);else try{let e=localStorage.getItem(t)||n,r=s&&"system"===e?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":e;d(r)}catch(e){}},a=["light","dark"],s="(prefers-color-scheme: dark)",i=r.createContext(void 0),c={setTheme:e=>{},themes:[]},l=()=>{var e;return null!=(e=r.useContext(i))?e:c},d=e=>r.useContext(i)?r.createElement(r.Fragment,null,e.children):r.createElement(m,{...e}),u=["light","dark"],m=e=>{let{forcedTheme:t,disableTransitionOnChange:n=!1,enableSystem:o=!0,enableColorScheme:c=!0,storageKey:l="theme",themes:d=u,defaultTheme:m=o?"system":"light",attribute:p="data-theme",value:w,children:k,nonce:y,scriptProps:g}=e,[C,E]=r.useState(()=>f(l,m)),[S,A]=r.useState(()=>"system"===C?b():C),x=w?Object.values(w):d,_=r.useCallback(e=>{let t=e;if(!t)return;"system"===e&&o&&(t=b());let r=w?w[t]:t,s=n?v(y):null,i=document.documentElement,l=e=>{"class"===e?(i.classList.remove(...x),r&&i.classList.add(r)):e.startsWith("data-")&&(r?i.setAttribute(e,r):i.removeAttribute(e))};if(Array.isArray(p)?p.forEach(l):l(p),c){let e=a.includes(m)?m:null,n=a.includes(t)?t:e;i.style.colorScheme=n}null==s||s()},[y]),N=r.useCallback(e=>{let t="function"==typeof e?e(C):e;E(t);try{localStorage.setItem(l,t)}catch(e){}},[C]),M=r.useCallback(e=>{A(b(e)),"system"===C&&o&&!t&&_("system")},[C,t]);r.useEffect(()=>{let e=window.matchMedia(s);return e.addListener(M),M(e),()=>e.removeListener(M)},[M]),r.useEffect(()=>{let e=e=>{e.key===l&&(e.newValue?E(e.newValue):N(m))};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[N]),r.useEffect(()=>{_(null!=t?t:C)},[t,C]);let P=r.useMemo(()=>({theme:C,setTheme:N,forcedTheme:t,resolvedTheme:"system"===C?S:C,themes:o?[...d,"system"]:d,systemTheme:o?S:void 0}),[C,N,t,S,o,d]);return r.createElement(i.Provider,{value:P},r.createElement(h,{forcedTheme:t,storageKey:l,attribute:p,enableSystem:o,enableColorScheme:c,defaultTheme:m,value:w,themes:d,nonce:y,scriptProps:g}),k)},h=r.memo(e=>{let{forcedTheme:t,storageKey:n,attribute:a,enableSystem:s,enableColorScheme:i,defaultTheme:c,value:l,themes:d,nonce:u,scriptProps:m}=e,h=JSON.stringify([a,n,c,t,d,l,s,i]).slice(1,-1);return r.createElement("script",{...m,suppressHydrationWarning:!0,nonce:"",dangerouslySetInnerHTML:{__html:"(".concat(o.toString(),")(").concat(h,")")}})}),f=(e,t)=>{let n;try{n=localStorage.getItem(e)||void 0}catch(e){}return n||t},v=e=>{let t=document.createElement("style");return e&&t.setAttribute("nonce",e),t.appendChild(document.createTextNode("*,*::before,*::after{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),document.head.appendChild(t),()=>{window.getComputedStyle(document.body),setTimeout(()=>{document.head.removeChild(t)},1)}},b=e=>(e||(e=window.matchMedia(s)),e.matches?"dark":"light")},35633:e=>{e.exports={style:{fontFamily:"'IBM Plex Sans', 'IBM Plex Sans Fallback'",fontStyle:"normal"},className:"__className_67235b",variable:"__variable_67235b"}},41290:()=>{},48988:(e,t,n)=>{"use strict";n.d(t,{i:()=>i,o:()=>s});var r=n(95155),o=n(12115);let a=(0,o.createContext)(void 0);function s(e){let{children:t}=e,[n,s]=(0,o.useState)([]),[i,c]=(0,o.useState)(new Map),[l,d]=(0,o.useState)(new Map),u=(0,o.useCallback)((e,t)=>{let n=new Date,r="".concat(e,":").concat(t);c(o=>{let a=(o.get(r)||0)+1,i=new Map(o);return i.set(r,a),a>=3&&s(r=>{let o=r.find(n=>n.type===e&&n.message===t);return o?r.map(e=>e.id===o.id?{...e,timestamp:n}:e):[...r,{id:"".concat(e,"-").concat(Date.now(),"-").concat(Math.random()),type:e,message:t,timestamp:n}]}),i}),setTimeout(()=>{c(e=>{let t=new Map(e);return t.delete(r),t})},3e4)},[]),m=(0,o.useCallback)(e=>{s(t=>t.filter(t=>t.id!==e))},[]),h=(0,o.useCallback)(()=>{s([]),c(new Map)},[]);(0,o.useEffect)(()=>{let e=e=>{u("api",e.detail.message)},t=()=>{let e=new Date;d(t=>{let n=new Map(t);return n.set("api",e),n}),s(e=>e.filter(e=>"api"!==e.type))},n=e=>{u("websocket",e.detail.message)},r=()=>{let e=new Date;d(t=>{let n=new Map(t);return n.set("websocket",e),n}),s(e=>e.filter(e=>"websocket"!==e.type))};return window.addEventListener("backend-api-error",e),window.addEventListener("backend-api-success",t),window.addEventListener("backend-websocket-error",n),window.addEventListener("backend-websocket-success",r),()=>{window.removeEventListener("backend-api-error",e),window.removeEventListener("backend-api-success",t),window.removeEventListener("backend-websocket-error",n),window.removeEventListener("backend-websocket-success",r)}},[u]);let f=n.length>0;return(0,r.jsx)(a.Provider,{value:{issues:n,addIssue:u,clearIssue:m,clearAllIssues:h,hasPersistentIssues:f},children:t})}function i(){let e=(0,o.useContext)(a);if(void 0===e)throw Error("useBackendHealth must be used within a BackendHealthProvider");return e}},60893:e=>{e.exports={style:{fontFamily:"'Inter', 'Inter Fallback'",fontStyle:"normal"},className:"__className_f367f3",variable:"__variable_f367f3"}},67285:(e,t,n)=>{"use strict";n.d(t,{y:()=>o});var r=n(30926);let o=(0,r.createServerReference)("7f3cc662e3a9a075e1f1c403081f6825bda59e3067",r.callServer,void 0,r.findSourceMapURL,"invalidateCacheAction")},71709:e=>{e.exports={style:{fontFamily:"'IBM Plex Mono', 'IBM Plex Mono Fallback'",fontStyle:"normal"},className:"__className_fbab85",variable:"__variable_fbab85"}},80584:(e,t,n)=>{"use strict";n.d(t,{Providers:()=>u});var r=n(95155);n(12115);var o=n(5379);function a(e){let{children:t,...n}=e;return(0,r.jsx)(o.N,{...n,children:t})}var s=n(65939),i=n(48988),c=n(99522),l=n(18720);let d=e=>{let{...t}=e,{theme:n="system"}=(0,o.D)();return(0,r.jsx)(l.l$,{theme:n,className:"toaster group",style:{"--normal-bg":"var(--popover)","--normal-text":"var(--popover-foreground)","--normal-border":"var(--border)"},...t})};function u(e){let{children:t}=e;return(0,r.jsx)(a,{attribute:"class",defaultTheme:"system",enableSystem:!0,disableTransitionOnChange:!0,children:(0,r.jsx)(s.O,{children:(0,r.jsx)(c._,{children:(0,r.jsxs)(i.o,{children:[t,(0,r.jsx)(d,{})]})})})})}},84106:(e,t,n)=>{Promise.resolve().then(n.t.bind(n,41290,23)),Promise.resolve().then(n.bind(n,80584)),Promise.resolve().then(n.bind(n,99961)),Promise.resolve().then(n.bind(n,78543)),Promise.resolve().then(n.bind(n,22004)),Promise.resolve().then(n.bind(n,23618)),Promise.resolve().then(n.bind(n,47471)),Promise.resolve().then(n.bind(n,11526)),Promise.resolve().then(n.t.bind(n,60893,23)),Promise.resolve().then(n.t.bind(n,35633,23)),Promise.resolve().then(n.t.bind(n,71709,23))},91637:(e,t,n)=>{"use strict";n.d(t,{A:()=>o});var r=n(30926);let o=(0,r.createServerReference)("7fc577a815542e40e0d1c7f119be9aaa6801ac003b",r.callServer,void 0,r.findSourceMapURL,"detectKeylessEnvDriftAction")},99522:(e,t,n)=>{"use strict";n.d(t,{_:()=>m,E:()=>u});var r=n(95155),o=n(12115),a=n(95657),s=n(65939),i=n(9829);class c{connect(e){if(this.isConnecting||this.socket&&this.socket.connected)return;this.isConnecting=!0;let t=e||localStorage.getItem("token")||void 0;if(!t){this.isConnecting=!1;return}this.socket=(0,i.io)("".concat("http://localhost:3001","/notifications"),{autoConnect:!0,transports:["websocket"],auth:{token:t},reconnection:!0,reconnectionAttempts:this.maxReconnectAttempts,reconnectionDelay:1e3,reconnectionDelayMax:5e3}),this.socket.on("connect",()=>{this.isConnecting=!1,this.reconnectAttempts=0,this.connectionHandlers.forEach(e=>e(!0))}),this.socket.on("connect_error",e=>{this.isConnecting=!1,this.reconnectAttempts++,console.error("[NotificationSocket] Connection error:",e.message),this.reconnectAttempts>=this.maxReconnectAttempts&&(console.warn("[NotificationSocket] Max reconnect attempts reached, falling back to polling"),this.connectionHandlers.forEach(e=>e(!1)))}),this.socket.on("disconnect",e=>{if(this.connectionHandlers.forEach(e=>e(!1)),"io server disconnect"===e||"io client disconnect"===e)return}),this.socket.on("connected",e=>{console.debug("[NotificationSocket] Connected for user:",e.userId)}),this.socket.on("notification",e=>{this.notificationHandlers.forEach(t=>t(e))}),this.socket.on("countUpdate",e=>{this.countUpdateHandlers.forEach(t=>t(e))})}disconnect(){this.socket&&(this.socket.removeAllListeners(),this.socket.disconnect(),this.socket=null),this.isConnecting=!1,this.reconnectAttempts=0}isConnected(){var e,t;return null!=(t=null==(e=this.socket)?void 0:e.connected)&&t}onNotification(e){this.notificationHandlers.add(e)}offNotification(e){this.notificationHandlers.delete(e)}onCountUpdate(e){this.countUpdateHandlers.add(e)}offCountUpdate(e){this.countUpdateHandlers.delete(e)}onConnectionChange(e){this.connectionHandlers.add(e)}offConnectionChange(e){this.connectionHandlers.delete(e)}constructor(){this.socket=null,this.notificationHandlers=new Set,this.countUpdateHandlers=new Set,this.connectionHandlers=new Set,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.isConnecting=!1}}let l=new c,d=(0,o.createContext)(null);function u(){let e=(0,o.useContext)(d);if(!e)throw Error("useNotifications must be used within NotificationsProvider");return e}function m(e){let{children:t}=e,{user:n,isLoading:i,token:c}=(0,s.A)(),u=!!n,[m,h]=(0,o.useState)([]),[f,v]=(0,o.useState)(!1),[b,p]=(0,o.useState)(null),[w,k]=(0,o.useState)(!1),y=(0,o.useRef)(0),g=(0,o.useRef)(!1),C=(0,o.useRef)(null),E=(0,o.useRef)(!0),S=(0,o.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!u)return void h([]);if(g.current)return;let t=Date.now();if(e||!(t-y.current<5e3)){g.current=!0,v(!0),p(null);try{let e=await a.F.notifications.list();h(e),y.current=Date.now()}catch(e){console.error("Failed to fetch notifications:",e),p(e instanceof Error?e:Error("Failed to fetch notifications"))}finally{v(!1),g.current=!1}}},[u]),A=(0,o.useCallback)(()=>{C.current||(C.current=setInterval(()=>{E.current&&u&&S()},6e4))},[S,u]),x=(0,o.useCallback)(()=>{C.current&&(clearInterval(C.current),C.current=null)},[]);(0,o.useEffect)(()=>{let e=()=>{let e="visible"===document.visibilityState;E.current=e,e&&u?(S(),A()):x()};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}},[S,A,x,u]);let _=(0,o.useCallback)(e=>{let t=e.payload||{};return{id:e.id,type:e.type,orgId:e.orgId||"",orgName:t.organizationName||"",orgType:t.orgType||"COMPANY",createdAt:new Date(e.createdAt),readAt:void 0,projectId:e.projectId,projectAddress:t.address,assignedRole:t.role,messagePreview:t.preview,messageChannel:t.channel,approverName:t.approverName,deliveryToken:t.deliveryToken}},[]);(0,o.useEffect)(()=>{if(i||!u||!c)return;let e=e=>{let t=_(e);h(e=>e.some(e=>e.id===t.id)?e:[t,...e])},t=e=>{k(e),e?x():A()};return l.onNotification(e),l.onConnectionChange(t),l.connect(c),()=>{l.offNotification(e),l.offConnectionChange(t),l.disconnect()}},[u,i,c,_,A,x]),(0,o.useEffect)(()=>{if(!i)return u?(S(!0),w||A()):(h([]),x(),l.disconnect()),()=>{x()}},[u,i,S,A,x,w]),(0,o.useEffect)(()=>()=>{x(),l.disconnect()},[x]);let N=(0,o.useCallback)(async e=>{try{await a.F.notifications.markRead(e),h(t=>t.map(t=>t.id===e?{...t,readAt:new Date}:t))}catch(e){throw console.error("Failed to mark notification as read:",e),e}},[]),M=(0,o.useCallback)(async()=>{try{await a.F.notifications.markAllRead(),h(e=>e.map(e=>({...e,readAt:e.readAt||new Date})))}catch(e){throw console.error("Failed to mark all notifications as read:",e),e}},[]),P=(0,o.useCallback)(async(e,t)=>{try{await a.F.invitations.accept(t),h(t=>t.filter(t=>t.id!==e))}catch(e){throw console.error("Failed to accept invitation:",e),e}},[]),L=(0,o.useCallback)(async(e,t)=>{try{await a.F.invitations.decline(t),h(t=>t.filter(t=>t.id!==e))}catch(e){throw console.error("Failed to decline invitation:",e),e}},[]),T=(0,o.useMemo)(()=>m.filter(e=>!e.readAt).length,[m]),F=(0,o.useMemo)(()=>({notifications:m,unreadCount:T,isLoading:f,error:b,refetch:()=>S(!0),markAsRead:N,markAllAsRead:M,acceptInvitation:P,declineInvitation:L}),[m,T,f,b,S,N,M,P,L]);return(0,r.jsx)(d.Provider,{value:F,children:t})}}},e=>{e.O(0,[1741,7269,547,2110,9829,4415,5657,5939,8441,1255,7358],()=>e(e.s=84106)),_N_E=e.O()}]);