(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9881],{18732:(e,t,a)=>{Promise.resolve().then(a.bind(a,58965))},25016:(e,t,a)=>{"use strict";a.d(t,{cn:()=>n,e:()=>l,w:()=>i});var r=a(2821),s=a(75889);function n(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,s.QP)((0,r.$)(t))}let l=!1;function i(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t){let t=[];return e.street&&t.push(e.street),t.push(e.city),t.push(e.stateProvince),e.postalCode&&t.push(e.postalCode),t.push(e.country),t.join(", ")}return"".concat(e.city,", ").concat(e.stateProvince,", ").concat(e.country)}},32559:(e,t,a)=>{"use strict";a.d(t,{Fc:()=>i,TN:()=>d,XL:()=>o});var r=a(95155);a(12115);var s=a(83101),n=a(64936);let l=(0,s.F)("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function i(e){let{className:t,variant:a,...s}=e;return(0,r.jsx)("div",{"data-slot":"alert",role:"alert",className:(0,n.cn)(l({variant:a}),t),...s})}function o(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"alert-title",className:(0,n.cn)("col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight",t),...a})}function d(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"alert-description",className:(0,n.cn)("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",t),...a})}},33884:(e,t,a)=>{"use strict";a.d(t,{BK:()=>i,eu:()=>l,q5:()=>o});var r=a(95155);a(12115);var s=a(63366),n=a(64936);function l(e){let{className:t,...a}=e;return(0,r.jsx)(s.bL,{"data-slot":"avatar",className:(0,n.cn)("relative flex size-10 shrink-0 overflow-hidden rounded-full",t),...a})}function i(e){let{className:t,...a}=e;return(0,r.jsx)(s._V,{"data-slot":"avatar-image",className:(0,n.cn)("aspect-square size-full",t),...a})}function o(e){let{className:t,...a}=e;return(0,r.jsx)(s.H4,{"data-slot":"avatar-fallback",className:(0,n.cn)("bg-muted flex size-full items-center justify-center rounded-full",t),...a})}},54679:(e,t,a)=>{"use strict";a.d(t,{Cf:()=>u,Es:()=>x,L3:()=>h,c7:()=>m,lG:()=>i,rr:()=>g,zM:()=>o});var r=a(95155);a(12115);var s=a(93409),n=a(65229),l=a(64936);function i(e){let{...t}=e;return(0,r.jsx)(s.bL,{"data-slot":"dialog",...t})}function o(e){let{...t}=e;return(0,r.jsx)(s.l9,{"data-slot":"dialog-trigger",...t})}function d(e){let{...t}=e;return(0,r.jsx)(s.ZL,{"data-slot":"dialog-portal",...t})}function c(e){let{className:t,...a}=e;return(0,r.jsx)(s.hJ,{"data-slot":"dialog-overlay",className:(0,l.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...a})}function u(e){let{className:t,children:a,...i}=e;return(0,r.jsxs)(d,{"data-slot":"dialog-portal",children:[(0,r.jsx)(c,{}),(0,r.jsxs)(s.UC,{"data-slot":"dialog-content",className:(0,l.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border-none p-6 shadow-lg duration-200 sm:max-w-lg",t),...i,children:[a,(0,r.jsxs)(s.bm,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[(0,r.jsx)(n.A,{}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function m(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"dialog-header",className:(0,l.cn)("flex flex-col gap-2 text-center sm:text-left",t),...a})}function x(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"dialog-footer",className:(0,l.cn)("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...a})}function h(e){let{className:t,...a}=e;return(0,r.jsx)(s.hE,{"data-slot":"dialog-title",className:(0,l.cn)("text-lg leading-none font-semibold",t),...a})}function g(e){let{className:t,...a}=e;return(0,r.jsx)(s.VY,{"data-slot":"dialog-description",className:(0,l.cn)("text-muted-foreground text-sm",t),...a})}},58965:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>W});var r=a(95155),s=a(12115),n=a(20063),l=a(95657),i=a(61771),o=a(67812),d=a(42529),c=a(6132),u=a(26983),m=a(19408),x=a(21873),h=a(16485),g=a(71163),p=a(15239);function v(e){let{organization:t,project:a}=e,s=[a.addressLine1,a.city,a.region].filter(Boolean).join(", ");return(0,r.jsx)("header",{className:"border-b bg-card",children:(0,r.jsxs)("div",{className:"container max-w-7xl mx-auto px-4 py-6",children:[(0,r.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[t.logoUrl?(0,r.jsx)(p.default,{src:t.logoUrl,alt:t.name,width:48,height:48,className:"rounded-lg object-cover"}):(0,r.jsx)("div",{className:"w-12 h-12 rounded-lg bg-primary/10 flex items-center justify-center",children:(0,r.jsx)(m.A,{className:"h-6 w-6 text-primary"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-xl font-semibold",children:t.name}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Media Delivery"})]})]}),(0,r.jsxs)("div",{className:"flex flex-col items-end gap-1",children:[function(e){switch(e){case i.bk.APPROVED:return(0,r.jsxs)(o.E,{variant:"default",className:"bg-emerald-500 hover:bg-emerald-600",children:[(0,r.jsx)(d.A,{className:"h-3 w-3 mr-1"}),"Approved"]});case i.bk.CHANGES_REQUESTED:return(0,r.jsxs)(o.E,{variant:"destructive",children:[(0,r.jsx)(c.A,{className:"h-3 w-3 mr-1"}),"Changes Requested"]});case i.bk.PENDING_REVIEW:default:return(0,r.jsxs)(o.E,{variant:"secondary",children:[(0,r.jsx)(u.A,{className:"h-3 w-3 mr-1"}),"Pending Review"]})}}(a.clientApprovalStatus),a.clientApprovalStatus===i.bk.APPROVED&&a.clientApprovedAt&&(0,r.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Approved on ",(0,g.GP)(a.clientApprovedAt,"MMM d, yyyy")]})]})]}),(0,r.jsxs)("div",{className:"mt-6 flex flex-wrap gap-4 text-sm text-muted-foreground",children:[s&&(0,r.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,r.jsx)(x.A,{className:"h-4 w-4"}),(0,r.jsx)("span",{children:s})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,r.jsx)(h.A,{className:"h-4 w-4"}),(0,r.jsx)("span",{children:(0,g.GP)(a.scheduledTime,"MMMM d, yyyy")})]})]})]})})}var f=a(90923),j=a(54679),b=a(97003),N=a(95664),y=a(60890),w=a(89715),A=a(39068),k=a(65229),z=a(90368),C=a(27937),R=a(39867);let E={[i.zu.PHOTO]:(0,r.jsx)(N.A,{className:"h-4 w-4"}),[i.zu.VIDEO]:(0,r.jsx)(y.A,{className:"h-4 w-4"}),[i.zu.FLOORPLAN]:(0,r.jsx)(w.A,{className:"h-4 w-4"}),[i.zu.DOCUMENT]:(0,r.jsx)(w.A,{className:"h-4 w-4"}),[i.zu.VIRTUAL_TOUR]:(0,r.jsx)(A.A,{className:"h-4 w-4"})},D={[i.zu.PHOTO]:"Photos",[i.zu.VIDEO]:"Videos",[i.zu.FLOORPLAN]:"Floor Plans",[i.zu.DOCUMENT]:"Documents",[i.zu.VIRTUAL_TOUR]:"Virtual Tours"};function F(e){return e.externalUrl?e.externalUrl:e.cdnUrl?e.cdnUrl:e.key?"https://ucarecdn.com/".concat(e.key,"/"):""}function _(e){let{media:t,token:a}=e,[n,l]=(0,s.useState)("ALL"),[o,d]=(0,s.useState)(!1),[c,u]=(0,s.useState)(0),m=(0,s.useMemo)(()=>Array.from(new Set(t.map(e=>e.type))),[t]),x=(0,s.useMemo)(()=>"ALL"===n?t:t.filter(e=>e.type===n),[t,n]),h=(0,s.useMemo)(()=>{let e={ALL:t.length};for(let a of t)e[a.type]=(e[a.type]||0)+1;return e},[t]),g=x[c];return 0===t.length?(0,r.jsxs)("div",{className:"text-center py-16",children:[(0,r.jsx)(N.A,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),(0,r.jsx)("h3",{className:"text-lg font-medium",children:"No media yet"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"Media will appear here once uploaded."})]}):(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"mb-6",children:(0,r.jsx)(f.tU,{value:n,onValueChange:e=>l(e),children:(0,r.jsxs)(f.j7,{children:[(0,r.jsxs)(f.Xi,{value:"ALL",children:["All (",h.ALL,")"]}),m.map(e=>(0,r.jsxs)(f.Xi,{value:e,className:"gap-1.5",children:[E[e],D[e]," (",h[e]||0,")"]},e))]})})}),(0,r.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:x.map((e,t)=>(0,r.jsxs)("button",{onClick:()=>{u(t),d(!0)},className:"group relative aspect-square rounded-lg overflow-hidden bg-muted hover:ring-2 hover:ring-primary transition-all",children:[e.type===i.zu.VIDEO?(0,r.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-muted",children:(0,r.jsx)(y.A,{className:"h-12 w-12 text-muted-foreground"})}):e.type===i.zu.DOCUMENT||e.type===i.zu.FLOORPLAN?(0,r.jsxs)("div",{className:"w-full h-full flex flex-col items-center justify-center bg-muted p-4",children:[(0,r.jsx)(w.A,{className:"h-12 w-12 text-muted-foreground mb-2"}),(0,r.jsx)("span",{className:"text-xs text-muted-foreground text-center truncate max-w-full",children:e.filename})]}):e.type===i.zu.VIRTUAL_TOUR?(0,r.jsxs)("div",{className:"w-full h-full flex flex-col items-center justify-center bg-muted p-4",children:[(0,r.jsx)(A.A,{className:"h-12 w-12 text-muted-foreground mb-2"}),(0,r.jsx)("span",{className:"text-xs text-muted-foreground text-center truncate max-w-full",children:e.filename||"Virtual Tour"})]}):(0,r.jsx)(p.default,{src:function(e){let t=F(e);return t.includes("ucarecdn.com")?"".concat(t,"-/preview/400x400/-/quality/smart/"):t}(e),alt:e.filename,fill:!0,className:"object-cover transition-transform group-hover:scale-105",sizes:"(max-width: 768px) 50vw, (max-width: 1024px) 33vw, 25vw"}),(0,r.jsx)("div",{className:"absolute bottom-2 left-2 bg-black/60 rounded px-2 py-1 text-white text-xs flex items-center gap-1",children:E[e.type]})]},e.id))}),(0,r.jsx)(j.lG,{open:o,onOpenChange:d,children:(0,r.jsx)(j.Cf,{className:"max-w-[95vw] max-h-[95vh] p-0 bg-black/95 border-none",children:(0,r.jsxs)("div",{className:"relative w-full h-[90vh] flex items-center justify-center",children:[(0,r.jsx)(b.$,{variant:"ghost",size:"icon",className:"absolute top-4 right-4 z-50 text-white hover:bg-white/20",onClick:()=>{d(!1)},children:(0,r.jsx)(k.A,{className:"h-6 w-6"})}),x.length>1&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(b.$,{variant:"ghost",size:"icon",className:"absolute left-4 z-50 text-white hover:bg-white/20 h-12 w-12",onClick:()=>{u(e=>e>0?e-1:x.length-1)},children:(0,r.jsx)(z.A,{className:"h-8 w-8"})}),(0,r.jsx)(b.$,{variant:"ghost",size:"icon",className:"absolute right-4 z-50 text-white hover:bg-white/20 h-12 w-12",onClick:()=>{u(e=>e<x.length-1?e+1:0)},children:(0,r.jsx)(C.A,{className:"h-8 w-8"})})]}),g&&(0,r.jsx)("div",{className:"relative w-full h-full flex items-center justify-center p-8",children:g.type===i.zu.VIDEO?(0,r.jsx)("video",{src:F(g),controls:!0,className:"max-w-full max-h-full"}):g.type===i.zu.DOCUMENT||g.type===i.zu.FLOORPLAN?(0,r.jsxs)("div",{className:"text-center text-white",children:[(0,r.jsx)(w.A,{className:"h-24 w-24 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-lg mb-4",children:g.filename}),(0,r.jsxs)(b.$,{variant:"outline",className:"text-white border-white hover:bg-white/20",onClick:()=>window.open(F(g),"_blank"),children:[(0,r.jsx)(R.A,{className:"h-4 w-4 mr-2"}),"Download"]})]}):g.type===i.zu.VIRTUAL_TOUR?(0,r.jsxs)("div",{className:"text-center text-white",children:[(0,r.jsx)(A.A,{className:"h-24 w-24 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-lg mb-4",children:g.filename||"Virtual Tour"}),(0,r.jsxs)(b.$,{variant:"outline",className:"text-white border-white hover:bg-white/20",onClick:()=>window.open(F(g),"_blank"),children:[(0,r.jsx)(A.A,{className:"h-4 w-4 mr-2"}),"Open Virtual Tour"]})]}):(0,r.jsx)(p.default,{src:F(g),alt:g.filename,fill:!0,className:"object-contain",sizes:"95vw"})}),(0,r.jsxs)("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 text-white text-sm",children:[c+1," / ",x.length]})]})})})]})}var T=a(67001),L=a(59865),S=a(35299),O=a(37586),U=a(18720),P=a(52619),q=a.n(P),I=a(65939);function V(e){let{project:t,canApprove:a,token:n,onStatusChange:o}=e,{user:c}=(0,I.A)(),[u,m]=(0,s.useState)(!1),[x,h]=(0,s.useState)(!1),[g,p]=(0,s.useState)(!1),[v,f]=(0,s.useState)(""),N=async()=>{try{m(!0),await l.F.delivery.approve(n),U.oR.success("Delivery approved!"),o()}catch(e){console.error("Failed to approve:",e),U.oR.error("Failed to approve delivery")}finally{m(!1)}},y=async()=>{if(!v.trim())return void U.oR.error("Please provide feedback");try{h(!0),await l.F.delivery.requestChanges(n,v),U.oR.success("Change request submitted"),p(!1),f(""),o()}catch(e){console.error("Failed to request changes:",e),U.oR.error("Failed to submit change request")}finally{h(!1)}};return t.clientApprovalStatus===i.bk.APPROVED?(0,r.jsxs)("div",{className:"bg-emerald-50 dark:bg-emerald-950/30 border border-emerald-200 dark:border-emerald-800 rounded-lg p-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 text-emerald-700 dark:text-emerald-400",children:[(0,r.jsx)(d.A,{className:"h-5 w-5"}),(0,r.jsx)("span",{className:"font-medium",children:"Delivery Approved"})]}),t.clientApprovedAt&&(0,r.jsxs)("p",{className:"text-sm text-emerald-600 dark:text-emerald-500 mt-1",children:["Approved on ",new Date(t.clientApprovedAt).toLocaleDateString()]})]}):c?a?(0,r.jsxs)("div",{className:"bg-card border rounded-lg p-4",children:[(0,r.jsx)("h3",{className:"font-medium mb-2",children:"Review Delivery"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:t.clientApprovalStatus===i.bk.CHANGES_REQUESTED?"You previously requested changes. Review the updates and approve when ready.":"Review the media above and approve the delivery or request changes."}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)(b.$,{onClick:N,disabled:u,children:[u?(0,r.jsx)(S.A,{className:"h-4 w-4 mr-2 animate-spin"}):(0,r.jsx)(d.A,{className:"h-4 w-4 mr-2"}),"Approve Delivery"]}),(0,r.jsxs)(b.$,{variant:"outline",onClick:()=>p(!0),children:[(0,r.jsx)(O.A,{className:"h-4 w-4 mr-2"}),"Request Changes"]})]}),(0,r.jsx)(j.lG,{open:g,onOpenChange:p,children:(0,r.jsxs)(j.Cf,{children:[(0,r.jsxs)(j.c7,{children:[(0,r.jsx)(j.L3,{children:"Request Changes"}),(0,r.jsx)(j.rr,{children:"Describe what changes you would like to the delivery."})]}),(0,r.jsx)(T.T,{placeholder:"Please describe the changes you need...",value:v,onChange:e=>f(e.target.value),className:"min-h-[120px]"}),(0,r.jsxs)(j.Es,{children:[(0,r.jsx)(b.$,{variant:"outline",onClick:()=>p(!1),children:"Cancel"}),(0,r.jsxs)(b.$,{onClick:y,disabled:x||!v.trim(),children:[x?(0,r.jsx)(S.A,{className:"h-4 w-4 mr-2 animate-spin"}):null,"Submit Request"]})]})]})})]}):(0,r.jsx)("div",{className:"bg-muted rounded-lg p-4",children:(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:t.clientApprovalStatus===i.bk.CHANGES_REQUESTED?"Changes have been requested. The customer will be notified.":"This delivery is pending review by the customer."})}):(0,r.jsxs)("div",{className:"bg-muted rounded-lg p-4",children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground mb-3",children:"Sign in to approve this delivery or request changes."}),(0,r.jsx)(q(),{href:"/login?redirect=/delivery/".concat(n),children:(0,r.jsxs)(b.$,{variant:"outline",size:"sm",children:[(0,r.jsx)(L.A,{className:"h-4 w-4 mr-2"}),"Sign In"]})})]})}var $=a(33884),M=a(18085),G=a(40521);function B(e){let{comments:t,canComment:a,token:n,onCommentAdded:i}=e,{user:o}=(0,I.A)(),[d,c]=(0,s.useState)(""),[u,m]=(0,s.useState)(!1),x=async()=>{if(d.trim())try{m(!0);let e=await l.F.delivery.addComment(n,d);i(e),c(""),U.oR.success("Comment added")}catch(e){console.error("Failed to add comment:",e),U.oR.error("Failed to add comment")}finally{m(!1)}};return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("h3",{className:"font-medium flex items-center gap-2",children:[(0,r.jsx)(O.A,{className:"h-4 w-4"}),"Comments (",t.length,")"]}),t.length>0?(0,r.jsx)("div",{className:"space-y-3",children:t.map(e=>{var t;return(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsxs)($.eu,{className:"h-8 w-8",children:[(0,r.jsx)($.BK,{src:null!=(t=e.user.avatarUrl)?t:void 0,alt:e.user.name}),(0,r.jsx)($.q5,{className:"text-xs",children:e.user.name.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2)})]}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"font-medium text-sm",children:e.user.name}),(0,r.jsx)("span",{className:"text-xs text-muted-foreground",children:(0,G.m)(new Date(e.timestamp),{addSuffix:!0})})]}),(0,r.jsx)("div",{className:"text-sm text-muted-foreground mt-0.5 prose prose-sm max-w-none [&_p]:my-1 [&_ul]:my-1 [&_ol]:my-1 [&_li]:my-0 [&_a]:text-primary [&_a]:underline",dangerouslySetInnerHTML:{__html:e.content}})]})]},e.id)})}):(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"No comments yet."}),o?a?(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(T.T,{placeholder:"Add a comment...",value:d,onChange:e=>c(e.target.value),className:"min-h-[80px] resize-none"}),(0,r.jsx)(b.$,{onClick:x,disabled:u||!d.trim(),size:"icon",className:"shrink-0",children:u?(0,r.jsx)(S.A,{className:"h-4 w-4 animate-spin"}):(0,r.jsx)(M.A,{className:"h-4 w-4"})})]}):(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Only the customer can add comments."}):(0,r.jsxs)("div",{className:"bg-muted rounded-lg p-3",children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:"Sign in to add comments."}),(0,r.jsx)(q(),{href:"/login?redirect=/delivery/".concat(n),children:(0,r.jsxs)(b.$,{variant:"outline",size:"sm",children:[(0,r.jsx)(L.A,{className:"h-4 w-4 mr-2"}),"Sign In"]})})]})]})}var X=a(83209),Z=a(82180),H=a(89559);function Q(e){let{delivery:t,token:a}=e,[n,i]=(0,s.useState)(t),[o,u]=(0,s.useState)("idle"),[m,x]=(0,s.useState)(null),[h,g]=(0,s.useState)(null),[p,f]=(0,s.useState)(!1),j=(0,s.useRef)(null),N=(0,s.useRef)(0);(0,s.useEffect)(()=>()=>{j.current&&clearTimeout(j.current)},[]);let y=(0,s.useCallback)((e,t)=>{let a=document.createElement("a");a.href=e,a.download=t,a.target="_blank",document.body.appendChild(a),a.click(),document.body.removeChild(a),U.oR.success("Download started"),u("idle")},[]),w=(0,s.useCallback)(async()=>{try{let e=await l.F.delivery.requestDownload(a);switch(e.status){case"READY":if(e.cdnUrl)u("ready"),y(e.cdnUrl,e.filename||"media.zip");else throw Error("Download URL not available");return null;case"GENERATING":case"PENDING":return u("generating"),e.artifactId;case"FAILED":return u("error"),x(e.error||"Download preparation failed"),g(e.artifactId),U.oR.error(e.error||"Download preparation failed"),null;default:return null}}catch(e){return console.error("Failed to request download:",e),u("error"),x(e.message||"Failed to start download"),U.oR.error("Failed to start download"),null}},[a,y]),A=(0,s.useCallback)(async e=>{if(N.current++,N.current>150){u("error"),x("Download preparation timed out. Please try again."),U.oR.error("Download preparation timed out");return}try{let t=await l.F.delivery.getDownloadStatus(a,e);switch(t.status){case"READY":if(t.cdnUrl)u("ready"),y(t.cdnUrl,t.filename||"media.zip");else throw Error("Download URL not available");break;case"GENERATING":case"PENDING":u("generating"),j.current=setTimeout(()=>{A(e)},2e3);break;case"FAILED":u("error"),x(t.error||"Download preparation failed"),g(e),U.oR.error(t.error||"Download preparation failed");break;case"EXPIRED":u("preparing");let r=await w();r&&(j.current=setTimeout(()=>{A(r)},2e3))}}catch(e){console.error("Failed to check download status:",e),u("error"),x("Failed to check download status"),U.oR.error("Failed to check download status")}},[a,y,w]),k=(0,s.useCallback)(async()=>{u("preparing"),x(null),N.current=0,U.oR.info("Preparing your download...");let e=await w();e&&(j.current=setTimeout(()=>{A(e)},2e3))},[w,A]),z=()=>{j.current&&clearTimeout(j.current),k()},C=(0,s.useCallback)(async()=>{try{let e=await l.F.delivery.getByToken(a);i(e)}catch(e){console.error("Failed to refresh delivery:",e)}},[a]),E=(0,s.useCallback)(e=>{i(t=>({...t,comments:[...t.comments,e]}))},[]),D=(0,s.useCallback)(async()=>{if(h){f(!0);try{await l.F.delivery.retryArtifact(h),U.oR.success("Retry queued. Starting download..."),g(null),x(null),u("generating"),N.current=0,j.current=setTimeout(()=>{A(h)},2e3)}catch(e){U.oR.error(e.message||"Failed to retry artifact")}finally{f(!1)}}},[h,A]);return(0,r.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,r.jsx)(v,{organization:n.organization,project:n.project}),(0,r.jsxs)("main",{className:"container max-w-7xl mx-auto px-4 py-8",children:[n.media.length>0&&(0,r.jsx)("div",{className:"flex flex-col items-end gap-2 mb-6",children:n.downloadEnabled?(0,r.jsxs)(r.Fragment,{children:["error"===o&&m&&(0,r.jsxs)("div",{className:"flex flex-col items-end gap-2",children:[(0,r.jsxs)("div",{className:"text-sm text-destructive flex items-center gap-2 bg-destructive/10 px-3 py-2 rounded-md max-w-md text-right",children:[(0,r.jsx)(c.A,{className:"h-4 w-4 shrink-0"}),(0,r.jsx)("span",{children:m})]}),n.canRetryArtifact&&h&&(0,r.jsx)(b.$,{onClick:D,disabled:p,variant:"outline",size:"sm",children:p?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(S.A,{className:"h-4 w-4 mr-2 animate-spin"}),"Retrying..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(H.A,{className:"h-4 w-4 mr-2"}),"Retry Failed Download"]})})]}),"error"!==o&&(0,r.jsx)(Z.Bc,{children:(0,r.jsx)(Z.m_,{children:(0,r.jsx)(Z.k$,{asChild:!0,children:(0,r.jsx)(b.$,{onClick:z,disabled:["preparing","generating","ready"].includes(o),variant:"outline",children:(()=>{switch(o){case"preparing":return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(S.A,{className:"h-4 w-4 mr-2 animate-spin"}),"Requesting..."]});case"generating":return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(S.A,{className:"h-4 w-4 mr-2 animate-spin"}),"Preparing download..."]});case"ready":return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(d.A,{className:"h-4 w-4 mr-2 text-green-600"}),"Download starting..."]});case"error":return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(H.A,{className:"h-4 w-4 mr-2"}),"Retry Download Preparation"]});default:return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(R.A,{className:"h-4 w-4 mr-2"}),"Download All (",n.media.length," files)"]})}})()})})})}),"error"===o&&!n.canRetryArtifact&&(0,r.jsx)(Z.Bc,{children:(0,r.jsxs)(Z.m_,{children:[(0,r.jsx)(Z.k$,{asChild:!0,children:(0,r.jsxs)(b.$,{onClick:z,variant:"destructive",children:[(0,r.jsx)(H.A,{className:"h-4 w-4 mr-2"}),"Try Again"]})}),(0,r.jsx)(Z.ZI,{children:(0,r.jsx)("p",{children:"Request a new download. The previous attempt failed."})})]})})]}):(0,r.jsxs)("div",{className:"text-sm text-muted-foreground flex items-center gap-2",children:[(0,r.jsx)(c.A,{className:"h-4 w-4"}),"Download all is temporarily unavailable"]})}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,r.jsx)("div",{className:"lg:col-span-2",children:(0,r.jsx)(_,{media:n.media,token:a})}),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsx)(V,{project:n.project,canApprove:n.canApprove,token:a,onStatusChange:C}),(0,r.jsxs)(X.Zp,{children:[(0,r.jsx)(X.aR,{className:"pb-3",children:(0,r.jsx)(X.ZB,{className:"text-base",children:"Discussion"})}),(0,r.jsx)(X.Wu,{children:(0,r.jsx)(B,{comments:n.comments,canComment:n.canComment,token:a,onCommentAdded:E})})]})]})]})]})]})}var Y=a(68122),K=a(32559);function W(){let e=(0,n.useParams)().token,[t,a]=(0,s.useState)(null),[i,o]=(0,s.useState)(!0),[d,u]=(0,s.useState)(null);return((0,s.useEffect)(()=>{let t=async()=>{try{o(!0),u(null);let t=await l.F.delivery.getByToken(e);a(t)}catch(e){console.error("Failed to load delivery:",e),u(e.message||"Failed to load delivery")}finally{o(!1)}};e&&t()},[e]),i)?(0,r.jsxs)("div",{className:"container max-w-6xl mx-auto px-4 py-8",children:[(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)(Y.E,{className:"h-8 w-48 mb-2"}),(0,r.jsx)(Y.E,{className:"h-6 w-72"})]}),(0,r.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:[...Array(8)].map((e,t)=>(0,r.jsx)(Y.E,{className:"aspect-square rounded-lg"},t))})]}):d?(0,r.jsx)("div",{className:"container max-w-2xl mx-auto px-4 py-16",children:(0,r.jsxs)(K.Fc,{variant:"destructive",children:[(0,r.jsx)(c.A,{className:"h-4 w-4"}),(0,r.jsx)(K.XL,{children:"Error"}),(0,r.jsx)(K.TN,{children:"Delivery not found or invalid token"===d?"This delivery link is invalid or has expired.":d})]})}):t?(0,r.jsx)(Q,{delivery:t,token:e}):null}},64936:(e,t,a)=>{"use strict";a.d(t,{cn:()=>n});var r=a(2821),s=a(75889);function n(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,s.QP)((0,r.$)(t))}},67001:(e,t,a)=>{"use strict";a.d(t,{T:()=>n});var r=a(95155);a(12115);var s=a(64936);function n(e){let{className:t,...a}=e;return(0,r.jsx)("textarea",{"data-slot":"textarea",className:(0,s.cn)("resize-none border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-input-background px-3 py-2 text-base transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),...a})}},67812:(e,t,a)=>{"use strict";a.d(t,{E:()=>o});var r=a(95155);a(12115);var s=a(32467),n=a(83101),l=a(25016);let i=(0,n.F)("inline-flex items-center justify-center rounded-full border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground",flat:"text-foreground bg-none [a&]:hover:text-accent-foreground border-none",muted:"text-primary bg-muted border-none"}},defaultVariants:{variant:"default"}});function o(e){let{className:t,variant:a,asChild:n=!1,...o}=e,d=n?s.DX:"span";return(0,r.jsx)(d,{"data-slot":"badge",className:(0,l.cn)(i({variant:a}),t),...o})}},68122:(e,t,a)=>{"use strict";a.d(t,{E:()=>n});var r=a(95155),s=a(64936);function n(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"skeleton",className:(0,s.cn)("bg-accent animate-pulse rounded-md",t),...a})}},82180:(e,t,a)=>{"use strict";a.d(t,{Bc:()=>l,ZI:()=>d,k$:()=>o,m_:()=>i});var r=a(95155);a(12115);var s=a(26852),n=a(64936);function l(e){let{delayDuration:t=200,...a}=e;return(0,r.jsx)(s.Kq,{"data-slot":"tooltip-provider",delayDuration:t,...a})}function i(e){let{...t}=e;return(0,r.jsx)(l,{children:(0,r.jsx)(s.bL,{"data-slot":"tooltip",...t})})}function o(e){let{...t}=e;return(0,r.jsx)(s.l9,{"data-slot":"tooltip-trigger",...t})}function d(e){let{className:t,sideOffset:a=0,children:l,...i}=e;return(0,r.jsx)(s.ZL,{children:(0,r.jsxs)(s.UC,{"data-slot":"tooltip-content",sideOffset:a,className:(0,n.cn)("bg-primary text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[state=closed]:hidden data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-fit origin-(--radix-tooltip-content-transform-origin) rounded-md px-3 py-1.5 text-xs text-balance",t),...i,children:[l,(0,r.jsx)(s.i3,{className:"bg-primary fill-primary z-50 size-2.5 translate-y-[calc(-50%_-_2px)] rotate-45 rounded-[2px]"})]})})}},83209:(e,t,a)=>{"use strict";a.d(t,{BT:()=>c,Wu:()=>u,ZB:()=>d,Zp:()=>i,aR:()=>o,wL:()=>m});var r=a(95155);a(12115);var s=a(83101),n=a(64936);let l=(0,s.F)("bg-card text-card-foreground flex flex-col gap-0 rounded-xl",{variants:{variant:{default:"border",outline:"border-2",ghost:"border-0 shadow-none",elevated:"border shadow-lg",bordered:"border-2 border-border",flat:"border-0 bg-transparent",muted:"border-none bg-muted"},size:{default:"rounded-md",sm:"rounded-lg",lg:"rounded-2xl"}},defaultVariants:{variant:"default",size:"default"}});function i(e){let{className:t,variant:a,size:s,...i}=e;return(0,r.jsx)("div",{"data-slot":"card",className:(0,n.cn)(l({variant:a,size:s}),t),...i})}function o(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-header",className:(0,n.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-0 px-6 pt-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...a})}function d(e){let{className:t,...a}=e;return(0,r.jsx)("h4",{"data-slot":"card-title",className:(0,n.cn)("leading-none",t),...a})}function c(e){let{className:t,...a}=e;return(0,r.jsx)("p",{"data-slot":"card-description",className:(0,n.cn)("text-muted-foreground",t),...a})}function u(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-content",className:(0,n.cn)("px-6 [&:last-child]:pb-6",t),...a})}function m(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"card-footer",className:(0,n.cn)("flex items-center px-6 pb-6 [.border-t]:pt-6",t),...a})}},90923:(e,t,a)=>{"use strict";a.d(t,{Xi:()=>o,av:()=>d,j7:()=>i,tU:()=>l});var r=a(95155);a(12115);var s=a(25667),n=a(64936);function l(e){let{className:t,...a}=e;return(0,r.jsx)(s.bL,{"data-slot":"tabs",className:(0,n.cn)("flex flex-col gap-2",t),...a})}function i(e){let{className:t,...a}=e;return(0,r.jsx)(s.B8,{"data-slot":"tabs-list",className:(0,n.cn)("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-md p-[3px] flex",t),...a})}function o(e){let{className:t,...a}=e;return(0,r.jsx)(s.l9,{"data-slot":"tabs-trigger",className:(0,n.cn)("data-[state=active]:bg-card dark:data-[state=active]:text-foreground focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:bg-background text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 hover:bg-secondary cursor-pointer",t),...a})}function d(e){let{className:t,...a}=e;return(0,r.jsx)(s.UC,{"data-slot":"tabs-content",className:(0,n.cn)("flex-1 outline-none",t),...a})}},97003:(e,t,a)=>{"use strict";a.d(t,{$:()=>o,r:()=>i});var r=a(95155);a(12115);var s=a(32467),n=a(83101),l=a(25016);let i=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive cursor-pointer",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline",muted:"text-primary border-none bg-muted hover:bg-primary/20 transition-colors duration-300",flat:"text-primary border-none bg-transparent hover:text-primary/60 transition-colors duration-300",activeFlat:"text-primary border-none bg-transparent",mutedFlat:"text-primary/60 border-none bg-transparent hover:text-primary/90 transition-colors duration-300"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9","icon-sm":"size-8","icon-lg":"size-10"}},defaultVariants:{variant:"default",size:"default"}});function o(e){let{className:t,variant:a,size:n,asChild:o=!1,...d}=e,c=o?s.DX:"button";return(0,r.jsx)(c,{"data-slot":"button",className:(0,l.cn)(i({variant:a,size:n,className:t})),...d})}}},e=>{e.O(0,[547,5707,2110,8234,2619,4001,3409,9360,1163,521,4350,5657,5939,8441,1255,7358],()=>e(e.s=18732)),_N_E=e.O()}]);