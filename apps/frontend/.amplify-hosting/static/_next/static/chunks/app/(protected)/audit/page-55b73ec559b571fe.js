(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2340],{24632:(e,t,a)=>{"use strict";a.d(t,{l:()=>o});var r=a(12115),n=a(20063),s=a(65939),l=a(75701),i=a(80408);function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=(0,n.useRouter)(),{user:o,isLoading:c,activeOrganizationId:d,memberships:u}=(0,s.A)(),{redirectTo:h,enforceRedirect:x}=t,m=(0,r.useCallback)(()=>(0,l.in)(u,d),[u,d]);return(0,r.useEffect)(()=>{if(c)return;if(!o)return void a.push("/");let t=e.map(e=>(0,i.FK)(e)),r=(0,i.FK)(o.accountType),n=u.find(e=>e.orgId===d),s=(0,l.hq)(n,r);if(!t.includes(s)){if(!1===x)return;if(h)a.push(h);else{let e=(0,l.zE)(s);a.push(e)}}},[o,c,e,a,h,x,u,d]),{user:o,organizationId:d,memberships:u,isLoading:c,getActiveOrgRole:m}}},25016:(e,t,a)=>{"use strict";a.d(t,{cn:()=>s,e:()=>l,w:()=>i});var r=a(2821),n=a(75889);function s(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,n.QP)((0,r.$)(t))}let l=!1;function i(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t){let t=[];return e.street&&t.push(e.street),t.push(e.city),t.push(e.stateProvince),e.postalCode&&t.push(e.postalCode),t.push(e.country),t.join(", ")}return"".concat(e.city,", ").concat(e.stateProvince,", ").concat(e.country)}},26229:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>A});var r=a(95155),n=a(12115),s=a(24632),l=a(73344),i=a(67812),o=a(96633),c=a(27346),d=a(89715),u=a(12181),h=a(61362),x=a(78874),m=a(11010),b=a(6132),p=a(26983),f=a(68122);function g(e){let{entries:t,isLoading:a=!1}=e,n=[...t].sort((e,t)=>t.timestamp.getTime()-e.timestamp.getTime());return(0,r.jsxs)("div",{className:"@container md:col-span-3 mt-md",children:[(0,r.jsxs)("div",{className:"mb-md flex items-baseline justify-between",children:[(0,r.jsx)(l.H2,{className:"text-lg border-0",children:"System Activity Audit Log"}),(0,r.jsx)(l.P,{className:"text-sm text-muted-foreground",children:"All system actions are timestamped and traceable to a user identity"})]}),(0,r.jsx)("div",{className:"",children:(0,r.jsx)(c.F,{className:"h-[600px]",children:(0,r.jsxs)(o.XI,{children:[(0,r.jsx)(o.A0,{children:(0,r.jsxs)(o.Hj,{children:[(0,r.jsx)(o.nd,{children:"Timestamp"}),(0,r.jsx)(o.nd,{children:"User"}),(0,r.jsx)(o.nd,{children:"Action"}),(0,r.jsx)(o.nd,{children:"Resource"}),(0,r.jsx)(o.nd,{children:"Details"})]})}),(0,r.jsx)(o.BF,{children:a?Array.from({length:5}).map((e,t)=>(0,r.jsxs)(o.Hj,{children:[(0,r.jsx)(o.nA,{children:(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(f.E,{className:"h-4 w-32"}),(0,r.jsx)(f.E,{className:"h-3 w-40"})]})}),(0,r.jsx)(o.nA,{children:(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(f.E,{className:"h-4 w-28"}),(0,r.jsx)(f.E,{className:"h-3 w-20"})]})}),(0,r.jsx)(o.nA,{children:(0,r.jsx)(f.E,{className:"h-4 w-32"})}),(0,r.jsx)(o.nA,{children:(0,r.jsx)(f.E,{className:"h-6 w-20"})}),(0,r.jsxs)(o.nA,{children:[(0,r.jsx)(f.E,{className:"h-4 w-32"}),(0,r.jsx)(f.E,{className:"h-3 w-24"})]})]},"audit-skeleton-".concat(t))):n.map(e=>{var t,a;let n=(t=e.action).includes("created")?d.A:t.includes("assigned")?u.A:t.includes("delivered")?h.A:t.includes("cancelled")?x.A:t.includes("updated")?m.A:b.A,s=(a=e.action).includes("created")?"text-primary":a.includes("assigned")?"text-purple-600":a.includes("delivered")?"text-emerald-600":a.includes("cancelled")?"text-destructive":a.includes("updated")?"text-yellow-600":"text-gray-600";return(0,r.jsxs)(o.Hj,{children:[(0,r.jsxs)(o.nA,{children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,r.jsx)(p.A,{className:"h-3 w-3 text-muted-foreground"}),(0,r.jsx)("span",{children:(e=>{let t=new Date().getTime()-e.getTime(),a=Math.floor(t/6e4),r=Math.floor(t/36e5),n=Math.floor(t/864e5);return a<1?"Just now":a<60?"".concat(a,"m ago"):r<24?"".concat(r,"h ago"):n<7?"".concat(n,"d ago"):e.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})(e.timestamp)})]}),(0,r.jsx)("div",{className:"text-xs text-muted-foreground mt-1",children:e.timestamp.toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"})})]}),(0,r.jsxs)(o.nA,{children:[(0,r.jsx)("div",{className:"text-sm",children:e.userName}),(0,r.jsx)("div",{className:"text-xs text-muted-foreground",children:e.userId})]}),(0,r.jsx)(o.nA,{children:(0,r.jsxs)("div",{className:"flex items-center gap-2 ".concat(s),children:[(0,r.jsx)(n,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"text-sm",children:e.action})]})}),(0,r.jsx)(o.nA,{children:(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(i.E,{variant:"outline",children:e.resourceType}),(0,r.jsx)("div",{className:"text-xs text-muted-foreground",children:e.resourceId})]})}),(0,r.jsx)(o.nA,{children:(0,r.jsx)("div",{className:"space-y-1 max-w-[300px]",children:Object.entries(e.details).map(e=>{let[t,a]=e;return(0,r.jsxs)("div",{className:"text-xs",children:[(0,r.jsxs)("span",{className:"text-muted-foreground",children:[t,":"]})," ",(0,r.jsx)("span",{children:"object"==typeof a?JSON.stringify(a):String(a)})]},t)})})})]},e.id)})})]})})})]})}var N=a(25016);function v(e){let{auditLog:t,isLoading:a=!1}=e,n=N.e?t:[];return(0,r.jsx)("main",{className:"container relative mx-auto",children:(0,r.jsx)("article",{className:"flex flex-col gap-2xl md:gap-3xl px-md",children:(0,r.jsxs)("div",{className:"@container w-full mt-md mb-md",children:[(0,r.jsx)(l.H2,{className:"text-4xl mb-xs",children:"Audit Log"}),(0,r.jsx)(g,{entries:n,isLoading:a})]})})})}var j=a(95657);function A(){let{user:e,isLoading:t,organizationId:a,memberships:l}=(0,s.l)(["COMPANY"]),[i,o]=(0,n.useState)([]),[c,d]=(0,n.useState)(!0);return((0,n.useEffect)(()=>{let t=async()=>{try{let e=await j.F.dashboard.get();o(e.auditLog||[])}catch(e){console.error("Failed to load audit log:",e),o([])}finally{d(!1)}};e&&t()},[e]),e)?(0,r.jsx)(v,{auditLog:i,isLoading:c}):null}},27346:(e,t,a)=>{"use strict";a.d(t,{$:()=>i,F:()=>l});var r=a(95155);a(12115);var n=a(59034),s=a(64936);function l(e){let{className:t,children:a,...l}=e;return(0,r.jsxs)(n.bL,{"data-slot":"scroll-area",className:(0,s.cn)("relative",t),...l,children:[(0,r.jsx)(n.LM,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:a}),(0,r.jsx)(i,{}),(0,r.jsx)(n.OK,{})]})}function i(e){let{className:t,orientation:a="vertical",...l}=e;return(0,r.jsx)(n.VM,{"data-slot":"scroll-area-scrollbar",orientation:a,className:(0,s.cn)("flex touch-none p-px transition-colors select-none","vertical"===a&&"h-full w-2.5 border-l border-l-transparent","horizontal"===a&&"h-2.5 flex-col border-t border-t-transparent",t),...l,children:(0,r.jsx)(n.lr,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}},61097:(e,t,a)=>{Promise.resolve().then(a.bind(a,26229))},64936:(e,t,a)=>{"use strict";a.d(t,{cn:()=>s});var r=a(2821),n=a(75889);function s(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,n.QP)((0,r.$)(t))}},67812:(e,t,a)=>{"use strict";a.d(t,{E:()=>o});var r=a(95155);a(12115);var n=a(32467),s=a(83101),l=a(25016);let i=(0,s.F)("inline-flex items-center justify-center rounded-full border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground",flat:"text-foreground bg-none [a&]:hover:text-accent-foreground border-none",muted:"text-primary bg-muted border-none"}},defaultVariants:{variant:"default"}});function o(e){let{className:t,variant:a,asChild:s=!1,...o}=e,c=s?n.DX:"span";return(0,r.jsx)(c,{"data-slot":"badge",className:(0,l.cn)(i({variant:a}),t),...o})}},68122:(e,t,a)=>{"use strict";a.d(t,{E:()=>s});var r=a(95155),n=a(64936);function s(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"skeleton",className:(0,n.cn)("bg-accent animate-pulse rounded-md",t),...a})}},73344:(e,t,a)=>{"use strict";a.d(t,{H1:()=>s,H2:()=>l,H3:()=>i,H4:()=>o,Oc:()=>u,P:()=>c,QX:()=>h,yE:()=>d});var r=a(95155);a(12115);var n=a(64936);function s(e){let{children:t,className:a,...s}=e;return(0,r.jsx)("h1",{className:(0,n.cn)("scroll-m-20 text-4xl font-extrabold tracking-tight text-balance",a),...s,children:t})}function l(e){let{children:t,className:a,...s}=e;return(0,r.jsx)("h2",{className:(0,n.cn)("scroll-m-20 text-3xl font-semibold tracking-tight transition-colors first:mt-0",a),...s,children:t})}function i(e){let{children:t,className:a,...s}=e;return(0,r.jsx)("h3",{className:(0,n.cn)("scroll-m-20 text-2xl font-semibold tracking-tight",a),...s,children:t})}function o(e){let{children:t,className:a,...s}=e;return(0,r.jsx)("h4",{className:(0,n.cn)("scroll-m-20 text-xl font-semibold tracking-tight",a),...s,children:t})}function c(e){let{children:t,className:a,...s}=e;return(0,r.jsx)("p",{className:(0,n.cn)("leading-[1.5em]",a),...s,children:t})}function d(e){let{children:t,className:a,...s}=e;return(0,r.jsx)("div",{className:(0,n.cn)("text-lg font-semibold",a),...s,children:t})}function u(e){let{children:t,className:a,...s}=e;return(0,r.jsx)("small",{className:(0,n.cn)("text-sm font-medium leading-none",a),...s,children:t})}function h(e){let{children:t,className:a,...s}=e;return(0,r.jsx)("p",{className:(0,n.cn)("text-sm text-muted-foreground",a),...s,children:t})}},75701:(e,t,a)=>{"use strict";a.d(t,{hq:()=>n,in:()=>s,zE:()=>l});var r=a(80408);let n=(e,t)=>{var a;if(!e)return(0,r.FK)(t);if("PERSONAL"===((null==(a=e.organization)?void 0:a.type)||e.organizationType||""))return"COMPANY";let n=e.orgRole||e.role||(null==e?void 0:e.organizationRole)||t;return(0,r.FK)(n)},s=(e,t)=>{var a,r;let n=e.find(e=>e.orgId===t),s=null!=(r=null!=(a=null==n?void 0:n.orgRole)?a:null==n?void 0:n.role)?r:null;return s?s.toUpperCase():null},l=e=>{let t=(0,r.FK)(e);return"COMPANY"===t||"AGENT"===t||"TECHNICIAN"===t?"/dashboard":"/"}},80408:(e,t,a)=>{"use strict";a.d(t,{EL:()=>u,FK:()=>o,UD:()=>d,aJ:()=>c});let r=[{path:"/dashboard",label:"Dashboard",icon:"LayoutDashboard"},{path:"/calendar",label:"Calendar",icon:"Calendar"}],n=[{path:"/dashboard",label:"Dashboard",icon:"LayoutDashboard"},{path:"/jobs/all-jobs",label:"Jobs",icon:"Briefcase"},{path:"/map",label:"Map",icon:"Map"},{path:"/calendar",label:"Calendar",icon:"Calendar"}],s=[{path:"/dashboard",label:"Dashboard",icon:"LayoutDashboard"},{path:"/jobs/all-jobs",label:"My Jobs",icon:"Briefcase"},{path:"/map",label:"Map",icon:"Map"},{path:"/calendar",label:"Calendar",icon:"Calendar"}],l=[{path:"/dashboard",label:"Dashboard",icon:"LayoutDashboard"},{path:"/jobs/all-jobs",label:"My Jobs",icon:"Briefcase"},{path:"/jobs/job-management",label:"Job Board",icon:"Kanban"},{path:"/map",label:"Map",icon:"Map"},{path:"/calendar",label:"Calendar",icon:"Calendar"}],i=["OWNER","ADMIN","PROJECT_MANAGER","EDITOR"],o=e=>{let t=(e||"").toUpperCase();return"COMPANY"===t||i.includes(t)?"COMPANY":"TECHNICIAN"===t||"PROVIDER"===t?"TECHNICIAN":"AGENT"},c=(e,t,a)=>{if(!e)return null;let r=u(e,t,a);return r?r.showSidebar?"COMPANY":"AGENT"===r.accountType?"AGENT":"PERSONAL"===r.orgType?"COMPANY":"TECHNICIAN":null},d=e=>"COMPANY"===e;function u(e,t,a){var i;if(!e)return null;let o=t.find(e=>e.orgId===a),c=(null==o||null==(i=o.organization)?void 0:i.type)||(null==o?void 0:o.organizationType)||"PERSONAL",d="PERSONAL"===c?"PERSONAL_OWNER":(null==o?void 0:o.orgRole)||(null==o?void 0:o.role)||null,u=e.accountType||"PROVIDER",h=(d||"").toString().toUpperCase(),x="COMPANY"===c&&["OWNER","ADMIN","PROJECT_MANAGER"].includes(h),m=[],b=!1,p="New Job",f="",g=["OWNER","ADMIN","PERSONAL_OWNER"].includes(h)||"PERSONAL"===c;return x?(b=["OWNER","ADMIN"].includes(h),p="New Job",f=""):"AGENT"===u?(m=r,b=!0,p="Create Order",f="/booking"):"COMPANY"===c&&"EDITOR"===h?(m=l,b=!1):"COMPANY"===c&&"TECHNICIAN"===h?(m=s,b=!1):("PROVIDER"===u||"COMPANY"===u)&&(m=n,b=!1),{accountType:u,orgType:c,orgRole:d,showSidebar:x,isElevatedRole:x,navItems:m,canCreateOrder:b,createActionLabel:p,createActionPath:f,canManageCustomers:g}}},96633:(e,t,a)=>{"use strict";a.d(t,{A0:()=>l,BF:()=>i,Hj:()=>o,XI:()=>s,nA:()=>d,nd:()=>c});var r=a(95155);a(12115);var n=a(64936);function s(e){let{className:t,...a}=e;return(0,r.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,r.jsx)("table",{"data-slot":"table",className:(0,n.cn)("w-full caption-bottom text-sm",t),...a})})}function l(e){let{className:t,...a}=e;return(0,r.jsx)("thead",{"data-slot":"table-header",className:(0,n.cn)("[&_tr]:border-b",t),...a})}function i(e){let{className:t,...a}=e;return(0,r.jsx)("tbody",{"data-slot":"table-body",className:(0,n.cn)("[&_tr:last-child]:border-0",t),...a})}function o(e){let{className:t,...a}=e;return(0,r.jsx)("tr",{"data-slot":"table-row",className:(0,n.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",t),...a})}function c(e){let{className:t,...a}=e;return(0,r.jsx)("th",{"data-slot":"table-head",className:(0,n.cn)("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...a})}function d(e){let{className:t,...a}=e;return(0,r.jsx)("td",{"data-slot":"table-cell",className:(0,n.cn)("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...a})}}},e=>{e.O(0,[547,5707,550,7336,5657,5939,8441,1255,7358],()=>e(e.s=61097)),_N_E=e.O()}]);