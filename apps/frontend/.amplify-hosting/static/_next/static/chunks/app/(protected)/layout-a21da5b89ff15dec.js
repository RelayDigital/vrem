(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[521,4163],{15870:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},17910:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]])},20908:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("circle-question-mark",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},24632:(e,t,a)=>{"use strict";a.d(t,{l:()=>l});var s=a(12115),n=a(20063),r=a(65939),i=a(75701),o=a(80408);function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=(0,n.useRouter)(),{user:l,isLoading:c,activeOrganizationId:d,memberships:u}=(0,r.A)(),{redirectTo:h,enforceRedirect:m}=t,p=(0,s.useCallback)(()=>(0,i.in)(u,d),[u,d]);return(0,s.useEffect)(()=>{if(c)return;if(!l)return void a.push("/");let t=e.map(e=>(0,o.FK)(e)),s=(0,o.FK)(l.accountType),n=u.find(e=>e.orgId===d),r=(0,i.hq)(n,s);if(!t.includes(r)){if(!1===m)return;if(h)a.push(h);else{let e=(0,i.zE)(r);a.push(e)}}},[l,c,e,a,h,m,u,d]),{user:l,organizationId:d,memberships:u,isLoading:c,getActiveOrgRole:p}}},26617:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]])},32580:(e,t,a)=>{"use strict";a.d(t,{U:()=>o,_:()=>l});var s=a(95155),n=a(12115),r=a(18720);let i=(0,n.createContext)(void 0);function o(e){let{children:t,defaultUserId:a,defaultOrganizationId:o,createJobHandler:l}=e,[c,d]=(0,n.useState)(!1),[u,h]=(0,n.useState)(),[m,p]=(0,n.useState)(null),g=(0,n.useCallback)(()=>{d(!1),h(void 0)},[]),f=(0,n.useCallback)(async e=>{if(!e)return void r.oR.error("Invalid job data");if(l){await l(e),r.oR.success("Job created successfully"),g();return}let t=localStorage.getItem("dispatcherJobs"),s=t?JSON.parse(t):[],n=s.length,i={id:"job-".concat(Date.now()),orderNumber:(n+1).toString().padStart(4,"0"),organizationId:o||"org-vx-001",clientName:e.clientName,propertyAddress:e.propertyAddress,location:e.location||{lat:51.0447,lng:-114.0719},scheduledDate:e.scheduledDate,scheduledTime:e.scheduledTime,mediaType:e.mediaType,priority:e.priority||"standard",status:"pending",estimatedDuration:e.estimatedDuration||120,requirements:e.requirements||"",createdBy:a||"user-001",createdAt:new Date,propertyImage:e.propertyImage||"https://images.unsplash.com/photo-1706808849780-7a04fbac83ef?w=800"},c=[i,...s];localStorage.setItem("dispatcherJobs",JSON.stringify(c)),window.dispatchEvent(new CustomEvent("jobCreated",{detail:i})),r.oR.success("Job created successfully"),g()},[a,o,l,g]),x=(0,n.useCallback)(async e=>{let t=m&&"function"==typeof m?m:f;await t(e)},[m,f]);return(0,s.jsx)(i.Provider,{value:{openJobCreationDialog:e=>{h(e),d(!0)},closeJobCreationDialog:g,setOnSubmit:p,handleJobCreate:x,isOpen:c,initialValues:u,onSubmit:m},children:t})}function l(){let e=(0,n.useContext)(i);if(void 0===e)throw Error("useJobCreation must be used within a JobCreationProvider");return e}},35722:(e,t,a)=>{"use strict";a.d(t,{NV:()=>l,ft:()=>i});var s=a(95657);let n={lat:51.0447,lng:-114.0719},r=new Map;async function i(e){let t="pk.eyJ1IjoiZHVyb2RwIiwiYSI6ImNtaHplcW53cDA4dHQycnB6dnhqeGtveXgifQ.6GR-s3V7vfGRsoVlhSTFhg";if(!t||!e)return null;try{var a,s;let n="https://api.mapbox.com/geocoding/v5/mapbox.places/".concat(encodeURIComponent(e),".json?access_token=").concat(t,"&limit=1"),r=await fetch(n);if(!r.ok)return null;let i=await r.json(),o=null==i||null==(a=i.features)?void 0:a[0];if((null==o||null==(s=o.center)?void 0:s.length)===2){let[e,t]=o.center;return{lat:t,lng:e}}}catch(e){console.error("Failed to geocode address",e)}return null}async function o(e){if(!e.user)return null;let t=e.user,a=e.personalOrg,s=a?[a.addressLine1,a.addressLine2,a.city,a.region,a.postalCode,a.countryCode].filter(Boolean).join(", "):"",o=(null==a?void 0:a.lat)!==void 0&&(null==a?void 0:a.lng)!==void 0?{lat:a.lat,lng:a.lng}:n;if(s){let e=r.get(s);if(e)o=e;else{let e=await i(s);e&&(o=e,r.set(s,e))}}return{id:t.id,userId:t.id,orgMemberId:e.id,orgId:e.orgId,memberId:e.id,role:e.role||e.orgRole||"TECHNICIAN",name:t.name||"Unnamed",email:t.email||"",phone:(null==a?void 0:a.phone)||"",organizationId:t.organizationId||void 0,isIndependent:!0,companyId:void 0,companyName:void 0,homeLocation:{lat:o.lat,lng:o.lng,address:{street:(null==a?void 0:a.addressLine1)||"",city:(null==a?void 0:a.city)||"",stateProvince:(null==a?void 0:a.region)||"",country:(null==a?void 0:a.countryCode)||"",postalCode:(null==a?void 0:a.postalCode)||""}},availability:[],reliability:{totalJobs:0,noShows:0,lateDeliveries:0,onTimeRate:0,averageDeliveryTime:0},skills:{residential:0,commercial:0,aerial:0,twilight:0,video:0},rating:{overall:0,count:0,recent:[]},preferredClients:[],status:"active",createdAt:e.createdAt?new Date(e.createdAt):new Date,avatar:t.avatarUrl,bio:"",services:{photography:!0,video:!1,aerial:!1,floorplan:!1,measurement:!1,twilight:!1,editing:!1,virtualStaging:!1},portfolio:[],certifications:[]}}async function l(){let e=await s.F.organizations.listMembers();return e&&0!==e.length?(await Promise.all(e.map(e=>o(e)))).filter(e=>!!e):[]}},37494:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("moon",[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]])},37586:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]])},40235:(e,t,a)=>{"use strict";a.d(t,{$:()=>l,H:()=>o});var s=a(95155),n=a(12115),r=a(20063);let i=(0,n.createContext)(void 0);function o(e){let{children:t}=e,a=(0,r.useRouter)(),o=(0,n.useCallback)(()=>{a.push("/jobs/all-jobs")},[a]),l=(0,n.useCallback)(()=>{a.push("/map")},[a]),c=(0,n.useCallback)(()=>{a.push("/calendar")},[a]),d=(0,n.useCallback)(e=>{a.push("/jobs/".concat(e.id))},[a]);return(0,s.jsx)(i.Provider,{value:{navigateToJobsView:o,navigateToMapView:l,navigateToCalendarView:c,navigateToJobInProjectManagement:d},children:t})}function l(){let e=(0,n.useContext)(i);if(void 0===e)throw Error("useDispatcherNavigation must be used within a DispatcherNavigationProvider");return e}},40521:(e,t,a)=>{"use strict";a.d(t,{m:()=>m});var s=a(94716),n=a(26217),r=a(39781),i=a(35805),o=a(45240),l=a(92118);function c(e,t){let a=(0,l.a)(e)-(0,l.a)(t);return a<0?-1:a>0?1:a}var d=a(9180),u=a(93014),h=a(88901);function m(e,t){return function(e,t,a){var s,m;let p,g=(0,r.q)(),f=null!=(m=null!=(s=null==a?void 0:a.locale)?s:g.locale)?m:n.c,x=c(e,t);if(isNaN(x))throw RangeError("Invalid time value");let v=Object.assign({},a,{addSuffix:null==a?void 0:a.addSuffix,comparison:x}),[j,y]=(0,o.x)(null==a?void 0:a.in,...x>0?[t,e]:[e,t]),b=function(e,t,a){var s;return(s=void 0,e=>{let t=(s?Math[s]:Math.trunc)(e);return 0===t?0:t})(((0,l.a)(e)-(0,l.a)(t))/1e3)}(y,j),w=Math.round((b-((0,i.G)(y)-(0,i.G)(j))/1e3)/60);if(w<2)if(null==a?void 0:a.includeSeconds)if(b<5)return f.formatDistance("lessThanXSeconds",5,v);else if(b<10)return f.formatDistance("lessThanXSeconds",10,v);else if(b<20)return f.formatDistance("lessThanXSeconds",20,v);else if(b<40)return f.formatDistance("halfAMinute",0,v);else if(b<60)return f.formatDistance("lessThanXMinutes",1,v);else return f.formatDistance("xMinutes",1,v);else if(0===w)return f.formatDistance("lessThanXMinutes",1,v);else return f.formatDistance("xMinutes",w,v);if(w<45)return f.formatDistance("xMinutes",w,v);if(w<90)return f.formatDistance("aboutXHours",1,v);if(w<d.F6){let e=Math.round(w/60);return f.formatDistance("aboutXHours",e,v)}if(w<2520)return f.formatDistance("xDays",1,v);else if(w<d.Nw){let e=Math.round(w/d.F6);return f.formatDistance("xDays",e,v)}else if(w<2*d.Nw)return p=Math.round(w/d.Nw),f.formatDistance("aboutXMonths",p,v);if((p=function(e,t,a){let[s,n,r]=(0,o.x)(void 0,e,e,t),i=c(n,r),d=Math.abs((0,u.U)(n,r));if(d<1)return 0;1===n.getMonth()&&n.getDate()>27&&n.setDate(30),n.setMonth(n.getMonth()-i*d);let m=c(n,r)===-i;(function(e,t){let a=(0,l.a)(e,void 0);return+function(e,t){let a=(0,l.a)(e,null==t?void 0:t.in);return a.setHours(23,59,59,999),a}(a,void 0)==+(0,h.p)(a,t)})(s)&&1===d&&1===c(s,r)&&(m=!1);let p=i*(d-m);return 0===p?0:p}(y,j))<12){let e=Math.round(w/d.Nw);return f.formatDistance("xMonths",e,v)}{let e=p%12,t=Math.trunc(p/12);return e<3?f.formatDistance("aboutXYears",t,v):e<9?f.formatDistance("overXYears",t,v):f.formatDistance("almostXYears",t+1,v)}}(e,(0,s.A)(e),t)}},41562:(e,t,a)=>{Promise.resolve().then(a.bind(a,65025))},42529:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},48988:(e,t,a)=>{"use strict";a.d(t,{i:()=>o,o:()=>i});var s=a(95155),n=a(12115);let r=(0,n.createContext)(void 0);function i(e){let{children:t}=e,[a,i]=(0,n.useState)([]),[o,l]=(0,n.useState)(new Map),[c,d]=(0,n.useState)(new Map),u=(0,n.useCallback)((e,t)=>{let a=new Date,s="".concat(e,":").concat(t);l(n=>{let r=(n.get(s)||0)+1,o=new Map(n);return o.set(s,r),r>=3&&i(s=>{let n=s.find(a=>a.type===e&&a.message===t);return n?s.map(e=>e.id===n.id?{...e,timestamp:a}:e):[...s,{id:"".concat(e,"-").concat(Date.now(),"-").concat(Math.random()),type:e,message:t,timestamp:a}]}),o}),setTimeout(()=>{l(e=>{let t=new Map(e);return t.delete(s),t})},3e4)},[]),h=(0,n.useCallback)(e=>{i(t=>t.filter(t=>t.id!==e))},[]),m=(0,n.useCallback)(()=>{i([]),l(new Map)},[]);(0,n.useEffect)(()=>{let e=e=>{u("api",e.detail.message)},t=()=>{let e=new Date;d(t=>{let a=new Map(t);return a.set("api",e),a}),i(e=>e.filter(e=>"api"!==e.type))},a=e=>{u("websocket",e.detail.message)},s=()=>{let e=new Date;d(t=>{let a=new Map(t);return a.set("websocket",e),a}),i(e=>e.filter(e=>"websocket"!==e.type))};return window.addEventListener("backend-api-error",e),window.addEventListener("backend-api-success",t),window.addEventListener("backend-websocket-error",a),window.addEventListener("backend-websocket-success",s),()=>{window.removeEventListener("backend-api-error",e),window.removeEventListener("backend-api-success",t),window.removeEventListener("backend-websocket-error",a),window.removeEventListener("backend-websocket-success",s)}},[u]);let p=a.length>0;return(0,s.jsx)(r.Provider,{value:{issues:a,addIssue:u,clearIssue:h,clearAllIssues:m,hasPersistentIssues:p},children:t})}function o(){let e=(0,n.useContext)(r);if(void 0===e)throw Error("useBackendHealth must be used within a BackendHealthProvider");return e}},52056:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},57259:(e,t,a)=>{"use strict";a.d(t,{Ke:()=>w,R6:()=>y,UC:()=>E,bL:()=>A,l9:()=>C,z3:()=>g});var s=a(12115),n=a(92556),r=a(3468),i=a(23558),o=a(4129),l=a(94446),c=a(88142),d=a(76842),u=a(68946),h=a(95155),m="Collapsible",[p,g]=(0,r.A)(m),[f,x]=p(m),v=s.forwardRef((e,t)=>{let{__scopeCollapsible:a,open:n,defaultOpen:r,disabled:o,onOpenChange:l,...d}=e,[p,g]=(0,i.i)({prop:n,defaultProp:null!=r&&r,onChange:l,caller:m});return(0,h.jsx)(f,{scope:a,disabled:o,contentId:(0,u.B)(),open:p,onOpenToggle:s.useCallback(()=>g(e=>!e),[g]),children:(0,h.jsx)(c.sG.div,{"data-state":k(p),"data-disabled":o?"":void 0,...d,ref:t})})});v.displayName=m;var j="CollapsibleTrigger",y=s.forwardRef((e,t)=>{let{__scopeCollapsible:a,...s}=e,r=x(j,a);return(0,h.jsx)(c.sG.button,{type:"button","aria-controls":r.contentId,"aria-expanded":r.open||!1,"data-state":k(r.open),"data-disabled":r.disabled?"":void 0,disabled:r.disabled,...s,ref:t,onClick:(0,n.mK)(e.onClick,r.onOpenToggle)})});y.displayName=j;var b="CollapsibleContent",w=s.forwardRef((e,t)=>{let{forceMount:a,...s}=e,n=x(b,e.__scopeCollapsible);return(0,h.jsx)(d.C,{present:a||n.open,children:e=>{let{present:a}=e;return(0,h.jsx)(N,{...s,ref:t,present:a})}})});w.displayName=b;var N=s.forwardRef((e,t)=>{let{__scopeCollapsible:a,present:n,children:r,...i}=e,d=x(b,a),[u,m]=s.useState(n),p=s.useRef(null),g=(0,l.s)(t,p),f=s.useRef(0),v=f.current,j=s.useRef(0),y=j.current,w=d.open||u,N=s.useRef(w),A=s.useRef(void 0);return s.useEffect(()=>{let e=requestAnimationFrame(()=>N.current=!1);return()=>cancelAnimationFrame(e)},[]),(0,o.N)(()=>{let e=p.current;if(e){A.current=A.current||{transitionDuration:e.style.transitionDuration,animationName:e.style.animationName},e.style.transitionDuration="0s",e.style.animationName="none";let t=e.getBoundingClientRect();f.current=t.height,j.current=t.width,N.current||(e.style.transitionDuration=A.current.transitionDuration,e.style.animationName=A.current.animationName),m(n)}},[d.open,n]),(0,h.jsx)(c.sG.div,{"data-state":k(d.open),"data-disabled":d.disabled?"":void 0,id:d.contentId,hidden:!w,...i,ref:g,style:{"--radix-collapsible-content-height":v?"".concat(v,"px"):void 0,"--radix-collapsible-content-width":y?"".concat(y,"px"):void 0,...e.style},children:w&&r})});function k(e){return e?"open":"closed"}var A=v,C=y,E=w},59427:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]])},65025:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>eU});var s=a(95155),n=a(24632),r=a(68122),i=a(32580),o=a(69802),l=a(55678),c=a(40235),d=a(25703),u=a(84993),h=a(5379),m=a(20063),p=a(97003),g=a(33884),f=a(30275),x=a(7220),v=a(6191),j=a(20508),y=a(15870),b=a(59427),w=a(37494),N=a(79451),k=a(71847);let A=(0,k.A)("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]]);var C=a(65939),E=a(19408);let M=(0,k.A)("chevrons-up-down",[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]]);var I=a(5917),S=a(65993),T=a(96583),R=a(78959),D=a(89617),O=a(12115),z=a(18720),P=a(67812);function U(e){var t,a,n,r;let{variant:i="sidebar",onOrgHome:o}=e,{user:l}=(0,C.A)(),{memberships:c,isLoading:d,setActiveOrganization:h}=(0,R.G)(),{activeOrganizationId:v}=(0,D.Q)(),j=(0,m.useRouter)(),b=e=>{var t;return(null==(t=e.organization)?void 0:t.type)==="PERSONAL"},w=(0,O.useMemo)(()=>c.find(e=>b(e)),[c]),N=(0,O.useMemo)(()=>[...w?[w]:[],...c.filter(e=>{if(b(e))return!1;if((null==l?void 0:l.accountType)==="AGENT"){var t;let a=(null==(t=e.organization)?void 0:t.type)==="COMPANY",s="CUSTOMER"===String(e.role||e.orgRole||"")||"customer"===e.relationship;if(a&&s)return!1}return!0})],[c,w,null==l?void 0:l.accountType]),k="expanded";try{k=null==(r=(0,u.cL)())?void 0:r.state}catch(e){k="expanded"}let A=(0,O.useMemo)(()=>{var e;return null==(e=c.find(e=>e.orgId===v))?void 0:e.organization},[c,v]),U=(0,O.useMemo)(()=>c.find(e=>e.orgId===v),[c,v]),L=(0,O.useMemo)(()=>{if(!(null==U?void 0:U.organization))return!1;let e=U.organization.type,t=U.orgRole||U.role||"";return"COMPANY"===e?"OWNER"===t||"ADMIN"===t:"PERSONAL"===e&&"OWNER"===t},[U]),H="header"===i||"collapsed"!==k;return(0,s.jsxs)(x.rI,{children:[(0,s.jsx)(x.ty,{asChild:!0,children:(0,s.jsx)(p.$,{variant:"ghost",className:"h-auto justify-between text-left pl-1.5! pr-2.5! py-0!",children:(0,s.jsxs)("div",{className:"flex items-center gap-2 cursor-pointer w-full",children:[(0,s.jsxs)(g.eu,{className:"size-8",children:[(0,s.jsx)(g.BK,{src:null==A?void 0:A.logoUrl,alt:null==A?void 0:A.name}),(0,s.jsx)(g.q5,{children:(0,s.jsx)(E.A,{className:"size-3"})})]}),H&&(0,s.jsx)("div",{className:"flex flex-col items-start",children:(0,s.jsx)("span",{className:"text-sm font-medium",children:v?(null==A?void 0:A.name)||"Select organization":"Personal workspace"})}),H&&(0,s.jsx)(M,{className:"size-3 text-muted-foreground ml-auto"})]})})}),(0,s.jsxs)(x.SQ,{className:"w-72 max-h-[400px]",align:"start",side:(0,f.a)()?"bottom":"right",children:[(0,s.jsx)(x.lp,{children:"Organizations"}),(0,s.jsx)(x.mB,{}),(0,s.jsxs)(x.I,{children:[d&&(0,s.jsx)("div",{className:"px-2 py-1.5 text-sm text-muted-foreground",children:"Loading..."}),!d&&0===c.length&&(0,s.jsx)("div",{className:"px-2 py-1.5 text-sm text-muted-foreground",children:"No organizations found"}),!d&&N.map(e=>{var t,a,n;let r=b(e);return(0,s.jsxs)(x._2,{onClick:()=>{var t;h(t=e.orgId),null!==t&&j.push("/dashboard")},className:"flex items-center gap-2 cursor-pointer",children:[(0,s.jsxs)(g.eu,{className:"size-8",children:[!r&&(0,s.jsx)(g.BK,{src:null==(t=e.organization)?void 0:t.logoUrl}),(0,s.jsx)(g.q5,{children:r?(0,s.jsx)(M,{className:"size-4"}):(0,s.jsx)(E.A,{className:"size-4"})})]}),(0,s.jsxs)("div",{className:"flex flex-col flex-1 min-w-0",children:[(0,s.jsx)("span",{className:"text-sm font-medium truncate",children:r?"Personal workspace":(null==(a=e.organization)?void 0:a.name)||e.orgId}),!r&&(0,s.jsx)(P.E,{variant:"muted",className:"truncate",children:(null==(n=e.role)?void 0:n.replaceAll("_"," "))||"Member"})]}),e.orgId===v&&(0,s.jsx)(I.A,{className:"size-4 text-primary ml-auto shrink-0"})]},e.orgId)})]}),(0,s.jsx)(x.mB,{}),(0,s.jsxs)(x.I,{children:[o&&(0,s.jsxs)(x._2,{onClick:o,children:[(0,s.jsx)(S.A,{className:"size-4 mr-2"}),(null==(a=c.find(e=>e.orgId===v))||null==(t=a.organization)?void 0:t.type)==="COMPANY"?"Company home":"Workspace home"]}),L&&(0,s.jsxs)(x._2,{onClick:()=>{let e=v||(null==w?void 0:w.orgId);e?j.push("/organization/".concat(e,"/settings")):j.push("/organization")},children:[(0,s.jsx)(y.A,{className:"size-4 mr-2"}),(null==U||null==(n=U.organization)?void 0:n.type)==="COMPANY"?"Company settings":"Workspace settings"]}),(null==l?void 0:l.accountType)==="PROVIDER"&&U&&b(U)&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x.mB,{}),(0,s.jsxs)(x._2,{onClick:()=>{z.oR.info("Join request sent (mock)")},disabled:!0,children:[(0,s.jsx)(T.A,{className:"size-4 mr-2"}),"Join company",(0,s.jsx)("span",{className:"ml-auto text-xs text-muted-foreground",children:"Coming soon"})]})]})]})]})]})}var L=a(29633),H=a(37586),F=a(42529),_=a(26617),J=a(52056);let G=(0,k.A)("message-circle",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]]),V=(0,k.A)("bell",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]]);var B=a(89442),W=a(65229),q=a(27937),Y=a(48314),$=a(69152),X=a(93499),Q=a(55850),K=a(27346),Z=a(36838),ee=a(40521),et=a(25016),ea=a(99522);function es(e){return"GROUPED_MESSAGES"===e.type}function en(e){var t,a,n;let{className:r}=e,i=(0,m.useRouter)(),{activeOrganizationId:o,switchOrganization:l,user:c,memberships:u}=(0,C.A)(),{notifications:h,unreadCount:g,isLoading:f,markAsRead:v,markAllAsRead:j,acceptInvitation:y,declineInvitation:b,refetch:w}=(0,ea.E)(),{status:N,getOverallProgress:k,resetProgress:A,dismissGuide:M,refetchStatus:S}=(0,d.Mw)(),[T,R]=(0,O.useState)(!1),[D,z]=(0,O.useState)(new Set),[U,en]=(0,O.useState)(!1),[er,ei]=(0,O.useState)(!1),eo=(0,O.useCallback)(e=>{R(e),e&&w()},[w]),el=async e=>{if(e.invitationId){z(t=>new Set(t).add(e.id));try{await y(e.id,e.invitationId),window.location.reload()}catch(e){console.error("Failed to accept invitation:",e)}finally{z(t=>{let a=new Set(t);return a.delete(e.id),a})}}},ec=async e=>{if(e.invitationId){z(t=>new Set(t).add(e.id));try{await b(e.id,e.invitationId)}catch(e){console.error("Failed to decline invitation:",e)}finally{z(t=>{let a=new Set(t);return a.delete(e.id),a})}}},ed=async e=>{i.push("/organization/".concat(e.orgId,"/preview")),R(!1)},eu=async e=>{if(!e.projectId)return;try{await v(e.id)}catch(e){console.error("Failed to mark notification as read:",e)}if("PROJECT_DELIVERED"===e.type&&e.deliveryToken){i.push("/delivery/".concat(e.deliveryToken)),R(!1);return}e.orgId&&e.orgId!==o&&l(e.orgId);let t="/jobs/".concat(e.projectId),a=new URLSearchParams;"NEW_MESSAGE"===e.type&&(a.set("tab","discussion"),e.messageChannel&&a.set("chat","CUSTOMER"===e.messageChannel?"client":"team")),a.toString()&&(t+="?".concat(a.toString())),i.push(t),R(!1)},eh=async e=>{try{await Promise.all(e.notifications.filter(e=>!e.readAt).map(e=>v(e.id)))}catch(e){console.error("Failed to mark notifications as read:",e)}let t=e.latestNotification.orgId;t&&t!==o&&l(t);let a="/jobs/".concat(e.projectId),s=new URLSearchParams;s.set("tab","discussion");let n=e.latestNotification.messageChannel;n&&s.set("chat","CUSTOMER"===n?"client":"team"),a+="?".concat(s.toString()),i.push(a),R(!1)},em=(0,O.useMemo)(()=>{let e=new Map,t=[];for(let a of h)if("NEW_MESSAGE"===a.type&&a.projectId){let t=e.get(a.projectId)||[];t.push(a),e.set(a.projectId,t)}else t.push(a);let a=[...t];for(let[t,s]of e)if(1===s.length)a.push(s[0]);else{let e=s.sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime())[0];a.push({type:"GROUPED_MESSAGES",projectId:t,projectAddress:e.projectAddress,notifications:s,messageCount:s.length,unreadCount:s.filter(e=>!e.readAt).length,latestNotification:e})}return a.sort((e,t)=>{let a=es(e)?new Date(e.latestNotification.createdAt).getTime():new Date(e.createdAt).getTime();return(es(t)?new Date(t.latestNotification.createdAt).getTime():new Date(t.createdAt).getTime())-a})},[h]),ep=k(),eg=null!=(a=null==N?void 0:N.hasCompletedSetup)&&a,ef=null!=(n=null==N?void 0:N.dismissedGuide)&&n,ex=(null==c||null==(t=c.accountType)?void 0:t.toUpperCase())==="COMPANY",ev=(0,O.useMemo)(()=>u.find(e=>{var t,a;return(null==(t=e.organization)?void 0:t.type)==="PERSONAL"||(null==(a=e.organization)?void 0:a.type)==="PERSONAL"}),[u]),ej=(0,O.useCallback)(()=>{(null==ev?void 0:ev.orgId)&&ev.orgId!==o&&l(ev.orgId),i.push("/dashboard"),setTimeout(()=>{let e=document.querySelector('[data-tour="setup-guide"]');e&&e.scrollIntoView({behavior:"smooth",block:"start"})},500)},[ev,o,l,i]),ey=async()=>{en(!0);try{await A(),await S(),R(!1),ej()}catch(e){console.error("Failed to reset tour:",e)}finally{en(!1)}},eb=async()=>{try{await M(),await S()}catch(e){console.error("Failed to dismiss tour:",e)}},ew=async()=>{ei(!0);try{await j()}catch(e){console.error("Failed to mark all as read:",e)}finally{ei(!1)}};return(0,s.jsxs)(x.rI,{open:T,onOpenChange:eo,children:[(0,s.jsx)(x.ty,{asChild:!0,children:(0,s.jsxs)(p.$,{variant:"ghost",size:"icon",className:(0,et.cn)("relative",r),"aria-label":"Notifications",children:[(0,s.jsx)(V,{className:"h-5 w-5"}),g>0&&(0,s.jsx)(P.E,{variant:"destructive",className:"absolute -top-1 -right-1 h-5 w-5 flex items-center justify-center p-0 text-xs",children:g>9?"9+":g})]})}),(0,s.jsxs)(x.SQ,{align:"end",className:"w-80",children:[!ef&&!ex&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"p-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)(B.A,{className:"h-4 w-4 text-primary"}),(0,s.jsx)("span",{className:"text-sm font-medium",children:"Setup Guide"}),eg&&(0,s.jsx)(P.E,{variant:"secondary",className:"ml-auto text-xs",children:"Complete"}),(0,s.jsx)(p.$,{size:"sm",variant:"ghost",className:(0,et.cn)("h-6 w-6 p-0",eg?"":"ml-auto"),onClick:eb,title:"Dismiss guide",children:(0,s.jsx)(W.A,{className:"h-3 w-3"})})]}),!eg&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)(Q.k,{value:ep.percentage,className:"h-1.5 flex-1"}),(0,s.jsxs)("span",{className:"text-xs text-muted-foreground",children:[ep.completed,"/",ep.total]})]}),(0,s.jsxs)(p.$,{size:"sm",variant:"outline",className:"w-full h-8 text-xs",onClick:()=>{R(!1),ej()},children:["Continue Setup",(0,s.jsx)(q.A,{className:"h-3 w-3 ml-1"})]})]}),eg&&(0,s.jsx)("div",{className:"flex gap-2",children:(0,s.jsxs)(p.$,{size:"sm",variant:"ghost",className:"flex-1 h-8 text-xs",onClick:ey,disabled:U,children:[U?(0,s.jsx)(Z.y,{className:"h-3 w-3 mr-1"}):(0,s.jsx)(Y.A,{className:"h-3 w-3 mr-1"}),"Restart Guide"]})}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-2",children:"You can always restart the guide from Settings."})]}),(0,s.jsx)(x.mB,{})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between px-2 py-1.5",children:[(0,s.jsx)(x.lp,{className:"font-semibold p-0",children:"Notifications"}),g>0&&(0,s.jsx)(p.$,{size:"sm",variant:"ghost",className:"h-6 text-xs text-muted-foreground hover:text-foreground",onClick:ew,disabled:er,children:er?(0,s.jsx)(Z.y,{className:"h-3 w-3"}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)($.A,{className:"h-3 w-3 mr-1"}),"Mark all read"]})})]}),(0,s.jsx)(x.mB,{}),f&&0===h.length?(0,s.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,s.jsx)(Z.y,{className:"h-6 w-6"})}):0===em.length?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 text-muted-foreground",children:[(0,s.jsx)(V,{className:"h-8 w-8 mb-2 opacity-50"}),(0,s.jsx)("p",{className:"text-sm",children:"All caught up!"})]}):(0,s.jsx)(K.F,{className:"max-h-[400px]",children:(0,s.jsx)("div",{className:"flex flex-col",children:em.map(e=>{let t;if(es(e)){let t=e.projectAddress||"Project ".concat(e.projectId.substring(0,8),"...");return(0,s.jsxs)("div",{className:(0,et.cn)("flex flex-col gap-2 p-3 border-b last:border-b-0 hover:bg-muted/50 transition-colors",e.unreadCount>0&&"bg-muted/30"),children:[(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("div",{className:"flex-shrink-0 mt-0.5",children:(0,s.jsx)(H.A,{className:"h-4 w-4 text-green-500"})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("p",{className:"text-sm font-medium leading-tight",children:[e.messageCount," new messages"]}),e.unreadCount>0&&(0,s.jsxs)(P.E,{variant:"secondary",className:"h-5 text-xs px-1.5",children:[e.unreadCount," unread"]})]}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-0.5",children:t}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:(0,ee.m)(e.latestNotification.createdAt,{addSuffix:!0})})]})]}),(0,s.jsx)("div",{className:"flex items-center gap-2 ml-7",children:(0,s.jsxs)(p.$,{size:"sm",variant:"outline",className:"h-7 text-xs",onClick:()=>eh(e),children:[(0,s.jsx)(X.A,{className:"h-3 w-3 mr-1"}),"View Project"]})})]},"grouped-".concat(e.projectId))}let a=D.has(e.id);return(0,s.jsxs)("div",{className:(0,et.cn)("flex flex-col gap-2 p-3 border-b last:border-b-0 hover:bg-muted/50 transition-colors",!e.readAt&&"bg-muted/30"),children:[(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("div",{className:"flex-shrink-0 mt-0.5",children:(e=>{switch(e){case"PROJECT_ASSIGNED":return(0,s.jsx)(L.A,{className:"h-4 w-4 text-blue-500"});case"NEW_MESSAGE":return(0,s.jsx)(H.A,{className:"h-4 w-4 text-green-500"});case"PROJECT_APPROVED":return(0,s.jsx)(F.A,{className:"h-4 w-4 text-emerald-500"});case"PROJECT_DELIVERED":return(0,s.jsx)(_.A,{className:"h-4 w-4 text-primary"});case"CHANGES_REQUESTED":return(0,s.jsx)(J.A,{className:"h-4 w-4 text-amber-500"});case"DELIVERY_COMMENT":return(0,s.jsx)(G,{className:"h-4 w-4 text-blue-500"});default:return(0,s.jsx)(E.A,{className:"h-4 w-4 text-purple-500"})}})(e.type)}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"text-sm font-medium leading-tight",children:(e=>{switch(e.type){case"INVITATION_MEMBER":return"Invited to join ".concat(e.orgName);case"INVITATION_CUSTOMER":return"Invited as customer of ".concat(e.orgName);case"PROJECT_ASSIGNED":return"Assigned to project";case"NEW_MESSAGE":return"New message in project";case"PROJECT_APPROVED":return"Project approved";case"PROJECT_DELIVERED":return"Your media is ready";case"CHANGES_REQUESTED":return"Changes requested";case"DELIVERY_COMMENT":return"New delivery comment";default:return"Notification"}})(e)}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-0.5 line-clamp-2",children:(e=>{switch(e.type){case"INVITATION_MEMBER":return e.role?"Role: ".concat(e.role):"Join as a team member";case"INVITATION_CUSTOMER":return"Become a customer of this organization";case"PROJECT_ASSIGNED":let t=e.assignedRole?e.assignedRole.replace("_"," ").toLowerCase():"team member";return e.projectAddress?"As ".concat(t," at ").concat(e.projectAddress):"As ".concat(t);case"NEW_MESSAGE":let a="CUSTOMER"===e.messageChannel?"Customer":"Team",s=e.projectAddress||(e.projectId?"Project ".concat(e.projectId.substring(0,8),"..."):"");if(e.messagePreview){let t=e.messagePreview.replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/<[^>]*>/g,"").trim(),n=t.substring(0,50);return"".concat(s?"".concat(s," • "):"").concat(a,': "').concat(n).concat(t.length>50?"...":"",'"')}return s?"".concat(s," • New message in ").concat(a," channel"):"New message in ".concat(a," channel");case"PROJECT_APPROVED":return e.approverName?"Approved by ".concat(e.approverName).concat(e.projectAddress?" - ".concat(e.projectAddress):""):e.projectAddress||"Project delivery approved";case"PROJECT_DELIVERED":return e.projectAddress?"".concat(e.orgName," has delivered your media for ").concat(e.projectAddress):"".concat(e.orgName," has delivered your media");case"CHANGES_REQUESTED":return e.projectAddress?"Customer requested changes for ".concat(e.projectAddress):"Customer requested changes on the delivery";case"DELIVERY_COMMENT":return e.messagePreview?'"'.concat(e.messagePreview.substring(0,50)).concat(e.messagePreview.length>50?"...":"",'"'):e.projectAddress||"New comment on delivery";default:return""}})(e)}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:(0,ee.m)(e.createdAt,{addSuffix:!0})})]})]}),(0,s.jsx)("div",{className:"flex items-center gap-2 ml-7",children:"INVITATION_MEMBER"===(t=e.type)||"INVITATION_CUSTOMER"===t?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(p.$,{size:"sm",variant:"default",className:"h-7 text-xs",onClick:()=>el(e),disabled:a,children:a?(0,s.jsx)(Z.y,{className:"h-3 w-3"}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(I.A,{className:"h-3 w-3 mr-1"}),"Accept"]})}),(0,s.jsxs)(p.$,{size:"sm",variant:"outline",className:"h-7 text-xs",onClick:()=>ec(e),disabled:a,children:[(0,s.jsx)(W.A,{className:"h-3 w-3 mr-1"}),"Decline"]}),(0,s.jsxs)(p.$,{size:"sm",variant:"ghost",className:"h-7 text-xs",onClick:()=>ed(e),children:[(0,s.jsx)(X.A,{className:"h-3 w-3 mr-1"}),"View"]})]}):(0,s.jsxs)(p.$,{size:"sm",variant:"outline",className:"h-7 text-xs",onClick:()=>eu(e),children:[(0,s.jsx)(X.A,{className:"h-3 w-3 mr-1"}),"PROJECT_DELIVERED"===e.type?"View Delivery":"View Project"]})})]},e.id)})})})]})]})}function er(){try{(0,u.cL)()}catch(e){return null}return(0,s.jsx)(u.x2,{})}function ei(e){let{user:t,showNewJobButton:a=!1,onNewJobClick:n,uiContext:r}=e,{theme:o,setTheme:l}=(0,h.D)(),{logout:c,activeOrganizationId:d}=(0,C.A)(),u=(0,i._)(),k=(0,m.useRouter)(),E=(0,m.usePathname)(),M=(0,f.a)(),{showSidebar:I,navItems:S,canCreateOrder:T,createActionLabel:R,createActionPath:D,accountType:O}=r||{showSidebar:!1,navItems:[],canCreateOrder:!1,createActionLabel:"New Job",createActionPath:"/jobs/new",accountType:"AGENT"},z=()=>{"AGENT"===O?k.push(D):n?n():u.openJobCreationDialog()},P=()=>{k.push(d?"/organization/".concat(d):"/organization")};return(0,s.jsx)("header",{className:"sticky top-0 z-50 flex items-center border-none! border-b bg-card/80 backdrop-blur-xl w-full pl-2 pr-4 h-header-h",children:(0,s.jsx)("div",{className:"w-full max-w-full",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("div",{className:"flex items-center gap-3",children:I?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(U,{variant:"header",onOrgHome:P}),!M&&(0,s.jsx)(er,{})]}):(0,s.jsx)(U,{variant:"header",onOrgHome:P})}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[!I&&!M&&S.length>0&&(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[S.map(e=>{var t;return(0,s.jsx)(p.$,{variant:("/dashboard"===(t=e.path)?"/dashboard"===E:"/orders"===t?"/orders"===E||(null==E?void 0:E.startsWith("/orders/")):"/jobs/all-jobs"===t?null==E?void 0:E.startsWith("/jobs"):null==E?void 0:E.startsWith(t))?"activeFlat":"mutedFlat",size:"sm",onClick:()=>k.push(e.path),children:e.label},e.path)}),T&&(0,s.jsxs)(p.$,{variant:E===D?"activeFlat":"mutedFlat",size:"sm",onClick:z,className:"gap-1",children:[(0,s.jsx)(v.A,{className:"h-4 w-4"}),R]})]}),I&&!M&&a&&(0,s.jsxs)(p.$,{onClick:z,size:"sm",className:"gap-2",variant:"mutedFlat",children:[(0,s.jsx)(v.A,{className:"h-4 w-4"}),R]}),("AGENT"===O||"PROVIDER"===O||"COMPANY"===O)&&(0,s.jsx)(en,{}),(0,s.jsxs)(x.rI,{children:[(0,s.jsx)(x.ty,{asChild:!0,children:(0,s.jsx)(p.$,{variant:"ghost",className:"flex items-center gap-3 h-auto p-0",children:(0,s.jsxs)(g.eu,{className:"size-9 border-2 border-border",children:[(0,s.jsx)(g.BK,{src:(null==t?void 0:t.avatarUrl)||""}),(0,s.jsx)(g.q5,{className:"bg-primary text-primary-foreground text-xs",children:(null==t?void 0:t.name)?t.name.split(" ").map(e=>e[0]).join(""):"U"})]})})}),(0,s.jsxs)(x.SQ,{align:"end",className:"w-56",children:[(0,s.jsx)(x.lp,{children:(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm",children:(null==t?void 0:t.name)||"User"}),(0,s.jsx)("div",{className:"text-xs text-muted-foreground",children:(null==t?void 0:t.email)||"email@example.com"})]})}),(0,s.jsx)(x.mB,{}),(0,s.jsxs)(x._2,{onClick:()=>k.push("/profile"),children:[(0,s.jsx)(j.A,{className:"h-4 w-4 mr-2"}),"Profile"]}),(0,s.jsxs)(x._2,{onClick:()=>{k.push("/settings")},children:[(0,s.jsx)(y.A,{className:"h-4 w-4 mr-2"}),"Settings"]}),(0,s.jsx)(x.mB,{}),(0,s.jsx)(x.lp,{children:"Theme"}),(0,s.jsxs)(x.Hr,{value:o,onValueChange:l,children:[(0,s.jsxs)(x.Ht,{value:"light",children:[(0,s.jsx)(b.A,{className:"h-4 w-4 mr-2"}),"Light"]}),(0,s.jsxs)(x.Ht,{value:"dark",children:[(0,s.jsx)(w.A,{className:"h-4 w-4 mr-2"}),"Dark"]}),(0,s.jsxs)(x.Ht,{value:"system",children:[(0,s.jsx)(N.A,{className:"h-4 w-4 mr-2"}),"System"]})]}),(0,s.jsx)(x.mB,{}),(0,s.jsxs)(x._2,{onClick:()=>{localStorage.removeItem("accountType"),c()},children:[(0,s.jsx)(A,{className:"h-4 w-4 mr-2"}),"Log out"]})]})]})]})]})})})}a(73344);let eo=(0,k.A)("layout-dashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);var el=a(21873),ec=a(16485),ed=a(64936);let eu={LayoutDashboard:eo,Briefcase:L.A,MapPin:el.A,Calendar:ec.A,Package:_.A,MessageSquare:H.A},eh=[{path:"/dashboard",icon:"LayoutDashboard",label:"Dashboard"},{path:"/jobs",icon:"Briefcase",label:"Jobs"},{path:"/map",icon:"MapPin",label:"Map"},{path:"/calendar",icon:"Calendar",label:"Calendar"}];function em(e){let{uiContext:t}=e,a=(0,m.usePathname)(),n=(0,m.useRouter)(),r=(0,i._)(),{showSidebar:o=!0,navItems:l=[],canCreateOrder:c=!1,createActionPath:d="/jobs/new",accountType:u="AGENT"}=t||{},h=(o?eh:l.length>0?l:eh).slice(0,4),p=e=>"/dashboard"===e?"/dashboard"===a:"/orders"===e?"/orders"===a||(null==a?void 0:a.startsWith("/orders/")):"/jobs"===e||"/jobs/all-jobs"===e?null==a?void 0:a.startsWith("/jobs"):null==a?void 0:a.startsWith(e);return(0,s.jsx)("nav",{className:"fixed bottom-0 left-0 right-0 z-50 md:hidden border-t bg-card/95 backdrop-blur-xl shadow-lg",style:{height:"var(--dock-h)",paddingBottom:"env(safe-area-inset-bottom, 0px)"},children:(0,s.jsxs)("div",{className:"flex items-center justify-around px-2 py-2 max-w-screen-sm mx-auto",children:[h.slice(0,2).map(e=>{let t=eu[e.icon]||eo,a=p(e.path);return(0,s.jsxs)("button",{type:"button",className:(0,ed.cn)("flex flex-col items-center justify-center gap-1 size-16 rounded-lg transition-colors relative",a?"bg-primary/10 text-primary":"text-muted-foreground hover:text-foreground hover:bg-accent/50"),onClick:()=>n.push(e.path),"aria-label":e.label,children:[(0,s.jsx)(t,{className:"h-5 w-5"}),(0,s.jsx)("span",{className:"text-xs font-medium",children:e.label})]},e.path)}),(c||"AGENT"===u)&&(0,s.jsx)("button",{type:"button",className:"size-14 rounded-full bg-primary text-primary-foreground shadow-lg hover:shadow-xl transition-all hover:scale-105 flex items-center justify-center",onClick:()=>{"AGENT"===u?n.push(d):r.openJobCreationDialog()},"aria-label":"AGENT"===u?"Create order":"Create new job",children:(0,s.jsx)(v.A,{className:"h-6 w-6"})}),h.slice(2,4).map(e=>{let t=eu[e.icon]||eo,a=p(e.path);return(0,s.jsxs)("button",{type:"button",className:(0,ed.cn)("flex flex-col items-center justify-center gap-1 size-16 rounded-lg transition-colors relative",a?"bg-primary/10 text-primary":"text-muted-foreground hover:text-foreground hover:bg-accent/50"),onClick:()=>n.push(e.path),"aria-label":e.label,children:[(0,s.jsx)(t,{className:"h-5 w-5"}),(0,s.jsx)("span",{className:"text-xs font-medium",children:e.label})]},e.path)})]})})}var ep=a(52619),eg=a.n(ep);let ef=(0,k.A)("kanban",[["path",{d:"M5 3v14",key:"9nsxs2"}],["path",{d:"M12 3v8",key:"1h2ygw"}],["path",{d:"M19 3v18",key:"1sk56x"}]]);var ex=a(91169);let ev=(0,k.A)("handshake",[["path",{d:"m11 17 2 2a1 1 0 1 0 3-3",key:"efffak"}],["path",{d:"m14 14 2.5 2.5a1 1 0 1 0 3-3l-3.88-3.88a3 3 0 0 0-4.24 0l-.88.88a1 1 0 1 1-3-3l2.81-2.81a5.79 5.79 0 0 1 7.06-.87l.47.28a2 2 0 0 0 1.42.25L21 4",key:"9pr0kb"}],["path",{d:"m21 3 1 11h-2",key:"1tisrp"}],["path",{d:"M3 3 2 14l6.5 6.5a1 1 0 1 0 3-3",key:"1uvwmv"}],["path",{d:"M3 4h8",key:"1ep09j"}]]);var ej=a(89715),ey=a(17910),eb=a(20908),ew=a(35561);function eN(){var e;let t=(0,m.usePathname)(),{state:a}=(0,u.cL)(),{activeMembership:n}=(0,D.Q)(),r=((null==n?void 0:n.role)||(null==n?void 0:n.orgRole)||"").toUpperCase(),i=(null==n||null==(e=n.organization)?void 0:e.type)||(null==n?void 0:n.organizationType)||"",o="PROJECT_MANAGER"===r&&"PERSONAL"!==i||"EDITOR"===r&&"PERSONAL"!==i,l=function(e){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("/dashboard"===e)return"/dashboard"===t;if(a&&e.startsWith("/settings")){if("/settings/account"===e)return(null==t?void 0:t.startsWith("/settings/account"))||(null==t?void 0:t.startsWith("/settings/notifications"))||"/settings/profile"===t;let a=e.split("/").slice(0,3).join("/");return null==t?void 0:t.startsWith(a)}return a?t===e:null==t?void 0:t.startsWith(e)},c=(null==t?void 0:t.startsWith("/jobs"))&&"/jobs"!==t,[d,h]=(0,O.useState)(!1),p=(null==t?void 0:t.startsWith("/settings"))&&"/settings"!==t,[g,f]=(0,O.useState)(!1);(0,O.useEffect)(()=>{h(c),f(p)},[c,p]);let x=[{path:"/dashboard",icon:eo,label:"Dashboard",tooltip:"Dashboard"},{path:"/jobs/all-jobs",icon:L.A,label:"Jobs",tooltip:"Jobs",defaultPath:"/jobs/all-jobs",submenu:[{path:"/jobs/all-jobs",icon:L.A,label:"All Jobs"},{path:"/jobs/job-management",icon:ef,label:"Job Management"}]},{path:"/team",icon:ex.A,label:"Team",tooltip:"Team"},{path:"/customers",icon:ev,label:"Customers",tooltip:"Customers"},{path:"/audit",icon:ej.A,label:"Audit Log",tooltip:"Audit Log"},{path:"/map",icon:el.A,label:"Map",tooltip:"Map"},{path:"/calendar",icon:ec.A,label:"Calendar",tooltip:"Calendar"},{path:"/settings",icon:y.A,label:"Settings",tooltip:"Settings",defaultPath:"/settings/account",submenu:[{path:"/settings/account",icon:j.A,label:"Personal"},{path:"/settings/organization/general",icon:E.A,label:"Organization"},{path:"/settings/product/features",icon:_.A,label:"Product"},{path:"/settings/security/password",icon:ey.A,label:"Security"},{path:"/settings/preferences/appearance",icon:y.A,label:"Preferences"},{path:"/settings/support/help-center",icon:eb.A,label:"Support"}]}].filter(e=>!(o&&("Customers"===e.label||"Audit Log"===e.label))).map(e=>{if(!e.submenu)return e;let t=o?e.submenu.filter(e=>"Organization"!==e.label&&"Product"!==e.label):e.submenu;return{...e,submenu:t}}).filter(e=>!(e.submenu&&0===e.submenu.length));return(0,s.jsx)(u.Bx,{collapsible:"icon",variant:"sidebar",style:{"--header-height":"var(--header-h)"},className:"**:data-[slot=sidebar-container]:top-(--header-height)! **:data-[slot=sidebar-container]:h-[calc(100vh-var(--header-height))]! **:data-[slot=sidebar-container]:bottom-auto! mt-[var(--header-h)] h-[calc(100vh-var(--header-h))] border-none! bg-card/80! backdrop-blur-xl!",children:(0,s.jsx)(u.Yv,{className:"pl-1.5",children:(0,s.jsx)(u.Cn,{children:(0,s.jsx)(u.rQ,{children:(0,s.jsx)(u.wZ,{children:x.map(e=>{var t;let n=e.icon,r=e.submenu&&e.submenu.length>0,i=l(e.path),o=e.defaultPath||e.path,c=r&&(null==(t=e.submenu)?void 0:t.some(e=>l(e.path,!0))),m=r&&(c||"/jobs"===e.path&&d||"/settings"===e.path&&g);if(r){let t="/jobs"===e.path,r="/settings"===e.path;return(0,s.jsx)(ew.Nt,{open:m,onOpenChange:e=>{t?h(e):r&&f(e)},children:(0,s.jsxs)(u.FX,{children:[(0,s.jsx)(u.Uj,{asChild:!0,isActive:c||i,tooltip:e.tooltip,children:(0,s.jsxs)(eg(),{href:o,children:[(0,s.jsx)(n,{}),(0,s.jsx)("span",{children:e.label}),"expanded"===a&&(0,s.jsx)(ew.R6,{asChild:!0,className:"ml-auto z-50",children:(0,s.jsx)(q.A,{className:(0,ed.cn)("h-3.5 w-3.5 transition-transform duration-200","text-sidebar-foreground/50 group-hover/menu-item:text-sidebar-accent-foreground/70",(c||i)&&"text-sidebar-accent-foreground/70",m&&"rotate-90")})})]})}),(0,s.jsx)(ew.Ke,{children:(0,s.jsx)(u.q9,{className:"w-full translate-x-0 mx-0 px-0 border-none",children:e.submenu.map(e=>{let t=e.icon;return(0,s.jsx)(u.Fg,{className:"ml-3",children:(0,s.jsx)(u.Cp,{asChild:!0,isActive:l(e.path,!0),children:(0,s.jsxs)(eg(),{href:e.path,children:[(0,s.jsx)(t,{}),(0,s.jsx)("span",{children:e.label})]})})},e.path)})})})]})},e.path)}return(0,s.jsx)(u.FX,{children:(0,s.jsx)(u.Uj,{asChild:!0,isActive:i,tooltip:e.tooltip,children:(0,s.jsxs)(eg(),{href:e.path,children:[(0,s.jsx)(n,{}),(0,s.jsx)("span",{children:e.label})]})})},e.path)})})})})})})}var ek=a(54679),eA=a(90908),eC=a(62816),eE=a(86784);function eM(e){let{open:t,onOpenChange:a,selectedJob:n,technicians:r,onJobAssign:i}=e;return(0,s.jsx)(ek.lG,{open:t,onOpenChange:a,children:(0,s.jsxs)(ek.Cf,{className:"md:min-w-[90vw] min-w-[calc(100vw-1rem)] md:max-w-[90vw] md:h-[90vh] h-[calc(100vh-1rem)] md:max-h-[90vh] p-0 gap-0 overflow-hidden flex flex-col",children:[(0,s.jsx)(ek.L3,{className:"sr-only",children:n?"Technician Rankings for ".concat(n.propertyAddress):"Technician Rankings"}),n&&(0,s.jsx)("div",{className:"flex-1 min-h-0 overflow-hidden h-full",children:(0,s.jsx)(eE.n,{jobs:[n],providers:r,selectedJob:n,onSelectJob:()=>{},onJobAssign:i,className:"size-full",fullScreen:!0,initialSidebarView:"rankings",initialJobForRankings:n,onGoBack:()=>a(!1),isDispatcherView:!0})})]})})}var eI=a(32559),eS=a(48988),eT=a(6132);function eR(){let{issues:e,clearIssue:t,clearAllIssues:a,hasPersistentIssues:n}=(0,eS.i)();if(!n)return null;let r=e.filter(e=>"api"===e.type),i=e.filter(e=>"websocket"===e.type),o=[];if(r.length>0){let e=Array.from(new Set(r.map(e=>e.message)));o.push(...e.map(e=>"API: ".concat(e)))}if(i.length>0){let e=Array.from(new Set(i.map(e=>e.message)));o.push(...e.map(e=>"WebSocket: ".concat(e)))}return(0,s.jsx)("div",{className:"fixed bottom-4 left-4 z-50 animate-in slide-in-from-bottom-5",children:(0,s.jsxs)(eI.Fc,{variant:"destructive",className:"h-full",children:[(0,s.jsx)(eT.A,{className:"h-4 w-4"}),(0,s.jsxs)(eI.XL,{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{children:"Backend Connection Issues"}),(0,s.jsx)(p.$,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:a,children:(0,s.jsx)(W.A,{className:"h-4 w-4"})})]}),(0,s.jsx)(eI.TN,{children:(0,s.jsx)("ul",{className:"list-disc list-inside space-y-1 mt-2 max-w-[80ch]",children:o.map((e,t)=>(0,s.jsx)("li",{className:"text-sm",children:e},t))})})]})})}var eD=a(95657),eO=a(35722),ez=a(80408);function eP(e){let{children:t,user:a,memberships:n,activeOrgId:r,uiContext:o}=e,c=(0,i._)(),d=(0,l.w)(),h=(0,f.a)(),[m,p]=(0,O.useState)([]),[,g]=(0,O.useState)(!1);(0,O.useEffect)(()=>{let e=!1;return(async()=>{if(r){g(!0);try{let t=await (0,eO.NV)();e||p(t)}catch(t){console.error("Failed to load technicians for rankings",t),e||p([])}finally{e||g(!1)}}})(),()=>{e=!0}},[r]);let{showSidebar:x,canCreateOrder:v,navItems:j,accountType:y}=o,b=n.find(e=>(null==e?void 0:e.orgId)===r),w=((null==b?void 0:b.role)||(null==b?void 0:b.orgRole)||"").toUpperCase(),N=x&&v&&!("PROJECT_MANAGER"===w&&x||"EDITOR"===w&&x),k=(0,s.jsx)(eC.RV,{initialValues:c.initialValues,onSubmit:c.handleJobCreate});return x?(0,s.jsxs)(u.GB,{children:[(0,s.jsx)("div",{className:"fixed top-0 left-0 right-0 z-50",children:(0,s.jsx)(ei,{user:a,showNewJobButton:N,uiContext:o})}),(0,s.jsx)(eN,{}),(0,s.jsx)(u.sF,{className:"min-w-0 pt-header-h pb-dock-h md:pb-0!",children:t}),(0,s.jsx)(em,{uiContext:o}),N&&(h?(0,s.jsx)(eA._s,{open:c.isOpen,onOpenChange:e=>{e||c.closeJobCreationDialog()},children:(0,s.jsxs)(eA.zj,{children:[(0,s.jsx)(eA.BE,{className:"sr-only",children:(0,s.jsx)(eA.gk,{children:"Create New Job"})}),(0,s.jsx)("div",{className:"overflow-y-auto px-4 pb-4",children:k})]})}):(0,s.jsx)(ek.lG,{open:c.isOpen,onOpenChange:e=>{e||c.closeJobCreationDialog()},children:(0,s.jsxs)(ek.Cf,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,s.jsx)(ek.c7,{children:(0,s.jsx)(ek.L3,{children:"Create New Job"})}),k]})})),(0,s.jsx)(eM,{open:d.showRankings,onOpenChange:e=>{e||d.closeRankings()},selectedJob:d.selectedJob,technicians:et.e?[]:m,onJobAssign:d.assignJob})]}):(0,s.jsxs)("div",{className:"flex h-screen w-full flex-col overflow-y-scroll",children:[(0,s.jsx)("div",{className:"fixed top-0 left-0 right-0 z-50",children:(0,s.jsx)(ei,{user:a,showNewJobButton:!1,uiContext:o})}),(0,s.jsx)("main",{className:"pt-header-h pb-dock-h md:pb-0! size-full flex-1",children:t}),(0,s.jsx)(em,{uiContext:o})]})}function eU(e){let{children:t}=e,{user:a,isLoading:i,organizationId:h,memberships:m}=(0,n.l)(["AGENT","TECHNICIAN","COMPANY"]),[p,g]=(0,O.useState)(null),f=(0,O.useMemo)(()=>(0,ez.EL)(a,m,h),[a,m,h]),x=m.find(e=>e.orgId===h),v=(null==x?void 0:x.orgRole)||(null==x?void 0:x.role)||null;return((0,O.useEffect)(()=>{(async()=>{if(h){eD.F.organizations.setActiveOrganization(h);try{let e=await eD.F.dashboard.get();g(e.projects||[])}catch(e){console.error("Failed to preload projects",e);try{let e=await eD.F.projects.listForCurrentUser();g(e)}catch(e){console.error("Failed to load projects as fallback",e)}}}})()},[h]),i)?(0,s.jsxs)(u.GB,{children:[(0,s.jsx)("div",{className:"fixed top-0 left-0 right-0 z-50 border-b bg-card/80 backdrop-blur-xl shadow-sm",children:(0,s.jsx)("div",{className:"w-full max-w-full py-3 px-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(r.E,{className:"h-6 w-24"}),(0,s.jsx)(r.E,{className:"h-8 w-8"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)(r.E,{className:"h-8 w-20"}),(0,s.jsx)(r.E,{className:"h-9 w-9 rounded-full"})]})]})})}),(0,s.jsxs)("div",{className:"p-6 pt-header-h",children:[(0,s.jsx)(r.E,{className:"h-8 w-48 mb-6"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)(r.E,{className:"h-32 w-full"}),(0,s.jsx)(r.E,{className:"h-32 w-full"}),(0,s.jsx)(r.E,{className:"h-32 w-full"})]})]})]}):a&&f?(0,s.jsx)(l.s,{defaultUserId:null==a?void 0:a.id,defaultOrganizationId:h||void 0,initialProjects:p||void 0,userRole:f.accountType,memberRole:v,children:(0,s.jsx)(eL,{defaultUserId:null==a?void 0:a.id,defaultOrganizationId:h||void 0,userRole:f.accountType,children:(0,s.jsx)(o.w,{defaultUserId:null==a?void 0:a.id,defaultUserName:null==a?void 0:a.name,defaultUserAvatar:null==a?void 0:a.avatarUrl,children:(0,s.jsxs)(c.H,{children:[(0,s.jsx)(d.AY,{children:(0,s.jsx)(eP,{user:a,memberships:m,activeOrgId:h,uiContext:f,children:t})}),(0,s.jsx)(eR,{})]})})})}):null}function eL(e){let{children:t,defaultUserId:a,defaultOrganizationId:n,userRole:r}=e,o=(0,l.w)(),c=async e=>{var t,s;let i={address:{unparsed_address:e.propertyAddress||"",latitude:null==(t=e.location)?void 0:t.lat,longitude:null==(s=e.location)?void 0:s.lng},scheduledTime:e.scheduledDate&&e.scheduledTime?new Date("".concat(e.scheduledDate,"T").concat(e.scheduledTime)):void 0,notes:e.requirements,customerId:e.customerId,orgId:e.organizationId||n,projectManagerId:e.createdBy||("AGENT"===r?a:void 0)},l=await o.createJob(i);return eD.F.mapProjectToJobCard(l)};return(0,s.jsx)(i.U,{defaultUserId:a,defaultOrganizationId:n,createJobHandler:c,children:t})}},69152:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("check-check",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]])},69802:(e,t,a)=>{"use strict";a.d(t,{w:()=>u,I:()=>h});var s=a(95155),n=a(12115),r=a(95657),i=a(9829);class o{connect(e){if(this.socket&&this.socket.connected)return;let t=e||localStorage.getItem("token")||void 0;this.socket=(0,i.io)("".concat("http://localhost:3001","/chat"),{autoConnect:!0,transports:["websocket"],auth:{token:t}}),this.socket.on("connect_error",e=>{{let t=e.message||"WebSocket connection failed";window.dispatchEvent(new CustomEvent("backend-websocket-error",{detail:{message:"WebSocket: ".concat(t)}}))}}),this.socket.on("connect",()=>{window.dispatchEvent(new CustomEvent("backend-websocket-success"))}),this.socket.on("disconnect",e=>{"io client disconnect"!==e&&window.dispatchEvent(new CustomEvent("backend-websocket-error",{detail:{message:"WebSocket disconnected: ".concat(e)}}))}),this.socket.on("messageCreated",e=>{let t=this.mapIncomingMessage(e);t&&this.messageHandlers.forEach(e=>e(t))}),this.socket.on("userTyping",e=>{this.typingHandlers.forEach(t=>t(e))}),this.socket.on("presenceUpdate",e=>{this.presenceUpdateHandlers.forEach(t=>t(e))}),this.socket.on("presenceList",e=>{this.presenceListHandlers.forEach(t=>t(e))}),this.socket.on("messagesRead",e=>{this.messagesReadHandlers.forEach(t=>t(e))})}disconnect(){this.socket&&(this.socket.removeAllListeners(),this.socket.disconnect(),this.socket=null),this.typingDebounceTimers.forEach(e=>clearTimeout(e)),this.typingDebounceTimers.clear(),this.typingState.clear()}async joinProject(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"TEAM";return this.socket||this.connect(),new Promise((a,s)=>{var n;null==(n=this.socket)||n.emit("joinProject",{projectId:e,channel:t},e=>{(null==e?void 0:e.error)?s(Error(e.error)):a()})})}async sendMessage(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"TEAM",s=arguments.length>3?arguments[3]:void 0;return this.socket||this.connect(),new Promise((n,r)=>{var i;null==(i=this.socket)||i.emit("sendMessage",{projectId:e,content:t,channel:a,thread:s},e=>{if(null==e?void 0:e.error)r(Error(e.error));else{let t=this.mapIncomingMessage(e);t?n(t):r(Error("Malformed message payload"))}})})}onMessage(e){this.messageHandlers.add(e)}offMessage(e){this.messageHandlers.delete(e)}emitTyping(e,t,a){var s,n;let r="".concat(e,":").concat(t),i=this.typingState.get(r),o=this.typingDebounceTimers.get(r);if(o&&(clearTimeout(o),this.typingDebounceTimers.delete(r)),a){i||(this.typingState.set(r,!0),null==(s=this.socket)||s.emit("typing",{projectId:e,channel:t,isTyping:!0}));let a=setTimeout(()=>{var a;this.typingState.set(r,!1),null==(a=this.socket)||a.emit("typing",{projectId:e,channel:t,isTyping:!1}),this.typingDebounceTimers.delete(r)},2e3);this.typingDebounceTimers.set(r,a)}else i&&(this.typingState.set(r,!1),null==(n=this.socket)||n.emit("typing",{projectId:e,channel:t,isTyping:!1}))}stopTyping(e,t){this.emitTyping(e,t,!1)}onTyping(e){this.typingHandlers.add(e)}offTyping(e){this.typingHandlers.delete(e)}onPresenceUpdate(e){this.presenceUpdateHandlers.add(e)}offPresenceUpdate(e){this.presenceUpdateHandlers.delete(e)}onPresenceList(e){this.presenceListHandlers.add(e)}offPresenceList(e){this.presenceListHandlers.delete(e)}async markMessagesRead(e,t,a){return this.socket||this.connect(),new Promise((s,n)=>{var r;null==(r=this.socket)||r.emit("markRead",{messageIds:t,projectId:e,channel:a},e=>{(null==e?void 0:e.error)?n(Error(e.error)):s({success:e.success,markedCount:e.markedCount})})})}onMessagesRead(e){this.messagesReadHandlers.add(e)}offMessagesRead(e){this.messagesReadHandlers.delete(e)}mapIncomingMessage(e){var t,a,s,n,r,i;if(!e)return null;let o=e.channel||((null==(t=e.user)?void 0:t.accountType)==="AGENT"||(null==(a=e.user)?void 0:a.account_type)==="AGENT"?"CUSTOMER":"TEAM");return{id:e.id,jobId:e.projectId,userId:e.userId,userName:(null==(s=e.user)?void 0:s.name)||"Unknown User",userAvatar:null==(n=e.user)?void 0:n.avatarUrl,content:e.content,createdAt:new Date(e.timestamp||e.createdAt||new Date),channel:o,thread:null!=(r=e.thread)?r:null,threadId:null!=(i=e.thread)?i:null,chatType:"CUSTOMER"===o?"client":"team"}}constructor(){this.socket=null,this.messageHandlers=new Set,this.typingHandlers=new Set,this.presenceUpdateHandlers=new Set,this.presenceListHandlers=new Set,this.messagesReadHandlers=new Set,this.typingDebounceTimers=new Map,this.typingState=new Map}}let l=new o;var c=a(18720);let d=(0,n.createContext)(void 0);function u(e){let{children:t,defaultUserId:a,defaultUserName:i,defaultUserAvatar:o}=e,[u,h]=(0,n.useState)([]),[m,p]=(0,n.useState)(a),[g,f]=(0,n.useState)(i),[x,v]=(0,n.useState)(o),[j,y]=(0,n.useState)(!1),[b,w]=(0,n.useState)(new Set),N=(0,n.useRef)(new Map),k=(0,n.useRef)(new Set),[A,C]=(0,n.useState)(new Map),[E,M]=(0,n.useState)(new Map),[I,S]=(0,n.useState)(new Map);(0,n.useEffect)(()=>(l.connect(),y(!0),()=>{l.disconnect(),y(!1)}),[]),(0,n.useEffect)(()=>{let e=e=>{h(t=>t.some(t=>t.id===e.id)?t:[...t,e])};return l.onMessage(e),()=>l.offMessage(e)},[]),(0,n.useEffect)(()=>{let e=e=>{if(e.userId===m)return;let t="".concat(e.projectId,":").concat(e.channel);C(a=>{let s=new Map(a),n=new Map(s.get(t)||new Map);return e.isTyping?n.set(e.userId,{userId:e.userId,userName:e.userName}):n.delete(e.userId),n.size>0?s.set(t,n):s.delete(t),s})};return l.onTyping(e),()=>l.offTyping(e)},[m]),(0,n.useEffect)(()=>{let e=e=>{e.projectId&&M(t=>{let a=new Map(t),s=new Map(a.get(e.projectId)||new Map);return e.isOnline?s.set(e.userId,{userId:e.userId,userName:e.userName,isOnline:!0}):s.delete(e.userId),a.set(e.projectId,s),a})},t=e=>{M(t=>{let a=new Map(t),s=new Map;for(let t of e.users)s.set(t.userId,t);return a.set(e.projectId,s),a})};return l.onPresenceUpdate(e),l.onPresenceList(t),()=>{l.offPresenceUpdate(e),l.offPresenceList(t)}},[]),(0,n.useEffect)(()=>{let e=e=>{S(t=>{let a=new Map(t);for(let t of e.messageIds){let s=a.get(t)||[];s.some(t=>t.userId===e.readBy.userId)||a.set(t,[...s,{userId:e.readBy.userId,userName:e.readBy.userName,readAt:new Date(e.readAt)}])}return a})};return l.onMessagesRead(e),()=>l.offMessagesRead(e)},[]);let T=(0,n.useCallback)(e=>u.filter(t=>t.jobId===e),[u]),R=(0,n.useCallback)(e=>b.has(e),[b]),D=(0,n.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"TEAM",a=arguments.length>2?arguments[2]:void 0,s="".concat(e,":").concat(t),n=Date.now(),i=N.current.get(s);if((!i||!(n-i<5e3))&&!k.current.has(s)){k.current.add(s),w(t=>new Set(t).add(e));try{a&&r.F.organizations.setActiveOrganization(a);let n=await r.F.chat.getMessages(e,t);N.current.set(s,Date.now());let i=n.map(e=>({...e,createdAt:new Date(e.createdAt),channel:e.channel||t,chatType:"CUSTOMER"===(e.channel||t)?"client":"team"}));h(a=>[...a.filter(a=>a.jobId!==e||a.channel!==t),...i]),j&&l.joinProject(e,t).catch(()=>{})}catch(e){console.error("Error fetching messages:",e)}finally{k.current.delete(s),w(t=>{let a=new Set(t);return a.delete(e),a})}}},[j]),O=(0,n.useCallback)(async(e,t,a,s)=>{if(!m||!g)return void console.warn("Cannot send message: user info not set");try{let n=null;if(j)n=await l.sendMessage(e,t,a,s);else{let i=await r.F.chat.sendMessage(e,t,a,s);n={...i,jobId:e,userId:m,userName:g,userAvatar:x,content:t,channel:a,chatType:"CUSTOMER"===a?"client":"team",thread:s||null,threadId:s||void 0,createdAt:new Date(i.createdAt||new Date)}}n&&(h(e=>[...e,n]),window.dispatchEvent(new CustomEvent("messageCreated",{detail:n})))}catch(e){console.error("Error sending message:",e),c.oR.error("Failed to send message")}},[j,m,g,x]),z=(0,n.useCallback)((e,t)=>{h(a=>a.map(a=>a.id===e?{...a,content:t}:a));let a=localStorage.getItem("chatMessages");if(a){let s=JSON.parse(a).map(a=>a.id===e?{...a,content:t}:a);localStorage.setItem("chatMessages",JSON.stringify(s))}window.dispatchEvent(new CustomEvent("messageUpdated",{detail:{messageId:e,content:t}}))},[]),P=(0,n.useCallback)(async e=>{h(t=>t.filter(t=>t.id!==e));let t=localStorage.getItem("chatMessages");if(t){let a=JSON.parse(t).filter(t=>t.id!==e);localStorage.setItem("chatMessages",JSON.stringify(a))}try{await r.F.messages.delete(e)}catch(e){console.error("Failed to delete message on backend",e)}window.dispatchEvent(new CustomEvent("messageDeleted",{detail:{messageId:e}}))},[]),U=(0,n.useCallback)((e,t,a)=>{p(e),f(t),v(a)},[]),L=(0,n.useCallback)((e,t)=>{let a="".concat(e,":").concat(t),s=A.get(a);return s?Array.from(s.values()):[]},[A]),H=(0,n.useCallback)((e,t)=>{l.emitTyping(e,t,!0)},[]),F=(0,n.useCallback)((e,t)=>{l.stopTyping(e,t)},[]),_=(0,n.useCallback)(e=>{let t=E.get(e);return t?Array.from(t.values()):[]},[E]),J=(0,n.useCallback)((e,t)=>{var a;let s=E.get(e);return null!=(a=null==s?void 0:s.has(t))&&a},[E]),G=(0,n.useCallback)(e=>I.get(e)||[],[I]),V=(0,n.useCallback)((e,t,a)=>{j&&0!==t.length&&l.markMessagesRead(e,t,a).catch(e=>{console.error("Failed to mark messages as read:",e)})},[j]);return(0,s.jsx)(d.Provider,{value:{messages:u,getMessagesForJob:T,fetchMessages:D,isLoadingMessages:R,sendMessage:O,editMessage:z,deleteMessage:P,getTypingUsers:L,emitTyping:H,stopTyping:F,getOnlineUsers:_,isUserOnline:J,getMessageReadReceipts:G,markMessagesAsRead:V,currentUserId:m,currentUserName:g,currentUserAvatar:x,setUserInfo:U},children:t})}function h(){let e=(0,n.useContext)(d);if(void 0===e)throw Error("useMessaging must be used within a MessagingProvider");return e}},78959:(e,t,a)=>{"use strict";a.d(t,{G:()=>i});var s=a(12115),n=a(95657),r=a(89617);function i(){let[e,t]=(0,s.useState)(null),[a,i]=(0,s.useState)(!0),{activeOrganizationId:o,setActiveOrganization:l}=(0,r.Q)(),c=(0,s.useMemo)(()=>e?function(e,t,a){let s=[];for(let a of(s.push({id:"personal-".concat(e.id),userId:"",user:{},orgId:e.id,organization:{id:e.id,name:e.name,type:e.type,logoUrl:e.logoUrl||void 0,createdAt:new Date},orgRole:"OWNER",role:"OWNER",createdAt:new Date}),t))s.push({id:"member-".concat(a.orgId),userId:"",user:{},orgId:a.orgId,organization:{id:a.organization.id,name:a.organization.name,type:a.organization.type,logoUrl:a.organization.logoUrl||void 0,createdAt:a.createdAt},orgRole:a.role,role:a.role,createdAt:a.createdAt});return s}(e.personalOrg,e.memberships,e.customerOfOrgs):[],[e]),d=(0,s.useMemo)(()=>(null==e?void 0:e.customerOfOrgs)||[],[e]),u=(0,s.useMemo)(()=>(null==e?void 0:e.personalOrg)||null,[e]);return(0,s.useEffect)(()=>{(async()=>{i(!0);try{let e=await n.F.me.orgContext();t(e),!o&&e.personalOrg&&l(e.personalOrg.id)}catch(e){console.error("Failed to load org context:",e)}finally{i(!1)}})()},[]),(0,s.useEffect)(()=>{let e=e=>{let a=null==e?void 0:e.detail,s=null==a?void 0:a.organization;s&&t(e=>{if(!e)return e;if(e.personalOrg.id===s.id)return{...e,personalOrg:{...e.personalOrg,...s}};let t=e.memberships.map(e=>e.organization.id===s.id?{...e,organization:{...e.organization,...s}}:e);return{...e,memberships:t}})};return window.addEventListener("organizationUpdated",e),()=>{window.removeEventListener("organizationUpdated",e)}},[]),{memberships:c,isLoading:a,activeOrganizationId:o,setActiveOrganization:l,orgContext:e,personalOrg:u,customerOfOrgs:d}}},79451:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]])},89442:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("graduation-cap",[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]])},89617:(e,t,a)=>{"use strict";a.d(t,{Q:()=>r});var s=a(12115),n=a(65939);function r(){let{memberships:e,activeOrganizationId:t,switchOrganization:a}=(0,n.A)(),r=(0,s.useMemo)(()=>t&&e.find(e=>e.orgId===t)||null,[t,e]);return{memberships:e,activeOrganizationId:t,activeMembership:r,setActiveOrganization:a}}},89715:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("file-text",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]])},91169:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]])},94716:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});var s=a(4168);function n(e){return(0,s.w)(e,Date.now())}},96583:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("user-plus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]])},99522:(e,t,a)=>{"use strict";a.d(t,{_:()=>h,E:()=>u});var s=a(95155),n=a(12115),r=a(95657),i=a(65939),o=a(9829);class l{connect(e){if(this.isConnecting||this.socket&&this.socket.connected)return;this.isConnecting=!0;let t=e||localStorage.getItem("token")||void 0;if(!t){this.isConnecting=!1;return}this.socket=(0,o.io)("".concat("http://localhost:3001","/notifications"),{autoConnect:!0,transports:["websocket"],auth:{token:t},reconnection:!0,reconnectionAttempts:this.maxReconnectAttempts,reconnectionDelay:1e3,reconnectionDelayMax:5e3}),this.socket.on("connect",()=>{this.isConnecting=!1,this.reconnectAttempts=0,this.connectionHandlers.forEach(e=>e(!0))}),this.socket.on("connect_error",e=>{this.isConnecting=!1,this.reconnectAttempts++,console.error("[NotificationSocket] Connection error:",e.message),this.reconnectAttempts>=this.maxReconnectAttempts&&(console.warn("[NotificationSocket] Max reconnect attempts reached, falling back to polling"),this.connectionHandlers.forEach(e=>e(!1)))}),this.socket.on("disconnect",e=>{if(this.connectionHandlers.forEach(e=>e(!1)),"io server disconnect"===e||"io client disconnect"===e)return}),this.socket.on("connected",e=>{console.debug("[NotificationSocket] Connected for user:",e.userId)}),this.socket.on("notification",e=>{this.notificationHandlers.forEach(t=>t(e))}),this.socket.on("countUpdate",e=>{this.countUpdateHandlers.forEach(t=>t(e))})}disconnect(){this.socket&&(this.socket.removeAllListeners(),this.socket.disconnect(),this.socket=null),this.isConnecting=!1,this.reconnectAttempts=0}isConnected(){var e,t;return null!=(t=null==(e=this.socket)?void 0:e.connected)&&t}onNotification(e){this.notificationHandlers.add(e)}offNotification(e){this.notificationHandlers.delete(e)}onCountUpdate(e){this.countUpdateHandlers.add(e)}offCountUpdate(e){this.countUpdateHandlers.delete(e)}onConnectionChange(e){this.connectionHandlers.add(e)}offConnectionChange(e){this.connectionHandlers.delete(e)}constructor(){this.socket=null,this.notificationHandlers=new Set,this.countUpdateHandlers=new Set,this.connectionHandlers=new Set,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.isConnecting=!1}}let c=new l,d=(0,n.createContext)(null);function u(){let e=(0,n.useContext)(d);if(!e)throw Error("useNotifications must be used within NotificationsProvider");return e}function h(e){let{children:t}=e,{user:a,isLoading:o,token:l}=(0,i.A)(),u=!!a,[h,m]=(0,n.useState)([]),[p,g]=(0,n.useState)(!1),[f,x]=(0,n.useState)(null),[v,j]=(0,n.useState)(!1),y=(0,n.useRef)(0),b=(0,n.useRef)(!1),w=(0,n.useRef)(null),N=(0,n.useRef)(!0),k=(0,n.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!u)return void m([]);if(b.current)return;let t=Date.now();if(e||!(t-y.current<5e3)){b.current=!0,g(!0),x(null);try{let e=await r.F.notifications.list();m(e),y.current=Date.now()}catch(e){console.error("Failed to fetch notifications:",e),x(e instanceof Error?e:Error("Failed to fetch notifications"))}finally{g(!1),b.current=!1}}},[u]),A=(0,n.useCallback)(()=>{w.current||(w.current=setInterval(()=>{N.current&&u&&k()},6e4))},[k,u]),C=(0,n.useCallback)(()=>{w.current&&(clearInterval(w.current),w.current=null)},[]);(0,n.useEffect)(()=>{let e=()=>{let e="visible"===document.visibilityState;N.current=e,e&&u?(k(),A()):C()};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}},[k,A,C,u]);let E=(0,n.useCallback)(e=>{let t=e.payload||{};return{id:e.id,type:e.type,orgId:e.orgId||"",orgName:t.organizationName||"",orgType:t.orgType||"COMPANY",createdAt:new Date(e.createdAt),readAt:void 0,projectId:e.projectId,projectAddress:t.address,assignedRole:t.role,messagePreview:t.preview,messageChannel:t.channel,approverName:t.approverName,deliveryToken:t.deliveryToken}},[]);(0,n.useEffect)(()=>{if(o||!u||!l)return;let e=e=>{let t=E(e);m(e=>e.some(e=>e.id===t.id)?e:[t,...e])},t=e=>{j(e),e?C():A()};return c.onNotification(e),c.onConnectionChange(t),c.connect(l),()=>{c.offNotification(e),c.offConnectionChange(t),c.disconnect()}},[u,o,l,E,A,C]),(0,n.useEffect)(()=>{if(!o)return u?(k(!0),v||A()):(m([]),C(),c.disconnect()),()=>{C()}},[u,o,k,A,C,v]),(0,n.useEffect)(()=>()=>{C(),c.disconnect()},[C]);let M=(0,n.useCallback)(async e=>{try{await r.F.notifications.markRead(e),m(t=>t.map(t=>t.id===e?{...t,readAt:new Date}:t))}catch(e){throw console.error("Failed to mark notification as read:",e),e}},[]),I=(0,n.useCallback)(async()=>{try{await r.F.notifications.markAllRead(),m(e=>e.map(e=>({...e,readAt:e.readAt||new Date})))}catch(e){throw console.error("Failed to mark all notifications as read:",e),e}},[]),S=(0,n.useCallback)(async(e,t)=>{try{await r.F.invitations.accept(t),m(t=>t.filter(t=>t.id!==e))}catch(e){throw console.error("Failed to accept invitation:",e),e}},[]),T=(0,n.useCallback)(async(e,t)=>{try{await r.F.invitations.decline(t),m(t=>t.filter(t=>t.id!==e))}catch(e){throw console.error("Failed to decline invitation:",e),e}},[]),R=(0,n.useMemo)(()=>h.filter(e=>!e.readAt).length,[h]),D=(0,n.useMemo)(()=>({notifications:h,unreadCount:R,isLoading:p,error:f,refetch:()=>k(!0),markAsRead:M,markAllAsRead:I,acceptInvitation:S,declineInvitation:T}),[h,R,p,f,k,M,I,S,T]);return(0,s.jsx)(d.Provider,{value:D,children:t})}}},e=>{e.O(0,[6143,4896,240,547,5707,2110,8234,2619,4001,3409,1204,9360,1163,550,1130,7117,2303,4419,7770,6362,9829,3161,2596,2305,5657,4802,4729,2816,6784,1279,8441,1255,7358],()=>e(e.s=41562)),_N_E=e.O()}]);