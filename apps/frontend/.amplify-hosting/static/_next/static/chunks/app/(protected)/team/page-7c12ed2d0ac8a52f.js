(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[356],{18514:(e,a,t)=>{"use strict";t.d(a,{A:()=>r});let r=(0,t(71847).A)("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]])},26989:(e,a,t)=>{"use strict";t.d(a,{A:()=>r});let r=(0,t(71847).A)("settings-2",[["path",{d:"M14 17H5",key:"gfn3mx"}],["path",{d:"M19 7h-9",key:"6i9tg"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]])},36342:(e,a,t)=>{"use strict";t.d(a,{N:()=>i});var r=t(12115),s=t(20063),l=t(65939),n=t(80408);function i(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=(0,s.useRouter)(),{user:i,isLoading:o,memberships:c,activeOrganizationId:d}=(0,l.A)(),{redirectOnDeny:m=!1,redirectTo:u="/dashboard"}=a;(0,r.useEffect)(()=>{if(o)return;if(!i){m&&t.replace("/");return}let a=e.map(e=>(0,n.FK)(e)),r=(0,n.aJ)(i,c,d)||(0,n.FK)(i.accountType);!a.includes(r)&&m&&t.replace(u)},[i,o,e,t,m,u,c,d]);let h=(()=>{if(o||!i)return!1;let a=e.map(e=>(0,n.FK)(e)),t=(0,n.aJ)(i,c,d)||(0,n.FK)(i.accountType);return a.includes(t)})();return{user:i,isLoading:o,isAllowed:h}}},37135:(e,a,t)=>{"use strict";t.d(a,{A:()=>r});let r=(0,t(71847).A)("trash",[["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]])},38162:(e,a,t)=>{"use strict";t.d(a,{C1:()=>k,bL:()=>N});var r=t(12115),s=t(94446),l=t(3468),n=t(92556),i=t(23558),o=t(78108),c=t(84288),d=t(76842),m=t(88142),u=t(95155),h="Checkbox",[x,f]=(0,l.A)(h),[p,v]=x(h);function j(e){let{__scopeCheckbox:a,checked:t,children:s,defaultChecked:l,disabled:n,form:o,name:c,onCheckedChange:d,required:m,value:x="on",internal_do_not_use_render:f}=e,[v,j]=(0,i.i)({prop:t,defaultProp:null!=l&&l,onChange:d,caller:h}),[g,y]=r.useState(null),[N,b]=r.useState(null),k=r.useRef(!1),w=!g||!!o||!!g.closest("form"),R={checked:v,disabled:n,setChecked:j,control:g,setControl:y,name:c,form:o,value:x,hasConsumerStoppedPropagationRef:k,required:m,defaultChecked:!C(l)&&l,isFormControl:w,bubbleInput:N,setBubbleInput:b};return(0,u.jsx)(p,{scope:a,...R,children:"function"==typeof f?f(R):s})}var g="CheckboxTrigger",y=r.forwardRef((e,a)=>{let{__scopeCheckbox:t,onKeyDown:l,onClick:i,...o}=e,{control:c,value:d,disabled:h,checked:x,required:f,setControl:p,setChecked:j,hasConsumerStoppedPropagationRef:y,isFormControl:N,bubbleInput:b}=v(g,t),k=(0,s.s)(a,p),w=r.useRef(x);return r.useEffect(()=>{let e=null==c?void 0:c.form;if(e){let a=()=>j(w.current);return e.addEventListener("reset",a),()=>e.removeEventListener("reset",a)}},[c,j]),(0,u.jsx)(m.sG.button,{type:"button",role:"checkbox","aria-checked":C(x)?"mixed":x,"aria-required":f,"data-state":E(x),"data-disabled":h?"":void 0,disabled:h,value:d,...o,ref:k,onKeyDown:(0,n.mK)(l,e=>{"Enter"===e.key&&e.preventDefault()}),onClick:(0,n.mK)(i,e=>{j(e=>!!C(e)||!e),b&&N&&(y.current=e.isPropagationStopped(),y.current||e.stopPropagation())})})});y.displayName=g;var N=r.forwardRef((e,a)=>{let{__scopeCheckbox:t,name:r,checked:s,defaultChecked:l,required:n,disabled:i,value:o,onCheckedChange:c,form:d,...m}=e;return(0,u.jsx)(j,{__scopeCheckbox:t,checked:s,defaultChecked:l,disabled:i,required:n,onCheckedChange:c,name:r,form:d,value:o,internal_do_not_use_render:e=>{let{isFormControl:r}=e;return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(y,{...m,ref:a,__scopeCheckbox:t}),r&&(0,u.jsx)(R,{__scopeCheckbox:t})]})}})});N.displayName=h;var b="CheckboxIndicator",k=r.forwardRef((e,a)=>{let{__scopeCheckbox:t,forceMount:r,...s}=e,l=v(b,t);return(0,u.jsx)(d.C,{present:r||C(l.checked)||!0===l.checked,children:(0,u.jsx)(m.sG.span,{"data-state":E(l.checked),"data-disabled":l.disabled?"":void 0,...s,ref:a,style:{pointerEvents:"none",...e.style}})})});k.displayName=b;var w="CheckboxBubbleInput",R=r.forwardRef((e,a)=>{let{__scopeCheckbox:t,...l}=e,{control:n,hasConsumerStoppedPropagationRef:i,checked:d,defaultChecked:h,required:x,disabled:f,name:p,value:j,form:g,bubbleInput:y,setBubbleInput:N}=v(w,t),b=(0,s.s)(a,N),k=(0,o.Z)(d),R=(0,c.X)(n);r.useEffect(()=>{if(!y)return;let e=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set,a=!i.current;if(k!==d&&e){let t=new Event("click",{bubbles:a});y.indeterminate=C(d),e.call(y,!C(d)&&d),y.dispatchEvent(t)}},[y,k,d,i]);let E=r.useRef(!C(d)&&d);return(0,u.jsx)(m.sG.input,{type:"checkbox","aria-hidden":!0,defaultChecked:null!=h?h:E.current,required:x,disabled:f,name:p,value:j,form:g,...l,tabIndex:-1,ref:b,style:{...l.style,...R,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});function C(e){return"indeterminate"===e}function E(e){return C(e)?"indeterminate":e?"checked":"unchecked"}R.displayName=w},46858:(e,a,t)=>{"use strict";t.d(a,{A:()=>r});let r=(0,t(71847).A)("door-open",[["path",{d:"M11 20H2",key:"nlcfvz"}],["path",{d:"M11 4.562v16.157a1 1 0 0 0 1.242.97L19 20V5.562a2 2 0 0 0-1.515-1.94l-4-1A2 2 0 0 0 11 4.561z",key:"au4z13"}],["path",{d:"M11 4H8a2 2 0 0 0-2 2v14",key:"74r1mk"}],["path",{d:"M14 12h.01",key:"1jfl7z"}],["path",{d:"M22 20h-3",key:"vhrsz"}]])},65905:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>w});var r=t(95155),s=t(12115),l=t(36342),n=t(6191),i=t(65229),o=t(18720),c=t(97003),d=t(54679),m=t(33789),u=t(33884),h=t(67812),x=t(73344),f=t(89617),p=t(95657),v=t(42456);function j(e){let{open:a,onOpenChange:t,target:s,newRole:l,onConfirm:n,loading:i=!1}=e;return(0,r.jsx)(d.lG,{open:a,onOpenChange:t,children:(0,r.jsxs)(d.Cf,{className:"sm:max-w-md",children:[(0,r.jsxs)(d.c7,{children:[(0,r.jsx)(d.L3,{children:"Confirm role change"}),(0,r.jsx)(d.rr,{children:"Changing roles updates permissions immediately. Promoting another user to OWNER will downgrade your own role to ADMIN."})]}),(0,r.jsx)("div",{className:"space-y-2 text-sm",children:(0,r.jsxs)("div",{children:["Change"," ",(0,r.jsx)("span",{className:"font-semibold",children:(null==s?void 0:s.name)||"this member"})," ","to ",(0,r.jsx)(h.E,{variant:"outline",children:l}),"?"]})}),(0,r.jsxs)(d.Es,{children:[(0,r.jsx)(c.$,{variant:"outline",onClick:()=>t(!1),disabled:i,children:"Cancel"}),(0,r.jsx)(c.$,{onClick:n,disabled:i,variant:"destructive",children:i?"Updating...":"Confirm"})]})]})})}var g=t(47507);function y(e){let{technicians:a,currentUserId:t}=e,[l,y]=(0,s.useState)(a),[N,b]=(0,s.useState)(!1),[k,w]=(0,s.useState)([]),[R,C]=(0,s.useState)(""),[E,I]=(0,s.useState)(!1),[M,A]=(0,s.useState)("https://app.vrem.io/invite/team"),{activeOrganizationId:S,activeMembership:O}=(0,f.Q)(),[T,z]=(0,s.useState)(!1),[P,F]=(0,s.useState)(null),[_,U]=(0,s.useState)(null),[D,H]=(0,s.useState)(!1),[G,K]=(0,s.useState)(void 0),[L,$]=(0,s.useState)(null),[J,V]=(0,s.useState)(null!=t?t:null),[q,W]=(0,s.useState)(null),Y=(0,s.useMemo)(()=>{var e;return null==(e=l.find(e=>e.id===J))?void 0:e.role},[l,J]),[B,Q]=(0,s.useState)("TECHNICIAN"),X=(0,s.useMemo)(()=>((null==O?void 0:O.role)||(null==O?void 0:O.orgRole)||"").toUpperCase(),[O]),Z=(0,s.useMemo)(()=>(Y||X||"").toUpperCase(),[Y,X]),ee="PROJECT_MANAGER"===Z||"EDITOR"===Z,ea=!ee,et=(0,s.useMemo)(()=>window.location.origin,[]);(0,s.useEffect)(()=>{let e=Math.random().toString(36).slice(2,8),a=S||"team";A("".concat(et,"/invite/").concat(a,"?token=").concat(e))},[S,et]),(0,s.useEffect)(()=>{y(a);try{let e=localStorage.getItem("userId");e?V(e):t&&V(t);let a=localStorage.getItem("membershipId");a&&W(a)}catch(e){}},[a,t]);let er=e=>{w(a=>{let t=new Set(a);return e.forEach(e=>{let a=e.trim();a&&t.add(a)}),Array.from(t)})},es=async()=>{if(!ea)return void o.oR.error("Project managers and editors cannot invite teammates.");let e=R.trim(),a=[...k,...e?[e]:[]];if(0===a.length)return void o.oR.error("Enter at least one email address.");let t=a.find(e=>!e.includes("@"));if(t)return void o.oR.error("Invalid email: ".concat(t));if(!S)return void o.oR.error("Select an organization before inviting teammates.");I(!0);try{await Promise.all(a.map(e=>p.F.organizations.createInvite(e,B||"TECHNICIAN"))),o.oR.success(a.length>1?"Invitations sent to ".concat(a.join(", ")):"Invitation sent to ".concat(a[0])),w([]),C(""),b(!1)}catch(a){console.error("Failed to send invite",a);let e=a instanceof Error?a.message:"Failed to send invite";o.oR.error(e)}finally{I(!1)}},el=async()=>{try{await navigator.clipboard.writeText(M),o.oR.success("Magic link copied")}catch(e){console.error("Failed to copy magic link",e),o.oR.error("Unable to copy magic link")}},en=async(e,a)=>{if(!ea)return void o.oR.error("Project managers and editors cannot change roles.");if(!e.memberId)return void o.oR.error("Unable to update role: missing member id");if("OWNER"===e.role)return void o.oR.error("Owners can only be changed by the current owner");if("OWNER"===a){$(e),K(a),H(!0);return}let t=e.role;U(e.id),y(t=>t.map(t=>t.id===e.id?{...t,role:a}:t));try{let t=await p.F.organizations.updateMemberRole(e.memberId,a),r=(null==t?void 0:t.orgRole)||t.role||a;y(a=>a.map(a=>a.id===e.id?{...a,role:r}:a)),o.oR.success("Role updated")}catch(a){console.error("Failed to update role",a),y(a=>a.map(a=>a.id===e.id?{...a,role:t}:a)),o.oR.error("Unable to update role")}finally{U(null)}},ei=async()=>{if(!ea){o.oR.error("Project managers and editors cannot change roles."),H(!1);return}if(!L||!G||!L.memberId)return void H(!1);let e=L.role;U(L.id),H(!1),y(e=>e.map(e=>e.id===L.id?{...e,role:G}:e));try{let e=await p.F.organizations.updateMemberRole(L.memberId,G),a=(null==e?void 0:e.orgRole)||e.role||G;y(e=>e.map(e=>e.id===L.id?{...e,role:a}:e)),o.oR.success("Role updated")}catch(a){console.error("Failed to update role",a),y(a=>a.map(a=>a.id===L.id?{...a,role:e}:a)),o.oR.error("Unable to update role")}finally{U(null),K(void 0),$(null)}};return(0,r.jsxs)("main",{className:"container relative mx-auto",children:[(0,r.jsx)("article",{className:"flex flex-col gap-2xl md:gap-3xl px-md",children:(0,r.jsxs)("div",{className:"@container w-full mt-md mb-md",children:[(0,r.jsxs)("div",{className:"mb-md flex items-baseline justify-between",children:[(0,r.jsx)(x.H2,{className:"text-4xl mb-xs",children:"Team"}),ea&&(0,r.jsxs)(d.lG,{open:N,onOpenChange:e=>{ea&&(b(e),e||(w([]),C("")))},children:[(0,r.jsx)(d.zM,{asChild:!0,children:(0,r.jsxs)(c.$,{variant:"default",className:"px-0",children:[(0,r.jsx)(n.A,{className:"h-4 w-4 mr-2"}),"Invite Teammate"]})}),(0,r.jsxs)(d.Cf,{className:"max-w-2xl w-full flex flex-col",children:[(0,r.jsxs)(d.c7,{className:"space-y-1.5",children:[(0,r.jsx)(d.L3,{className:"text-xl",children:"Invite people to your team"}),(0,r.jsx)(d.rr,{className:"text-sm text-muted-foreground",children:"Send email invites or share a magic link to bring teammates on board."})]}),(0,r.jsxs)("div",{className:"space-y-5 w-full",children:[(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("div",{className:"text-sm font-semibold",children:"Invite teammates"}),(0,r.jsxs)("div",{className:"flex gap-2 flex-col",children:[(0,r.jsx)("div",{className:"flex flex-1 gap-2 overflow-x-scroll scrollbar-hide max-w-full",children:k.map(e=>(0,r.jsxs)(h.E,{variant:"secondary",className:"flex items-center gap-1",children:[e,(0,r.jsx)(c.$,{variant:"mutedFlat",className:"p-0 w-auto ml-0.5 cursor-pointer",onClick:()=>{w(a=>a.filter(a=>a!==e))},"aria-label":"Remove ".concat(e),size:"icon-sm",children:(0,r.jsx)(i.A,{className:"h-3 w-3"})})]},e))}),(0,r.jsx)("div",{className:"flex flex-1 flex-col gap-0 sm:flex-row",children:(0,r.jsx)(m.p,{placeholder:"Enter emails (comma separated)",value:R,onChange:e=>(e=>{let a=e.split(/[, ]+/);if(a.length>1){let e=a.pop()||"";er(a),C(e)}else C(e)})(e.target.value),onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),R.trim()&&(er([R]),C("")))},className:"flex-1",autoFocus:!0})}),(0,r.jsxs)("div",{className:"flex flex-1 flex-col gap-2 sm:flex-row",children:[(0,r.jsxs)(g.l6,{value:B,onValueChange:e=>Q(e),children:[(0,r.jsx)(g.bq,{className:"w-40",children:(0,r.jsx)(g.yv,{placeholder:"Role"})}),(0,r.jsxs)(g.gC,{children:[(0,r.jsx)(g.eb,{value:"TECHNICIAN",children:"Technician"}),(0,r.jsx)(g.eb,{value:"PROJECT_MANAGER",children:"Project Manager"}),(0,r.jsx)(g.eb,{value:"EDITOR",children:"Editor"}),(0,r.jsx)(g.eb,{value:"ADMIN",children:"Admin"})]})]}),(0,r.jsx)(c.$,{onClick:es,disabled:E,className:"sm:w-auto w-full flex-1",children:E?"Sending...":"Invite"})]})]}),(0,r.jsx)("div",{className:"space-y-2 max-h-64 overflow-auto",children:0===l.length?(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"No team members yet. Invite someone to get started."}):l.map(e=>{var a;return(0,r.jsxs)("div",{className:"flex items-center gap-3 rounded-lg border bg-muted/60 px-3 py-2",children:[(0,r.jsxs)(u.eu,{className:"h-10 w-10 border",children:[(0,r.jsx)(u.BK,{src:e.avatar,alt:e.name}),(0,r.jsx)(u.q5,{children:(null==(a=e.name)?void 0:a.slice(0,1))||"T"})]}),(0,r.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col",children:[(0,r.jsx)("span",{className:"text-sm font-medium truncate",children:e.name||"Technician"}),(0,r.jsx)("span",{className:"text-xs text-muted-foreground truncate",children:e.email||"No email provided"})]}),(0,r.jsx)(h.E,{variant:"outline",className:"shrink-0",children:e.role||"Technician"})]},e.id)})})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between text-sm font-semibold",children:[(0,r.jsx)("span",{children:"Invite via magic link"}),(0,r.jsx)(c.$,{variant:"ghost",size:"sm",className:"gap-2",onClick:()=>{let e=Math.random().toString(36).slice(2,8),a=S||"team";A("".concat(et,"/invite/").concat(a,"?token=").concat(e)),o.oR.success("Magic link reset")},children:"Reset"})]}),(0,r.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row",children:[(0,r.jsx)(m.p,{readOnly:!0,value:M,className:"flex-1"}),(0,r.jsx)(c.$,{variant:"default",className:"sm:w-auto w-full",onClick:el,children:"Copy"})]})]})]})]})]})]}),ee&&(0,r.jsx)("div",{className:"mb-4 text-sm text-muted-foreground",children:"Project managers and editors can view the roster but cannot invite teammates or change roles."}),(0,r.jsx)(v.ZJ,{technicians:l,onRemove:ea?e=>{ea&&(F(e),z(!0))}:void 0,onRoleChange:ea?en:void 0,updatingRoleId:_,currentUserId:J||void 0,currentUserMemberId:q||void 0,currentUserRole:Y})]})}),(0,r.jsx)(d.lG,{open:T,onOpenChange:e=>{z(e),e||F(null)},children:(0,r.jsxs)(d.Cf,{className:"sm:max-w-md",children:[(0,r.jsxs)(d.c7,{children:[(0,r.jsx)(d.L3,{children:"Remove technician"}),(0,r.jsx)(d.rr,{children:"This technician will be removed from your team. You can re-invite them later if needed."})]}),(0,r.jsxs)("div",{className:"text-sm",children:["Are you sure you want to remove"," ",(0,r.jsx)("span",{className:"font-medium",children:(null==P?void 0:P.name)||"this technician"}),"?"]}),(0,r.jsxs)(d.Es,{children:[(0,r.jsx)(c.$,{variant:"outline",onClick:()=>z(!1),children:"Cancel"}),(0,r.jsx)(c.$,{variant:"destructive",onClick:()=>{P&&(y(e=>e.filter(e=>e.id!==P.id)),o.oR.success("Technician removed from team"),z(!1),F(null))},children:"Remove"})]})]})}),(0,r.jsx)(j,{open:ea&&D,onOpenChange:e=>{H(e),e||(K(void 0),$(null))},target:L,newRole:G,onConfirm:ei,loading:!!_})]})}var N=t(74875),b=t(68122),k=t(35722);function w(){let{user:e,isLoading:a,isAllowed:t}=(0,l.N)(["COMPANY","PROJECT_MANAGER"]),[n,i]=(0,s.useState)([]),[o,c]=(0,s.useState)(!0);return((0,s.useEffect)(()=>{let a=async()=>{try{let e=await (0,k.NV)();i(e)}catch(e){console.error("Failed to load team:",e),i([])}finally{c(!1)}};e&&t&&a()},[e,t]),e)?t?(0,r.jsx)("div",{className:"size-full overflow-x-hidden space-y-6",children:o?(0,r.jsx)(()=>(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Array.from({length:6}).map((e,a)=>(0,r.jsxs)("div",{className:"border rounded-md p-4 space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)(b.E,{className:"size-12 rounded-full"}),(0,r.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,r.jsx)(b.E,{className:"h-4 w-32"}),(0,r.jsx)(b.E,{className:"h-3 w-24"})]})]}),(0,r.jsx)(b.E,{className:"h-4 w-full"}),(0,r.jsx)(b.E,{className:"h-4 w-3/4"}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(b.E,{className:"h-6 w-16"}),(0,r.jsx)(b.E,{className:"h-6 w-16"})]})]},"team-skeleton-".concat(a)))}),{}):(0,r.jsx)(y,{technicians:n,currentUserId:null==e?void 0:e.id})}):(0,r.jsx)(N.O,{title:"Access Denied",description:"You do not have permission to view team members. Please contact your administrator."}):null}},89617:(e,a,t)=>{"use strict";t.d(a,{Q:()=>l});var r=t(12115),s=t(65939);function l(){let{memberships:e,activeOrganizationId:a,switchOrganization:t}=(0,s.A)(),l=(0,r.useMemo)(()=>a&&e.find(e=>e.orgId===a)||null,[a,e]);return{memberships:e,activeOrganizationId:a,activeMembership:l,setActiveOrganization:t}}},91169:(e,a,t)=>{"use strict";t.d(a,{A:()=>r});let r=(0,t(71847).A)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]])},94479:(e,a,t)=>{Promise.resolve().then(t.bind(t,65905))}},e=>{e.O(0,[4896,6143,240,547,5707,2110,8234,2619,4001,3409,1204,9360,1163,550,1130,7117,2303,4419,7770,6362,3161,2596,2305,4795,5657,4802,4729,2816,6784,1279,4960,1151,8441,1255,7358],()=>e(e.s=94479)),_N_E=e.O()}]);