(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2892,8053],{6939:(e,s,l)=>{"use strict";l.r(s),l.d(s,{default:()=>N});var a=l(95155),i=l(12115),r=l(20063),n=l(24632),t=l(86784),o=l(84993),d=l(30275),c=l(89617);function m(e){var s;let l,{jobs:r,technicians:n,selectedJob:m,onSelectJob:u,onNavigateToJobInProjectManagement:h,onJobAssign:f,hasSidebar:v=!0,isDispatcherView:g=!0}=e;try{let e=(0,o.cL)();l=e.state,e.open}catch(e){l="expanded"}let x=(0,d.a)(),{activeMembership:N}=(0,c.Q)(),p=(null==N||null==(s=N.organization)?void 0:s.type)||"",j=!v||"PERSONAL"===p||x?"0":"collapsed"===l?"3rem":"16rem";return(0,i.useEffect)(()=>(document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden",()=>{document.body.style.overflow="",document.documentElement.style.overflow=""}),[]),(0,i.useEffect)(()=>{let e=setTimeout(()=>{window.dispatchEvent(new Event("resize"))},250);return()=>clearTimeout(e)},[l]),(0,a.jsx)("main",{className:"fixed overflow-hidden transition-[left] duration-200 ease-linear",style:{top:"var(--header-h)",left:j,right:0,bottom:0,height:"calc(100vh - var(--header-h))"},children:(0,a.jsx)(t.n,{jobs:r,providers:n,selectedJob:m,onSelectJob:u,onNavigateToJobInProjectManagement:h,onJobAssign:f,className:"size-full",fullScreen:!0,isDispatcherView:g})})}var u=l(42892),h=l(55678),f=l(62816),v=l(35722),g=l(80408),x=l(95657);function N(){var e;let{user:s,isLoading:l,memberships:t,organizationId:o}=(0,n.l)(["COMPANY","AGENT","TECHNICIAN","EDITOR","PROJECT_MANAGER"]),d=(0,r.useRouter)(),c=(0,h.w)(),[N,p]=(0,i.useState)([]),[j,w]=(0,i.useState)(!1),[b,y]=(0,i.useState)(null),[E,I]=(0,i.useState)(null);(0,i.useEffect)(()=>{let e=!1,l=async()=>{w(!0);try{let s=await (0,v.NV)();e||p(s)}catch(s){console.error("Failed to load technicians for map:",s),e||p([])}finally{e||w(!1)}};return s?l():(p([]),w(!1)),()=>{e=!0}},[s]),(0,i.useEffect)(()=>{let e=!1,l=async()=>{if(!o)return void y(null);try{let s=await x.F.organizations.getById(o);e||y(s)}catch(s){e||(y(null),console.error("Failed to load organization for map",s))}};return s?l():y(null),()=>{e=!0}},[o,s]);let A=(0,g.aJ)(s,t,o),C=(0,g.UD)(A),T=t.find(e=>e.orgId===o),R=b||(null==T?void 0:T.organization),z="PERSONAL"===(null==T||null==(e=T.organization)?void 0:e.type)||(null==R?void 0:R.type)==="PERSONAL"||(null==T?void 0:T.organizationType)==="PERSONAL",J=null==b?void 0:b.lat,S=null==b?void 0:b.lng,D="string"==typeof J?parseFloat(J):J,L="string"==typeof S?parseFloat(S):S,M="number"==typeof D&&!Number.isNaN(D)&&"number"==typeof L&&!Number.isNaN(L);(0,i.useEffect)(()=>{(async()=>{if(M||!b)return;let e=[b.addressLine1,b.addressLine2,b.city,b.region,b.postalCode,b.countryCode].filter(Boolean);if(!e.length)return;let s=e.join(", ");try{let e=await (0,v.ft)(s);e?I(e):console.warn("Geocoding returned no results for org address")}catch(e){console.error("Failed to geocode org address for map:",e)}})()},[b,M]);let O=(0,i.useMemo)(()=>s&&z&&(M||E)?{id:s.id,userId:s.id,orgMemberId:(null==T?void 0:T.id)||s.id,orgId:o||(null==T?void 0:T.orgId)||(null==b?void 0:b.id)||s.organizationId||"",memberId:null==T?void 0:T.id,organizationId:null==b?void 0:b.id,role:"TECHNICIAN",name:s.name||"Me",email:s.email||"",phone:(null==b?void 0:b.phone)||"",isIndependent:!0,companyId:void 0,companyName:void 0,homeLocation:{lat:M?D:null==E?void 0:E.lat,lng:M?L:null==E?void 0:E.lng,address:{street:(null==b?void 0:b.addressLine1)||"",city:(null==b?void 0:b.city)||"",stateProvince:(null==b?void 0:b.region)||"",country:(null==b?void 0:b.countryCode)||"",postalCode:(null==b?void 0:b.postalCode)||""}},availability:[],reliability:{totalJobs:0,noShows:0,lateDeliveries:0,onTimeRate:0,averageDeliveryTime:0},skills:{residential:0,commercial:0,aerial:0,twilight:0,video:0},rating:{overall:0,count:0,recent:[]},preferredClients:[],status:"active",createdAt:new Date,avatar:s.avatarUrl,bio:"",services:{photography:!0,video:!1,aerial:!1,floorplan:!1,measurement:!1,twilight:!1,editing:!1,virtualStaging:!1},portfolio:[],certifications:[]}:null,[T,b,M,z,o,E,D,L,s]),k=(0,i.useMemo)(()=>{if(!s)return[];let e=t.find(e=>e.orgId===o),l=((null==e?void 0:e.role)||(null==e?void 0:e.orgRole)||"").toUpperCase();return C?c.jobs:"TECHNICIAN"===l?c.jobs.filter(e=>e.assignedTechnicianId===s.id):"EDITOR"===l?c.jobs.filter(e=>e.editorId===s.id):c.jobs.filter(e=>e.assignedTechnicianId===s.id||e.editorId===s.id)},[C,c.jobs,t,o,s]),P=(0,i.useMemo)(()=>{if(!s)return[];let e=t.find(e=>e.orgId===o),l=((null==e?void 0:e.role)||(null==e?void 0:e.orgRole)||"").toUpperCase();if(C)return!N.some(e=>e.id===s.id)&&O?[O,...N]:N;if("EDITOR"===l)return[];if("TECHNICIAN"===l){let e=new Set(k.map(e=>e.assignedTechnicianId||e.assignedTechnicianId).filter(e=>!!e)),l=N.filter(l=>e.has(l.id)||l.id===s.id);if(!l.find(e=>e.id===s.id)){let e=N.find(e=>e.id===s.id)||O;return e?[e,...l]:l}return l}return O&&!N.some(e=>e.id===s.id)?[O,...N]:N},[C,k,t,o,O,N,s]);if(!s)return null;if(j)return(0,a.jsx)(u.is,{});let F=(0,g.UD)(A),H=F?c.assignJob:void 0;return(0,a.jsx)(f.WT,{fallback:(0,a.jsx)(u.is,{}),children:(0,a.jsx)(m,{jobs:k,technicians:P,selectedJob:c.selectedJob,onSelectJob:e=>{var s;(null==(s=c.selectedJob)?void 0:s.id)===e.id?c.selectJob(null):c.selectJob(e)},onNavigateToJobInProjectManagement:e=>{c.selectJob(e),d.push("/jobs/".concat(e.id))},onJobAssign:H,hasSidebar:F,isDispatcherView:F})})}},24632:(e,s,l)=>{"use strict";l.d(s,{l:()=>o});var a=l(12115),i=l(20063),r=l(65939),n=l(75701),t=l(80408);function o(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=(0,i.useRouter)(),{user:o,isLoading:d,activeOrganizationId:c,memberships:m}=(0,r.A)(),{redirectTo:u,enforceRedirect:h}=s,f=(0,a.useCallback)(()=>(0,n.in)(m,c),[m,c]);return(0,a.useEffect)(()=>{if(d)return;if(!o)return void l.push("/");let s=e.map(e=>(0,t.FK)(e)),a=(0,t.FK)(o.accountType),i=m.find(e=>e.orgId===c),r=(0,n.hq)(i,a);if(!s.includes(r)){if(!1===h)return;if(u)l.push(u);else{let e=(0,n.zE)(r);l.push(e)}}},[o,d,e,l,u,h,m,c]),{user:o,organizationId:c,memberships:m,isLoading:d,getActiveOrgRole:f}}},35722:(e,s,l)=>{"use strict";l.d(s,{NV:()=>o,ft:()=>n});var a=l(95657);let i={lat:51.0447,lng:-114.0719},r=new Map;async function n(e){let s="pk.eyJ1IjoiZHVyb2RwIiwiYSI6ImNtaHplcW53cDA4dHQycnB6dnhqeGtveXgifQ.6GR-s3V7vfGRsoVlhSTFhg";if(!s||!e)return null;try{var l,a;let i="https://api.mapbox.com/geocoding/v5/mapbox.places/".concat(encodeURIComponent(e),".json?access_token=").concat(s,"&limit=1"),r=await fetch(i);if(!r.ok)return null;let n=await r.json(),t=null==n||null==(l=n.features)?void 0:l[0];if((null==t||null==(a=t.center)?void 0:a.length)===2){let[e,s]=t.center;return{lat:s,lng:e}}}catch(e){console.error("Failed to geocode address",e)}return null}async function t(e){if(!e.user)return null;let s=e.user,l=e.personalOrg,a=l?[l.addressLine1,l.addressLine2,l.city,l.region,l.postalCode,l.countryCode].filter(Boolean).join(", "):"",t=(null==l?void 0:l.lat)!==void 0&&(null==l?void 0:l.lng)!==void 0?{lat:l.lat,lng:l.lng}:i;if(a){let e=r.get(a);if(e)t=e;else{let e=await n(a);e&&(t=e,r.set(a,e))}}return{id:s.id,userId:s.id,orgMemberId:e.id,orgId:e.orgId,memberId:e.id,role:e.role||e.orgRole||"TECHNICIAN",name:s.name||"Unnamed",email:s.email||"",phone:(null==l?void 0:l.phone)||"",organizationId:s.organizationId||void 0,isIndependent:!0,companyId:void 0,companyName:void 0,homeLocation:{lat:t.lat,lng:t.lng,address:{street:(null==l?void 0:l.addressLine1)||"",city:(null==l?void 0:l.city)||"",stateProvince:(null==l?void 0:l.region)||"",country:(null==l?void 0:l.countryCode)||"",postalCode:(null==l?void 0:l.postalCode)||""}},availability:[],reliability:{totalJobs:0,noShows:0,lateDeliveries:0,onTimeRate:0,averageDeliveryTime:0},skills:{residential:0,commercial:0,aerial:0,twilight:0,video:0},rating:{overall:0,count:0,recent:[]},preferredClients:[],status:"active",createdAt:e.createdAt?new Date(e.createdAt):new Date,avatar:s.avatarUrl,bio:"",services:{photography:!0,video:!1,aerial:!1,floorplan:!1,measurement:!1,twilight:!1,editing:!1,virtualStaging:!1},portfolio:[],certifications:[]}}async function o(){let e=await a.F.organizations.listMembers();return e&&0!==e.length?(await Promise.all(e.map(e=>t(e)))).filter(e=>!!e):[]}},42892:(e,s,l)=>{"use strict";l.d(s,{Eg:()=>r,N3:()=>d,a1:()=>t,is:()=>n,jw:()=>o});var a=l(95155),i=l(68122);function r(){return(0,a.jsx)("main",{className:"container relative mx-auto",children:(0,a.jsxs)("article",{className:"flex flex-col gap-2xl md:gap-3xl px-md",children:[(0,a.jsx)("div",{className:"@container w-full mt-md",children:(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:Array.from({length:4}).map((e,s)=>(0,a.jsxs)("div",{className:"p-4 border rounded-md",children:[(0,a.jsx)(i.E,{className:"h-4 w-24 mb-2"}),(0,a.jsx)(i.E,{className:"h-8 w-32"})]},s))})}),(0,a.jsxs)("div",{className:"@container w-full",children:[(0,a.jsxs)("div",{className:"mb-md flex items-baseline justify-between",children:[(0,a.jsx)(i.E,{className:"h-6 w-32"}),(0,a.jsx)(i.E,{className:"h-8 w-28"})]}),(0,a.jsxs)("div",{className:"border rounded-md overflow-hidden p-4",children:[(0,a.jsx)("div",{className:"grid grid-cols-7 gap-2 mb-2",children:Array.from({length:7}).map((e,s)=>(0,a.jsx)(i.E,{className:"h-8 w-full"},s))}),(0,a.jsx)("div",{className:"grid grid-cols-7 gap-2",children:Array.from({length:35}).map((e,s)=>(0,a.jsx)(i.E,{className:"h-16 w-full"},s))})]})]}),(0,a.jsxs)("div",{className:"@container w-full",children:[(0,a.jsxs)("div",{className:"mb-md flex items-baseline justify-between",children:[(0,a.jsx)(i.E,{className:"h-6 w-32"}),(0,a.jsx)(i.E,{className:"h-8 w-28"})]}),(0,a.jsx)("div",{className:"border rounded-md overflow-hidden",children:(0,a.jsx)(i.E,{className:"h-96 w-full"})})]}),(0,a.jsxs)("div",{className:"@container w-full mb-md",children:[(0,a.jsxs)("div",{className:"mb-md flex items-baseline justify-between",children:[(0,a.jsx)(i.E,{className:"h-6 w-32"}),(0,a.jsx)(i.E,{className:"h-8 w-24"})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:Array.from({length:4}).map((e,s)=>(0,a.jsxs)("div",{className:"border rounded-md p-4 space-y-3",children:[(0,a.jsx)(i.E,{className:"h-32 w-full rounded"}),(0,a.jsx)(i.E,{className:"h-4 w-3/4"}),(0,a.jsx)(i.E,{className:"h-4 w-1/2"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(i.E,{className:"h-6 w-16"}),(0,a.jsx)(i.E,{className:"h-6 w-20"})]})]},s))})]})]})})}function n(){return(0,a.jsxs)("main",{className:"fixed inset-0 overflow-hidden",children:[(0,a.jsx)("div",{className:"absolute inset-0",children:(0,a.jsx)(i.E,{className:"h-full w-full"})}),(0,a.jsxs)("div",{className:"absolute right-0 top-0 bottom-0 w-80 border-l bg-background p-4",children:[(0,a.jsx)(i.E,{className:"h-8 w-32 mb-4"}),(0,a.jsx)("div",{className:"space-y-3",children:Array.from({length:5}).map((e,s)=>(0,a.jsxs)("div",{className:"border rounded-md p-3 space-y-2",children:[(0,a.jsx)(i.E,{className:"h-4 w-3/4"}),(0,a.jsx)(i.E,{className:"h-4 w-1/2"}),(0,a.jsx)(i.E,{className:"h-6 w-20"})]},s))})]})]})}function t(){return(0,a.jsxs)("div",{className:"flex flex-col size-full",children:[(0,a.jsx)("div",{className:"border-b p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(i.E,{className:"h-8 w-8"}),(0,a.jsx)(i.E,{className:"h-8 w-8"}),(0,a.jsx)(i.E,{className:"h-6 w-32"}),(0,a.jsx)(i.E,{className:"h-8 w-8"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(i.E,{className:"h-8 w-24"}),(0,a.jsx)(i.E,{className:"h-8 w-24"}),(0,a.jsx)(i.E,{className:"h-8 w-24"})]})]})}),(0,a.jsx)("div",{className:"flex-1 p-4",children:(0,a.jsxs)("div",{className:"grid grid-cols-7 gap-2 h-full",children:[(0,a.jsx)("div",{className:"space-y-2",children:Array.from({length:24}).map((e,s)=>(0,a.jsx)(i.E,{className:"h-12 w-full"},s))}),Array.from({length:6}).map((e,s)=>(0,a.jsx)("div",{className:"space-y-2",children:Array.from({length:24}).map((e,s)=>(0,a.jsx)(i.E,{className:"h-12 w-full"},s))},s))]})})]})}function o(){return(0,a.jsx)("main",{className:"container relative mx-auto",children:(0,a.jsx)("article",{className:"flex flex-col gap-2xl md:gap-3xl px-md",children:(0,a.jsxs)("div",{className:"@container w-full mt-md mb-md",children:[(0,a.jsx)(i.E,{className:"h-10 w-32 mb-6"}),(0,a.jsxs)("div",{className:"flex gap-3 mb-6",children:[(0,a.jsx)(i.E,{className:"h-10 flex-1"}),(0,a.jsx)(i.E,{className:"h-10 w-32"})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Array.from({length:6}).map((e,s)=>(0,a.jsxs)("div",{className:"border rounded-md p-4 space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(i.E,{className:"size-12 rounded-full"}),(0,a.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,a.jsx)(i.E,{className:"h-4 w-32"}),(0,a.jsx)(i.E,{className:"h-3 w-24"})]})]}),(0,a.jsx)(i.E,{className:"h-4 w-full"}),(0,a.jsx)(i.E,{className:"h-4 w-3/4"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(i.E,{className:"h-6 w-16"}),(0,a.jsx)(i.E,{className:"h-6 w-16"})]})]},s))})]})})})}function d(){return(0,a.jsxs)("div",{className:"flex size-full",children:[(0,a.jsx)("div",{className:"w-64 border-r p-4 space-y-2",children:Array.from({length:8}).map((e,s)=>(0,a.jsx)(i.E,{className:"h-10 w-full"},s))}),(0,a.jsxs)("div",{className:"flex-1 p-6 space-y-6",children:[(0,a.jsx)(i.E,{className:"h-8 w-48"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(i.E,{className:"h-4 w-full"}),(0,a.jsx)(i.E,{className:"h-4 w-3/4"}),(0,a.jsx)(i.E,{className:"h-32 w-full"}),(0,a.jsx)(i.E,{className:"h-10 w-32"})]})]})]})}},87874:(e,s,l)=>{Promise.resolve().then(l.bind(l,6939))},89617:(e,s,l)=>{"use strict";l.d(s,{Q:()=>r});var a=l(12115),i=l(65939);function r(){let{memberships:e,activeOrganizationId:s,switchOrganization:l}=(0,i.A)(),r=(0,a.useMemo)(()=>s&&e.find(e=>e.orgId===s)||null,[s,e]);return{memberships:e,activeOrganizationId:s,activeMembership:r,setActiveOrganization:l}}}},e=>{e.O(0,[4896,240,547,5707,2110,8234,2619,4001,3409,1204,9360,1163,550,1130,7117,2303,4419,7770,6362,3161,2596,5657,5939,4802,4729,2816,6784,8441,1255,7358],()=>e(e.s=87874)),_N_E=e.O()}]);