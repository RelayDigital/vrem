(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8022],{7220:(e,t,a)=>{"use strict";a.d(t,{Hr:()=>h,Ht:()=>p,I:()=>u,M5:()=>v,SQ:()=>c,_2:()=>m,lp:()=>x,lv:()=>f,mB:()=>j,nV:()=>g,rI:()=>o,ty:()=>d});var s=a(95155);a(12115);var n=a(56348),r=a(99051),l=a(27937),i=a(64936);function o(e){let{...t}=e;return(0,s.jsx)(n.bL,{"data-slot":"dropdown-menu",...t})}function d(e){let{...t}=e;return(0,s.jsx)(n.l9,{"data-slot":"dropdown-menu-trigger",...t})}function c(e){let{className:t,sideOffset:a=4,...r}=e;return(0,s.jsx)(n.ZL,{children:(0,s.jsx)(n.UC,{"data-slot":"dropdown-menu-content",sideOffset:a,className:(0,i.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",t),...r})})}function u(e){let{...t}=e;return(0,s.jsx)(n.YJ,{"data-slot":"dropdown-menu-group",...t})}function m(e){let{className:t,inset:a,variant:r="default",...l}=e;return(0,s.jsx)(n.q7,{"data-slot":"dropdown-menu-item","data-inset":a,"data-variant":r,className:(0,i.cn)("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-pointer items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-disabled:pointer-events-none data-disabled:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...l})}function h(e){let{...t}=e;return(0,s.jsx)(n.z6,{"data-slot":"dropdown-menu-radio-group",...t})}function p(e){let{className:t,children:a,...l}=e;return(0,s.jsxs)(n.hN,{"data-slot":"dropdown-menu-radio-item",className:(0,i.cn)("focus:bg-accent focus:text-accent-foreground relative flex cursor-pointer items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-disabled:pointer-events-none data-disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...l,children:[(0,s.jsx)("span",{className:"pointer-events-none absolute left-2 flex size-3.5 items-center justify-center",children:(0,s.jsx)(n.VF,{children:(0,s.jsx)(r.A,{className:"size-2 fill-current"})})}),a]})}function x(e){let{className:t,inset:a,...r}=e;return(0,s.jsx)(n.JU,{"data-slot":"dropdown-menu-label","data-inset":a,className:(0,i.cn)("px-2 py-1.5 text-sm font-medium data-[inset]:pl-8",t),...r})}function j(e){let{className:t,...a}=e;return(0,s.jsx)(n.wv,{"data-slot":"dropdown-menu-separator",className:(0,i.cn)("bg-border -mx-1 my-1 h-px",t),...a})}function f(e){let{...t}=e;return(0,s.jsx)(n.Pb,{"data-slot":"dropdown-menu-sub",...t})}function g(e){let{className:t,inset:a,children:r,...o}=e;return(0,s.jsxs)(n.ZP,{"data-slot":"dropdown-menu-sub-trigger","data-inset":a,className:(0,i.cn)("focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground flex cursor-pointer items-center rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[inset]:pl-8",t),...o,children:[r,(0,s.jsx)(l.A,{className:"ml-auto size-4"})]})}function v(e){let{className:t,...a}=e;return(0,s.jsx)(n.G5,{"data-slot":"dropdown-menu-sub-content",className:(0,i.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-hidden rounded-md border p-1 shadow-lg",t),...a})}},18514:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]])},20954:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>I});var s=a(95155),n=a(12115),r=a(36342);let l=(0,a(71847).A)("file-spreadsheet",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);var i=a(39867),o=a(21786),d=a(6191),c=a(6132),u=a(61362),m=a(18720),h=a(97003),p=a(54679),x=a(54664),j=a(7220),f=a(47507),g=a(33789),v=a(90235),N=a(67001),b=a(73344),y=a(95657),A=a(64563),C=a(91169),w=a(29633),E=a(1524),k=a(48432);function R(e){let{customers:t,isLoading:a=!1,onEdit:n,onDelete:r,deletingId:l,isDeleting:i,selectedIds:o,onToggleSelect:d,onToggleSelectAll:c}=e,u=t.filter(()=>!0),m=t.reduce((e,t)=>e+(t.totalJobs||0),0),h=t.length>0?m/t.length:0;return(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a?Array.from({length:3}).map((e,t)=>(0,s.jsxs)("div",{className:"rounded-lg border bg-card p-4 space-y-3",children:[(0,s.jsx)("div",{className:"h-4 w-24 rounded bg-muted animate-pulse"}),(0,s.jsx)("div",{className:"h-8 w-16 rounded bg-muted animate-pulse"}),(0,s.jsx)("div",{className:"h-3 w-20 rounded bg-muted animate-pulse"})]},"customer-stats-skeleton-".concat(t))):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(k.CN,{icon:C.A,value:u.length,label:"Active Customers",iconBgColor:"bg-accent",iconColor:"text-primary"}),(0,s.jsx)(k.CN,{icon:w.A,value:m,label:"Total Jobs",iconBgColor:"bg-blue-100",iconColor:"text-blue-600"}),(0,s.jsx)(k.CN,{icon:E.A,value:h.toFixed(1),label:"Avg Jobs per Customer",iconBgColor:"bg-emerald-100",iconColor:"text-emerald-600"})]}),(0,s.jsx)("div",{className:"@container md:col-span-3 mt-md",children:(0,s.jsx)("div",{className:"",children:(0,s.jsx)(A.I,{customers:t,isLoading:a,onEdit:n,onDelete:r,deletingId:l,isDeleting:i,selectedIds:o,onToggleSelect:d,onToggleSelectAll:c})})})]})}var O=a(53594);function M(e){var t;let{customers:a,isLoading:r=!1}=e,{canManageCustomers:A}=(0,O.q1)(),[C,w]=(0,n.useState)(a),[E,k]=(0,n.useState)(!1),[M,S]=(0,n.useState)(!1),[I,P]=(0,n.useState)(!1),[D,_]=(0,n.useState)(!1),[L,z]=(0,n.useState)(null),[T,J]=(0,n.useState)(null),[F,q]=(0,n.useState)(!1),[K,U]=(0,n.useState)(!1),[W,H]=(0,n.useState)([]),[G,V]=(0,n.useState)(null),[B,$]=(0,n.useState)({}),Y=(0,n.useRef)(null),[Z,X]=(0,n.useState)({name:"",email:"",phone:"",notes:""}),[Q,ee]=(0,n.useState)([]);(0,n.useEffect)(()=>{w(a),ee([])},[a]);let et=e=>e.trim().toLowerCase().replace(/[^a-z0-9]/g,""),ea=()=>{X({name:"",email:"",phone:"",notes:""}),z(null)},es=()=>{let e=new Blob([[["id","orgId","name","email","phone","notes","jobs","userId","createdAt","updatedAt"],...(em.length>0?em:C).map(e=>{var t,a,s,n,r,l,i;return[e.id,null!=(t=e.orgId)?t:"",null!=(a=e.name)?a:"",null!=(s=e.email)?s:"",null!=(n=e.phone)?n:"",null!=(r=e.notes)?r:"",null!=(l=e.totalJobs)?l:0,null!=(i=e.userId)?i:"",e.createdAt?new Date(e.createdAt).toISOString():"",e.updatedAt?new Date(e.updatedAt).toISOString():""]})].map(e=>e.map(e=>(e=>{let t=null==e?"":String(e);return t.includes(",")||t.includes('"')||t.includes("\n")?'"'.concat(t.replace(/"/g,'""'),'"'):t})(e)).join(",")).join("\n")],{type:"text/csv;charset=utf-8;"}),t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.setAttribute("download","customers-".concat(Date.now(),".csv")),document.body.appendChild(a),a.click(),a.remove(),URL.revokeObjectURL(t),m.oR.success("Customers exported")},en=async e=>{var t;let a=null==(t=e.target.files)?void 0:t[0];if(a){P(!0);try{let e=await a.text(),[t,...s]=(e=>{let t=[],a=[],s="",n=!1;for(let r=0;r<e.length;r++){let l=e[r];if('"'===l){n&&'"'===e[r+1]?(s+='"',r++):n=!n;continue}if(","===l&&!n){a.push(s),s="";continue}if(("\n"===l||"\r"===l)&&!n){"\r"===l&&"\n"===e[r+1]&&r++,a.push(s),a.some(e=>e.trim().length>0)&&t.push(a),a=[],s="";continue}s+=l}return(s.length>0||a.length>0)&&(a.push(s),a.some(e=>e.trim().length>0)&&t.push(a)),t})(e);if(!t||0===t.length)return void m.oR.error("CSV is missing headers");let n=t.map(et);V({headers:t,firstRow:s[0]||[],normalizedHeaders:n,rows:s});let r={};el.forEach(e=>{let t=n.indexOf(e.matchKey);r[e.matchKey]=t>=0?t:null}),$(r),el.filter(e=>e.required&&!n.includes(e.matchKey)).length&&m.oR.info("Required columns missing. Map headers to required fields to import."),_(!0)}catch(e){console.error("Failed to import customers",e),m.oR.error("Unable to import customers")}finally{P(!1),e.target.value=""}}},er=async()=>{if(!G)return;let e=e=>{if(B.hasOwnProperty(e)){let t=B[e];return"number"==typeof t?t:-1}return G.normalizedHeaders.indexOf(e)};if(el.some(t=>!!t.required&&0>e(t.matchKey)))return void m.oR.error("Map all required fields before importing");let t=G.rows.map(t=>{var a,s,n,r;let l=e("name"),i=l>=0?null==(a=t[l])?void 0:a.trim():"";if(!i)return null;let o=e("email"),d=e("phone"),c=e("notes");return{name:i,email:o>=0?null==(s=t[o])?void 0:s.trim():void 0,phone:d>=0?null==(n=t[d])?void 0:n.trim():void 0,notes:c>=0?null==(r=t[c])?void 0:r.trim():void 0}}).filter(Boolean);if(!t.length)return void m.oR.error("No valid rows to import. Check your mappings.");P(!0);try{let e=(await Promise.all(t.map(async e=>{try{let t=await y.F.customers.create(e);if("customer_created"===t.type&&t.customer)return t.customer;return null}catch(e){return console.error("Failed to import customer row",e),null}}))).filter(Boolean);e.length?(w(t=>[...e,...t]),m.oR.success("Imported ".concat(e.length," customer").concat(1===e.length?"":"s"))):m.oR.error("Unable to import customers")}catch(e){console.error("Failed to import customers",e),m.oR.error("Unable to import customers")}finally{P(!1),_(!1),V(null),$({})}},el=[{label:"Name",matchKey:et("name"),dbField:"name",required:!0,type:"text"},{label:"Email",matchKey:et("email"),dbField:"email",required:!1,type:"text"},{label:"Phone",matchKey:et("phone"),dbField:"phone",required:!1,type:"text"},{label:"Notes",matchKey:et("notes"),dbField:"notes",required:!1,type:"text"}],ei=!!G&&el.some(e=>{if(!e.required)return!1;let t=B[e.matchKey];return null===t||("number"==typeof t&&t>=0?t:G.normalizedHeaders.indexOf(e.matchKey))<0}),eo=e=>{var t;if(B.hasOwnProperty(e)){let t=B[e];if("number"==typeof t)return t;if(null===t)return -1}return null!=(t=null==G?void 0:G.normalizedHeaders.indexOf(e))?t:-1},ed=G&&G.rows.filter(e=>{var t;let a=eo("name");return!(a<0)&&!!(null==(t=e[a])?void 0:t.trim())}).length,ec=async()=>{if(!Z.name.trim())return void m.oR.error("Customer name is required");S(!0);try{let a={name:Z.name.trim(),email:Z.email.trim()||void 0,phone:Z.phone.trim()||void 0,notes:Z.notes.trim()||void 0};if(L){var e,t;let s=await (null==(e=(t=y.F.customers).update)?void 0:e.call(t,L.id,a)),n=null!=s?s:{...L,...a};w(e=>e.map(e=>e.id===L.id?n:e)),m.oR.success("Customer updated")}else{let e=await y.F.customers.create(a);switch(e.type){case"customer_created":default:e.customer&&(w(t=>[e.customer,...t]),m.oR.success("Customer added"));break;case"invitation_sent":m.oR.success(e.message||"Invitation sent to ".concat(a.email));break;case"invitation_pending":m.oR.info(e.message||"An invitation is already pending for ".concat(a.email));break;case"existing_customer":if(m.oR.info(e.message||"".concat(a.email," is already a customer")),e.customer){let e=await y.F.customers.list();w(e)}break;case"existing_customer_linked":if(m.oR.success(e.message||"".concat(a.email," has been linked to their account")),e.customer){let e=await y.F.customers.list();w(e)}}}k(!1),ea()}catch(e){console.error("Failed to create customer",e),m.oR.error("Unable to save customer")}finally{S(!1)}},eu=async()=>{if(!W.length)return;let e=W.map(e=>e.id);q(!0),J(1===W.length?W[0].id:"bulk");let t=C.filter(t=>e.includes(t.id));w(t=>t.filter(t=>!e.includes(t.id))),ee(t=>t.filter(t=>!e.includes(t))),U(!1),H([]);try{y.F.customers.delete&&await Promise.all(e.map(e=>y.F.customers.delete(e))),m.oR.success("Deleted ".concat(e.length," customer").concat(1===e.length?"":"s"))}catch(e){console.error("Failed to delete customers",e),t.length>0&&w(e=>[...e,...t]),m.oR.error("Unable to delete customers")}finally{q(!1),J(null)}},em=C.filter(e=>Q.includes(e.id));return(0,s.jsxs)("main",{className:"container relative mx-auto",children:[(0,s.jsx)("article",{className:"flex flex-col gap-2xl md:gap-3xl px-md",children:(0,s.jsxs)("div",{className:"@container w-full mt-md mb-md",children:[(0,s.jsxs)("div",{className:"mb-md flex items-baseline justify-between",children:[(0,s.jsx)(b.H2,{className:"text-4xl mb-xs",children:"Customers"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[A&&em.length>0&&!F&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(b.P,{className:"text-destructive self-center",children:[em.length," selected"]}),(0,s.jsx)(h.$,{variant:"destructive",className:"px-3 border-none self-center",disabled:0===em.length||F,onClick:()=>{let e=C.filter(e=>Q.includes(e.id));e.length&&(H(e),U(!0))},children:"Delete Selected"})]}),A&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("input",{ref:Y,type:"file",accept:".csv,text/csv",className:"hidden",onChange:en}),(0,s.jsxs)(j.rI,{children:[(0,s.jsx)(j.ty,{asChild:!0,children:(0,s.jsxs)(h.$,{variant:"outline",className:"px-0",disabled:I,children:[(0,s.jsx)(l,{className:"h-4 w-4 mr-2"}),"Import/Export"]})}),(0,s.jsxs)(j.SQ,{align:"end",children:[(0,s.jsxs)(j._2,{onClick:es,children:[(0,s.jsx)(i.A,{className:"h-4 w-4 mr-2"}),"Download CSV"]}),(0,s.jsxs)(j._2,{onClick:es,disabled:0===em.length,children:[(0,s.jsx)(i.A,{className:"h-4 w-4 mr-2"}),"Download Selected"]}),(0,s.jsxs)(j._2,{onClick:()=>{var e;I||null==(e=Y.current)||e.click()},disabled:I,children:[(0,s.jsx)(o.A,{className:"h-4 w-4 mr-2"}),"Upload CSV"]})]})]})]}),A&&(0,s.jsxs)(p.lG,{open:E,onOpenChange:e=>{k(e),e||ea()},children:[(0,s.jsx)(p.zM,{asChild:!0,children:(0,s.jsxs)(h.$,{variant:"default",className:"px-0",children:[(0,s.jsx)(d.A,{className:"h-4 w-4 mr-2"}),"Add Customer"]})}),(0,s.jsxs)(p.Cf,{className:"sm:max-w-lg",children:[(0,s.jsxs)(p.c7,{children:[(0,s.jsx)(p.L3,{children:L?"Edit Customer":"Add Customer"}),(0,s.jsx)(p.rr,{children:L?"Update customer contact details.":"Capture contact details for a new customer."})]}),(0,s.jsxs)("div",{className:"grid gap-4 py-2",children:[(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(v.J,{htmlFor:"customer-name",children:"Name"}),(0,s.jsx)(g.p,{id:"customer-name",value:Z.name,onChange:e=>X(t=>({...t,name:e.target.value})),placeholder:"Jane Cooper",autoFocus:!0})]}),(0,s.jsxs)("div",{className:"grid gap-2 md:grid-cols-2 md:gap-4",children:[(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(v.J,{htmlFor:"customer-email",children:"Email"}),(0,s.jsx)(g.p,{id:"customer-email",type:"email",value:Z.email,onChange:e=>X(t=>({...t,email:e.target.value})),placeholder:"jane@example.com"})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(v.J,{htmlFor:"customer-phone",children:"Phone"}),(0,s.jsx)(g.p,{id:"customer-phone",value:Z.phone,onChange:e=>X(t=>({...t,phone:e.target.value})),placeholder:"(555) 123-4567"})]})]}),(0,s.jsxs)("div",{className:"grid gap-2",children:[(0,s.jsx)(v.J,{htmlFor:"customer-notes",children:"Notes"}),(0,s.jsx)(N.T,{id:"customer-notes",value:Z.notes,onChange:e=>X(t=>({...t,notes:e.target.value})),placeholder:"Preferences, access details, or context",rows:3})]})]}),(0,s.jsxs)(p.Es,{children:[(0,s.jsx)(h.$,{variant:"outline",onClick:()=>k(!1),disabled:M,children:"Cancel"}),(0,s.jsx)(h.$,{onClick:ec,disabled:M,children:M?L?"Saving...":"Adding...":L?"Save Changes":"Add Customer"})]})]})]})]})]}),(0,s.jsx)(R,{customers:C,isLoading:r,onEdit:A?e=>{e.userId||(z(e),X({name:e.name||"",email:e.email||"",phone:e.phone||"",notes:e.notes||""}),k(!0))}:void 0,onDelete:A?e=>{H([e]),U(!0)}:void 0,deletingId:T,isDeleting:F,selectedIds:A?Q:[],onToggleSelect:A?(e,t)=>{ee(a=>{let s=new Set(a);return t?s.add(e):s.delete(e),Array.from(s)})}:void 0,onToggleSelectAll:A?(e,t)=>{ee(a=>{let s=new Set(a);return e.forEach(e=>{t?s.add(e):s.delete(e)}),Array.from(s)})}:void 0})]})}),(0,s.jsx)(p.lG,{open:D,onOpenChange:e=>{_(e),e||(V(null),$({}))},children:(0,s.jsxs)(p.Cf,{className:"sm:max-w-3xl",children:[(0,s.jsxs)(p.c7,{className:"space-y-1",children:[(0,s.jsx)(p.L3,{children:"CSV Import"}),(0,s.jsx)(p.rr,{children:"Mapping is fixed to the customer table. Ensure required columns are present before importing."})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"rounded-lg border bg-muted/30 p-3 text-sm",children:[(0,s.jsx)("div",{className:"font-medium",children:"Schema mapping"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"CSV column names must match the database fields below. Missing required fields are highlighted."})]}),(0,s.jsxs)("div",{className:"rounded-lg border",children:[(0,s.jsxs)("div",{className:"grid grid-cols-4 gap-3 px-4 py-3 text-xs font-medium uppercase tracking-wide text-muted-foreground",children:[(0,s.jsx)("span",{children:"CSV column"}),(0,s.jsx)("span",{children:"Database field"}),(0,s.jsx)("span",{children:"Field type"}),(0,s.jsx)("span",{children:"Sample"})]}),(0,s.jsx)(x.w,{}),(0,s.jsx)("div",{className:"divide-y",children:el.map(e=>{var t,a;let n=eo(e.matchKey),r=n>=0?null!=(t=null==G?void 0:G.headers[n])?t:e.label:"Select column",l=n>=0&&G&&null!=(a=G.firstRow[n])?a:"—";return(0,s.jsxs)("div",{className:"grid grid-cols-4 gap-3 px-4 py-3 items-center",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[-1===n?(0,s.jsx)(c.A,{className:"h-4 w-4 text-destructive"}):(0,s.jsx)(u.A,{className:"h-4 w-4 text-emerald-600"}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("span",{className:"font-medium",children:r}),(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:e.required?"Required":"Optional"})]})]}),(0,s.jsx)("div",{className:"text-sm font-mono",children:e.dbField}),(0,s.jsx)("div",{className:"text-sm capitalize",children:e.type}),(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsxs)(f.l6,{value:n>=0?String(n):"unmapped",onValueChange:t=>{$(a=>({...a,[e.matchKey]:"unmapped"===t?null:Number(t)}))},disabled:!G,children:[(0,s.jsx)(f.bq,{variant:"muted",children:(0,s.jsx)(f.yv,{placeholder:"Select column"})}),(0,s.jsxs)(f.gC,{children:[(0,s.jsx)(f.eb,{value:"unmapped",children:"Not mapped"}),null==G?void 0:G.headers.map((e,t)=>(0,s.jsx)(f.eb,{value:String(t),children:e||"Column ".concat(t+1)},"".concat(e||"column","-").concat(t)))]})]})}),(0,s.jsx)("div",{className:"text-sm text-muted-foreground break-all",children:l||"—"})]},e.matchKey)})})]}),G&&(0,s.jsx)("div",{className:"rounded-lg border bg-muted/50 px-4 py-3 text-sm",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"font-medium",children:"Import summary"}),(0,s.jsxs)("span",{className:"text-muted-foreground",children:[ed||0," row",1===ed?"":"s"," ready to import"]})]})})]}),(0,s.jsxs)(p.Es,{children:[(0,s.jsx)(h.$,{variant:"outline",onClick:()=>{_(!1),V(null),$({})},disabled:I,children:"Cancel"}),(0,s.jsx)(h.$,{onClick:er,disabled:!G||I||ei||!ed,children:I?"Importing...":"Import"})]})]})}),(0,s.jsx)(p.lG,{open:K,onOpenChange:e=>{U(e),e||H([])},children:(0,s.jsxs)(p.Cf,{className:"sm:max-w-md",children:[(0,s.jsxs)(p.c7,{children:[(0,s.jsx)(p.L3,{children:"Delete customer"}),(0,s.jsx)(p.rr,{children:"This action cannot be undone. The customer will be removed from your organization."})]}),(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsxs)("p",{className:"text-sm",children:["Are you sure you want to delete"," ",1===W.length?(0,s.jsx)("span",{className:"font-medium",children:(null==(t=W[0])?void 0:t.name)||"this customer"}):(0,s.jsxs)("span",{className:"font-medium",children:[W.length," customers"]}),"?"]})}),(0,s.jsxs)(p.Es,{children:[(0,s.jsx)(h.$,{variant:"outline",onClick:()=>U(!1),disabled:!!F,children:"Cancel"}),(0,s.jsx)(h.$,{variant:"destructive",onClick:eu,disabled:0===W.length||F,children:F?"Deleting...":"Delete"})]})]})})]})}var S=a(74875);function I(){let{user:e,isLoading:t,isAllowed:a}=(0,r.N)(["COMPANY","ADMIN","PROJECT_MANAGER"]),[l,i]=(0,n.useState)([]),[o,d]=(0,n.useState)(!0),[c,u]=(0,n.useState)(null);return((0,n.useEffect)(()=>t||!e||a?t||!e?void 0:a?void(async()=>{try{let e=await y.F.customers.list();i(e),u(null)}catch(e){console.error("Failed to load customers:",e),i([]),u("Unable to load customers")}finally{d(!1)}})():void d(!1):void d(!1),[e,a,t]),e)?a?(0,s.jsxs)("div",{className:"size-full overflow-x-hidden",children:[(0,s.jsx)(M,{customers:l,isLoading:o}),c&&(0,s.jsx)("div",{className:"container relative mx-auto px-md pb-md text-sm text-destructive",children:c})]}):(0,s.jsx)(S.O,{title:"Access Denied",description:"You do not have permission to view customers. Please contact your administrator."}):null}},21786:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]])},23664:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("mail",[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]])},26921:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("trending-down",[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]])},29633:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]])},36342:(e,t,a)=>{"use strict";a.d(t,{N:()=>i});var s=a(12115),n=a(20063),r=a(65939),l=a(80408);function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=(0,n.useRouter)(),{user:i,isLoading:o,memberships:d,activeOrganizationId:c}=(0,r.A)(),{redirectOnDeny:u=!1,redirectTo:m="/dashboard"}=t;(0,s.useEffect)(()=>{if(o)return;if(!i){u&&a.replace("/");return}let t=e.map(e=>(0,l.FK)(e)),s=(0,l.aJ)(i,d,c)||(0,l.FK)(i.accountType);!t.includes(s)&&u&&a.replace(m)},[i,o,e,a,u,m,d,c]);let h=(()=>{if(o||!i)return!1;let t=e.map(e=>(0,l.FK)(e)),a=(0,l.aJ)(i,d,c)||(0,l.FK)(i.accountType);return t.includes(a)})();return{user:i,isLoading:o,isAllowed:h}}},37135:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("trash",[["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]])},38162:(e,t,a)=>{"use strict";a.d(t,{C1:()=>A,bL:()=>b});var s=a(12115),n=a(94446),r=a(3468),l=a(92556),i=a(23558),o=a(78108),d=a(84288),c=a(76842),u=a(88142),m=a(95155),h="Checkbox",[p,x]=(0,r.A)(h),[j,f]=p(h);function g(e){let{__scopeCheckbox:t,checked:a,children:n,defaultChecked:r,disabled:l,form:o,name:d,onCheckedChange:c,required:u,value:p="on",internal_do_not_use_render:x}=e,[f,g]=(0,i.i)({prop:a,defaultProp:null!=r&&r,onChange:c,caller:h}),[v,N]=s.useState(null),[b,y]=s.useState(null),A=s.useRef(!1),C=!v||!!o||!!v.closest("form"),w={checked:f,disabled:l,setChecked:g,control:v,setControl:N,name:d,form:o,value:p,hasConsumerStoppedPropagationRef:A,required:u,defaultChecked:!E(r)&&r,isFormControl:C,bubbleInput:b,setBubbleInput:y};return(0,m.jsx)(j,{scope:t,...w,children:"function"==typeof x?x(w):n})}var v="CheckboxTrigger",N=s.forwardRef((e,t)=>{let{__scopeCheckbox:a,onKeyDown:r,onClick:i,...o}=e,{control:d,value:c,disabled:h,checked:p,required:x,setControl:j,setChecked:g,hasConsumerStoppedPropagationRef:N,isFormControl:b,bubbleInput:y}=f(v,a),A=(0,n.s)(t,j),C=s.useRef(p);return s.useEffect(()=>{let e=null==d?void 0:d.form;if(e){let t=()=>g(C.current);return e.addEventListener("reset",t),()=>e.removeEventListener("reset",t)}},[d,g]),(0,m.jsx)(u.sG.button,{type:"button",role:"checkbox","aria-checked":E(p)?"mixed":p,"aria-required":x,"data-state":k(p),"data-disabled":h?"":void 0,disabled:h,value:c,...o,ref:A,onKeyDown:(0,l.mK)(r,e=>{"Enter"===e.key&&e.preventDefault()}),onClick:(0,l.mK)(i,e=>{g(e=>!!E(e)||!e),y&&b&&(N.current=e.isPropagationStopped(),N.current||e.stopPropagation())})})});N.displayName=v;var b=s.forwardRef((e,t)=>{let{__scopeCheckbox:a,name:s,checked:n,defaultChecked:r,required:l,disabled:i,value:o,onCheckedChange:d,form:c,...u}=e;return(0,m.jsx)(g,{__scopeCheckbox:a,checked:n,defaultChecked:r,disabled:i,required:l,onCheckedChange:d,name:s,form:c,value:o,internal_do_not_use_render:e=>{let{isFormControl:s}=e;return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(N,{...u,ref:t,__scopeCheckbox:a}),s&&(0,m.jsx)(w,{__scopeCheckbox:a})]})}})});b.displayName=h;var y="CheckboxIndicator",A=s.forwardRef((e,t)=>{let{__scopeCheckbox:a,forceMount:s,...n}=e,r=f(y,a);return(0,m.jsx)(c.C,{present:s||E(r.checked)||!0===r.checked,children:(0,m.jsx)(u.sG.span,{"data-state":k(r.checked),"data-disabled":r.disabled?"":void 0,...n,ref:t,style:{pointerEvents:"none",...e.style}})})});A.displayName=y;var C="CheckboxBubbleInput",w=s.forwardRef((e,t)=>{let{__scopeCheckbox:a,...r}=e,{control:l,hasConsumerStoppedPropagationRef:i,checked:c,defaultChecked:h,required:p,disabled:x,name:j,value:g,form:v,bubbleInput:N,setBubbleInput:b}=f(C,a),y=(0,n.s)(t,b),A=(0,o.Z)(c),w=(0,d.X)(l);s.useEffect(()=>{if(!N)return;let e=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set,t=!i.current;if(A!==c&&e){let a=new Event("click",{bubbles:t});N.indeterminate=E(c),e.call(N,!E(c)&&c),N.dispatchEvent(a)}},[N,A,c,i]);let k=s.useRef(!E(c)&&c);return(0,m.jsx)(u.sG.input,{type:"checkbox","aria-hidden":!0,defaultChecked:null!=h?h:k.current,required:p,disabled:x,name:j,value:g,form:v,...r,tabIndex:-1,ref:y,style:{...r.style,...w,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});function E(e){return"indeterminate"===e}function k(e){return E(e)?"indeterminate":e?"checked":"unchecked"}w.displayName=C},39867:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]])},46858:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("door-open",[["path",{d:"M11 20H2",key:"nlcfvz"}],["path",{d:"M11 4.562v16.157a1 1 0 0 0 1.242.97L19 20V5.562a2 2 0 0 0-1.515-1.94l-4-1A2 2 0 0 0 11 4.561z",key:"au4z13"}],["path",{d:"M11 4H8a2 2 0 0 0-2 2v14",key:"74r1mk"}],["path",{d:"M14 12h.01",key:"1jfl7z"}],["path",{d:"M22 20h-3",key:"vhrsz"}]])},51631:(e,t,a)=>{"use strict";a.d(t,{Eb:()=>h,Iu:()=>c,M_:()=>x,WA:()=>p,cU:()=>u,dK:()=>d,n$:()=>m});var s=a(95155);a(12115);var n=a(90368),r=a(27937),l=a(37772),i=a(64936),o=a(97003);function d(e){let{className:t,...a}=e;return(0,s.jsx)("nav",{role:"navigation","aria-label":"pagination","data-slot":"pagination",className:(0,i.cn)("mx-auto flex w-full justify-center",t),...a})}function c(e){let{className:t,...a}=e;return(0,s.jsx)("ul",{"data-slot":"pagination-content",className:(0,i.cn)("flex flex-row items-center gap-1",t),...a})}function u(e){let{...t}=e;return(0,s.jsx)("li",{"data-slot":"pagination-item",...t})}function m(e){let{className:t,isActive:a,size:n="icon",...r}=e;return(0,s.jsx)("a",{"aria-current":a?"page":void 0,"data-slot":"pagination-link","data-active":a,className:(0,i.cn)((0,o.r)({variant:a?"outline":"ghost",size:n}),t),...r})}function h(e){let{className:t,...a}=e;return(0,s.jsxs)(m,{"aria-label":"Go to previous page",size:"default",className:(0,i.cn)("gap-1 px-2.5 sm:pl-2.5",t),...a,children:[(0,s.jsx)(n.A,{}),(0,s.jsx)("span",{className:"hidden sm:block",children:"Previous"})]})}function p(e){let{className:t,...a}=e;return(0,s.jsxs)(m,{"aria-label":"Go to next page",size:"default",className:(0,i.cn)("gap-1 px-2.5 sm:pr-2.5",t),...a,children:[(0,s.jsx)("span",{className:"hidden sm:block",children:"Next"}),(0,s.jsx)(r.A,{})]})}function x(e){let{className:t,...a}=e;return(0,s.jsxs)("span",{"aria-hidden":!0,"data-slot":"pagination-ellipsis",className:(0,i.cn)("flex size-9 items-center justify-center",t),...a,children:[(0,s.jsx)(l.A,{className:"size-4"}),(0,s.jsx)("span",{className:"sr-only",children:"More pages"})]})}},53594:(e,t,a)=>{"use strict";a.d(t,{FT:()=>i,q1:()=>o});var s=a(12115),n=a(65939),r=a(76457);function l(e,t){var a;if(!t)return"NONE";let s=e.find(e=>e.orgId===t);if(!s)return"NONE";if("PERSONAL"===(null==(a=s.organization)?void 0:a.type))return"PERSONAL_OWNER";let n=s.orgRole||s.role;return n||"NONE"}function i(e){let{user:t,memberships:a,activeOrganizationId:i}=(0,n.A)();return(0,s.useMemo)(()=>{var s;let n=l(a,i),o=null!=(s=null==t?void 0:t.id)?s:null;return(0,r.Ib)(n,e,o)},[null==t?void 0:t.id,a,i,null==e?void 0:e.projectManagerId,null==e?void 0:e.technicianId,null==e?void 0:e.editorId])}function o(){let{user:e,memberships:t,activeOrganizationId:a}=(0,n.A)();return(0,s.useMemo)(()=>{var s;let n=l(t,a);return{canManageCustomers:(0,r.lN)(n),canViewCustomers:(0,r.BO)(n),canCreateOrder:(0,r.$K)(n),isAdmin:(0,r.qc)(n),effectiveRole:n,userId:null!=(s=null==e?void 0:e.id)?s:null}},[null==e?void 0:e.id,t,a])}},54664:(e,t,a)=>{"use strict";a.d(t,{w:()=>l});var s=a(95155);a(12115);var n=a(47321),r=a(25016);function l(e){let{className:t,orientation:a="horizontal",decorative:l=!0,...i}=e;return(0,s.jsx)(n.b,{"data-slot":"separator",decorative:l,orientation:a,className:(0,r.cn)("bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",t),...i})}},64563:(e,t,a)=>{"use strict";a.d(t,{I:()=>b});var s=a(95155),n=a(12115),r=a(96633),l=a(33884),i=a(86651),o=a(93341),d=a(23664),c=a(29633),u=a(18514),m=a(46858),h=a(37135),p=a(33789),x=a(47507),j=a(68122),f=a(97003),g=a(82180),v=a(84916),N=a(51631);function b(e){let{customers:t=[],onRowClick:a,isLoading:b=!1,onEdit:y,onDelete:A,deletingId:C,isDeleting:w=!1,selectedIds:E=[],onToggleSelect:k,onToggleSelectAll:R}=e,[O,M]=(0,n.useState)(""),[S,I]=(0,n.useState)("name-asc"),[P,D]=(0,n.useState)(1),[_,L]=(0,n.useState)(10),z=(0,n.useMemo)(()=>{let e=[...t];if(O){let t=O.toLowerCase();e=e.filter(e=>{let a=e.name.toLowerCase(),s=(e.email||"").toLowerCase(),n=(e.notes||"").toLowerCase(),r=(e.phone||"").toLowerCase();return a.includes(t)||s.includes(t)||n.includes(t)||r.includes(t)})}return e.sort((e,t)=>{switch(S){case"name-asc":return e.name.localeCompare(t.name);case"name-desc":return t.name.localeCompare(e.name);case"notes-asc":return(e.notes||"").localeCompare(t.notes||"");case"notes-desc":return(t.notes||"").localeCompare(e.notes||"");case"jobs-asc":return(e.totalJobs||0)-(t.totalJobs||0);case"jobs-desc":return(t.totalJobs||0)-(e.totalJobs||0);default:return 0}}),e},[t,O,S]),T=Math.max(1,Math.ceil(z.length/_)),J=(P-1)*_,F=J+_,q=z.slice(J,F),K=q.length>0&&q.every(e=>E.includes(e.id));q.some(e=>E.includes(e.id)),(0,n.useEffect)(()=>{let e=Math.max(1,Math.ceil(z.length/_));P>e?D(e):P<1&&D(1)},[z.length,_,P]);let U=e=>{D(Math.min(Math.max(e,1),T))};return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsxs)("div",{className:"relative flex-1 min-w-0",children:[(0,s.jsx)(i.A,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground/60"}),(0,s.jsx)(p.p,{type:"text",variant:"muted",placeholder:"Search by name, email, or brokerage...",value:O,onChange:e=>M(e.target.value),className:"pl-10"})]}),(0,s.jsxs)(x.l6,{value:S,onValueChange:I,children:[(0,s.jsxs)(x.bq,{variant:"muted",className:"w-10 md:w-[180px] shrink-0 [&>svg:last-child]:hidden md:[&>svg:last-child]:block",children:[(0,s.jsx)(o.A,{className:"h-4 w-4 md:mr-2"}),(0,s.jsx)(x.yv,{placeholder:"Sort by",className:"hidden md:inline"})]}),(0,s.jsxs)(x.gC,{children:[(0,s.jsx)(x.eb,{value:"name-asc",children:"Name (A-Z)"}),(0,s.jsx)(x.eb,{value:"name-desc",children:"Name (Z-A)"}),(0,s.jsx)(x.eb,{value:"notes-asc",children:"Notes (A-Z)"}),(0,s.jsx)(x.eb,{value:"notes-desc",children:"Notes (Z-A)"}),(0,s.jsx)(x.eb,{value:"jobs-desc",children:"Jobs (Most)"}),(0,s.jsx)(x.eb,{value:"jobs-asc",children:"Jobs (Least)"})]})]})]}),z.length>0&&(0,s.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Showing ",z.length," of ",t.length," customers"]}),(0,s.jsxs)(r.XI,{children:[(0,s.jsx)(r.A0,{children:(0,s.jsxs)(r.Hj,{children:[(0,s.jsx)(r.nd,{className:"w-10",children:(0,s.jsx)(v.S,{"aria-label":"Select all",checked:K,onCheckedChange:e=>null==R?void 0:R(z.map(e=>e.id),!!e),disabled:0===z.length})}),(0,s.jsx)(r.nd,{children:"Customer"}),(0,s.jsx)(r.nd,{children:"Email"}),(0,s.jsx)(r.nd,{children:"Phone"}),(0,s.jsx)(r.nd,{children:"Jobs"}),(0,s.jsx)(r.nd,{children:"Last Job"}),(0,s.jsx)(r.nd,{children:"Created"}),(0,s.jsx)(r.nd,{className:"text-right",children:"Actions"})]})}),(0,s.jsx)(r.BF,{children:b?Array.from({length:5}).map((e,t)=>(0,s.jsxs)(r.Hj,{children:[(0,s.jsx)(r.nA,{children:(0,s.jsx)(j.E,{className:"h-4 w-4"})}),(0,s.jsx)(r.nA,{children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsxs)(l.eu,{className:"size-10 border-2 border-border",children:[(0,s.jsx)(l.BK,{}),(0,s.jsx)(l.q5,{className:"bg-muted"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(j.E,{className:"h-4 w-32"}),(0,s.jsx)(j.E,{className:"h-3 w-24"})]})]})}),(0,s.jsx)(r.nA,{children:(0,s.jsx)(j.E,{className:"h-4 w-32"})}),(0,s.jsx)(r.nA,{children:(0,s.jsx)(j.E,{className:"h-4 w-24"})}),(0,s.jsx)(r.nA,{children:(0,s.jsx)(j.E,{className:"h-4 w-12"})}),(0,s.jsx)(r.nA,{children:(0,s.jsx)(j.E,{className:"h-4 w-20"})}),(0,s.jsx)(r.nA,{children:(0,s.jsx)(j.E,{className:"h-4 w-24"})}),(0,s.jsx)(r.nA,{children:(0,s.jsx)(j.E,{className:"h-4 w-16 ml-auto"})})]},"customer-skeleton-".concat(t))):0===z.length?(0,s.jsx)(r.Hj,{children:(0,s.jsx)(r.nA,{colSpan:8,className:"text-center py-12 text-muted-foreground",children:"No customers found"})}):q.map(e=>{var t;return(0,s.jsxs)(r.Hj,{className:a?"cursor-pointer hover:bg-muted/50":"",onClick:()=>null==a?void 0:a(e),children:[(0,s.jsx)(r.nA,{onClick:e=>e.stopPropagation(),children:(0,s.jsx)(v.S,{"aria-label":"Select ".concat(e.name),checked:E.includes(e.id),onCheckedChange:t=>null==k?void 0:k(e.id,!!t)})}),(0,s.jsx)(r.nA,{children:(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsxs)(l.eu,{className:"size-10 border-2 border-border",children:[(0,s.jsx)(l.BK,{src:e.avatar}),(0,s.jsx)(l.q5,{className:"bg-primary text-primary-foreground text-xs",children:e.name.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium",children:e.name}),e.lastJob&&(0,s.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Last job: ",new Date(e.lastJob).toLocaleDateString()]})]})]})}),(0,s.jsx)(r.nA,{children:(0,s.jsxs)("div",{className:"flex items-center gap-1 text-sm",children:[(0,s.jsx)(d.A,{className:"h-4 w-4 text-muted-foreground/60"}),(0,s.jsx)("span",{className:"text-muted-foreground",children:e.email||"—"})]})}),(0,s.jsx)(r.nA,{children:(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:e.phone||"—"})}),(0,s.jsx)(r.nA,{children:(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(c.A,{className:"h-4 w-4 text-muted-foreground/60"}),(0,s.jsx)("span",{children:null!=(t=e.totalJobs)?t:0})]})}),(0,s.jsx)(r.nA,{children:(0,s.jsx)("div",{className:"text-sm text-muted-foreground",children:e.lastJob?new Date(e.lastJob).toLocaleDateString():"—"})}),(0,s.jsx)(r.nA,{children:(0,s.jsxs)(g.m_,{children:[(0,s.jsx)(g.k$,{asChild:!0,children:(0,s.jsx)("span",{className:"text-sm text-muted-foreground cursor-default",children:(e=>{if(!e)return"—";let t="string"==typeof e?new Date(e):e;return Number.isNaN(t.getTime())?"—":t.toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"})})(e.createdAt)})}),(0,s.jsx)(g.ZI,{children:e.createdAt?new Date(e.createdAt).toISOString():"Unknown"})]})}),(0,s.jsx)(r.nA,{children:(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,s.jsx)(f.$,{variant:"ghost",size:"icon-sm",onClick:t=>{t.stopPropagation(),e.userId||null==y||y(e)},disabled:!!e.userId||!y,children:(0,s.jsx)(u.A,{className:"h-4 w-4"})}),(0,s.jsxs)(g.m_,{children:[(0,s.jsx)(g.k$,{asChild:!0,children:(0,s.jsx)(f.$,{variant:"ghost",size:"icon-sm",onClick:t=>{t.stopPropagation(),null==A||A(e)},disabled:!A||C===e.id||"bulk"===C||w,children:e.userId?(0,s.jsx)(m.A,{className:"h-4 w-4 text-destructive"}):(0,s.jsx)(h.A,{className:"h-4 w-4 text-destructive"})})}),(0,s.jsx)(g.ZI,{children:e.userId?"Remove from organization":"Delete customer"})]})]})})]},e.id)})})]}),!b&&z.length>0&&(0,s.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,s.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Showing ",J+1,"-",Math.min(F,z.length)," of ",z.length]}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsxs)(x.l6,{value:_.toString(),onValueChange:e=>{L(Number(e)),D(1)},children:[(0,s.jsx)(x.bq,{className:"w-[140px]",children:(0,s.jsx)(x.yv,{placeholder:"Per page"})}),(0,s.jsxs)(x.gC,{children:[(0,s.jsx)(x.eb,{value:"10",children:"10 per page"}),(0,s.jsx)(x.eb,{value:"25",children:"25 per page"}),(0,s.jsx)(x.eb,{value:"50",children:"50 per page"}),(0,s.jsx)(x.eb,{value:"100",children:"100 per page"})]})]}),T>1&&(0,s.jsx)(N.dK,{children:(0,s.jsxs)(N.Iu,{children:[(0,s.jsx)(N.cU,{children:(0,s.jsx)(N.Eb,{onClick:()=>U(P-1),className:1===P?"pointer-events-none opacity-50":"cursor-pointer"})}),(()=>{let e=[];if(T<=5)for(let t=1;t<=T;t++)e.push(t);else{e.push(1),P>3&&e.push("ellipsis");let t=Math.max(2,P-1),a=Math.min(T-1,P+1);for(let s=t;s<=a;s++)e.push(s);P<T-2&&e.push("ellipsis"),e.push(T)}return e})().map((e,t)=>(0,s.jsx)(N.cU,{children:"ellipsis"===e?(0,s.jsx)(N.M_,{}):(0,s.jsx)(N.n$,{onClick:()=>U(e),isActive:P===e,className:"cursor-pointer",children:e})},"".concat(e,"-").concat(t))),(0,s.jsx)(N.cU,{children:(0,s.jsx)(N.WA,{onClick:()=>U(P+1),className:P===T?"pointer-events-none opacity-50":"cursor-pointer"})})]})})]})]})]})}},71951:(e,t,a)=>{Promise.resolve().then(a.bind(a,20954))},76457:(e,t,a)=>{"use strict";a.d(t,{$K:()=>c,BO:()=>x,Ib:()=>f,Kh:()=>l,ZZ:()=>d,aN:()=>o,jC:()=>i,lN:()=>p,mR:()=>h,nS:()=>m,qc:()=>j});let s=["PERSONAL_OWNER","OWNER","ADMIN"],n=["PERSONAL_OWNER","OWNER","ADMIN","PROJECT_MANAGER"],r=["PERSONAL_OWNER","OWNER","ADMIN"];function l(e,t,a){return!!e&&"NONE"!==e&&!!t&&(!!s.includes(e)||"PROJECT_MANAGER"===e&&t.projectManagerId===a)}function i(e){return!!e&&"NONE"!==e&&s.includes(e)}function o(e){return!!e&&"NONE"!==e&&s.includes(e)}function d(e,t,a){return l(e,t,a)}function c(e){return!!e&&"NONE"!==e&&n.includes(e)}function u(e){return!!e&&"NONE"!==e}function m(e){return!!e&&"NONE"!==e&&"EDITOR"!==e&&"TECHNICIAN"!==e&&["PERSONAL_OWNER","OWNER","ADMIN","PROJECT_MANAGER"].includes(e)}function h(e,t,a,n){return(null==n?void 0:n.userAccountType)==="AGENT"&&null!=n&&!!n.customerUserId&&n.customerUserId===a||!!e&&"NONE"!==e&&!!t&&(!!s.includes(e)||"PROJECT_MANAGER"===e&&t.projectManagerId===a)}function p(e){return!!e&&"NONE"!==e&&r.includes(e)}function x(e){return!!e&&"NONE"!==e&&["PERSONAL_OWNER","OWNER","ADMIN","PROJECT_MANAGER"].includes(e)}function j(e){return!!e&&"NONE"!==e&&s.includes(e)}function f(e,t,a){return{canViewProject:!!e&&"NONE"!==e&&(!!["PERSONAL_OWNER","OWNER","ADMIN","PROJECT_MANAGER"].includes(e)||("TECHNICIAN"===e?(null==t?void 0:t.technicianId)===a:"EDITOR"===e&&(null==t?void 0:t.editorId)===a)),canEditProject:l(e,t,a),canDeleteProject:i(e),canChangeCustomer:o(e),canAssignTechnician:"PERSONAL_OWNER"!==e&&l(e,t,a),canAssignEditor:"PERSONAL_OWNER"!==e&&l(e,t,a),canChangeStatus:l(e,t,a),canReschedule:l(e,t,a),canWriteTeamChat:u(e),canReadTeamChat:u(e),canWriteCustomerChat:h(e,t,a),canReadCustomerChat:m(e),isAssignedPM:!!t&&!!a&&t.projectManagerId===a,isAssignedTechnician:!!t&&!!a&&t.technicianId===a,isAssignedEditor:!!t&&!!a&&t.editorId===a}}},80408:(e,t,a)=>{"use strict";a.d(t,{EL:()=>u,FK:()=>o,UD:()=>c,aJ:()=>d});let s=[{path:"/dashboard",label:"Dashboard",icon:"LayoutDashboard"},{path:"/calendar",label:"Calendar",icon:"Calendar"}],n=[{path:"/dashboard",label:"Dashboard",icon:"LayoutDashboard"},{path:"/jobs/all-jobs",label:"Jobs",icon:"Briefcase"},{path:"/map",label:"Map",icon:"Map"},{path:"/calendar",label:"Calendar",icon:"Calendar"}],r=[{path:"/dashboard",label:"Dashboard",icon:"LayoutDashboard"},{path:"/jobs/all-jobs",label:"My Jobs",icon:"Briefcase"},{path:"/map",label:"Map",icon:"Map"},{path:"/calendar",label:"Calendar",icon:"Calendar"}],l=[{path:"/dashboard",label:"Dashboard",icon:"LayoutDashboard"},{path:"/jobs/all-jobs",label:"My Jobs",icon:"Briefcase"},{path:"/jobs/job-management",label:"Job Board",icon:"Kanban"},{path:"/map",label:"Map",icon:"Map"},{path:"/calendar",label:"Calendar",icon:"Calendar"}],i=["OWNER","ADMIN","PROJECT_MANAGER","EDITOR"],o=e=>{let t=(e||"").toUpperCase();return"COMPANY"===t||i.includes(t)?"COMPANY":"TECHNICIAN"===t||"PROVIDER"===t?"TECHNICIAN":"AGENT"},d=(e,t,a)=>{if(!e)return null;let s=u(e,t,a);return s?s.showSidebar?"COMPANY":"AGENT"===s.accountType?"AGENT":"PERSONAL"===s.orgType?"COMPANY":"TECHNICIAN":null},c=e=>"COMPANY"===e;function u(e,t,a){var i;if(!e)return null;let o=t.find(e=>e.orgId===a),d=(null==o||null==(i=o.organization)?void 0:i.type)||(null==o?void 0:o.organizationType)||"PERSONAL",c="PERSONAL"===d?"PERSONAL_OWNER":(null==o?void 0:o.orgRole)||(null==o?void 0:o.role)||null,u=e.accountType||"PROVIDER",m=(c||"").toString().toUpperCase(),h="COMPANY"===d&&["OWNER","ADMIN","PROJECT_MANAGER"].includes(m),p=[],x=!1,j="New Job",f="",g=["OWNER","ADMIN","PERSONAL_OWNER"].includes(m)||"PERSONAL"===d;return h?(x=["OWNER","ADMIN"].includes(m),j="New Job",f=""):"AGENT"===u?(p=s,x=!0,j="Create Order",f="/booking"):"COMPANY"===d&&"EDITOR"===m?(p=l,x=!1):"COMPANY"===d&&"TECHNICIAN"===m?(p=r,x=!1):("PROVIDER"===u||"COMPANY"===u)&&(p=n,x=!1),{accountType:u,orgType:d,orgRole:c,showSidebar:h,isElevatedRole:h,navItems:p,canCreateOrder:x,createActionLabel:j,createActionPath:f,canManageCustomers:g}}},90368:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},91169:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(71847).A)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]])},96633:(e,t,a)=>{"use strict";a.d(t,{A0:()=>l,BF:()=>i,Hj:()=>o,XI:()=>r,nA:()=>c,nd:()=>d});var s=a(95155);a(12115);var n=a(64936);function r(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,s.jsx)("table",{"data-slot":"table",className:(0,n.cn)("w-full caption-bottom text-sm",t),...a})})}function l(e){let{className:t,...a}=e;return(0,s.jsx)("thead",{"data-slot":"table-header",className:(0,n.cn)("[&_tr]:border-b",t),...a})}function i(e){let{className:t,...a}=e;return(0,s.jsx)("tbody",{"data-slot":"table-body",className:(0,n.cn)("[&_tr:last-child]:border-0",t),...a})}function o(e){let{className:t,...a}=e;return(0,s.jsx)("tr",{"data-slot":"table-row",className:(0,n.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",t),...a})}function d(e){let{className:t,...a}=e;return(0,s.jsx)("th",{"data-slot":"table-head",className:(0,n.cn)("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...a})}function c(e){let{className:t,...a}=e;return(0,s.jsx)("td",{"data-slot":"table-cell",className:(0,n.cn)("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...a})}}},e=>{e.O(0,[547,5707,2110,8234,2619,4001,3409,1204,9360,550,7117,4419,5657,5939,4802,7909,8441,1255,7358],()=>e(e.s=71951)),_N_E=e.O()}]);