(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6815],{7235:(e,r,t)=>{"use strict";t.d(r,{d:()=>i});var a=t(95155);t(12115);var n=t(27599),s=t(25016);function i(e){let{className:r,...t}=e;return(0,a.jsx)(n.bL,{"data-slot":"switch",className:(0,s.cn)("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",r),...t,children:(0,a.jsx)(n.zi,{"data-slot":"switch-thumb",className:(0,s.cn)("bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}},15271:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>v});var a=t(95155),n=t(12115),s=t(24632),i=t(73344),d=t(7235),o=t(90235),l=t(33789),c=t(97003),u=t(42892),m=t(18720),h=t(42713),x=t(28014),b=t(52056),p=t(69141),f=t(61362),g=t(36838);function v(){let{user:e,isLoading:r}=(0,s.l)(["COMPANY","AGENT","TECHNICIAN","EDITOR","PROJECT_MANAGER"]),{user:t,isLoaded:v}=(0,x.Jd)(),[N,j]=(0,n.useState)(!0),[y,k]=(0,n.useState)(!1),[C,w]=(0,n.useState)(!0),[S,A]=(0,n.useState)(!1),[P,R]=(0,n.useState)(""),[E,F]=(0,n.useState)(""),[z,I]=(0,n.useState)(null),[M,J]=(0,n.useState)(!1),[O,T]=(0,n.useState)(!1),V=null==t?void 0:t.primaryPhoneNumber,_=!!V;if(r||!v)return(0,a.jsx)(u.N3,{});if(!e)return null;let K=async()=>{if(!P.trim())return void m.oR.error("Please enter a phone number");if(!t)return void m.oR.error("User not loaded");T(!0);try{let e=await t.createPhoneNumber({phoneNumber:P});I(e),await e.prepareVerification(),m.oR.success("Verification code sent to your phone")}catch(a){var e,r;console.error("Failed to add phone number:",a);let t=(null==(r=a.errors)||null==(e=r[0])?void 0:e.message)||a.message||"Failed to add phone number";m.oR.error(t)}finally{T(!1)}},L=async()=>{if(!E.trim())return void m.oR.error("Please enter the verification code");if(!z)return void m.oR.error("Phone number not found. Please try again.");J(!0);try{await z.attemptVerification({code:E}),await (null==t?void 0:t.update({primaryPhoneNumberId:z.id})),m.oR.success("Phone number verified and added successfully"),k(!0),A(!1),R(""),F(""),I(null)}catch(a){var e,r;console.error("Failed to verify phone:",a);let t=(null==(r=a.errors)||null==(e=r[0])?void 0:e.message)||a.message||"Invalid verification code";m.oR.error(t)}finally{J(!1)}},$=()=>{A(!1),R(""),F(""),I(null)};return(0,a.jsx)(h.U,{id:"notifications",title:"Notifications",description:"Manage your notification preferences and alerts.",onSave:()=>{m.oR.success("Notification preferences saved successfully")},children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(o.J,{children:"Notification Preferences"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(o.J,{htmlFor:"email-notifications",children:"Email Notifications"}),(0,a.jsxs)(i.QX,{className:"text-xs block",children:["Receive updates via email (",e.email,")"]})]}),(0,a.jsx)(d.d,{id:"email-notifications",checked:N,onCheckedChange:j})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(o.J,{htmlFor:"sms-notifications",children:"SMS Notifications"}),(0,a.jsx)(i.QX,{className:"text-xs block",children:_?"Receive urgent updates via SMS (".concat(V.phoneNumber,")"):"Receive urgent updates via SMS"})]}),(0,a.jsx)(d.d,{id:"sms-notifications",checked:y,onCheckedChange:e=>{if(e&&!_){A(!0),m.oR.info("Please add a phone number to enable SMS notifications");return}k(e)},disabled:!_&&!S})]}),!_&&!S&&(0,a.jsxs)("div",{className:"flex items-start gap-3 p-3 bg-amber-50 dark:bg-amber-950/30 border border-amber-200 dark:border-amber-800 rounded-lg",children:[(0,a.jsx)(b.A,{className:"h-5 w-5 text-amber-600 dark:text-amber-500 mt-0.5 shrink-0"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-amber-800 dark:text-amber-200",children:"Phone number required"}),(0,a.jsx)("p",{className:"text-xs text-amber-700 dark:text-amber-300 mt-1",children:"Add a phone number to enable SMS notifications for urgent updates."}),(0,a.jsxs)(c.$,{variant:"outline",size:"sm",className:"mt-2",onClick:()=>A(!0),children:[(0,a.jsx)(p.A,{className:"h-4 w-4 mr-2"}),"Add Phone Number"]})]})]}),S&&(0,a.jsxs)("div",{className:"p-4 border rounded-lg space-y-4 bg-muted/30",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(p.A,{className:"h-5 w-5 text-primary"}),(0,a.jsx)(o.J,{className:"text-base",children:"Add Phone Number"})]}),z?(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,a.jsx)(f.A,{className:"h-4 w-4 text-green-600"}),"Code sent to ",P]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o.J,{htmlFor:"verification-code",children:"Verification Code"}),(0,a.jsx)(l.p,{id:"verification-code",type:"text",placeholder:"Enter 6-digit code",value:E,onChange:e=>F(e.target.value),maxLength:6})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(c.$,{onClick:L,disabled:M||!E.trim(),children:M?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(g.y,{className:"h-4 w-4 mr-2"}),"Verifying..."]}):"Verify & Enable SMS"}),(0,a.jsx)(c.$,{variant:"outline",onClick:$,children:"Cancel"})]})]}):(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o.J,{htmlFor:"phone-input",children:"Phone Number"}),(0,a.jsx)(l.p,{id:"phone-input",type:"tel",placeholder:"+1 (555) 123-4567",value:P,onChange:e=>R(e.target.value)}),(0,a.jsx)(i.QX,{className:"text-xs",children:"Include country code (e.g., +1 for US/Canada)"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(c.$,{onClick:K,disabled:O||!P.trim(),children:O?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(g.y,{className:"h-4 w-4 mr-2"}),"Sending..."]}):"Send Verification Code"}),(0,a.jsx)(c.$,{variant:"outline",onClick:$,children:"Cancel"})]})]})]}),_&&(0,a.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 text-sm text-green-700 dark:text-green-400 bg-green-50 dark:bg-green-950/30 border border-green-200 dark:border-green-800 rounded-lg",children:[(0,a.jsx)(f.A,{className:"h-4 w-4"}),"Phone number verified: ",V.phoneNumber]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(o.J,{htmlFor:"job-alerts",children:"Job Assignment Alerts"}),(0,a.jsx)(i.QX,{className:"text-xs block",children:"Notify when jobs are assigned to you"})]}),(0,a.jsx)(d.d,{id:"job-alerts",checked:C,onCheckedChange:w})]})]})]})})}},24632:(e,r,t)=>{"use strict";t.d(r,{l:()=>o});var a=t(12115),n=t(20063),s=t(65939),i=t(75701),d=t(80408);function o(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=(0,n.useRouter)(),{user:o,isLoading:l,activeOrganizationId:c,memberships:u}=(0,s.A)(),{redirectTo:m,enforceRedirect:h}=r,x=(0,a.useCallback)(()=>(0,i.in)(u,c),[u,c]);return(0,a.useEffect)(()=>{if(l)return;if(!o)return void t.push("/");let r=e.map(e=>(0,d.FK)(e)),a=(0,d.FK)(o.accountType),n=u.find(e=>e.orgId===c),s=(0,i.hq)(n,a);if(!r.includes(s)){if(!1===h)return;if(m)t.push(m);else{let e=(0,i.zE)(s);t.push(e)}}},[o,l,e,t,m,h,u,c]),{user:o,organizationId:c,memberships:u,isLoading:l,getActiveOrgRole:x}}},33789:(e,r,t)=>{"use strict";t.d(r,{p:()=>d});var a=t(95155);t(12115);var n=t(83101),s=t(64936);let i=(0,n.F)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground flex w-full min-w-0 rounded-md transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"border-input bg-input-background dark:bg-input/30 border px-3 py-1",outline:"border-2 bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 border px-3 py-1",ghost:"border-0 bg-transparent hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50 px-3 py-1",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80 px-3 py-1",muted:"border-transparent bg-muted text-foreground hover:bg-muted/80 px-3 py-1",flat:"border-0 bg-transparent px-3 py-1"},size:{default:"h-9 text-base md:text-sm",sm:"h-8 text-sm px-2.5 py-1",lg:"h-10 text-base px-4 py-2"}},defaultVariants:{variant:"default",size:"default"}});function d(e){let{className:r,type:t,variant:n,size:d,...o}=e;return(0,a.jsx)("input",{type:t,"data-slot":"input",className:(0,s.cn)(i({variant:n,size:d}),r),...o})}},36838:(e,r,t)=>{"use strict";t.d(r,{y:()=>i});var a=t(95155),n=t(35299),s=t(25016);function i(e){let{className:r,...t}=e;return(0,a.jsx)(n.A,{role:"status","aria-label":"Loading",className:(0,s.cn)("size-4 animate-spin",r),...t})}},45692:(e,r,t)=>{Promise.resolve().then(t.bind(t,15271))},68122:(e,r,t)=>{"use strict";t.d(r,{E:()=>s});var a=t(95155),n=t(64936);function s(e){let{className:r,...t}=e;return(0,a.jsx)("div",{"data-slot":"skeleton",className:(0,n.cn)("bg-accent animate-pulse rounded-md",r),...t})}},75701:(e,r,t)=>{"use strict";t.d(r,{hq:()=>n,in:()=>s,zE:()=>i});var a=t(80408);let n=(e,r)=>{var t;if(!e)return(0,a.FK)(r);if("PERSONAL"===((null==(t=e.organization)?void 0:t.type)||e.organizationType||""))return"COMPANY";let n=e.orgRole||e.role||(null==e?void 0:e.organizationRole)||r;return(0,a.FK)(n)},s=(e,r)=>{var t,a;let n=e.find(e=>e.orgId===r),s=null!=(a=null!=(t=null==n?void 0:n.orgRole)?t:null==n?void 0:n.role)?a:null;return s?s.toUpperCase():null},i=e=>{let r=(0,a.FK)(e);return"COMPANY"===r||"AGENT"===r||"TECHNICIAN"===r?"/dashboard":"/"}}},e=>{e.O(0,[547,5707,2110,3726,5657,5939,8698,2892,8441,1255,7358],()=>e(e.s=45692)),_N_E=e.O()}]);