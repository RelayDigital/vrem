"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3532],{45620:(e,t,i)=>{let s;i.r(t),i.d(t,{ActivityBlock:()=>eI,ActivityHeader:()=>tu,BaseComponent:()=>r.$G,Block:()=>eA,BtnUi:()=>tG,CameraSource:()=>tv,CloudImageEditor:()=>i2,CloudImageEditorActivity:()=>tQ,CloudImageEditorBlock:()=>tA,Config:()=>il,Copyright:()=>ic,CropFrame:()=>t$,Data:()=>r.B_,DropArea:()=>ib,EditorAspectRatioButtonControl:()=>tk,EditorCropButtonControl:()=>tM,EditorFilterControl:()=>tV,EditorFreeformButtonControl:()=>tI,EditorImageCropper:()=>tR,EditorImageFader:()=>tN,EditorOperationControl:()=>tz,EditorScroller:()=>tH,EditorSlider:()=>tL,EditorToolbar:()=>tj,ExternalSource:()=>i$,ExternalUploadSource:()=>eB,FileItem:()=>iM,FileUploaderInline:()=>i3,FileUploaderMinimal:()=>i4,FileUploaderRegular:()=>i8,FormInput:()=>iT,Icon:()=>iS,Img:()=>iB,LineLoaderUi:()=>tZ,Modal:()=>iz,ModalEvents:()=>ef,PACKAGE_NAME:()=>e_,PACKAGE_VERSION:()=>ey,PresenceToggle:()=>tW,ProgressBar:()=>iH,ProgressBarCommon:()=>ij,Select:()=>iG,SimpleBtn:()=>iZ,SliderUi:()=>tK,SolutionBlock:()=>eT,SourceBtn:()=>iq,SourceList:()=>iW,Spinner:()=>iK,StartFrom:()=>iQ,Thumb:()=>iJ,UID:()=>r.V0,UploadCtxProvider:()=>i0,UploadList:()=>i1,UploadSource:()=>ez,UploaderBlock:()=>th,UrlSource:()=>i5,defineComponents:()=>ek,defineLocale:()=>ec,loadFileUploaderFrom:()=>eM,toKebabCase:()=>tY});var r=i(18582),a=i(55659),o=i(61799),l=i(5109),n=i(15648),c=i(71361),d=i(26029),h=i(73756),u=i(55972),p=i(49984),m=i(3223),g=Object.freeze({INIT_SOLUTION:"init-solution",CHANGE_CONFIG:"change-config",ACTION_EVENT:"action-event",ERROR_EVENT:"error-event"}),b=Object.freeze({FILE_ADDED:"file-added",FILE_REMOVED:"file-removed",FILE_UPLOAD_START:"file-upload-start",FILE_UPLOAD_PROGRESS:"file-upload-progress",FILE_UPLOAD_SUCCESS:"file-upload-success",FILE_UPLOAD_FAILED:"file-upload-failed",FILE_URL_CHANGED:"file-url-changed",MODAL_OPEN:"modal-open",MODAL_CLOSE:"modal-close",DONE_CLICK:"done-click",UPLOAD_CLICK:"upload-click",ACTIVITY_CHANGE:"activity-change",COMMON_UPLOAD_START:"common-upload-start",COMMON_UPLOAD_PROGRESS:"common-upload-progress",COMMON_UPLOAD_SUCCESS:"common-upload-success",COMMON_UPLOAD_FAILED:"common-upload-failed",CHANGE:"change",GROUP_CREATED:"group-created"}),f=class{_timeoutStore=new Map;_targets=new Set;_debugPrint=null;constructor(e){this._debugPrint=e}bindTarget(e){this._targets.add(e)}unbindTarget(e){this._targets.delete(e)}_dispatch(e,t){for(let i of this._targets)i.dispatchEvent(new CustomEvent(e,{detail:t}));this._debugPrint?.(()=>[`event "${e}"`,t&&"object"==typeof t?{...t}:t])}emit(e,t,i={}){let{debounce:s}=i;if("number"!=typeof s&&!s)return void this._dispatch(e,"function"==typeof t?t():t);this._timeoutStore.has(e)&&window.clearTimeout(this._timeoutStore.get(e));let r=window.setTimeout(()=>{this._dispatch(e,"function"==typeof t?t():t),this._timeoutStore.delete(e)},"number"==typeof s?s:20);this._timeoutStore.set(e,r)}};function v(e,t){let i,s=(...s)=>{i&&clearTimeout(i),i=setTimeout(()=>e(...s),t)};return s.cancel=()=>{i&&clearTimeout(i)},s}var _=e=>e?e.split(",").map(e=>e.trim()).filter(Boolean):[],y=e=>e.join(","),w=e=>{if("string"!=typeof e||!e)return"";let t=e.trim();return t.startsWith("-/")?t=t.slice(2):t.startsWith("/")&&(t=t.slice(1)),t.endsWith("/")&&(t=t.slice(0,t.length-1)),t},C=(...e)=>e.filter(e=>"string"==typeof e&&!!e).map(e=>w(e)).join("/-/"),E=(...e)=>{let t=C(...e);return t?`-/${t}/`:""};function A(e){let t=new URL(e),i=t.pathname+t.search+t.hash,s=i.lastIndexOf("http"),r=i.lastIndexOf("/"),a="";return s>=0?a=i.slice(s):r>=0&&(a=i.slice(r+1)),a}function $(e){let{pathname:t}=new URL(e),i=t.indexOf("/"),s=t.indexOf("/",i+1);return t.substring(i+1,s)}function x(e){let t=new URL(k(e)),i=t.pathname.indexOf("/-/");return -1===i?"":t.pathname.substring(i).slice(1)}function I(e){return x(e).split("/-/").filter(Boolean).map(e=>w(e))}function k(e){let t=new URL(e),i=A(e),s=M(i)?T(i).pathname:i;return t.pathname=t.pathname.replace(s,""),t.search="",t.hash="",t.toString()}function M(e){return e.startsWith("http")}function T(e){let t=new URL(e);return{pathname:`${t.origin}${t.pathname??""}`,search:t.search??"",hash:t.hash??""}}var S=(e,t,i)=>{let s=new URL(k(e)),r=i??A(e),a=t??"";if(s.pathname.startsWith("//")&&(s.pathname=s.pathname.replace("//","/")),r&&M(r)){let e=T(r);s.pathname=`${s.pathname}${a}${e.pathname||""}`,s.search=e.search,s.hash=e.hash}else s.pathname=`${s.pathname}${a}${r||""}`;return s.toString()},O=(e,t)=>{let i=new URL(e);return i.pathname=`${t}/`,i.toString()},L=(e,t=",")=>e.trim().split(t).map(e=>e.trim()).filter(e=>e.length>0),U=Object.freeze({brightness:0,exposure:0,gamma:100,contrast:0,saturation:0,vibrance:0,warmth:0,enhance:0,filter:0,rotate:0,mirror:!1,flip:!1,crop:void 0}),V=["enhance","brightness","exposure","gamma","contrast","saturation","vibrance","warmth","filter","mirror","flip","rotate","crop"];function P(e){return C(...V.filter(t=>void 0!==e[t]&&null!==e[t]).map(t=>{let i=e[t];if("number"==typeof i)return U[t]!==i?`${t}/${i}`:"";if("boolean"==typeof i)return U[t]!==i?`${t}`:"";if("filter"===t&&i){let{name:e,amount:s}=i;return U.filter===s?"":`${t}/${e}/${s}`}if("crop"===t&&i){let{dimensions:e,coords:s}=i;return`${t}/${e.join("x")}/${s.join(",")}`}return""}).filter(e=>!!e))}var F=C("format/auto","progressive/yes"),R=([e])=>void 0!==e?Number(e):void 0,D=()=>!0,B=Object.freeze({enhance:R,brightness:R,exposure:R,gamma:R,contrast:R,saturation:R,vibrance:R,warmth:R,filter:([e,t])=>({name:e,amount:void 0!==t?Number(t):100}),mirror:D,flip:D,rotate:R,crop:e=>{let[t,i]=e,{dimensions:s,coords:r}=(([e,t])=>{if(!/\d+x\d+/.test(e)||!/\d+,\d+/.test(t))throw Error("Crop by aspect ratio, percentage or alignment shortcuts is not supported.");return{dimensions:L(e,"x").map(Number),coords:L(t).map(Number)}})([t,i]);return{dimensions:s,coords:r}}});function N(e){let t={};for(let i of e){let[e,...s]=i.split("/");if(!e||!V.includes(e))continue;let r=B[e];try{let i=r(s);t[e]=i}catch(e){console.warn([`Failed to parse URL operation "${i}". It will be ignored.`,e instanceof Error?`Error message: "${e.message}"`:e,"If you need this functionality, please feel free to open an issue at https://github.com/uploadcare/blocks/issues/new"].join("\n"))}}return t}var z=Object.freeze({CROP:"crop",TUNING:"tuning",FILTERS:"filters"}),H=Object.freeze([z.CROP,z.TUNING,z.FILTERS]),j=Object.freeze(["brightness","exposure","gamma","contrast","saturation","vibrance","warmth","enhance"]),G=Object.freeze(["adaris","briaril","calarel","carris","cynarel","cyren","elmet","elonni","enzana","erydark","fenralan","ferand","galen","gavin","gethriel","iorill","iothari","iselva","jadis","lavra","misiara","namala","nerion","nethari","pamaya","sarnar","sedis","sewen","sorahel","sorlen","tarian","thellassan","varriel","varven","vevera","virkas","yedis","yllara","zatvel","zevcen"]),Z=Object.freeze(["rotate","mirror","flip"]),q=Object.freeze({brightness:{zero:U.brightness,range:[-100,100],keypointsNumber:2},exposure:{zero:U.exposure,range:[-500,500],keypointsNumber:2},gamma:{zero:U.gamma,range:[0,1e3],keypointsNumber:2},contrast:{zero:U.contrast,range:[-100,500],keypointsNumber:2},saturation:{zero:U.saturation,range:[-100,500],keypointsNumber:1},vibrance:{zero:U.vibrance,range:[-100,500],keypointsNumber:1},warmth:{zero:U.warmth,range:[-100,100],keypointsNumber:1},enhance:{zero:U.enhance,range:[0,100],keypointsNumber:1},filter:{zero:U.filter,range:[0,100],keypointsNumber:1}}),W="https://ucarecdn.com",K=Object.freeze({pubkey:"",multiple:!0,multipleMin:0,multipleMax:Number.MAX_SAFE_INTEGER,confirmUpload:!1,imgOnly:!1,accept:"",externalSourcesPreferredTypes:"",externalSourcesEmbedCss:"",store:"auto",cameraMirror:!1,cameraCapture:"",sourceList:"local, url, camera, dropbox, gdrive",topLevelOrigin:"",cloudImageEditorTabs:y(H),maxLocalFileSizeBytes:0,thumbSize:76,showEmptyList:!1,useLocalImageEditor:!1,useCloudImageEditor:!0,removeCopyright:!1,cropPreset:"",imageShrink:"",modalScrollLock:!0,modalBackdropStrokes:!1,sourceListWrap:!0,remoteTabSessionKey:"",cdnCname:W,cdnCnamePrefixed:"https://ucarecd.net",baseUrl:"https://upload.uploadcare.com",socialBaseUrl:"https://social.uploadcare.com",secureSignature:"",secureExpire:"",secureDeliveryProxy:"",retryThrottledRequestMaxTimes:10,retryNetworkErrorMaxTimes:3,multipartMinFileSize:0x1900000,multipartChunkSize:5242880,maxConcurrentRequests:10,multipartMaxConcurrentRequests:4,multipartMaxAttempts:3,checkForUrlDuplicates:!1,saveUrlForRecurrentUploads:!1,groupOutput:!1,userAgentIntegration:"",debug:!1,metadata:null,localeName:"en",localeDefinitionOverride:null,secureUploadsExpireThreshold:6e5,secureUploadsSignatureResolver:null,secureDeliveryProxyUrlResolver:null,iconHrefResolver:null,fileValidators:[],collectionValidators:[],validationTimeout:15e3,validationConcurrency:100,cameraModes:"photo, video",defaultCameraMode:null,enableAudioRecording:!0,enableVideoRecording:null,maxVideoRecordingDuration:null,mediaRecorderOptions:null,filesViewMode:"list",gridShowFileNames:!1,cloudImageEditorAutoOpen:!1,cloudImageEditorMaskHref:null,testMode:!1,qualityInsights:!0}),Q=(e,t)=>new Intl.PluralRules(e).select(t),Y=e=>e,X="plural:";function J(e,t={},i={}){let{openToken:s="{{",closeToken:r="}}",transform:a=Y}=i;for(let i in t){let o=t[i],l=null!=o?o.toString():void 0,n="string"==typeof l?a(l):String(l);e=e.replaceAll(s+i+r,n)}return e}var ee="--uploadcare-blocks-window-height",et=class e{static clientsRegistry=new Set;static flush=v(()=>{document.documentElement.style.setProperty(ee,`${window.innerHeight}px`)},100);static registerClient(t){0===e.clientsRegistry.size&&e.attachTracker(),e.clientsRegistry.add(t)}static unregisterClient(t){e.clientsRegistry.delete(t),0===e.clientsRegistry.size&&e.detachTracker()}static attachTracker(){window.addEventListener("resize",e.flush,{passive:!0,capture:!0}),e.flush()}static detachTracker(){window.removeEventListener("resize",e.flush,{capture:!0}),document.documentElement.style.removeProperty(ee)}},ei=()=>({}),es=e=>({...ei(),"*currentActivity":null,"*currentActivityParams":{},"*history":[],"*historyBack":null,"*closeModal":()=>{e.modalManager?.close(e.$["*currentActivity"]),e.set$({"*currentActivity":null})}}),er=e=>({...es(e),"*commonProgress":0,"*uploadList":[],"*uploadQueue":new a.op(1),"*collectionErrors":[],"*collectionState":null,"*groupInfo":null,"*uploadTrigger":new Set,"*secureUploadsManager":null}),ea={"locale-id":"en","social-source-lang":"en","upload-file":"Upload file","upload-files":"Upload files","choose-file":"Choose file","choose-files":"Choose files","drop-files-here":"Drop files here","select-file-source":"Select file source",selected:"Selected",upload:"Upload","add-more":"Add more",cancel:"Cancel","start-from-cancel":"Cancel",clear:"Clear","camera-shot":"Shot","upload-url":"Import","upload-url-placeholder":"Paste link here","edit-image":"Edit image","edit-detail":"Details",back:"Back",done:"Done",ok:"Ok","remove-from-list":"Remove",no:"No",yes:"Yes","confirm-your-action":"Confirm your action","are-you-sure":"Are you sure?","selected-count":"{{count}} of {{total}} selected","select-all":"Select all","deselect-all":"Deselect all","upload-error":"Upload error","validation-error":"Validation error","no-files":"No files selected",browse:"Browse","not-uploaded-yet":"Not uploaded yet...",file__one:"file",file__other:"files",error__one:"error",error__other:"errors","header-uploading":"Uploading {{count}} {{plural:file(count)}}","header-failed":"{{count}} {{plural:error(count)}}","header-succeed":"{{count}} {{plural:file(count)}} uploaded","header-total":"{{count}} {{plural:file(count)}} selected","src-type-local":"From device","src-type-from-url":"From link","src-type-camera":"Camera","src-type-mobile-video-camera":"Video","src-type-mobile-photo-camera":"Photo","src-type-draw":"Draw","src-type-facebook":"Facebook","src-type-dropbox":"Dropbox","src-type-gdrive":"Google Drive","src-type-ngdrive":"Google Drive","src-type-gphotos":"Google Photos","src-type-flickr":"Flickr","src-type-vk":"VK","src-type-evernote":"Evernote","src-type-box":"Box","src-type-onedrive":"OneDrive","src-type-huddle":"Huddle","src-type-other":"Other","caption-from-url":"Import from link","caption-camera":"Camera","caption-draw":"Draw","caption-edit-file":"Edit file","file-no-name":"No name...","toggle-fullscreen":"Toggle fullscreen","toggle-guides":"Toggle guides",rotate:"Rotate","flip-vertical":"Flip vertical","flip-horizontal":"Flip horizontal",apply:"Apply",brightness:"Brightness",contrast:"Contrast",saturation:"Saturation",exposure:"Exposure",gamma:"Gamma",vibrance:"Vibrance",warmth:"Warmth",enhance:"Enhance",original:"Original",resize:"Resize image",crop:"Crop","select-color":"Select color",text:"Text",draw:"Draw","cancel-edit":"Cancel edit","tab-view":"Preview","tab-details":"Details","file-name":"Name","file-size":"Size","cdn-url":"CDN URL","file-size-unknown":"Unknown","camera-permissions-denied":"Camera access denied","camera-permissions-prompt":"Please allow access to the camera","camera-permissions-request":"Request access","files-count-limit-error-title":"Files count limit overflow","files-count-limit-error-too-few":"You’ve chosen {{total}} {{plural:file(total)}}. At least {{min}} {{plural:file(min)}} required.","files-count-limit-error-too-many":"You’ve chosen too many files. {{max}} {{plural:file(max)}} is maximum.","files-max-size-limit-error":"File is too big. Max file size is {{maxFileSize}}.","has-validation-errors":"File validation error occurred. Please, check your files before upload.","images-only-accepted":"Only image files are accepted.","file-type-not-allowed":"Uploading of these file types is not allowed.","some-files-were-not-uploaded":"Some files were not uploaded.","file-item-edit-button":"Edit","file-item-remove-button":"Remove","a11y-editor-tab-filters":"Filters","a11y-editor-tab-tuning":"Tuning","a11y-editor-tab-crop":"Crop","a11y-activity-header-button-close":"Close",flip:"Flip",mirror:"Mirror","a11y-cloud-editor-apply-filter":"Apply {{name}} filter","a11y-cloud-editor-apply-crop":"Apply {{name}} operation","a11y-cloud-editor-apply-tuning":"Apply {{name}} tuning","a11y-cloud-editor-apply-aspect-ratio":"Apply operation {{name}} {{value}}",finished:"Finished",failed:"Failed",uploading:"Uploading",idle:"Idle","a11y-file-item-status":"File {{fileName}} in status {{status}}","waiting-for":"Waiting for {{source}}","queued-uploading":"Queued for upload","queued-validation":"Queued for validation",validation:"Validating","crop-to-shape":"Crop to {{value}}",custom:"Freeform","freeform-crop":"Freeform crop"},eo=new Map,el=new Map,en=(e,t)=>{eo.has(e)&&console.log(`Locale ${e} is already defined. Overwriting...`),eo.set(e,{...ea,...t})},ec=(e,t)=>{if("function"==typeof t)el.set(e,t);else en(e,t)},ed=async e=>{if(!eo.has(e)){if(!el.has(e))throw Error(`Locale ${e} is not defined`);let t=el.get(e);en(e,await t())}return eo.get(e)};ec("en",ea);var eh=e=>`*l10n/${e}`,eu=class{_blockInstance=null;_localeName="";_callbacks=new Set;_boundBlocks=new Map;constructor(e){for(let[t,i]of(this._blockInstance=e,Object.entries(ea))){let e=!this._blockInstance.has(eh(t))||!this._blockInstance.$[eh(t)];this._blockInstance.add(eh(t),i,e)}setTimeout(()=>{e.subConfigValue("localeName",async e=>{if(!this._blockInstance||!e)return;this._localeName=e;let t=await ed(e);if("en"!==e&&this._localeName!==e)return;let i=this._blockInstance.cfg.localeDefinitionOverride?.[e];for(let[e,s]of Object.entries(t)){let t=i?.[e];for(let i of(this._blockInstance.add(eh(e),t??s,!0),this._callbacks))i()}}),e.subConfigValue("localeDefinitionOverride",e=>{if(!e)return;let t=e[this._localeName];if(t)for(let[e,i]of Object.entries(t))for(let t of(this._blockInstance?.add(eh(e),i,!0),this._callbacks))t()})})}onLocaleChange(e){let t=v(e,0);return this._callbacks.add(t),()=>{this._callbacks.delete(t)}}bindL10n(e,t,i){e.$[t]=i(),this._boundBlocks.has(e)||this._boundBlocks.set(e,new Map),this._boundBlocks.get(e)?.get(t)?.();let s=this.onLocaleChange(()=>{e.$[t]=i()});this._boundBlocks.get(e)?.set(t,s)}destroyL10nBindings(e){let t=this._boundBlocks.get(e);if(t){for(let e of t.values())e();this._boundBlocks.delete(e)}}destroy(){this._callbacks.clear()}};function ep(e,t){[...e.querySelectorAll("[l10n]")].forEach(e=>{let i=e.getAttribute("l10n");if(i)for(let s of i.split(";"))s&&em(e,s,t)})}var em=(e,t,i)=>{let s="textContent",r=!1;if(t.includes(":")){let e=t.split(":");if(2!==e.length)return void console.warn(`l10n attribute value should be in format "property:key" or "key". Found: ${t}`);s=e[0],t=e[1],s.startsWith("@")&&(s=s.slice(1),r=!0)}let a=t;i.has(a)&&i.sub(a,t=>{if(!t)return;i.l10nProcessorSubs.has(a)||i.l10nProcessorSubs.set(a,new Set);let r=i.l10nProcessorSubs.get(a);r?.forEach(e=>{e.remove(),r.delete(e),i.allSubs.delete(e)});let o=eh(t).replace("*","");i.nodeCtx.has(o)||i.nodeCtx.add(o,t);let l=i.nodeCtx.sub(o,()=>{e[s]=i.l10n(t)});r?.add(l),i.allSubs.add(l),e.removeAttribute("l10n")});let o=eh(t);i.has(o)||i.add(o,""),i.sub(o,()=>{r?e.setAttribute(s,i.l10n(t)):e[s]=i.l10n(t)}),e.removeAttribute("l10n")},eg=class{_listeners=new Map;_scope=[];addEventListener(e,t){let i=e=>{let i=e.target;i instanceof Node&&this._scope.some(e=>e===i||e.contains(i))&&t(e)};this._listeners.set(t,i),window.addEventListener(e,i)}removeEventListener(e,t){let i=this._listeners.get(t);i&&window.removeEventListener(e,i),this._listeners.delete(t)}get CustomEvent(){return window.CustomEvent}get document(){return window.document}get navigator(){return window.navigator}registerScope(e){this._scope.push(e)}destroy(){for(let e of(this._scope=[],this._listeners.values()))window.removeEventListener("keydown",e),window.removeEventListener("keyup",e);this._listeners.clear()}},eb=class{_destroyKeyUX;_scopedWindow;constructor(){this._scopedWindow=new eg,this._destroyKeyUX=(0,o.J5)(this._scopedWindow,[(0,l.o)(),(0,n.A)("is-pressed"),(0,c.V)(),(0,d.j)()])}registerBlock(e){this._scopedWindow.registerScope(e)}destroy(){this._destroyKeyUX?.(),this._scopedWindow.destroy()}},ef=Object.freeze({ADD:"modal:add",DELETE:"modal:delete",OPEN:"modal:open",CLOSE:"modal:close",CLOSE_ALL:"modal:closeAll",DESTROY:"modal:destroy"}),ev=class{_modals=new Map;_activeModals=new Set;_subscribers=new Map;_block;constructor(e){this._block=e}_debugPrint(...e){this._block.debugPrint("[modal-manager]",...e)}registerModal(e,t){this._modals.set(e,t),this._notify(ef.ADD,{id:e,modal:t})}deleteModal(e){if(!this._modals.has(e))return!1;let t=this._modals.get(e);return this._modals.delete(e),this._activeModals.delete(e),this._notify(ef.DELETE,{id:e,modal:t}),!0}open(e){if(!this._modals.has(e))return this._debugPrint(`Modal with ID "${e}" not found`),!1;let t=this._modals.get(e);return this._activeModals.add(e),this._notify(ef.OPEN,{modal:t,id:e}),!0}close(e){if(!this._modals.has(e)||!this._activeModals.has(e))return this._debugPrint(`Modal with ID "${e}" not found or not active`),!1;let t=this._modals.get(e);return this._activeModals.delete(e),this._notify(ef.CLOSE,{id:e,modal:t}),!0}toggle(e){return this._modals.has(e)?this._activeModals.has(e)?this.close(e):this.open(e):(this._debugPrint(`Modal with ID "${e}" not found`),!1)}get hasActiveModals(){return this._activeModals.size>0}back(){if(0===this._activeModals.size)return this._debugPrint("No active modals to go back from"),!1;let e=Array.from(this._activeModals).pop();return!!e&&this.close(e)}closeAll(){let e=this._activeModals.size;return this._activeModals.clear(),this._notify(ef.CLOSE_ALL,{}),e}subscribe(e,t){return this._subscribers.has(e)||this._subscribers.set(e,new Set),this._subscribers.get(e)?.add(t),()=>this.unsubscribe(e,t)}unsubscribe(e,t){this._subscribers.has(e)&&this._subscribers.get(e)?.delete(t)}_notify(e,t){if(this._subscribers.has(e))for(let i of this._subscribers.get(e)??new Set)try{i(t)}catch(e){this._block.telemetryManager.sendEventError(e,"modal subscriber"),this._debugPrint("Error in modal subscriber:",e)}}destroy(){this.closeAll(),this._modals.clear(),this._subscribers.clear(),this._notify(ef.DESTROY,{})}},e_="blocks",ey="1.24.4",ew=class{_sessionId=crypto.randomUUID();_telemetryInstance;_block;_config=structuredClone(K);_initialized=!1;_lastPayload=null;_queue;constructor(e){for(let t of(this._block=e,this._telemetryInstance=new h.T,this._queue=new a.op(10),Object.keys(this._config)))this._block.subConfigValue(t,e=>{this._initialized&&this._config[t]!==e&&this.sendEvent({eventType:g.CHANGE_CONFIG}),this._setConfig(t,e)})}_init(e){e!==g.INIT_SOLUTION||this._initialized||(this._initialized=!0)}_setConfig(e,t){this._config[e]!==t&&(this._config[e]=t)}_formattingPayload(e){let t=e.payload?{...e.payload}:{};t.activity&&(t.activity=void 0);let i={...e};return(e.eventType===g.INIT_SOLUTION||e.eventType===g.CHANGE_CONFIG)&&(i.config=this._config),{...i,appVersion:ey,appName:e_,sessionId:this._sessionId,component:this._solution,activity:this._activity,projectPubkey:this._config.pubkey,userAgent:navigator.userAgent,eventType:i.eventType??"",eventTimestamp:this._timestamp,payload:{...t}}}_excludedEvents(e){return!!(e&&[b.CHANGE,b.COMMON_UPLOAD_PROGRESS,b.FILE_ADDED,b.FILE_REMOVED,b.FILE_UPLOAD_START,b.FILE_UPLOAD_PROGRESS,b.FILE_UPLOAD_SUCCESS,b.FILE_UPLOAD_FAILED].includes(e))}sendEvent(e){let t=this._formattingPayload({eventType:e.eventType,payload:e.payload,config:e.config});this._init(e.eventType),!this._excludedEvents(e.eventType)&&(this._lastPayload&&this._checkObj(this._lastPayload,t)||this._queue.add(async()=>{this._lastPayload=t,await this._telemetryInstance.sendEvent(t)}))}sendEventError(e,t="unknown"){this.sendEvent({eventType:g.ERROR_EVENT,payload:{metadata:{event:"error",text:`Error in ${t}`,error:e.message}}})}sendEventCloudImageEditor(e,t,i={}){this.sendEvent({eventType:g.ACTION_EVENT,payload:{metadata:{tabId:t,node:e.currentTarget?.tagName,event:e.type,...i}}})}_checkObj(e,t){if(JSON.stringify(e)===JSON.stringify(t))return!0;if("object"!=typeof e||"object"!=typeof t||null==e||null==t)return!1;let i=Object.keys(e),s=Object.keys(t);if(i.length!==s.length)return!1;for(let s of i)if(!Object.hasOwn(t,s)||!this._checkObj(e[s],t[s]))return!1;return!0}get _timestamp(){return Date.now()}get _solution(){if(!this._block.has("*solution"))return null;let e=this._block.$["*solution"];return e?e.toLowerCase():null}get _activity(){return this._block.has("*currentActivity")?this._block.$["*currentActivity"]??null:null}},eC=e=>`*cfg/${e}`;function eE(e,t){let i=e.querySelectorAll("[data-testid]");if(0===i.length)return;let s=new WeakMap;for(let e of i){let t=e.getAttribute("data-testid");t&&s.set(e,t)}t.subConfigValue("testMode",e=>{if(!e){for(let e of i)e.removeAttribute("data-testid");return}let r=t.testId;for(let e of i){let t=s.get(e);t&&e.setAttribute("data-testid",`${r}--${t}`)}})}var eA=class extends r.$G{__cfgProxy;l10nProcessorSubs=new Map;static StateConsumerScope=null;static styleAttrs=[];requireCtxName=!1;activityType=null;init$=ei();l10n(e,t={}){if(!e)return"";let i=this.$[eh(e)]||e;for(let e of function(e){let t=[],i=e.indexOf("{{");for(;-1!==i;){let s=e.indexOf("}}",i);if(-1===s)break;let r=e.substring(i+2,s);if(r.startsWith(X)){let a=e.substring(i+2,s).replace(X,""),o=a.substring(0,a.indexOf("(")),l=a.substring(a.indexOf("(")+1,a.indexOf(")"));t.push({variable:r,pluralKey:o,countVariable:l})}i=e.indexOf("{{",s)}return t}(i))t[e.variable]=this.pluralize(e.pluralKey,Number(t[e.countVariable]));return J(i,t)}pluralize(e,t){let i=Q(this.l10n("locale-id")||"en",t);return this.l10n(`${e}__${i}`)}bindL10n(e,t){this.localeManager?.bindL10n(this,e,t)}constructor(){super(),this.addTemplateProcessor(ep),this.addTemplateProcessor(eE)}emit(e,t,i){let s=this.has("*eventEmitter")?this.$["*eventEmitter"]:void 0;s&&(s.emit(e,t,i),this.telemetryManager.sendEvent({eventType:e,payload:"function"==typeof t?t():t}))}hasBlockInCtx(e){for(let t of this.blocksRegistry)if(e(t))return!0;return!1}setOrAddState(e,t){this.add$({[e]:t},!0)}connectedCallback(){this.constructor.styleAttrs.forEach(e=>{this.setAttribute(e,"")}),this.hasAttribute("retpl")&&(this.constructor.template=null,this.processInnerHtml=!0),this.requireCtxName?(({element:e,attribute:t,onSuccess:i,onTimeout:s,timeout:r=300})=>{let a=e.getAttribute(t);if(null!==a)return i(a);let o=new MutationObserver(e=>{let t=e[e.length-1];t&&n(t)});o.observe(e,{attributes:!0,attributeFilter:[t]});let l=window.setTimeout(()=>{o.disconnect(),s()},r),n=s=>{let r=e.getAttribute(t);"attributes"===s.type&&s.attributeName===t&&null!==r&&(window.clearTimeout(l),o.disconnect(),i(r))}})({element:this,attribute:"ctx-name",onSuccess:()=>{super.connectedCallback()},onTimeout:()=>{console.error("Attribute `ctx-name` is required and it is not set.")}}):super.connectedCallback(),et.registerClient(this)}disconnectedCallback(){super.disconnectedCallback(),et.unregisterClient(this)}initCallback(){this.has("*blocksRegistry")||this.add("*blocksRegistry",new Set),this.$["*blocksRegistry"].add(this),this.has("*eventEmitter")||this.add("*eventEmitter",new f(this.debugPrint.bind(this))),this.has("*localeManager")||this.add("*localeManager",new eu(this)),this.cfg.qualityInsights&&!this.has("*telemetryManager")&&this.add("*telemetryManager",new ew(this)),this.has("*a11y")||this.add("*a11y",new eb),this.has("*modalManager")||this.add("*modalManager",new ev(this)),this.sub(eh("locale-id"),e=>{let t=(e=>{let t=new Intl.Locale(e),i="ltr",s=t.getTextInfo?.().direction;return s?i=s:t.textInfo?.direction&&(i=t.textInfo.direction),i})(e);this.style.direction="ltr"===t?"":t}),this.subConfigValue("testMode",e=>{if(!e||!this.testId)return void this.removeAttribute("data-testid");this.setAttribute("data-testid",this.testId)})}get testId(){return window.customElements.getName(this.constructor)}get modalManager(){return this.has("*modalManager")?this.$["*modalManager"]:void 0}get telemetryManager(){return this.cfg.qualityInsights?this.has("*telemetryManager")&&this.$["*telemetryManager"]:{sendEvent:()=>{},sendEventCloudImageEditor:()=>{},sendEventError:()=>{}}}get localeManager(){return this.has("*localeManager")?this.$["*localeManager"]:null}get a11y(){return this.has("*a11y")?this.$["*a11y"]:null}get blocksRegistry(){return this.$["*blocksRegistry"]}destroyCallback(){super.destroyCallback();let e=this.blocksRegistry;e?.delete(this),this.localeManager?.destroyL10nBindings(this),this.l10nProcessorSubs=new Map,r.B_.deleteCtx(this),e?.size===0&&setTimeout(()=>{this.destroyCtxCallback()},0)}destroyCtxCallback(){r.B_.deleteCtx(this.ctxName),this.localeManager?.destroy(),this.modalManager?.destroy()}async proxyUrl(e){if(this.cfg.secureDeliveryProxy&&this.cfg.secureDeliveryProxyUrlResolver&&console.warn("Both secureDeliveryProxy and secureDeliveryProxyUrlResolver are set. The secureDeliveryProxyUrlResolver will be used."),this.cfg.secureDeliveryProxyUrlResolver)try{return await this.cfg.secureDeliveryProxyUrlResolver(e,{uuid:$(e),cdnUrlModifiers:x(e),fileName:A(e)})}catch(t){return console.error("Failed to resolve secure delivery proxy URL. Falling back to the default URL.",t),this.telemetryManager.sendEventError(t,"secureDeliveryProxyUrlResolver. Failed to resolve secure delivery proxy URL. Falling back to the default URL."),e}return this.cfg.secureDeliveryProxy?J(this.cfg.secureDeliveryProxy,{previewUrl:e},{transform:e=>window.encodeURIComponent(e)}):e}get cfg(){if(!this.__cfgProxy){let e=Object.create(null);this.__cfgProxy=new Proxy(e,{set:(e,t,i)=>{if("string"!=typeof t)return!1;let s=eC(t);return this.has(s)||this.add(s,K[t]),this.$[s]=i,!0},get:(e,t)=>{let i=eC(t);return this.has(i)||this.add(i,K[t]),this.$[eC(t)]}})}return this.__cfgProxy}subConfigValue(e,t){let i=eC(e);this.has(i)||this.add(i,K[e]),this.sub(i,t)}debugPrint(...e){if(!this.cfg.debug)return;let t=e;"function"==typeof e?.[0]&&(t=(0,e[0])()),console.log(`[${this.ctxName}]`,...t)}static reg(e){if(!e)return void super.reg();e.startsWith("uc-")&&super.reg(e)}},e$="active",ex="___ACTIVITY_IS_ACTIVE___",eI=class e extends eA{historyTracked=!1;[ex];init$=es(this);_debouncedHistoryFlush=v(this._historyFlush.bind(this),10);_deactivate(){let t=e._activityCallbacks.get(this);this[ex]=!1,this.removeAttribute(e$),t?.deactivateCallback?.()}_activate(){let t=e._activityCallbacks.get(this);this.$["*historyBack"]=this.historyBack.bind(this),this[ex]=!0,this.setAttribute(e$,""),t?.activateCallback?.(),this._debouncedHistoryFlush(),this.emit(b.ACTIVITY_CHANGE,{activity:this.activityType})}initCallback(){super.initCallback(),this.activityType&&(this.hasAttribute("activity")||this.setAttribute("activity",this.activityType),this.sub("*currentActivity",e=>{try{this.activityType!==e&&this[ex]?this._deactivate():this.activityType!==e||this[ex]||this._activate()}catch(e){this.telemetryManager.sendEventError(e,`activity "${this.activityType}"`),console.error(`Error in activity "${this.activityType}". `,e),this.$["*currentActivity"]=this.$["*history"][this.$["*history"].length-1]??null}e||(this.$["*history"]=[])}))}_historyFlush(){let e=this.$["*history"];e&&(e.length>10&&(e=e.slice(e.length-11,e.length-1)),this.historyTracked&&e[e.length-1]!==this.activityType&&e.push(this.activityType),this.$["*history"]=e)}_isActivityRegistered(){return!!this.activityType&&e._activityCallbacks.has(this)}static _activityCallbacks=new Map;static activities;get isActivityActive(){return!!this[ex]}get couldOpenActivity(){return!0}registerActivity(t,i={}){let{onActivate:s,onDeactivate:r}=i;e._activityCallbacks.set(this,{activateCallback:s,deactivateCallback:r})}unregisterActivity(){this.isActivityActive&&this._deactivate(),e._activityCallbacks.delete(this)}destroyCallback(){super.destroyCallback(),this._isActivityRegistered()&&this.unregisterActivity();let t=this.$["*currentActivity"];[...this.blocksRegistry].find(i=>i instanceof e&&i.activityType===t)||(this.$["*currentActivity"]=null,this.modalManager?.closeAll())}get activityKey(){return this.ctxName+this.activityType}get activityParams(){return this.$["*currentActivityParams"]}get initActivity(){return this.getCssData("--cfg-init-activity")}get doneActivity(){return this.getCssData("--cfg-done-activity")}historyBack(){let e=this.$["*history"];if(e){let t=e.pop();for(;t===this.activityType;)t=e.pop();let i=!!t;if(t){let e=[...this.blocksRegistry].find(e=>e.activityType===t);i=e?.couldOpenActivity??!1}(t=i?t:void 0)&&this.modalManager?.open(t),this.$["*currentActivity"]=t,this.$["*history"]=e,t||this.modalManager?.closeAll()}}};function ek(e){for(let t in e){let i=[...t].reduce((e,t)=>(t.toUpperCase()===t&&(t=`-${t.toLowerCase()}`),e+=t),"");i.startsWith("-")&&(i=i.replace("-","")),i.startsWith("uc-")||(i=`uc-${i}`),e[t].reg&&e[t].reg(i)}}function eM(e,t=!1){return new Promise((i,s)=>{if("object"!=typeof document)return void i(null);if("object"==typeof window&&window.UC)return void i(window.UC);let r=document.createElement("script");r.async=!0,r.src=e,r.onerror=()=>{s()},r.onload=()=>{let e=window.UC;t&&ek(e),i(e)},document.head.appendChild(r)})}eI.activities=Object.freeze({START_FROM:"start-from",CAMERA:"camera",DRAW:"draw",UPLOAD_LIST:"upload-list",URL:"url",CLOUD_IMG_EDIT:"cloud-image-edit",EXTERNAL:"external"});var eT=class extends eA{static styleAttrs=["uc-wgt-common"];requireCtxName=!0;init$=(s=this,{...er(s),"*solution":null});static _template="";initCallback(){super.initCallback(),this.a11y?.registerBlock(this)}static set template(e){this._template=`${"<svg width='0' height='0' style='position:absolute'><symbol viewBox='0 0 24 24' id='uc-icon-about' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M11.152 14.12v.1h1.523v-.1c.007-.409.053-.752.138-1.028.086-.277.22-.517.405-.72.188-.202.434-.397.735-.586.32-.191.593-.412.82-.66.232-.249.41-.531.533-.847.125-.32.187-.678.187-1.076 0-.579-.137-1.085-.41-1.518a2.717 2.717 0 0 0-1.14-1.018c-.49-.245-1.062-.367-1.715-.367-.597 0-1.142.114-1.636.34-.49.228-.884.564-1.182 1.008-.299.44-.46.98-.485 1.619h1.62c.024-.377.118-.684.282-.922a1.48 1.48 0 0 1 .617-.532c.25-.114.51-.17.784-.17.301 0 .575.063.82.191.248.124.447.302.597.533.149.23.223.504.223.82 0 .263-.05.502-.149.72a1.91 1.91 0 0 1-.405.574 3.48 3.48 0 0 1-.575.453 4.22 4.22 0 0 0-.847.66c-.234.242-.415.558-.543.949-.125.39-.19.916-.197 1.577Zm.053 3.03c.21.206.46.31.75.31.196 0 .374-.049.534-.144a1.1 1.1 0 0 0 .383-.384c.1-.163.15-.343.15-.538a1 1 0 0 0-.32-.746 1.019 1.019 0 0 0-.746-.314c-.291 0-.542.105-.751.314-.21.206-.314.455-.314.746 0 .295.104.547.314.756ZM24 12c0 6.627-5.373 12-12 12S0 18.627 0 12 5.373 0 12 0s12 5.373 12 12Zm-1.5 0c0 5.799-4.701 10.5-10.5 10.5S1.5 17.799 1.5 12 6.201 1.5 12 1.5 22.5 6.201 22.5 12Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-add' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M12.75 21a.75.75 0 0 1-1.5 0v-8.25H3a.75.75 0 0 1 0-1.5h8.25V3a.75.75 0 0 1 1.5 0v8.25H21a.75.75 0 0 1 0 1.5h-8.25V21Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-arrow-down' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M11.5 23.03a.75.75 0 0 0 .999 0l9.29-8.276a.75.75 0 0 0-.998-1.12l-8.042 7.164V1.53a.75.75 0 0 0-1.5 0v19.267l-8.04-7.163a.75.75 0 0 0-.998 1.12z'/></symbol><symbol fill='none' viewBox='0 0 9 6' id='uc-icon-arrow-dropdown' xmlns='http://www.w3.org/2000/svg'><path stroke='currentColor' d='m1.5 1.667 3 2.666 3-2.666' opacity='.5'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-aspect-ratio' xmlns='http://www.w3.org/2000/svg'><path stroke='currentColor' d='M7.395 22.5H2.454v-5.25m14.824 5.25h4.94v-5.25m0-10.5V1.5h-4.94m-9.883 0H2.454v5.25'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-back' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M20.251 12a.75.75 0 0 1-.75.75H6.067l5.72 5.85a.75.75 0 1 1-1.072 1.05L4.136 12.92a1.292 1.292 0 0 1 0-1.842l6.579-6.728a.75.75 0 1 1 1.072 1.048l-5.72 5.851H19.5a.75.75 0 0 1 .75.75Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-badge-error' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M13.6 18.4a1.6 1.6 0 1 1-3.2 0 1.6 1.6 0 0 1 3.2 0zM12 4.5A1.5 1.5 0 0 1 13.5 6v7a1.5 1.5 0 0 1-3 0V6A1.5 1.5 0 0 1 12 4.5z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-badge-success' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='m10.5 18.204 7.6-8.183a1.5 1.5 0 0 0-2.2-2.042l-5.4 5.817-2.4-2.586a1.5 1.5 0 1 0-2.2 2.041l4.6 4.953Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-box' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M1.01 4.148a.75.75 0 0 1 .75.75v4.348a4.437 4.437 0 0 1 2.988-1.153c1.734 0 3.23.992 3.978 2.438a4.478 4.478 0 0 1 3.978-2.438c2.49 0 4.488 2.044 4.488 4.543 0 2.5-1.999 4.544-4.488 4.544a4.478 4.478 0 0 1-3.978-2.438 4.478 4.478 0 0 1-3.978 2.438C2.26 17.18.26 15.135.26 12.636V4.898a.75.75 0 0 1 .75-.75Zm.75 8.488c0 1.692 1.348 3.044 2.988 3.044s2.989-1.352 2.989-3.044c0-1.691-1.349-3.043-2.989-3.043S1.76 10.945 1.76 12.636Zm10.944-3.043c-1.64 0-2.988 1.352-2.988 3.043 0 1.692 1.348 3.044 2.988 3.044s2.988-1.352 2.988-3.044c0-1.69-1.348-3.043-2.988-3.043Zm4.328-1.23a.75.75 0 0 1 1.052.128l2.333 2.983 2.333-2.983a.75.75 0 0 1 1.181.924l-2.562 3.277 2.562 3.276a.75.75 0 1 1-1.181.924l-2.333-2.983-2.333 2.983a.75.75 0 1 1-1.181-.924l2.562-3.276-2.562-3.277a.75.75 0 0 1 .129-1.052Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-camera' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M7.65 2.55a.75.75 0 0 1 .6-.3h7.5a.75.75 0 0 1 .6.3l2.025 2.7H21a3 3 0 0 1 3 3v10.5a3 3 0 0 1-3 3H3a3 3 0 0 1-3-3V8.25a3 3 0 0 1 3-3h2.625zm.975 1.2L6.6 6.45a.75.75 0 0 1-.6.3H3a1.5 1.5 0 0 0-1.5 1.5v10.5a1.5 1.5 0 0 0 1.5 1.5h18a1.5 1.5 0 0 0 1.5-1.5V8.25a1.5 1.5 0 0 0-1.5-1.5h-3a.75.75 0 0 1-.6-.3l-2.025-2.7zm3.375 6a3.375 3.375 0 1 0 0 6.75 3.375 3.375 0 0 0 0-6.75zm-4.875 3.375a4.875 4.875 0 1 1 9.75 0 4.875 4.875 0 0 1-9.75 0z'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-camera-full' xmlns='http://www.w3.org/2000/svg'><path fill-rule='evenodd' clip-rule='evenodd' d='M2 4.667a2 2 0 0 0-2 2V16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6.667a2 2 0 0 0-2-2h-2.667l-2-2.667H6.667l-2 2.667H2Zm8 10a3.667 3.667 0 1 0 0-7.334 3.667 3.667 0 0 0 0 7.334Z' fill='currentColor'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-close' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M4.604 4.604a.75.75 0 0 1 1.06 0L12 10.939l6.335-6.335a.75.75 0 1 1 1.061 1.06L13.061 12l6.335 6.335a.75.75 0 1 1-1.06 1.061L12 13.061l-6.335 6.335a.75.75 0 0 1-1.061-1.06L10.939 12 4.604 5.665a.75.75 0 0 1 0-1.061z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-collapse' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M3.116 12a.75.75 0 0 1 .75-.75h16.268a.75.75 0 0 1 0 1.5H3.866a.75.75 0 0 1-.75-.75Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-default' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M11.501.392a.75.75 0 0 1 .998 0l6.704 5.972a.75.75 0 0 1-.998 1.12l-5.455-4.86v13.439a.75.75 0 0 1-1.5 0V2.625l-5.454 4.86a.75.75 0 1 1-.998-1.12zM.857 16.73a.75.75 0 0 1 .75.75v4.914h20.786v-4.914a.75.75 0 0 1 1.5 0v5.664a.75.75 0 0 1-.75.75H.857a.75.75 0 0 1-.75-.75v-5.664a.75.75 0 0 1 .75-.75z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-dropbox' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M6.019 1.92a.75.75 0 0 1 .806 0L12 5.219l5.176-3.297a.75.75 0 0 1 .806 0l5.577 3.553a.75.75 0 0 1 0 1.265l-4.574 2.914 4.574 2.914a.75.75 0 0 1 0 1.265l-5.577 3.554a.75.75 0 0 1-.806 0L12 14.089l-5.175 3.297a.75.75 0 0 1-.806 0L.44 13.833a.75.75 0 0 1 0-1.266l4.575-2.914L.44 6.74a.75.75 0 0 1 0-1.265zm.403 8.616L2.24 13.2l4.182 2.664 4.181-2.664zm6.975 2.664 4.182 2.664L21.76 13.2l-4.181-2.664zm2.776-3.547L12 12.311 7.828 9.653 12 6.995zm1.406-.882 4.181-2.664-4.181-2.664-4.182 2.664zm-6.976-2.664L6.422 3.443 2.24 6.107 6.422 8.77zM5.791 18.544a.75.75 0 0 1 1.035-.23l5.175 3.297 5.175-3.297a.75.75 0 1 1 .806 1.265l-5.578 3.554a.75.75 0 0 1-.806 0L6.02 19.579a.75.75 0 0 1-.23-1.035z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-edit-file' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M18.558 2.804a.78.78 0 0 0-.557.235l-.008.007-2.472 2.46 3.847 3.848 2.46-2.473.004-.003a.78.78 0 0 0 0-1.108l-.004-.003-2.712-2.728a.78.78 0 0 0-.558-.235Zm-.248 7.613-3.852-3.852-8.93 8.887-1.516 5.41 5.41-1.515 8.888-8.93Zm-.636-8.934a2.28 2.28 0 0 1 2.512.505l2.702 2.717.002.002a2.278 2.278 0 0 1 0 3.234l-.002.002-12.541 12.602a.75.75 0 0 1-.33.193l-6.884 1.928a.75.75 0 0 1-.925-.924l1.928-6.885a.75.75 0 0 1 .193-.33l12.603-12.54a2.28 2.28 0 0 1 .742-.504Z' clip-rule='evenodd'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-error' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M13 13h-2V7h2m0 10h-2v-2h2M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10A10 10 0 0 0 12 2Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-evernote' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M9.804 2.27v-.048c.055-.263.313-.562.85-.562h.44c.142 0 .325.014.526.033.066.009.124.023.267.06l.13.032h.002c.319.079.515.275.644.482a1.461 1.461 0 0 1 .16.356l.004.012a.75.75 0 0 0 .603.577l1.191.207a1988.512 1988.512 0 0 0 2.332.402c.512.083 1.1.178 1.665.442.64.3 1.19.795 1.376 1.77.548 2.931.657 5.829.621 8a39.233 39.233 0 0 1-.125 2.602 17.518 17.518 0 0 1-.092.849.735.735 0 0 0-.024.112c-.378 2.705-1.269 3.796-2.04 4.27-.746.457-1.53.451-2.217.447h-.192c-.46 0-1.073-.23-1.581-.635-.518-.412-.763-.87-.763-1.217 0-.45.188-.688.355-.786.161-.095.436-.137.796.087a.75.75 0 1 0 .792-1.274c-.766-.476-1.64-.52-2.345-.108-.7.409-1.098 1.188-1.098 2.08 0 .996.634 1.84 1.329 2.392.704.56 1.638.96 2.515.96l.185.002c.667.009 1.874.025 3.007-.67 1.283-.786 2.314-2.358 2.733-5.276a4.213 4.213 0 0 0 .056-.335c.023-.184.051-.445.079-.772.055-.655.111-1.585.13-2.704.037-2.234-.074-5.239-.647-8.301v-.002c-.294-1.544-1.233-2.391-2.215-2.85-.777-.363-1.623-.496-2.129-.576a8.872 8.872 0 0 1-.25-.041l-.006-.001-1.99-.345-.761-.132a2.93 2.93 0 0 0-.182-.338A2.532 2.532 0 0 0 12.379.329l-.091-.023a3.967 3.967 0 0 0-.493-.103L11.769.2a7.846 7.846 0 0 0-.675-.04h-.44c-.733 0-1.368.284-1.795.742L2.416 7.431c-.468.428-.751 1.071-.751 1.81 0 .02 0 .041.003.062l.003.034c.017.21.038.468.096.796.107.715.275 1.47.391 1.994.029.13.055.245.075.342l.002.008c.258 1.141.641 1.94.978 2.466.168.263.323.456.444.589a2.808 2.808 0 0 0 .192.194c1.536 1.562 3.713 2.196 5.731 2.08.13-.005.35-.032.537-.073a2.627 2.627 0 0 0 .652-.24c.425-.26.75-.661.992-1.046.184-.294.342-.61.473-.915a3.8 3.8 0 0 0 .627.493 5.022 5.022 0 0 0 1.97.709l.023.002.018.003.11.016c.088.014.205.035.325.058l.056.014c.088.022.164.04.235.061a1.736 1.736 0 0 1 .145.048l.03.014c.765.34 1.302 1.09 1.302 1.871a.75.75 0 0 0 1.5 0c0-1.456-.964-2.69-2.18-3.235a3.595 3.595 0 0 0-.679-.217l-.063-.015a10.616 10.616 0 0 0-.606-.105l-.02-.003-.03-.003h-.002a3.542 3.542 0 0 1-1.331-.485c-.471-.298-.788-.692-.828-1.234a.75.75 0 0 0-1.48-.106l-.001.003-.004.017a8.23 8.23 0 0 1-.092.352 9.963 9.963 0 0 1-.298.892c-.132.34-.29.68-.47.966-.174.276-.339.454-.478.549a1.178 1.178 0 0 1-.221.072 1.949 1.949 0 0 1-.241.036h-.013l-.032.002c-1.684.1-3.423-.437-4.604-1.65a.746.746 0 0 0-.053-.05L4.84 14.6a1.348 1.348 0 0 1-.07-.073 2.99 2.99 0 0 1-.293-.392c-.242-.379-.558-1.014-.778-1.985a54.1 54.1 0 0 0-.083-.376 27.494 27.494 0 0 1-.367-1.872l-.003-.02a6.791 6.791 0 0 1-.08-.67c.004-.277.086-.475.2-.609l.067-.067a.63.63 0 0 1 .292-.145h.05c.18 0 1.095.055 2.013.115l1.207.08.534.037a.747.747 0 0 0 .052.002c.782 0 1.349-.206 1.759-.585l.005-.005c.553-.52.622-1.225.622-1.76V6.24l-.026-.565A774.97 774.97 0 0 1 9.885 4.4c-.042-.961-.081-1.939-.081-2.13ZM4.995 6.953a251.126 251.126 0 0 1 2.102.137l.508.035c.48-.004.646-.122.715-.185.07-.068.146-.209.147-.649l-.024-.548a791.69 791.69 0 0 1-.095-2.187L4.995 6.953Zm16.122 9.996Zm-5.479-5.323a.75.75 0 0 0 1.014.31 2.04 2.04 0 0 1 .304-.089 1.84 1.84 0 0 1 .544-.039c.215.023.321.06.37.085.033.016.039.026.047.04a.75.75 0 0 0 1.289-.767c-.337-.567-.906-.783-1.552-.85a3.334 3.334 0 0 0-1.002.062c-.27.056-.531.14-.705.234a.75.75 0 0 0-.31 1.014Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-expand' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='m12 8.337-8.47 8.47a.75.75 0 0 1-1.06-1.06l8.605-8.606a1.29 1.29 0 0 1 1.85 0l8.605 8.605a.75.75 0 1 1-1.06 1.06L12 8.338Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-external-source-placeholder' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M6.341 3.27a10.5 10.5 0 0 1 5.834-1.77.75.75 0 0 0 0-1.5 12 12 0 1 0 12 12 .75.75 0 0 0-1.5 0A10.5 10.5 0 1 1 6.34 3.27Zm14.145 1.48a.75.75 0 1 0-1.06-1.062L9.925 13.19V7.95a.75.75 0 1 0-1.5 0V15c0 .414.336.75.75.75h7.05a.75.75 0 0 0 0-1.5h-5.24l9.501-9.5Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-facebook' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M12 1.5C6.201 1.5 1.5 6.201 1.5 12c0 4.943 3.416 9.089 8.016 10.204v-6.108H7.383a.75.75 0 0 1-.75-.75v-3.281a.75.75 0 0 1 .75-.75h2.133V9.393c0-.958.225-2.511 1.38-3.65 1.194-1.177 3.174-1.718 6.254-1.056a.75.75 0 0 1 .592.733v2.754a.75.75 0 0 1-.75.75c-.692 0-1.203.026-1.584.082-.387.057-.578.137-.675.202-.109.073-.237.205-.237 1.029v1.078h2.39a.75.75 0 0 1 .742.866l-.516 3.281a.75.75 0 0 1-.74.634h-1.876v6.106C19.09 21.082 22.5 16.939 22.5 12c0-5.799-4.701-10.5-10.5-10.5zM0 12C0 5.373 5.373 0 12 0s12 5.373 12 12c0 5.995-4.395 10.961-10.138 11.856a.75.75 0 0 1-.866-.74v-7.77a.75.75 0 0 1 .75-.75h1.984l.28-1.781h-2.264a.75.75 0 0 1-.75-.75v-1.828c0-.829.089-1.729.9-2.274.363-.244.807-.37 1.293-.441a9.623 9.623 0 0 1 1.053-.086V6.04c-2.41-.405-3.645.132-4.293.771-.737.728-.933 1.793-.933 2.582v2.672a.75.75 0 0 1-.75.75H8.133v1.78h2.133a.75.75 0 0 1 .75.75v7.772a.75.75 0 0 1-.865.741C4.4 22.968 0 18 0 12z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-file' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M2.895 1.201c0-.473.383-.857.857-.857h8.4c.227 0 .445.09.606.251l8.4 8.4c.16.16.25.379.25.606v13.2a.857.857 0 0 1-.856.857h-16.8a.857.857 0 0 1-.857-.857zm1.714.857v19.886h15.085V10.458h-7.542a.857.857 0 0 1-.858-.857V2.058zm8.4 1.213 5.473 5.473H13.01z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-flickr' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M5.959 7.926c-2.298 0-4.14 1.834-4.14 4.073 0 2.241 1.842 4.075 4.14 4.075 2.302 0 4.145-1.834 4.145-4.075 0-2.238-1.843-4.073-4.145-4.073Zm-5.64 4.073c0-3.086 2.533-5.573 5.64-5.573 3.11 0 5.645 2.486 5.645 5.573 0 3.089-2.535 5.575-5.645 5.575-3.107 0-5.64-2.487-5.64-5.575Zm18.07-4.073c-2.301 0-4.144 1.835-4.144 4.073 0 2.24 1.843 4.075 4.145 4.075 2.299 0 4.141-1.834 4.141-4.075 0-2.239-1.842-4.073-4.141-4.073Zm-5.644 4.073c0-3.087 2.535-5.573 5.645-5.573 3.108 0 5.641 2.487 5.641 5.573 0 3.088-2.533 5.575-5.641 5.575-3.11 0-5.645-2.486-5.645-5.575Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-gdrive' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M7.736 1.818a.75.75 0 0 1 .647-.37h7.587a.75.75 0 0 1 .655.383l7.233 12.946a.75.75 0 0 1-.003.737l-3.794 6.66a.75.75 0 0 1-.651.378H4.59a.75.75 0 0 1-.651-.378l-3.794-6.66a.75.75 0 0 1 .005-.75zm.64 1.876L1.663 15.148l2.93 5.145 6.655-11.581zm3.736 6.526-2.398 4.173H14.5zm4.116 4.173h5.697L15.53 2.947H9.677zm5.685 1.5H8.852l-2.966 5.16h13.088z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-gphotos' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M12.51 0c-.702 0-1.272.57-1.272 1.273V7.35A6.381 6.381 0 0 0 0 11.489c0 .703.57 1.273 1.273 1.273H7.35A6.381 6.381 0 0 0 11.488 24c.704 0 1.274-.57 1.274-1.273V16.65A6.381 6.381 0 0 0 24 12.51c0-.703-.57-1.273-1.273-1.273H16.65A6.381 6.381 0 0 0 12.511 0Zm.252 11.232V1.53a4.857 4.857 0 0 1 0 9.702Zm-1.53.006H1.53a4.857 4.857 0 0 1 9.702 0Zm1.536 1.524a4.857 4.857 0 0 0 9.702 0h-9.702Zm-6.136 4.857c0-2.598 2.04-4.72 4.606-4.85v9.7a4.857 4.857 0 0 1-4.606-4.85Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-huddle' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M6.204 2.002c-.252.23-.357.486-.357.67V21.07c0 .15.084.505.313.812.208.28.499.477.929.477.519 0 .796-.174.956-.365.178-.212.286-.535.286-.924v-.013l.117-6.58c.004-1.725 1.419-3.883 3.867-3.883 1.33 0 2.332.581 2.987 1.364.637.762.95 1.717.95 2.526v6.47c0 .392.11.751.305.995.175.22.468.41 1.008.41.52 0 .816-.198 1.002-.437.207-.266.31-.633.31-.969V14.04c0-2.81-1.943-5.108-4.136-5.422a5.971 5.971 0 0 0-3.183.41c-.912.393-1.538.96-1.81 1.489a.75.75 0 0 1-1.417-.344v-7.5c0-.587-.47-1.031-1.242-1.031-.315 0-.638.136-.885.36ZM5.194.892A2.844 2.844 0 0 1 7.09.142c1.328 0 2.742.867 2.742 2.53v5.607a6.358 6.358 0 0 1 1.133-.629 7.47 7.47 0 0 1 3.989-.516c3.056.436 5.425 3.482 5.425 6.906v6.914c0 .602-.177 1.313-.627 1.89-.47.605-1.204 1.016-2.186 1.016-.96 0-1.698-.37-2.179-.973-.46-.575-.633-1.294-.633-1.933v-6.469c0-.456-.19-1.071-.602-1.563-.394-.471-.986-.827-1.836-.827-1.447 0-2.367 1.304-2.367 2.39v.014l-.117 6.58c-.001.64-.177 1.333-.637 1.881-.48.57-1.2.9-2.105.9-.995 0-1.7-.5-2.132-1.081-.41-.552-.61-1.217-.61-1.708V2.672c0-.707.366-1.341.847-1.78Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-info' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M11 9h2V7h-2m1 13c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m0-18A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10A10 10 0 0 0 12 2m-1 15h2v-6h-2v6Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-local' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M3 3.75a1.5 1.5 0 0 0-1.5 1.5v13.5a1.5 1.5 0 0 0 1.5 1.5h18a1.5 1.5 0 0 0 1.5-1.5V9A1.5 1.5 0 0 0 21 7.5h-9a.75.75 0 0 1-.643-.364L9.325 3.75zm-3 1.5a3 3 0 0 1 3-3h6.75a.75.75 0 0 1 .643.364L12.425 6H21a3 3 0 0 1 3 3v9.75a3 3 0 0 1-3 3H3a3 3 0 0 1-3-3z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-microphone' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' clip-rule='evenodd' d='M7.5 4.781a4.5 4.5 0 0 1 9 0v6.469a4.5 4.5 0 1 1-9 0V4.781Zm4.5-3a3 3 0 0 0-3 3v6.469a3 3 0 1 0 6 0V4.781a3 3 0 0 0-3-3Zm-8.156 8.11a.75.75 0 0 1 .75.75 7.406 7.406 0 1 0 14.812 0 .75.75 0 0 1 1.5 0 8.907 8.907 0 0 1-8.156 8.875v2.703h3.258a.75.75 0 1 1 0 1.5H7.992a.75.75 0 0 1 0-1.5h3.258v-2.703a8.907 8.907 0 0 1-8.156-8.875.75.75 0 0 1 .75-.75Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-microphone-mute' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' clip-rule='evenodd' d='M7.5 4.781a4.5 4.5 0 0 1 9 0V6l3.524-3.524a.75.75 0 1 1 1.061 1.06L5.036 19.585a.75.75 0 0 1-1.06-1.06l1.656-1.657a8.88 8.88 0 0 1-2.538-6.227.75.75 0 0 1 1.5 0c0 2.009.8 3.83 2.1 5.166l1.771-1.772A4.483 4.483 0 0 1 7.5 11.25V4.781Zm2.037 8.182L15 7.5V4.781a3 3 0 1 0-6 0v6.469c0 .637.198 1.227.537 1.713Zm10.62-3.072a.75.75 0 0 1 .75.75 8.907 8.907 0 0 1-8.157 8.875v2.703h3.258a.75.75 0 1 1 0 1.5H7.992a.75.75 0 0 1 0-1.5h3.258v-2.703a8.855 8.855 0 0 1-3.035-.811.75.75 0 1 1 .638-1.358 7.406 7.406 0 0 0 10.553-6.707.75.75 0 0 1 .75-.75ZM15 10.81a.75.75 0 0 1 1.5 0v.439a4.5 4.5 0 0 1-5 4.473.75.75 0 1 1 .166-1.491A3 3 0 0 0 15 11.25v-.44Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-mobile-photo-camera' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M7.65 2.55a.75.75 0 0 1 .6-.3h7.5a.75.75 0 0 1 .6.3l2.025 2.7H21a3 3 0 0 1 3 3v10.5a3 3 0 0 1-3 3H3a3 3 0 0 1-3-3V8.25a3 3 0 0 1 3-3h2.625zm.975 1.2L6.6 6.45a.75.75 0 0 1-.6.3H3a1.5 1.5 0 0 0-1.5 1.5v10.5a1.5 1.5 0 0 0 1.5 1.5h18a1.5 1.5 0 0 0 1.5-1.5V8.25a1.5 1.5 0 0 0-1.5-1.5h-3a.75.75 0 0 1-.6-.3l-2.025-2.7zm3.375 6a3.375 3.375 0 1 0 0 6.75 3.375 3.375 0 0 0 0-6.75zm-4.875 3.375a4.875 4.875 0 1 1 9.75 0 4.875 4.875 0 0 1-9.75 0z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-mobile-video-camera' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' clip-rule='evenodd' d='M0 6.75a3 3 0 0 1 3-3h12a3 3 0 0 1 3 3v1.078L22.873 5A.75.75 0 0 1 24 5.648v12.704a.75.75 0 0 1-1.123.65L18 16.207v1.043a3 3 0 0 1-3 3H3a3 3 0 0 1-3-3V6.75Zm18 7.728 4.5 2.58V6.95L18 9.562v4.916ZM16.5 6.75a1.5 1.5 0 0 0-1.5-1.5H3a1.5 1.5 0 0 0-1.5 1.5v10.5a1.5 1.5 0 0 0 1.5 1.5h12a1.5 1.5 0 0 0 1.5-1.5V6.75Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-ngdrive' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M7.736 1.818a.75.75 0 0 1 .647-.37h7.587a.75.75 0 0 1 .655.383l7.233 12.946a.75.75 0 0 1-.003.737l-3.794 6.66a.75.75 0 0 1-.651.378H4.59a.75.75 0 0 1-.651-.378l-3.794-6.66a.75.75 0 0 1 .005-.75zm.64 1.876L1.663 15.148l2.93 5.145 6.655-11.581zm3.736 6.526-2.398 4.173H14.5zm4.116 4.173h5.697L15.53 2.947H9.677zm5.685 1.5H8.852l-2.966 5.16h13.088z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-onedrive' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M13.616 4.147a7.689 7.689 0 0 0-7.642 3.285A6.299 6.299 0 0 0 1.455 17.3c.684.894 2.473 2.658 5.17 2.658h12.141c.95 0 1.882-.256 2.697-.743.815-.486 1.514-1.247 1.964-2.083a5.26 5.26 0 0 0-3.713-7.612 7.69 7.69 0 0 0-6.098-5.373ZM3.34 17.15c.674.63 1.761 1.308 3.284 1.308h12.142a3.76 3.76 0 0 0 2.915-1.383l-7.494-4.489L3.34 17.15Zm10.875-6.25 2.47-1.038a5.239 5.239 0 0 1 1.427-.389 6.19 6.19 0 0 0-10.3-1.952 6.338 6.338 0 0 1 2.118.813l4.285 2.567Zm4.55.033c-.512 0-1.019.104-1.489.307l-.006.003-1.414.594 6.521 3.906a3.76 3.76 0 0 0-3.357-4.8l-.254-.01ZM4.097 9.617A4.799 4.799 0 0 1 6.558 8.9c.9 0 1.84.25 2.587.713l3.4 2.037-10.17 4.28a4.799 4.799 0 0 1 1.721-6.312Z'/></symbol><symbol fill='none' viewBox='0 0 10 10' id='uc-icon-pause' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' d='M1 0h2.5v10H1zM6.5 0H9v10H6.5z'/></symbol><symbol fill='none' viewBox='0 0 10 10' id='uc-icon-play' xmlns='http://www.w3.org/2000/svg'><path d='m1 0 9 5-9 5V0Z' fill='currentColor'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-remove-file' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M11.955 3.3A2.969 2.969 0 0 0 8.998 6h5.914a2.97 2.97 0 0 0-2.957-2.7zM16.416 6a4.47 4.47 0 0 0-8.922 0h-2.32a.755.755 0 0 0-.111.008H3.075a.75.75 0 1 0 0 1.5h1.35V19.35a2.85 2.85 0 0 0 2.85 2.85h9.45a2.85 2.85 0 0 0 2.85-2.85V7.508h1.35a.75.75 0 0 0 0-1.5h-1.989A.754.754 0 0 0 18.825 6zM5.925 7.508V19.35a1.35 1.35 0 0 0 1.35 1.35h9.45a1.35 1.35 0 0 0 1.35-1.35V7.508z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-select' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='m7 10 5 5 5-5H7Z'/></symbol><symbol fill='none' viewBox='0 0 20 20' id='uc-icon-square' xmlns='http://www.w3.org/2000/svg'><rect width='20' height='20' rx='4' fill='#fff'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-upload' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M11.501.392a.75.75 0 0 1 .998 0l6.704 5.972a.75.75 0 0 1-.998 1.12l-5.455-4.86v13.439a.75.75 0 0 1-1.5 0V2.625l-5.454 4.86a.75.75 0 1 1-.998-1.12zM.857 16.73a.75.75 0 0 1 .75.75v4.914h20.786v-4.914a.75.75 0 0 1 1.5 0v5.664a.75.75 0 0 1-.75.75H.857a.75.75 0 0 1-.75-.75v-5.664a.75.75 0 0 1 .75-.75z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-upload-error' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M13 13h-2V7h2m0 10h-2v-2h2M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10A10 10 0 0 0 12 2Z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-url' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M19.11 3.67c-1.71-1.709-4.578-1.682-6.408.148l-2.22 2.22a.75.75 0 0 1-1.062-1.06l2.222-2.221C14.018.381 17.836.276 20.17 2.61l1.22 1.22c2.335 2.334 2.23 6.153-.147 8.529l-2.22 2.22a.75.75 0 0 1-1.062-1.06l2.222-2.221c1.83-1.83 1.856-4.698.147-6.408zm-3.36 4.58a.75.75 0 0 1 0 1.06l-6.439 6.44a.75.75 0 0 1-1.06-1.06l6.439-6.44a.75.75 0 0 1 1.06 0zM6.04 9.42a.75.75 0 0 1 0 1.061l-2.222 2.222c-1.83 1.83-1.856 4.698-.147 6.407l1.22 1.22c1.71 1.71 4.578 1.683 6.408-.147l2.221-2.221a.75.75 0 1 1 1.06 1.06l-2.22 2.222c-2.377 2.376-6.195 2.481-8.53.147l-1.22-1.22c-2.334-2.334-2.228-6.153.148-8.53l2.221-2.22a.75.75 0 0 1 1.06 0z'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-video-camera' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' clip-rule='evenodd' d='M0 6.75a3 3 0 0 1 3-3h12a3 3 0 0 1 3 3v1.078L22.873 5A.75.75 0 0 1 24 5.648v12.704a.75.75 0 0 1-1.123.65L18 16.207v1.043a3 3 0 0 1-3 3H3a3 3 0 0 1-3-3V6.75Zm18 7.728 4.5 2.58V6.95L18 9.562v4.916ZM16.5 6.75a1.5 1.5 0 0 0-1.5-1.5H3a1.5 1.5 0 0 0-1.5 1.5v10.5a1.5 1.5 0 0 0 1.5 1.5h12a1.5 1.5 0 0 0 1.5-1.5V6.75Z'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-video-camera-full' xmlns='http://www.w3.org/2000/svg'><path d='M2 3.333a2 2 0 0 0-2 2v9.334a2 2 0 0 0 2 2h10.938a2 2 0 0 0 2-2v-2.013L20 15.646V4.354l-5.063 3.03v-2.05a2 2 0 0 0-2-2H2Z' fill='currentColor'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-vk' xmlns='http://www.w3.org/2000/svg'><path fill='currentColor' fill-rule='evenodd' d='M6.341 3.27a10.5 10.5 0 0 1 5.834-1.77.75.75 0 0 0 0-1.5 12 12 0 1 0 12 12 .75.75 0 0 0-1.5 0A10.5 10.5 0 1 1 6.34 3.27Zm14.145 1.48a.75.75 0 1 0-1.06-1.062L9.925 13.19V7.95a.75.75 0 1 0-1.5 0V15c0 .414.336.75.75.75h7.05a.75.75 0 0 0 0-1.5h-5.24l9.501-9.5Z'/></symbol></svg>"+e}<slot></slot>`}static get template(){return this._template}},eS=100/3;function eO(e,t){for(let[i,s]of Object.entries(t))e.setAttributeNS(null,i,s.toString())}function eL(e,t={}){let i=document.createElementNS("http://www.w3.org/2000/svg",e);return eO(i,t),i}function eU(e,t){let{x:i}=e,{y:s}=e;return e.x<t.x?i=t.x:e.x+e.width>t.x+t.width&&(i=t.x+t.width-e.width),e.y<t.y?s=t.y:e.y+e.height>t.y+t.height&&(s=t.y+t.height-e.height),{...e,x:i,y:s}}function eV({width:e,height:t},i){let s=i/90%2!=0;return{width:s?t:e,height:s?e:t}}function eP(e){return{x:Math.round(e.x),y:Math.round(e.y),width:Math.round(e.width),height:Math.round(e.height)}}function eF(e,t,i){return Math.min(Math.max(e,t),i)}var eR=["free"],eD=e=>{let t=L(e);if(!t||0===t.length)return[];let i=[];for(let e of t){let t=e.trim();if(!t)continue;let s=t.indexOf(":");if(-1===s&&!eR.includes(t)){console.warn(`Invalid crop preset: ${t}`);continue}let a=Number(t.slice(0,s)),o=Number(t.slice(s+1));if((!Number.isFinite(a)||!Number.isFinite(o)||a<=0||o<=0)&&!eR.includes(t)){console.warn(`Invalid crop preset: ${t}`);continue}i.push({id:r.V0.generate(),type:"aspect-ratio",width:eR.includes(t)?0:a,height:eR.includes(t)?0:o,hasFreeform:eR.includes(t)})}return i},eB=Object.freeze({FACEBOOK:"facebook",DROPBOX:"dropbox",GDRIVE:"gdrive",GPHOTOS:"gphotos",FLICKR:"flickr",VK:"vk",EVERNOTE:"evernote",BOX:"box",ONEDRIVE:"onedrive",HUDDLE:"huddle"}),eN=Object.freeze({MOBILE_VIDEO_CAMERA:"mobile-video-camera",MOBILE_PHOTO_CAMERA:"mobile-photo-camera"}),ez=Object.freeze({LOCAL:"local",DROP_AREA:"drop-area",CAMERA:"camera",EXTERNAL:"external",API:"js-api",URL:"url",DRAW:"draw",...eN,...eB});function eH(e){return(0,a.$t)({...e,libraryName:e_,libraryVersion:ey})}var ej=e=>"number"!=typeof e?0:Math.floor(e/1e3),eG=class{_block;_secureToken=null;constructor(e){this._block=e}_debugPrint(...e){this._block.debugPrint("[secure-uploads]",...e)}async getSecureToken(){let{secureSignature:e,secureExpire:t,secureUploadsSignatureResolver:i}=this._block.cfg;if((e||t)&&i&&console.warn("Both secureSignature/secureExpire and secureUploadsSignatureResolver are set. secureUploadsSignatureResolver will be used."),i){if(!this._secureToken||((e,{threshold:t})=>{let{secureExpire:i}=e,s=ej(Date.now()),r=Number(i);return s+ej(t)>=r})(this._secureToken,{threshold:this._block.cfg.secureUploadsExpireThreshold})){this._secureToken?this._debugPrint("Secure signature is expired. Resolving a new one..."):this._debugPrint("Secure signature is not set yet.");try{let e=await i();e?e.secureSignature&&e.secureExpire?(this._debugPrint("Secure signature resolved:",e),this._debugPrint("Secure signature will expire in",new Date(1e3*Number(e.secureExpire)).toISOString()),this._secureToken=e):console.error("Secure signature resolver returned an invalid result:",e):(this._debugPrint("Secure signature resolver returned nothing."),this._secureToken=null)}catch(e){console.error("Secure signature resolving failed. Falling back to the previous one.",e),this._block.telemetryManager.sendEventError(e,"secureUploadsSignatureResolver. Secure signature resolving failed. Falling back to the previous one.")}}return this._secureToken}return e&&t?(this._debugPrint("Secure signature and expire are set. Using them...",{secureSignature:e,secureExpire:t}),{secureSignature:e,secureExpire:t}):null}},eZ=(e,t)=>{if(e.failedCount>0)return{type:"SOME_FILES_HAS_ERRORS",message:t.l10n("some-files-were-not-uploaded")}},eq=(e,t)=>{let i=e.totalCount,s=t.cfg.multiple?t.cfg.multipleMin:0,r=t.cfg.multiple?t.cfg.multipleMax:1;return s&&i<s?{type:"TOO_FEW_FILES",message:t.l10n("files-count-limit-error-too-few",{min:s,max:r,total:i}),payload:{total:i,min:s,max:r}}:r&&i>r?{type:"TOO_MANY_FILES",message:t.l10n("files-count-limit-error-too-many",{min:s,max:r,total:i}),payload:{total:i,min:s,max:r}}:void 0},eW={safariDesktop:(()=>{let e=navigator.userAgent;return/Macintosh|Windows/.test(e)&&/Version\/[\d.]+.*Safari/.test(e)&&!/Chrome|Chromium|Edg|OPR/.test(e)})()},eK={htmlMediaCapture:"capture"in document.createElement("input")},eQ="image/*",eY="video/*",eX=eW.safariDesktop?[eQ]:[eQ,"image/heif","image/heif-sequence","image/heic","image/heic-sequence","image/avif","image/avif-sequence",".heif",".heifs",".heic",".heics",".avif",".avifs"],eJ=e=>e?e.filter(e=>"string"==typeof e).flatMap(e=>L(e)):[],e0=(e,t)=>t.some(t=>{if(t.endsWith("*")){let i=t.replace("*","");return e.startsWith(i)}return e===t}),e1=(e,t)=>{let i=eJ([...t.cfg.imgOnly?eX:[],t.cfg.accept]);if(!i.length)return;let s=e.mimeType,r=e.name;if(!s||!r)return;let a=e0(s,i),o=i.some(e=>!!e.startsWith(".")&&r.toLowerCase().endsWith(e.toLowerCase()));if(!a&&!o)return{type:"FORBIDDEN_FILE_TYPE",message:t.l10n("file-type-not-allowed"),payload:{entry:e}}},e5=(e,t)=>{let i=t.cfg.imgOnly,s=e.isImage;if(i&&!s&&(e.fileInfo||!e.externalUrl)&&(e.fileInfo||e.mimeType))return{type:"NOT_AN_IMAGE",message:t.l10n("images-only-accepted"),payload:{entry:e}}},e2=Object.freeze({AUTO:"auto",BYTE:"byte",KB:"kb",MB:"mb",GB:"gb",TB:"tb",PB:"pb"}),e3=e=>Math.ceil(100*e)/100,e7=(e,t)=>{let i=t.cfg.maxLocalFileSizeBytes,s=e.size;if(i&&s&&s>i)return{type:"FILE_SIZE_EXCEEDED",message:t.l10n("files-max-size-limit-error",{maxFileSize:((e,t=e2.AUTO)=>{let i=t===e2.AUTO;if(t===e2.BYTE||i&&e<1e3){let t=Q("en-US",e);return`${e} ${"one"===t?"byte":"bytes"}`}return t===e2.KB||i&&e<1e6?`${e3(e/1e3)} KB`:t===e2.MB||i&&e<1e9?`${e3(e/1e6)} MB`:t===e2.GB||i&&e<1e12?`${e3(e/1e9)} GB`:t===e2.TB||i&&e<1e15?`${e3(e/1e12)} TB`:`${e3(e/1e15)} PB`})(i)}),payload:{entry:e}}},e4=(e,t)=>{let{internalId:i}=e,s=t._uploadCollection.read(i),r=s?.getValue("uploadError");if(!r)return;if(r instanceof a.oW)return{type:"UPLOAD_ERROR",message:r.message,payload:{entry:e,error:r}};if(r instanceof a.Dr)return{type:"NETWORK_ERROR",message:r.message,payload:{entry:e,error:r}};let o=r instanceof Error?r:Error("Unknown error",{cause:r});return{type:"UNKNOWN_ERROR",message:o.message,payload:{entry:e,error:o}}},e8={FILE_VALIDATION_FAILED:"File validator execution has failed",FILE_VALIDATION_TIMEOUT:"File validator execution has timed out",COLLECTION_VALIDATION_FAILED:"Collection validator execution has failed",MISSING_ERROR_MESSAGE:"Missing message. We recommend adding message: value."},e6=e=>"function"==typeof e?{runOn:"change",validator:e}:e,e9=class{_blockInstance;_uploadCollection;_commonFileValidators=[e5,e1,e7,e4];_commonCollectionValidators=[eq,eZ];_queue=new a.op(20);_runQueueDebounced=v(()=>{this._queue.run()},500);_entryValidationState=new Map;constructor(e){this._blockInstance=e,this._uploadCollection=this._blockInstance.uploadCollection;let t=()=>{this.runFileValidators("change"),this.runCollectionValidators()};this._blockInstance.subConfigValue("maxLocalFileSizeBytes",t),this._blockInstance.subConfigValue("multipleMin",t),this._blockInstance.subConfigValue("multipleMax",t),this._blockInstance.subConfigValue("multiple",t),this._blockInstance.subConfigValue("imgOnly",t),this._blockInstance.subConfigValue("accept",t),this._blockInstance.subConfigValue("validationConcurrency",e=>{this._queue.concurrency=e})}runFileValidators(e,t){for(let i of t??this._uploadCollection.items()){let t=this._uploadCollection.read(i);t&&this._runFileValidatorsForEntry(t,e)}}runCollectionValidators(){let e=this._blockInstance.api.getOutputCollectionState(),t=[];for(let i of[...this._commonCollectionValidators,...this._blockInstance.cfg.collectionValidators])try{let s=i(e,this._blockInstance.api);if(!s)continue;s&&(t.push(this._addCustomTypeToValidationError(s)),s.message||console.warn(e8.MISSING_ERROR_MESSAGE))}catch(e){console.warn(e8.COLLECTION_VALIDATION_FAILED,e)}this._blockInstance.$["*collectionErrors"]=t,t.length>0&&this._blockInstance.emit(b.COMMON_UPLOAD_FAILED,()=>this._blockInstance.api.getOutputCollectionState(),{debounce:!0})}cleanupValidationForEntry(e){let t=this._entryValidationState.get(e.uid);t&&(t.abortController?.abort(),this._entryValidationState.delete(e.uid))}async _runFileValidatorsForEntry(e,t){let i,s,r=this._getValidatorDescriptorsForEntry(e,t);if(0===r.length)return;e.setMultipleValues({isQueuedForValidation:!0,isValidationPending:!0});let a=this._blockInstance.api.getOutputItem(e.uid),o=this._getEntryValidationState(e);o.promise&&await o.promise;let{promise:l,resolve:n}=(i=()=>{},s=()=>{},{promise:new Promise((e,t)=>{i=e,s=t}),resolve:i,reject:s});o.promise=l;let c=new AbortController;o.abortController=c;let d=this._blockInstance.cfg.validationTimeout,h=this._getValidatorDescriptors(),u=new Set(r.map(e=>e.validator)),p=[];for(let e of h)if(!u.has(e.validator)){let t=o.lastErrorThrownByValidator.get(e.validator);t&&p.push(t)}let m=r.map(e=>async()=>{if(!this._blockInstance.isConnected)return;let t=setTimeout(()=>{o.skippedValidators.add(e.validator),c.abort(),console.warn(e8.FILE_VALIDATION_TIMEOUT)},d);try{let t=await e.validator(a,this._blockInstance.api,{signal:c.signal});if(!t||c.signal.aborted)return void o.lastErrorThrownByValidator.set(e.validator,void 0);let i=this._addCustomTypeToValidationError(t);o.lastErrorThrownByValidator.set(e.validator,i),p.push(i),t.message||console.warn(e8.MISSING_ERROR_MESSAGE)}catch(t){c.signal.aborted||(o.skippedValidators.add(e.validator),console.warn(e8.FILE_VALIDATION_FAILED,t),this._blockInstance.telemetryManager.sendEventError(t,`file validator. ${e8.FILE_VALIDATION_FAILED}`))}finally{clearTimeout(t),"change"!==e.runOn&&o.skippedValidators.add(e.validator)}});if(this._runQueueDebounced(),await this._queue.add(async()=>{e.setValue("isQueuedForValidation",!1),await Promise.all(m.map(e=>e())).catch(()=>{})},{autoRun:!1}),c.signal.aborted){e.setMultipleValues({isQueuedForValidation:!1,isValidationPending:!1}),n();return}e.setMultipleValues({isValidationPending:!1,isQueuedForValidation:!1,errors:p}),n()}_addCustomTypeToValidationError(e){return{...e,type:e.type??"CUSTOM_ERROR"}}_getEntryValidationState(e){let t=this._entryValidationState.get(e.uid);if(t)return t;let i={abortController:void 0,skippedValidators:new WeakSet,promise:void 0,lastErrorThrownByValidator:new WeakMap};return this._entryValidationState.set(e.uid,i),i}_getValidatorDescriptors(){return[...this._commonFileValidators,...this._blockInstance.cfg.fileValidators].map(e6)}_getValidatorDescriptorsForEntry(e,t){let i=this._getEntryValidationState(e);return this._getValidatorDescriptors().filter(e=>!i.skippedValidators.has(e.validator)).filter(e=>e.runOn===t)}},te="[Typed State] Wrong property name: ",tt=class{__typedSchema;__ctxId;__schema;__data;constructor(e,t){this.__typedSchema=e,this.__ctxId=t||r.V0.generate(),this.__schema=Object.keys(e).reduce((t,i)=>(e[i]&&(t[i]=e[i].value),t),{}),this.__data=r.B_.registerCtx(this.__schema,this.__ctxId)}get uid(){return this.__ctxId}setValue(e,t){if(!Object.hasOwn(this.__typedSchema,e)||!this.__typedSchema[e])return void console.warn(te+e);let i=this.__typedSchema[e],s=t?.constructor===i.type,r=t instanceof i.type,a=i.nullable&&null===t;if(s||r||a)return void this.__data.pub(e,t);console.warn("[Typed State] Wrong property type: "+e)}setMultipleValues(e){for(let[t,i]of Object.entries(e))this.setValue(t,i)}getValue(e){return Object.hasOwn(this.__typedSchema,e)||console.warn(te+e),this.__data.read(e)}subscribe(e,t){return this.__data.sub(e,t)}remove(){r.B_.deleteCtx(this.__ctxId)}},ti=class{__typedSchema;__ctxId;__data;__watchList;__subsMap=Object.create(null);__propertyObservers=new Set;__collectionObservers=new Set;__items=new Set;__removed=new Set;__added=new Set;__observeTimeout;__notifyTimeout;__notifyObservers;constructor(e){this.__typedSchema=e.typedSchema,this.__ctxId=e.ctxName||r.V0.generate(),this.__data=r.B_.registerCtx({},this.__ctxId),this.__watchList=e.watchList||[];let t=Object.create(null);this.__notifyObservers=(e,i)=>{this.__observeTimeout&&window.clearTimeout(this.__observeTimeout),t[e]||(t[e]=new Set),t[e].add(i),this.__observeTimeout=window.setTimeout(()=>{0!==Object.keys(t).length&&(this.__propertyObservers.forEach(e=>{e({...t})}),t=Object.create(null))})},e.handler&&this.observeCollection(e.handler)}notify(){this.__notifyTimeout&&window.clearTimeout(this.__notifyTimeout),this.__notifyTimeout=window.setTimeout(()=>{let e=new Set(this.__added),t=new Set(this.__removed);for(let i of(this.__added.clear(),this.__removed.clear(),this.__collectionObservers))i?.([...this.__items],e,t)})}observeCollection(e){return this.__collectionObservers.add(e),this.__items.size>0&&this.notify(),()=>{this.unobserveCollection(e)}}unobserveCollection(e){this.__collectionObservers.delete(e)}add(e){let t=new tt(this.__typedSchema);for(let[i,s]of Object.entries(e))void 0!==s&&t.setValue(i,s);return this.__items.add(t.uid),this.notify(),this.__data.add(t.uid,t),this.__added.add(t),this.__watchList.forEach(e=>{this.__subsMap[t.uid]||(this.__subsMap[t.uid]=[]),this.__subsMap[t.uid]?.push(t.subscribe(e,()=>{this.__notifyObservers(e,t.uid)}))}),t.uid}read(e){return this.__data.read(e)}readProp(e,t){let i=this.read(e);return i?i.getValue(t):(console.warn(`Item with id ${e} not found`),null)}publishProp(e,t,i){let s=this.read(e);if(!s)return void console.warn(`Item with id ${e} not found`);s.setValue(t,i)}remove(e){let t=this.read(e);t&&this.__removed.add(t),this.__items.delete(e),this.notify(),this.__data.pub(e,null),delete this.__subsMap[e]}clearAll(){this.__items.forEach(e=>{this.remove(e)})}observeProperties(e){return this.__propertyObservers.add(e),()=>{this.unobserveProperties(e)}}unobserveProperties(e){this.__propertyObservers.delete(e)}findItems(e){let t=[];return this.__items.forEach(i=>{let s=this.read(i);s&&e(s)&&t.push(i)}),t}items(){return[...this.__items]}get size(){return this.__items.size}destroy(){for(let e in r.B_.deleteCtx(this.__ctxId),this.__propertyObservers=new Set,this.__collectionObservers=new Set,this.__subsMap)this.__subsMap[e]?.forEach(e=>{e.remove()}),delete this.__subsMap[e]}},ts=Object.freeze({PHOTO:"photo",VIDEO:"video"}),tr=Object.freeze({IDLE:"idle",SHOT:"shot",PLAY:"play",PAUSE:"pause",RESUME:"resume",STOP:"stop",RETAKE:"retake",ACCEPT:"accept"}),ta=e=>({isVideoRecordingEnabled:_(e.cameraModes).includes(ts.VIDEO),isPhotoEnabled:_(e.cameraModes).includes(ts.PHOTO)}),to=RegExp(`^/?(${/[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}/i.source})(?:/(-/(?:[^/]+/)+)?([^/]*))?$`,"i"),tl=new Set;function tn(e){tl.has(e)||(tl.add(e),console.warn(e))}var tc=class{_ctx;constructor(e){this._ctx=e}get _uploadCollection(){return this._ctx.uploadCollection}get cfg(){return this._ctx.cfg}get l10n(){return this._ctx.l10n.bind(this._ctx)}addFileFromUrl=(e,{silent:t,fileName:i,source:s}={})=>{let r=this._uploadCollection.add({externalUrl:e,fileName:i??null,silent:t??!1,source:s??ez.API});return this.getOutputItem(r)};addFileFromUuid=(e,{silent:t,fileName:i,source:s}={})=>{let r=this._uploadCollection.add({uuid:e,fileName:i??null,silent:t??!1,source:s??ez.API});return this.getOutputItem(r)};addFileFromCdnUrl=(e,{silent:t,fileName:i,source:s}={})=>{let r=(({url:e,cdnBase:t})=>{let i=new URL(t),s=new URL(W),r=new URL(e);if(i.host!==r.host&&s.host!==r.host)return null;let a=to.exec(r.pathname);if(!a)return null;let[,o,l,n]=a;return o?{uuid:o,cdnUrlModifiers:l||"",filename:n||null}:null})({url:e,cdnBase:this.cfg.cdnCname});if(!r)throw Error("Invalid CDN URL");let a=this._uploadCollection.add({uuid:r.uuid,cdnUrl:e,cdnUrlModifiers:r.cdnUrlModifiers,fileName:i??r.filename??null,silent:t??!1,source:s??ez.API});return this.getOutputItem(a)};addFileFromObject=(e,{silent:t,fileName:i,source:s,fullPath:r}={})=>{let a=this._uploadCollection.add({file:e,isImage:(e=>{let t=e?.type;return!!t&&e0(t,eX)})(e),mimeType:e.type,fileName:i??e.name,fileSize:e.size,silent:t??!1,source:s??ez.API,fullPath:r??null});return this.getOutputItem(a)};removeFileByInternalId=e=>{if(!this._uploadCollection.read(e))throw Error(`File with internalId ${e} not found`);this._uploadCollection.remove(e)};removeAllFiles(){this._uploadCollection.clearAll()}uploadAll=()=>{let e=this._uploadCollection.items().filter(e=>{let t=this._uploadCollection.read(e);return!!t&&!t.getValue("isRemoved")&&!t.getValue("isUploading")&&!t.getValue("fileInfo")&&0===t.getValue("errors").length&&!t.getValue("isValidationPending")&&!t.getValue("isQueuedForValidation")});0!==e.length&&(this._ctx.$["*uploadTrigger"]=new Set(e),this._ctx.emit(b.COMMON_UPLOAD_START,this.getOutputCollectionState()))};openSystemDialog=(e={})=>{let t=y(eJ([this.cfg.accept??"",...this.cfg.imgOnly?eX:[]])),i="uploadcare-file-input",s=document.createElement("input");if(s.setAttribute(i,""),(0,r.ZM)(s,{opacity:0,height:0,width:0,visibility:"hidden",position:"absolute",top:0,left:0}),s.type="file",s.multiple=this.cfg.multiple,e.captureCamera){s.capture=this.cfg.cameraCapture;let{isPhotoEnabled:t,isVideoRecordingEnabled:i}=ta(this.cfg);e.modeCamera===ts.PHOTO&&t?s.accept=eQ:e.modeCamera===ts.VIDEO&&i?s.accept=eY:s.accept=[eQ,i&&eY].filter(Boolean).join(",")}else s.accept=t;s.addEventListener("change",()=>{s.files&&([...s.files].forEach(t=>{this.addFileFromObject(t,{source:e.captureCamera?ez.CAMERA:ez.LOCAL})}),this._ctx.modalManager?.open(eI.activities.UPLOAD_LIST),this._ctx.$["*currentActivity"]=eI.activities.UPLOAD_LIST,s.remove())},{once:!0}),document.querySelectorAll(`[${i}]`).forEach(e=>{e.remove()}),document.body.appendChild(s),s.dispatchEvent(new MouseEvent("click"))};getOutputItem(e){let t=r.B_.getCtx(e).store,i=t.fileInfo,s=t.isRemoved?"removed":t.errors.length>0?"failed":t.fileInfo?"success":t.isUploading?"uploading":"idle";return{uuid:i?.uuid??t.uuid??null,internalId:e,name:i?.originalFilename??t.fileName,size:i?.size??t.fileSize,isImage:i?.isImage??t.isImage,mimeType:i?.mimeType??t.mimeType,file:t.file,externalUrl:t.externalUrl,cdnUrlModifiers:t.cdnUrlModifiers,cdnUrl:t.cdnUrl??i?.cdnUrl??null,fullPath:t.fullPath,uploadProgress:t.uploadProgress,fileInfo:i??null,metadata:t.metadata??i?.metadata??null,isSuccess:"success"===s,isUploading:"uploading"===s,isFailed:"failed"===s,isRemoved:"removed"===s,isValidationPending:t.isValidationPending,errors:t.errors,status:s,source:t?.source}}getOutputCollectionState(){return function(e){let t,i={},s=(t=!1,setTimeout(()=>{t=!0},0),e=>(...i)=>(t&&tn("You're trying to access the OutputCollectionState asynchronously. In this case, the data you retrieve will be newer than it was when the OutputCollectionState was created or when the event was dispatched. If you want to retain the state at a specific moment in time, you should use the spread operator like this: `{...outputCollectionState}` or `{...e.detail}`"),e(...i)));for(let[t,r]of Object.entries({progress:()=>e.$["*commonProgress"],errors:()=>e.$["*collectionErrors"],group:()=>e.$["*groupInfo"],totalCount:()=>e.uploadCollection.size,failedCount:()=>i.failedEntries.length,successCount:()=>i.successEntries.length,uploadingCount:()=>i.uploadingEntries.length,status:()=>i.isFailed?"failed":i.isUploading?"uploading":i.isSuccess?"success":"idle",isSuccess:()=>i.allEntries.length>0&&0===i.errors.length&&i.successEntries.length===i.allEntries.length,isUploading:()=>i.allEntries.some(e=>"uploading"===e.status),isFailed:()=>i.errors.length>0||i.failedEntries.length>0,allEntries:()=>e.getOutputData(),successEntries:()=>i.allEntries.filter(e=>"success"===e.status),failedEntries:()=>i.allEntries.filter(e=>"failed"===e.status),uploadingEntries:()=>i.allEntries.filter(e=>"uploading"===e.status),idleEntries:()=>i.allEntries.filter(e=>"idle"===e.status)}))Object.defineProperty(i,t,{get:function(e){let t=new Map;return(...i)=>{let s=JSON.stringify(i);if(t.has(s))return t.get(s);let r=e(...i);return t.set(s,r),r}}(s(r)),enumerable:!0});return i}(this._ctx)}initFlow=(e=!1)=>{if(this._uploadCollection.size>0&&!e)this._ctx.modalManager?.open(eI.activities.UPLOAD_LIST),this._ctx.set$({"*currentActivity":eI.activities.UPLOAD_LIST});else if(this._sourceList?.length===1){let e=this._sourceList[0];if("local"===e){this._ctx.$["*currentActivity"]=eI.activities.UPLOAD_LIST,this.openSystemDialog();return}if("camera"===e&&eK.htmlMediaCapture){let{isPhotoEnabled:e,isVideoRecordingEnabled:t}=ta(this.cfg);if(e&&t)return void this._ctx.set$({"*currentActivity":eI.activities.START_FROM});if(e||t)return void this.openSystemDialog({captureCamera:!0,modeCamera:e?ts.PHOTO:ts.VIDEO});this.openSystemDialog({captureCamera:!0,modeCamera:ts.PHOTO})}let t=[...this._ctx.$["*blocksRegistry"]].find(t=>"type"in t&&t.type===e);t?.activate(),this._ctx.$["*currentActivity"]&&this._ctx.modalManager?.open(this._ctx.$["*currentActivity"])}else this._ctx.modalManager?.open(eI.activities.START_FROM),this._ctx.set$({"*currentActivity":eI.activities.START_FROM})};doneFlow=()=>{this._ctx.set$({"*currentActivity":this._ctx.doneActivity,"*history":this._ctx.doneActivity?[this._ctx.doneActivity]:[]}),this._ctx.$["*currentActivity"]||this._ctx.modalManager?.closeAll()};setCurrentActivity=(e,...t)=>{if(this._ctx.hasBlockInCtx(t=>t.activityType===e))return void this._ctx.set$({"*currentActivityParams":t??{},"*currentActivity":e});console.warn(`Activity type "${e}" not found in the context`)};getCurrentActivity=()=>this._ctx.$["*currentActivity"];setModalState=e=>{if(e&&!this._ctx.$["*currentActivity"])return void console.warn('Can\'t open modal without current activity. Please use "setCurrentActivity" method first.');e?this._ctx.modalManager?.open(this._ctx.$["*currentActivity"]):(this._ctx.modalManager?.close(this._ctx.$["*currentActivity"]),this._ctx.$["*currentActivity"]=null)};get _sourceList(){let e=[];return this.cfg.sourceList&&(e=L(this.cfg.sourceList)),e}},td=Object.freeze({file:Object.freeze({type:File,value:null,nullable:!0}),externalUrl:Object.freeze({type:String,value:null,nullable:!0}),fileName:Object.freeze({type:String,value:null,nullable:!0}),fileSize:Object.freeze({type:Number,value:null,nullable:!0}),lastModified:Object.freeze({type:Number,value:Date.now()}),uploadProgress:Object.freeze({type:Number,value:0}),uuid:Object.freeze({type:String,value:null,nullable:!0}),isImage:Object.freeze({type:Boolean,value:!1}),mimeType:Object.freeze({type:String,value:null,nullable:!0}),ctxName:Object.freeze({type:String,value:null,nullable:!0}),cdnUrl:Object.freeze({type:String,value:null,nullable:!0}),cdnUrlModifiers:Object.freeze({type:String,value:null,nullable:!0}),fileInfo:Object.freeze({type:a.Lw,value:null,nullable:!0}),isUploading:Object.freeze({type:Boolean,value:!1}),abortController:Object.freeze({type:AbortController,value:null,nullable:!0}),thumbUrl:Object.freeze({type:String,value:null,nullable:!0}),silent:Object.freeze({type:Boolean,value:!1}),source:Object.freeze({type:String,value:null,nullable:!0}),fullPath:Object.freeze({type:String,value:null,nullable:!0}),metadata:Object.freeze({type:Object,value:null,nullable:!0}),errors:Object.freeze({type:Array,value:[]}),uploadError:Object.freeze({type:Error,value:null,nullable:!0}),isRemoved:Object.freeze({type:Boolean,value:!1}),isQueuedForUploading:Object.freeze({type:Boolean,value:!1}),isValidationPending:Object.freeze({type:Boolean,value:!1}),isQueuedForValidation:Object.freeze({type:Boolean,value:!1})}),th=class e extends eI{static extSrcList;static sourceTypes;couldBeCtxOwner=!1;isCtxOwner=!1;_unobserveCollection;_unobserveCollectionProperties;init$=er(this);get hasCtxOwner(){return this.hasBlockInCtx(t=>t instanceof e&&t.isCtxOwner&&t.isConnected&&t!==this)}initCallback(){if(super.initCallback(),!this.has("*uploadCollection")){let e=new ti({typedSchema:td,watchList:["uploadProgress","uploadError","fileInfo","errors","cdnUrl","isUploading","isValidationPending"]});this.add("*uploadCollection",e)}this.has("*publicApi")||this.add("*publicApi",new tc(this)),this.has("*validationManager")||this.add("*validationManager",new e9(this)),!this.hasCtxOwner&&this.couldBeCtxOwner&&this._initCtxOwner()}get validationManager(){if(!this.has("*validationManager"))throw Error("Unexpected error: ValidationManager is not initialized");return this.$["*validationManager"]}get api(){if(!this.has("*publicApi"))throw Error("Unexpected error: UploaderPublicApi is not initialized");return this.$["*publicApi"]}getAPI(){return this.api}get uploadCollection(){if(!this.has("*uploadCollection"))throw Error("Unexpected error: TypedCollection is not initialized");return this.$["*uploadCollection"]}destroyCtxCallback(){this.uploadCollection.destroy(),this.$["*uploadCollection"]=null,super.destroyCtxCallback()}disconnectedCallback(){super.disconnectedCallback(),this.isCtxOwner&&this._unobserveUploadCollection()}connectedCallback(){super.connectedCallback(),this.isCtxOwner&&this._observeUploadCollection()}destroyCallback(){super.destroyCallback(),this._flushOutputItems.cancel()}_initCtxOwner(){this.isCtxOwner=!0,this._observeUploadCollection(),this.subConfigValue("maxConcurrentRequests",e=>{this.$["*uploadQueue"].concurrency=Number(e)||1}),this.$["*secureUploadsManager"]||(this.$["*secureUploadsManager"]=new eG(this))}_observeUploadCollection(){this._unobserveUploadCollection(),this._unobserveCollection=this.uploadCollection.observeCollection(this._handleCollectionUpdate),this._unobserveCollectionProperties=this.uploadCollection.observeProperties(this._handleCollectionPropertiesUpdate)}_unobserveUploadCollection(){this._unobserveCollectionProperties?.(),this._unobserveCollection?.(),this._unobserveCollectionProperties=void 0,this._unobserveCollection=void 0}async _createGroup(e){let t=await this.getUploadClientOptions(),i=e.allEntries.map(e=>e.uuid+(e.cdnUrlModifiers?`/${e.cdnUrlModifiers}`:"")),s=new AbortController,r=await (0,a.fB)(i,{...t,signal:s.signal});if(this.$["*collectionState"]!==e)return void s.abort();this.$["*groupInfo"]=r;let o=this.api.getOutputCollectionState();this.emit(b.GROUP_CREATED,o),this.emit(b.CHANGE,()=>this.api.getOutputCollectionState(),{debounce:!0}),this.$["*collectionState"]=o}_flushOutputItems=v(async()=>{if(this.getOutputData().length!==this.uploadCollection.size)return;let e=this.api.getOutputCollectionState();this.$["*collectionState"]=e,this.emit(b.CHANGE,()=>this.api.getOutputCollectionState(),{debounce:!0}),this.cfg.groupOutput&&e.totalCount>0&&"success"===e.status&&this._createGroup(e)},300);_handleCollectionUpdate=(e,t,i)=>{for(let e of((t.size||i.size)&&(this.$["*groupInfo"]=null),this.validationManager.runFileValidators("add",[...t].map(e=>e.uid)),t))e.getValue("silent")||this.emit(b.FILE_ADDED,this.api.getOutputItem(e.uid));for(let e of(this.validationManager.runCollectionValidators(),i)){this.$["*uploadTrigger"].delete(e.uid),this.validationManager.cleanupValidationForEntry(e),e.getValue("abortController")?.abort(),e.setMultipleValues({isRemoved:!0,abortController:null,isUploading:!1,uploadProgress:0});let t=e?.getValue("thumbUrl");t&&URL.revokeObjectURL(t),this.emit(b.FILE_REMOVED,this.api.getOutputItem(e.uid))}this.$["*uploadList"]=e.map(e=>({uid:e})),this._flushCommonUploadProgress(),this._flushOutputItems()};_handleCollectionPropertiesUpdate=e=>{this._flushOutputItems();let t=this.uploadCollection,i=[...new Set(Object.entries(e).filter(([e])=>["uploadError","fileInfo","cdnUrl","cdnUrlModifiers"].includes(e)).flatMap(([,e])=>[...e]))];if(i.length>0&&setTimeout(()=>{let t=i.filter(t=>e.fileInfo?.has(t)&&!!r.B_.getCtx(t).store.fileInfo);t.length>0&&this.validationManager.runFileValidators("upload",t),this.validationManager.runFileValidators("change",i)}),e.uploadProgress){for(let t of e.uploadProgress){let{isUploading:e,silent:i}=r.B_.getCtx(t).store;e&&!i&&this.emit(b.FILE_UPLOAD_PROGRESS,this.api.getOutputItem(t))}this._flushCommonUploadProgress()}if(e.isUploading)for(let t of e.isUploading){let{isUploading:e,silent:i}=r.B_.getCtx(t).store;e&&!i&&this.emit(b.FILE_UPLOAD_START,this.api.getOutputItem(t))}if(e.fileInfo){for(let t of e.fileInfo){let{fileInfo:e,silent:i}=r.B_.getCtx(t).store;e&&!i&&this.emit(b.FILE_UPLOAD_SUCCESS,this.api.getOutputItem(t))}this.cfg.cropPreset&&this.setInitialCrop(),this.cfg.cloudImageEditorAutoOpen&&this.openCloudImageEditor()}if(e.errors){for(let t of(this.validationManager.runCollectionValidators(),e.errors)){let{errors:e}=r.B_.getCtx(t).store;e.length>0&&(this.emit(b.FILE_UPLOAD_FAILED,this.api.getOutputItem(t)),this.emit(b.COMMON_UPLOAD_FAILED,()=>this.api.getOutputCollectionState(),{debounce:!0}))}let i=t.findItems(e=>!!e.getValue("fileInfo")),s=t.findItems(e=>e.getValue("errors").length>0);t.size>0&&0===s.length&&t.size===i.length&&0===this.$["*collectionErrors"].length&&this.emit(b.COMMON_UPLOAD_SUCCESS,this.api.getOutputCollectionState())}e.cdnUrl&&([...e.cdnUrl].filter(e=>!!this.uploadCollection.read(e)?.getValue("cdnUrl")).forEach(e=>{this.emit(b.FILE_URL_CHANGED,this.api.getOutputItem(e))}),this.$["*groupInfo"]=null)};_flushCommonUploadProgress=()=>{let e=0,t=[...this.$["*uploadTrigger"]].filter(e=>!!this.uploadCollection.read(e));t.forEach(t=>{let i=this.uploadCollection.readProp(t,"uploadProgress");"number"==typeof i&&(e+=i)});let i=t.length?Math.round(e/t.length):0;this.$["*commonProgress"]!==i&&(this.$["*commonProgress"]=i,this.emit(b.COMMON_UPLOAD_PROGRESS,this.api.getOutputCollectionState()))};openCloudImageEditor(){let[e]=this.uploadCollection.findItems(e=>!!e.getValue("fileInfo")&&e.getValue("isImage")).map(e=>this.uploadCollection.read(e));e&&1===this.uploadCollection.size&&this.cfg.useCloudImageEditor&&this.hasBlockInCtx(e=>e.activityType===eI.activities.CLOUD_IMG_EDIT)&&(this.$["*currentActivityParams"]={internalId:e.uid},this.$["*currentActivity"]=eI.activities.CLOUD_IMG_EDIT,this.modalManager?.open(eI.activities.CLOUD_IMG_EDIT))}setInitialCrop(){let e=eD(this.cfg.cropPreset);if(e){let[t]=e;for(let e of this.uploadCollection.findItems(e=>!!e.getValue("fileInfo")&&e.getValue("isImage")&&!e.getValue("cdnUrlModifiers")?.includes("/crop/")).map(e=>this.uploadCollection.read(e)).filter(Boolean)){let i=e.getValue("fileInfo");if(!i||!i.imageInfo){console.warn("Failed to get image info for entry",e.uid);continue}let{width:s,height:r}=i.imageInfo,a=function(e,t,i){let s,r;e/t>i?(s=Math.round(t*i),r=t):(s=e,r=Math.round(e/i));let a=Math.round((e-s)/2),o=Math.round((t-r)/2);return a+s>e&&(s=e-a),o+r>t&&(r=t-o),{x:a,y:o,width:s,height:r}}(s,r,"number"==typeof t?.width&&"number"==typeof t?.height&&t.width>0&&t.height>0?t.width/t.height:1),o=E(`crop/${a.width}x${a.height}/${a.x},${a.y}`,"preview"),l=e.getValue("cdnUrl");if(!l){console.warn("Failed to get cdnUrl for entry",e.uid);continue}e.setMultipleValues({cdnUrlModifiers:o,cdnUrl:S(l,o)}),1===this.uploadCollection.size&&this.cfg.useCloudImageEditor&&this.hasBlockInCtx(e=>e.activityType===eI.activities.CLOUD_IMG_EDIT)&&(this.$["*currentActivityParams"]={internalId:e.uid},this.$["*currentActivity"]=eI.activities.CLOUD_IMG_EDIT,this.modalManager?.open(eI.activities.CLOUD_IMG_EDIT))}}}async getMetadataFor(e){let t=this.cfg.metadata||void 0;if("function"==typeof t){let i=this.api.getOutputItem(e);return await t(i)}return t}async getUploadClientOptions(){let e=this.$["*secureUploadsManager"],t=await e.getSecureToken().catch(()=>null);return{store:this.cfg.store,publicKey:this.cfg.pubkey,baseCDN:this.cfg.cdnCname,baseURL:this.cfg.baseUrl,userAgent:eH,integration:this.cfg.userAgentIntegration,secureSignature:t?.secureSignature,secureExpire:t?.secureExpire,retryThrottledRequestMaxTimes:this.cfg.retryThrottledRequestMaxTimes,retryNetworkErrorMaxTimes:this.cfg.retryNetworkErrorMaxTimes,multipartMinFileSize:this.cfg.multipartMinFileSize,multipartChunkSize:this.cfg.multipartChunkSize,maxConcurrentRequests:this.cfg.multipartMaxConcurrentRequests,multipartMaxAttempts:this.cfg.multipartMaxAttempts,checkForUrlDuplicates:!!this.cfg.checkForUrlDuplicates,saveUrlForRecurrentUploads:!!this.cfg.saveUrlForRecurrentUploads}}getOutputData(){return this.uploadCollection.items().map(e=>this.api.getOutputItem(e))}};th.extSrcList=Object.freeze({...eB}),th.sourceTypes=Object.freeze({...ez});var tu=class extends eI{},tp={width:{ideal:1920},height:{ideal:1080},frameRate:{ideal:30}},tm=["camera","microphone"];function tg(e){let t=Math.floor(e/60).toString().padStart(2,"0"),i=Math.floor(e%60).toString().padStart(2,"0");return`${t}:${i}`}var tb="image/jpeg",tf="video/webm",tv=class extends th{couldBeCtxOwner=!0;activityType=eI.activities.CAMERA;_unsubPermissions=null;_capturing=!1;_chunks=[];_mediaRecorder=null;_stream=null;_selectedAudioId=null;_selectedCameraId=null;_activeTab=null;_options={};_canvas=null;_ctx=null;_cameraDevices=[];_audioDevices=[];_permissionResponses={};constructor(){super(),this.init$={...this.init$,video:null,videoTransformCss:null,videoHidden:!0,messageHidden:!0,requestBtnHidden:void 0!==navigator.permissions,cameraSelectOptions:null,cameraSelectHidden:!0,l10nMessage:"",switcher:null,panels:null,timer:null,timerHidden:!0,cameraHidden:!0,cameraActionsHidden:!0,audioSelectOptions:null,audioSelectHidden:!0,audioSelectDisabled:!0,audioToggleMicrophoneHidden:!0,tabCameraHidden:!0,tabVideoHidden:!0,currentIcon:"camera-full",currentTimelineIcon:"play",toggleMicrophoneIcon:"microphone",_startTime:0,_elapsedTime:0,_animationFrameId:null,mutableClassButton:"uc-shot-btn uc-camera-action",onCameraSelectChange:e=>{let t=e.target;t&&(this._selectedCameraId=t.value,this._capture())},onAudioSelectChange:e=>{let t=e.target;t&&(this._selectedAudioId=t.value,this._capture())},onCancel:()=>{this.historyBack()},onShot:()=>{this.telemetryManager.sendEvent({eventType:g.ACTION_EVENT,payload:{metadata:{event:"shot-camera",node:this.tagName,tabId:this._activeTab}}}),this._shot()},onRequestPermissions:()=>this._capture(),onStartCamera:()=>{this.telemetryManager.sendEvent({eventType:g.ACTION_EVENT,payload:{metadata:{event:"start-camera",node:this.tagName,tabId:this._activeTab}}}),this._chooseActionWithCamera()},onStartRecording:()=>this._startRecording(),onStopRecording:()=>this._stopRecording(),onToggleRecording:()=>this._toggleRecording(),onToggleAudio:()=>this._toggleEnableAudio(),onRetake:()=>{this.telemetryManager.sendEvent({eventType:g.ACTION_EVENT,payload:{metadata:{event:"retake-camera",node:this.tagName,tabId:this._activeTab}}}),this._retake()},onAccept:()=>{this.telemetryManager.sendEvent({eventType:g.ACTION_EVENT,payload:{metadata:{event:"accept-camera",node:this.tagName,tabId:this._activeTab}}}),this._accept()},onClickTab:e=>{let t=e.currentTarget,i=t?.getAttribute("data-id");i&&this._handleActiveTab(i)}}}_chooseActionWithCamera=()=>{if(this._activeTab===ts.PHOTO&&this._shot(),this._activeTab===ts.VIDEO){if(this._mediaRecorder?.state==="recording")return void this._stopRecording();this._startRecording()}};_updateTimer=()=>{let e=Math.floor((performance.now()-this.$._startTime+this.$._elapsedTime)/1e3);if("number"==typeof this.cfg.maxVideoRecordingDuration&&this.cfg.maxVideoRecordingDuration>0){let t=this.cfg.maxVideoRecordingDuration-e;if(t<=0){let e=this.ref.timer;e&&(e.textContent=tg(t)),this._stopRecording();return}let i=this.ref.timer;i&&(i.textContent=tg(t))}else{let t=this.ref.timer;t&&(t.textContent=tg(e))}this._animationFrameId=requestAnimationFrame(this._updateTimer)};_startTimer=()=>{this.$._startTime=performance.now(),this.$._elapsedTime=0,this._updateTimer()};_stopTimer=()=>{this._animationFrameId&&cancelAnimationFrame(this._animationFrameId)};_startTimeline=()=>{let e=this.ref.video;if(!e)return;let t=e.currentTime,i=e.duration||1,s=this.ref.line;s&&(s.style.transform=`scaleX(${t/i})`);let r=this.ref.timer;r&&(r.textContent=tg(t)),this._animationFrameId=requestAnimationFrame(this._startTimeline)};_stopTimeline=()=>{this._animationFrameId&&cancelAnimationFrame(this._animationFrameId)};_animationFrameId=null;_startRecording=()=>{try{this._chunks=[],this._options={...this.cfg.mediaRecorderOptions};let{mimeType:e}=this.cfg.mediaRecorderOptions||{};e&&MediaRecorder.isTypeSupported(e)?this._options.mimeType=e:MediaRecorder.isTypeSupported(tf)?this._options.mimeType=tf:this._options.mimeType="video/mp4",this._stream&&(this._mediaRecorder=new MediaRecorder(this._stream,this._options),this._mediaRecorder.start(),this._mediaRecorder.addEventListener("dataavailable",e=>{this._chunks.push(e.data)}),this._startTimer(),this.classList.add("uc-recording"),this._setCameraState(tr.PLAY))}catch(e){console.error("Failed to start recording",e),this.telemetryManager.sendEventError(e,"camera recording. Failed to start recording")}};_stopRecording=()=>{this._mediaRecorder?.addEventListener("stop",()=>{this._previewVideo(),this._stopTimer(),this._setCameraState(tr.STOP)}),this._mediaRecorder?.stop(),this.classList.remove("uc-recording"),this.telemetryManager.sendEvent({eventType:g.ACTION_EVENT,payload:{metadata:{event:"stop-camera",node:this.tagName,tabId:this._activeTab}}})};_toggleRecording=()=>{this._mediaRecorder?.state!=="recording"&&(this.ref.video.paused||this.ref.video.ended||!(this.ref.video.readyState>2)?this.ref.video.paused&&this.ref.video.play():this.ref.video.pause())};_toggleEnableAudio=()=>{this._stream?.getAudioTracks().forEach(e=>{e.enabled=!e.enabled,this.$.toggleMicrophoneIcon=e.enabled?"microphone":"microphone-mute",this.$.audioSelectDisabled=!e.enabled})};_previewVideo=()=>{try{let e=new Blob(this._chunks,{type:this._mediaRecorder?.mimeType}),t=URL.createObjectURL(e),i=this.ref.video;if(!i)return;i.muted=!1,i.volume=1,this.$.video=null,i.src=t,i.addEventListener("play",()=>{this._startTimeline(),this.set$({currentTimelineIcon:"pause"})}),i.addEventListener("pause",()=>{this.set$({currentTimelineIcon:"play"}),this._stopTimeline()})}catch(e){console.error("Failed to preview video",e),this.telemetryManager.sendEventError(e,"camera previewing. Failed to preview video")}};_retake=()=>{if(this._setCameraState(tr.RETAKE),this._activeTab===ts.VIDEO){this.$.video=this._stream;let e=this.ref.video;e&&(e.muted=!0)}this.ref.video?.play?.()};_accept=()=>{if(this._setCameraState(tr.ACCEPT),this._activeTab===ts.PHOTO)return void this._canvas?.toBlob(e=>{if(!e)return;let t=this._createFile("camera","jpeg",tb,e);this._toSend(t)},tb);let e=new Blob(this._chunks,{type:this._mediaRecorder?.mimeType}),t=this._guessExtensionByMime(this._mediaRecorder?.mimeType),i=this._createFile("video",t,`video/${t}`,e);this._toSend(i),this._chunks=[]};_handlePhoto=e=>{e===tr.SHOT&&this.set$({tabVideoHidden:!0,cameraHidden:!0,tabCameraHidden:!0,cameraActionsHidden:!1,cameraSelectHidden:!0}),(e===tr.RETAKE||e===tr.ACCEPT)&&this.set$({tabVideoHidden:!this._cameraModes.includes(ts.VIDEO),tabCameraHidden:!this._cameraModes.includes(ts.PHOTO),cameraHidden:!1,cameraActionsHidden:!0,cameraSelectHidden:this._cameraDevices.length<=1})};_handleVideo=e=>{e===tr.PLAY&&this.set$({timerHidden:!1,tabCameraHidden:!0,cameraSelectHidden:!0,audioSelectHidden:!0,currentTimelineIcon:"pause",currentIcon:"square",mutableClassButton:"uc-shot-btn uc-camera-action uc-stop-record"}),e===tr.STOP&&this.set$({timerHidden:!1,cameraHidden:!0,audioToggleMicrophoneHidden:!0,cameraActionsHidden:!1}),(e===tr.RETAKE||e===tr.ACCEPT)&&this.set$({timerHidden:!0,tabVideoHidden:!this._cameraModes.includes(ts.VIDEO),tabCameraHidden:!this._cameraModes.includes(ts.PHOTO),cameraHidden:!1,cameraActionsHidden:!0,audioToggleMicrophoneHidden:!this.cfg.enableAudioRecording,currentIcon:"video-camera-full",mutableClassButton:"uc-shot-btn uc-camera-action",audioSelectHidden:!this.cfg.enableAudioRecording||this._audioDevices.length<=1,cameraSelectHidden:this._cameraDevices.length<=1})};_setCameraState=e=>{this._activeTab===ts.PHOTO&&("shot"===e||"retake"===e||"accept"===e)&&this._handlePhoto(e),this._activeTab===ts.VIDEO&&("play"===e||"stop"===e||"retake"===e||"accept"===e||"pause"===e||"resume"===e)&&this._handleVideo(e)};_shot(){if(this._setCameraState("shot"),this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d"),!this._ctx)throw Error("Failed to get canvas context");this._canvas.height=this.ref.video.videoHeight,this._canvas.width=this.ref.video.videoWidth,this.cfg.cameraMirror&&(this._ctx.translate(this._canvas.width,0),this._ctx.scale(-1,1)),this._ctx.drawImage(this.ref.video,0,0),this.ref.video.pause()}_handleActiveTab=e=>{let t=this.ref.switcher;t?.querySelectorAll("button").forEach(t=>{t.classList.toggle("uc-active",t.getAttribute("data-id")===e)}),e===ts.PHOTO&&this.set$({currentIcon:"camera-full",audioSelectHidden:!0,audioToggleMicrophoneHidden:!0}),e===ts.VIDEO&&this.set$({currentTimelineIcon:"play",currentIcon:"video-camera-full",audioSelectHidden:!this.cfg.enableAudioRecording||this._audioDevices.length<=1,audioToggleMicrophoneHidden:!this.cfg.enableAudioRecording}),this.telemetryManager.sendEvent({eventType:g.ACTION_EVENT,payload:{metadata:{event:"camera-tab-switch",node:this.tagName,tabId:e}}}),this._activeTab=e};_createFile=(e,t,i,s)=>{let r=Date.now();return new File([s],`${e}-${r}.${t}`,{lastModified:r,type:i})};_guessExtensionByMime(e){let t={mp4:"mp4",ogg:"ogg",webm:"webm",quicktime:"mov","x-matroska":"mkv"};if(""===e)return"webm";if(e){let i=e.split("/");if(i?.[0]==="video"){let e=i.slice(1).join("/"),s=e?.split(";")[0];if(s&&t[s])return t[s]}}return"avi"}_toSend=e=>{this.api.addFileFromObject(e,{source:ez.CAMERA}),this.set$({"*currentActivity":eI.activities.UPLOAD_LIST}),this.modalManager?.open(eI.activities.UPLOAD_LIST)};get _cameraModes(){return L(this.cfg.cameraModes).filter(e=>e===ts.PHOTO||e===ts.VIDEO)}_setPermissionsState=v(e=>{this.classList.toggle("uc-initialized","granted"===e);let t=this._activeTab===ts.VIDEO&&this.cfg.enableAudioRecording,i=this._activeTab===ts.PHOTO?"camera-full":"video-camera-full";"granted"===e?this.set$({videoHidden:!1,cameraHidden:!1,tabCameraHidden:!this._cameraModes.includes(ts.PHOTO),tabVideoHidden:!this._cameraModes.includes(ts.VIDEO),messageHidden:!0,timerHidden:!0,currentIcon:i,audioToggleMicrophoneHidden:!t,audioSelectHidden:!t}):("prompt"===e?(this.$.l10nMessage="camera-permissions-prompt",this.set$({videoHidden:!0,cameraHidden:!0,tabCameraHidden:!0,messageHidden:!1})):(this.$.l10nMessage="camera-permissions-denied",this.set$({videoHidden:!0,messageHidden:!1,tabCameraHidden:!this._cameraModes.includes(ts.PHOTO),tabVideoHidden:!this._cameraModes.includes(ts.VIDEO),cameraActionsHidden:!0,mutableClassButton:"uc-shot-btn uc-camera-action"})),this._stopCapture())},300);_makeStreamInactive=()=>{if(!this._stream)return!1;let e=this._stream?.getAudioTracks(),t=this._stream?.getVideoTracks();return e.forEach(e=>{e.stop()}),t.forEach(e=>{e.stop()}),!0};_stopCapture=()=>{if(this._capturing){this.ref.video.volume=0;let e=this.$.video?.getTracks?.();e?.[0]?.stop(),this.$.video=null,this._makeStreamInactive(),this._stopTimer(),this._capturing=!1}};_capture=async()=>{let e={video:{...tp},audio:!!this.cfg.enableAudioRecording&&{}};this._selectedCameraId&&(e.video={deviceId:{exact:this._selectedCameraId}}),this._selectedAudioId&&this.cfg.enableAudioRecording&&(e.audio={deviceId:{exact:this._selectedAudioId}}),this.ref.video&&(this.ref.video.volume=0);try{this._setPermissionsState("prompt"),this._stream=await navigator.mediaDevices.getUserMedia(e),this._stream.addEventListener("inactive",()=>{this._setPermissionsState("denied")}),this.$.video=this._stream,this._capturing=!0,this._setPermissionsState("granted")}catch(e){this._setPermissionsState("denied"),console.log("Failed to capture camera",e),this.telemetryManager.sendEventError(e,"camera capturing. Failed to capture camera")}};_handlePermissionsChange=()=>{this._capture()};_permissionAccess=async()=>{try{for(let e of tm){let t=await navigator.permissions.query({name:e});this._permissionResponses[e]=t,t.addEventListener("change",this._handlePermissionsChange)}}catch(e){console.log("Failed to use permissions API. Fallback to manual request mode.",e),this.telemetryManager.sendEventError(e,"camera permissions. Failed to use permissions API"),this._capture()}};_getPermission=()=>{};_requestDeviceAccess=async()=>{try{await navigator.mediaDevices.getUserMedia({video:!0,audio:this.cfg.enableAudioRecording}),await this._getDevices(),navigator.mediaDevices.addEventListener("devicechange",this._getDevices)}catch(e){this.telemetryManager.sendEventError(e,"camera devices. Failed to get user media"),console.log("Failed to get user media",e)}};_getDevices=async()=>{try{let e=await navigator.mediaDevices.enumerateDevices();this._cameraDevices=e.filter(e=>"videoinput"===e.kind).map((e,t)=>({text:e.label.trim()||`${this.l10n("caption-camera")} ${t+1}`,value:e.deviceId})),this._audioDevices=this.cfg.enableAudioRecording?e.filter(e=>"audioinput"===e.kind).map(e=>({text:e.label.trim(),value:e.deviceId})):[],this._cameraDevices.length>1&&this.set$({cameraSelectOptions:this._cameraDevices,cameraSelectHidden:!1}),this._selectedCameraId=this._cameraDevices[0]?.value??null,this._audioDevices.length>1&&this.set$({audioSelectOptions:this._audioDevices,audioSelectHidden:!1}),this._selectedAudioId=this._audioDevices[0]?.value??null}catch(e){this.telemetryManager.sendEventError(e,"camera devices. Failed to get devices"),console.log("Failed to get devices",e)}};_onActivate=async()=>{await this._permissionAccess(),await this._requestDeviceAccess(),await this._capture(),this._handleCameraModes(this._cameraModes)};_onDeactivate=async()=>{this._unsubPermissions&&this._unsubPermissions(),window.chrome||this._setPermissionsState("denied"),this._stopCapture()};_handleCameraModes=e=>{this.$.tabVideoHidden=!e.includes(ts.VIDEO),this.$.tabCameraHidden=!e.includes(ts.PHOTO);let t=e[0];!t||this._activeTab&&e.includes(this._activeTab)||this._handleActiveTab(t)};initCallback(){super.initCallback(),this.registerActivity(this.activityType,{onActivate:this._onActivate,onDeactivate:this._onDeactivate}),this.subConfigValue("cameraMirror",e=>{this.$.videoTransformCss=e?"scaleX(-1)":null}),this.subConfigValue("enableAudioRecording",e=>{this.$.audioToggleMicrophoneHidden=!e,this.$.audioSelectDisabled=!e}),this.subConfigValue("cameraModes",e=>{if(!this.isActivityActive)return;let t=_(e);this._handleCameraModes(t.filter(e=>e===ts.PHOTO||e===ts.VIDEO))})}_destroy(){for(let e of tm)this._permissionResponses[e]?.removeEventListener("change",this._handlePermissionsChange);navigator.mediaDevices?.removeEventListener("devicechange",this._getDevices)}async destroyCallback(){super.destroyCallback(),this._destroy()}};tv.template=`
  <uc-activity-header>
    <button
      type="button"
      class="uc-mini-btn"
      set="onclick: *historyBack"
      l10n="@title:back"
    >
      <uc-icon name="back"></uc-icon>
    </button>
    <div set="@hidden: !cameraSelectHidden">
      <uc-icon name="camera"></uc-icon>
      <span l10n="caption-camera"></span>
    </div>
    <uc-select
      class="uc-camera-select"
      set="$.options: cameraSelectOptions; @hidden: cameraSelectHidden; onchange: onCameraSelectChange"
    >
    </uc-select>
    <button
      type="button"
      class="uc-mini-btn uc-close-btn"
      set="onclick: *closeModal"
      l10n="@title:a11y-activity-header-button-close;@aria-label:a11y-activity-header-button-close"
    >
      <uc-icon name="close"></uc-icon>
    </button>
  </uc-activity-header>
  <div class="uc-content">
    <video
      muted
      autoplay
      playsinline
      set="srcObject: video; style.transform: videoTransformCss; @hidden: videoHidden"
      ref="video"
    ></video>
    <div class="uc-message-box" set="@hidden: messageHidden">
      <span l10n="l10nMessage"></span>
      <button
        type="button"
        set="onclick: onRequestPermissions; @hidden: requestBtnHidden"
        l10n="camera-permissions-request"
      ></button>
    </div>
  </div>

  <div class="uc-controls">
    <div ref="switcher" class="uc-switcher" set="@hidden:!timerHidden">
      <button
        data-id="photo"
        type="button"
        class="uc-switch uc-mini-btn"
        set="onclick: onClickTab;  @hidden: tabCameraHidden"
      >
        <uc-icon name="camera"></uc-icon>
      </button>
      <button
        data-id="video"
        type="button"
        class="uc-switch uc-mini-btn"
        set="onclick: onClickTab; @hidden: tabVideoHidden"
      >
        <uc-icon name="video-camera"></uc-icon>
      </button>
    </div>

    <button
      class="uc-secondary-btn uc-recording-timer"
      set="@hidden:timerHidden; onclick: onToggleRecording"
    >
      <uc-icon set="@name: currentTimelineIcon"></uc-icon>
      <span ref="timer"> 00:00 </span>
      <span ref="line" class="uc-line"></span>
    </button>

    <div
      class="uc-camera-actions uc-camera-action"
      set="@hidden: cameraActionsHidden"
    >
      <button type="button" class="uc-secondary-btn" set="onclick: onRetake">
        Retake
      </button>
      <button
        type="button"
        class="uc-primary-btn"
        set="onclick: onAccept"
        data-testid="accept"
      >
        Accept
      </button>
    </div>

    <button
      type="button"
      class="uc-shot-btn uc-camera-action"
      data-testid="shot"
      set="onclick: onStartCamera; @class: mutableClassButton; @hidden: cameraHidden;"
    >
      <uc-icon set="@name: currentIcon"></uc-icon>
    </button>

    <div class="uc-select">
      <button
        class="uc-mini-btn uc-btn-microphone"
        set="onclick: onToggleAudio; @hidden: audioToggleMicrophoneHidden;"
      >
        <uc-icon set="@name:toggleMicrophoneIcon"></uc-icon>
      </button>

      <uc-select
        class="uc-audio-select"
        set="$.options: audioSelectOptions; onchange: onAudioSelectChange; @hidden: audioSelectHidden; @disabled: audioSelectDisabled"
      >
      </uc-select>
    </div>
  </div>
`;var t_="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=";function ty(...e){return e.reduce((e,t)=>{if("string"==typeof t)return e[t]=!0,e;for(let i of Object.keys(t))e[i]=t[i];return e},{})}function tw(...e){let t=ty(...e);return Object.keys(t).reduce((e,i)=>(t[i]&&e.push(i),e),[]).join(" ")}var tC=e=>H.includes(e),tE=`
  <svg width='0' height='0' style='position:absolute'><symbol fill='none' viewBox='0 0 9 6' id='uc-icon-arrow-dropdown' xmlns='http://www.w3.org/2000/svg'><path stroke='currentColor' d='m1.5 1.667 3 2.666 3-2.666' opacity='.5'/></symbol><symbol viewBox='0 0 24 24' id='uc-icon-aspect-ratio' xmlns='http://www.w3.org/2000/svg'/><symbol viewBox='0 0 20 20' id='uc-icon-brightness' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M15 10a5 5 0 0 1-5 5m5-5a5 5 0 0 0-5-5m5 5h-5m0 5a5 5 0 0 1 0-10m0 10V5m0 15v-3M2.93 2.929 5.05 5.05M0 10h3m-.07 7.071 2.12-2.121M10 0v3m7.07 14.071-2.12-2.121M20 10h-3m.07-7.071L14.95 5.05m-.626 2.45H10m4.324 5H10'/></symbol><symbol fill='currentColor' viewBox='0 0 20 20' id='uc-icon-closeMax' xmlns='http://www.w3.org/2000/svg'><path fill-rule='evenodd' d='M8.232 10 3.585 5.353l1.768-1.768L10 8.232l4.648-4.647 1.767 1.768L11.768 10l4.647 4.648-1.767 1.767L10 11.768l-4.647 4.647-1.768-1.767L8.232 10Z' clip-rule='evenodd'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-contrast' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M2 10a8 8 0 1 0 16 0 8 8 0 1 0-16 0m8-8v16m8-8h-8m7.598 2.5H10m6.24 2.5H10m7.6-7.5H10M16.242 5H10'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-crop' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M20 14H7.005C6.45 14 6 13.55 6 12.995V0M0 6h13.067c.515 0 .933.418.933.933V20M14.5.4 13 2l1.5 1.6M13 2h2a3 3 0 0 1 3 3v2M5.5 19.6 7 18l-1.5-1.6M7 18H5a3 3 0 0 1-3-3v-2'/></symbol><symbol fill='currentColor' viewBox='0 0 20 20' id='uc-icon-done' xmlns='http://www.w3.org/2000/svg'><path fill-rule='evenodd' d='m18.057 6.333-9.365 9.125a1.25 1.25 0 0 1-1.768-.023L1.92 10.296l1.791-1.744 4.132 4.243 8.47-8.253 1.744 1.79Z' clip-rule='evenodd'/></symbol><symbol fill='currentColor' viewBox='0 0 25 24' id='uc-icon-edit-file' xmlns='http://www.w3.org/2000/svg'><path fill-rule='evenodd' d='M18.558 2.804a.78.78 0 0 0-.557.235l-.008.007-2.472 2.46 3.847 3.848 2.46-2.473.004-.003a.78.78 0 0 0 0-1.108l-.004-.003-2.712-2.728a.78.78 0 0 0-.558-.235Zm-.248 7.613-3.852-3.852-8.93 8.887-1.516 5.41 5.41-1.515 8.888-8.93Zm-.636-8.934a2.28 2.28 0 0 1 2.512.505l2.702 2.717.002.002a2.278 2.278 0 0 1 0 3.234l-.002.002-12.541 12.602a.75.75 0 0 1-.33.193l-6.884 1.928a.75.75 0 0 1-.925-.924l1.928-6.885a.75.75 0 0 1 .193-.33l12.603-12.54a2.28 2.28 0 0 1 .742-.504Z' clip-rule='evenodd'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-enhance' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M19 13h-2m0 0a4 4 0 0 1-4-4m4 4a4 4 0 0 0-4 4m0-8V7m0 2a4 4 0 0 1-4 4m-2 0h2m0 0a4 4 0 0 1 4 4m0 0v2M8 8.5H6.5m0 0a2 2 0 0 1-2-2m2 2a2 2 0 0 0-2 2m0-4V5m0 1.5a2 2 0 0 1-2 2M1 8.5h1.5m0 0a2 2 0 0 1 2 2m0 0V12M12 3h-1m0 0a1 1 0 0 1-1-1m1 1a1 1 0 0 0-1 1m0-2V1m0 1a1 1 0 0 1-1 1M8 3h1m0 0a1 1 0 0 1 1 1m0 0v1'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-exposure' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M10 20v-3M2.93 2.929 5.05 5.05M0 10h3m-.07 7.071 2.12-2.121M10 0v3m7.07 14.071-2.12-2.121M20 10h-3m.07-7.071L14.95 5.05M5 10a5 5 0 1 0 10 0 5 5 0 1 0-10 0'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-filters' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M4.5 6.5a5.5 5.5 0 1 0 11 0 5.5 5.5 0 1 0-11 0m-3.5 6a5.5 5.5 0 1 0 11 0 5.5 5.5 0 1 0-11 0m7 0a5.5 5.5 0 1 0 11 0 5.5 5.5 0 1 0-11 0'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-flip' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M19.6 5 18 3.5 16.4 5m3.2 10L18 16.5 16.4 15M18 3.523v12.954M3.3 8.5h10.654c.301 0 .415-.395.159-.554L3.459 1.286A.3.3 0 0 0 3 1.542V8.2a.3.3 0 0 0 .3.3zm0 3h10.654c.301 0 .415.395.159.554l-10.654 6.66A.3.3 0 0 1 3 18.458v-6.66a.3.3 0 0 1 .3-.3z'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-gamma' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M17 3C9 6 2.5 11.5 2.5 17.5m0 0h1m-1 0v-1m14 1h1m-3 0h1m-3 0h1m-3 0h1m-3 0h1m-3 0h1m-3 0h1m-3-14v-1m0 3v-1m0 3v-1m0 3v-1m0 3v-1m0 3v-1m0 3v-1'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-mirror' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M5 .4 3.5 2 5 3.6M15 .4 16.5 2 15 3.6M3.52 2h12.957M8.5 16.7V6.046c0-.301-.394-.415-.554-.159L1.287 16.541a.3.3 0 0 0 .255.459H8.2a.3.3 0 0 0 .3-.3zm3 0V6.046c0-.301.395-.415.555-.159l6.659 10.654a.3.3 0 0 1-.255.459H11.8a.3.3 0 0 1-.3-.3z'/></symbol><symbol viewBox='0 0 40 40' id='uc-icon-original' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.5' d='M0 40 40 0'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-rotate' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M13.5.4 12 2l1.5 1.6M12.023 2H14.4A3.6 3.6 0 0 1 18 5.6V8M4 17h9a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1v9a1 1 0 0 0 1 1z'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-sad' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M2 17c4.418-4 11.582-4 16 0M16.5 5a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm-11 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0z'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-saturation' xmlns='http://www.w3.org/2000/svg'><defs><linearGradient id='ruc-icon-id__a' x1='10.001' y1='1' x2='10.001' y2='19' gradientUnits='userSpaceOnUse'><stop stop-color='#DE15FF'/><stop offset='.203' stop-color='#0029FF'/><stop offset='.479' stop-color='#2AE4F0'/><stop offset='.604' stop-color='#15EF11'/><stop offset='.75' stop-color='#FAE528'/><stop offset='1' stop-color='#EB2A2A'/></linearGradient></defs><circle cx='10.001' cy='10' r='9' transform='rotate(90 10 10)' fill='url(#ruc-icon-id__a)'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-slider' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M0 10h11m0 0a2 2 0 1 0 4 0m-4 0a2 2 0 1 1 4 0m0 0h5'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-tuning' xmlns='http://www.w3.org/2000/svg'><path stroke-linejoin='round' fill='none' stroke='currentColor' stroke-width='1.2' d='M8 10h11M1 10h4M1 4.5h11m3 0h4m-18 11h11m3 0h4m-7-11a1.5 1.5 0 1 0 3 0 1.5 1.5 0 1 0-3 0M5 10a1.5 1.5 0 1 0 3 0 1.5 1.5 0 1 0-3 0m7 5.5a1.5 1.5 0 1 0 3 0 1.5 1.5 0 1 0-3 0'/></symbol><symbol viewBox='0 0 20 20' id='uc-icon-vibrance' xmlns='http://www.w3.org/2000/svg'><path d='M2.125 5.64A8.96 8.96 0 0 0 1.001 10a8.96 8.96 0 0 0 1.124 4.36V5.64z' fill='url(#uuc-icon-id__a)'/><path d='M2.875 15.499V4.502a9.053 9.053 0 0 1 1.75-1.72v14.437a9.05 9.05 0 0 1-1.75-1.72z' fill='url(#uuc-icon-id__b)'/><path d='M5.375 17.722c.548.33 1.134.601 1.75.809V1.469a8.956 8.956 0 0 0-1.75.81v15.443z' fill='url(#uuc-icon-id__c)'/><path d='M7.875 1.253v17.495c.564.136 1.15.22 1.75.244V1.008a9 9 0 0 0-1.75.245z' fill='url(#uuc-icon-id__d)'/><path d='M10.375 1.008v17.984a9 9 0 0 0 1.75-.244V1.252a9 9 0 0 0-1.75-.244z' fill='url(#uuc-icon-id__e)'/><path d='M12.875 1.469V18.53a8.957 8.957 0 0 0 1.75-.808V2.277a8.957 8.957 0 0 0-1.75-.808z' fill='url(#uuc-icon-id__f)'/><path d='M15.375 2.78v14.44a9.053 9.053 0 0 0 1.75-1.72v-11a9.054 9.054 0 0 0-1.75-1.72z' fill='url(#uuc-icon-id__g)'/><path d='M17.875 5.638v8.724A8.959 8.959 0 0 0 19.001 10a8.96 8.96 0 0 0-1.126-4.362z' fill='url(#uuc-icon-id__h)'/><defs><linearGradient id='uuc-icon-id__a' x1='19.001' y1='10' x2='1.001' y2='10' gradientUnits='userSpaceOnUse'><stop stop-color='#DE15FF'/><stop offset='.203' stop-color='#0029FF'/><stop offset='.479' stop-color='#2AE4F0'/><stop offset='.604' stop-color='#15EF11'/><stop offset='.75' stop-color='#FAE528'/><stop offset='1' stop-color='#EB2A2A'/></linearGradient><linearGradient id='uuc-icon-id__b' x1='19.001' y1='10' x2='1.001' y2='10' gradientUnits='userSpaceOnUse'><stop stop-color='#DE15FF'/><stop offset='.203' stop-color='#0029FF'/><stop offset='.479' stop-color='#2AE4F0'/><stop offset='.604' stop-color='#15EF11'/><stop offset='.75' stop-color='#FAE528'/><stop offset='1' stop-color='#EB2A2A'/></linearGradient><linearGradient id='uuc-icon-id__c' x1='19.001' y1='10' x2='1.001' y2='10' gradientUnits='userSpaceOnUse'><stop stop-color='#DE15FF'/><stop offset='.203' stop-color='#0029FF'/><stop offset='.479' stop-color='#2AE4F0'/><stop offset='.604' stop-color='#15EF11'/><stop offset='.75' stop-color='#FAE528'/><stop offset='1' stop-color='#EB2A2A'/></linearGradient><linearGradient id='uuc-icon-id__d' x1='19.001' y1='10' x2='1.001' y2='10' gradientUnits='userSpaceOnUse'><stop stop-color='#DE15FF'/><stop offset='.203' stop-color='#0029FF'/><stop offset='.479' stop-color='#2AE4F0'/><stop offset='.604' stop-color='#15EF11'/><stop offset='.75' stop-color='#FAE528'/><stop offset='1' stop-color='#EB2A2A'/></linearGradient><linearGradient id='uuc-icon-id__e' x1='19.001' y1='10' x2='1.001' y2='10' gradientUnits='userSpaceOnUse'><stop stop-color='#DE15FF'/><stop offset='.203' stop-color='#0029FF'/><stop offset='.479' stop-color='#2AE4F0'/><stop offset='.604' stop-color='#15EF11'/><stop offset='.75' stop-color='#FAE528'/><stop offset='1' stop-color='#EB2A2A'/></linearGradient><linearGradient id='uuc-icon-id__f' x1='19.001' y1='10' x2='1.001' y2='10' gradientUnits='userSpaceOnUse'><stop stop-color='#DE15FF'/><stop offset='.203' stop-color='#0029FF'/><stop offset='.479' stop-color='#2AE4F0'/><stop offset='.604' stop-color='#15EF11'/><stop offset='.75' stop-color='#FAE528'/><stop offset='1' stop-color='#EB2A2A'/></linearGradient><linearGradient id='uuc-icon-id__g' x1='19.001' y1='10' x2='1.001' y2='10' gradientUnits='userSpaceOnUse'><stop stop-color='#DE15FF'/><stop offset='.203' stop-color='#0029FF'/><stop offset='.479' stop-color='#2AE4F0'/><stop offset='.604' stop-color='#15EF11'/><stop offset='.75' stop-color='#FAE528'/><stop offset='1' stop-color='#EB2A2A'/></linearGradient><linearGradient id='uuc-icon-id__h' x1='19.001' y1='10' x2='1.001' y2='10' gradientUnits='userSpaceOnUse'><stop stop-color='#DE15FF'/><stop offset='.203' stop-color='#0029FF'/><stop offset='.479' stop-color='#2AE4F0'/><stop offset='.604' stop-color='#15EF11'/><stop offset='.75' stop-color='#FAE528'/><stop offset='1' stop-color='#EB2A2A'/></linearGradient></defs></symbol><symbol viewBox='0 0 20 20' id='uc-icon-warmth' xmlns='http://www.w3.org/2000/svg'><path d='m7.5 13.05.429.42.171-.175v-.244h-.6zm5 0h-.6v.245l.172.175.428-.42zM8.1 3.5c0-1.05.85-1.9 1.9-1.9V.4a3.1 3.1 0 0 0-3.1 3.1h1.2zm0 9.55V3.5H6.9v9.55h1.2zm-1 2.45c0-.79.315-1.506.829-2.03l-.858-.84A4.088 4.088 0 0 0 5.9 15.5h1.2zm2.9 2.9a2.9 2.9 0 0 1-2.9-2.9H5.9a4.1 4.1 0 0 0 4.1 4.1v-1.2zm2.9-2.9a2.9 2.9 0 0 1-2.9 2.9v1.2a4.1 4.1 0 0 0 4.1-4.1h-1.2zm-.829-2.03c.514.524.829 1.24.829 2.03h1.2c0-1.117-.447-2.13-1.171-2.87l-.858.84zM11.9 3.5v9.55h1.2V3.5h-1.2zM10 1.6c1.05 0 1.9.85 1.9 1.9h1.2A3.1 3.1 0 0 0 10 .4v1.2z' fill='currentColor'/><path d='M10 14V8' stroke='currentColor' stroke-width='1.2' stroke-linecap='round'/><path d='M14 3h3m-3 3h3m-3 3h3m-8 6.5a1 1 0 1 0 2 0 1 1 0 1 0-2 0' stroke='currentColor' stroke-width='1.2'/></symbol></svg>
  <div class="uc-wrapper uc-wrapper_desktop">
    <uc-presence-toggle class="uc-network_problems_splash" set="visible: presence.networkProblems;">
      <div class="uc-network_problems_content">
        <div class="uc-network_problems_icon">
          <uc-icon name="sad"></uc-icon>
        </div>
        <div class="uc-network_problems_text">Network error</div>
      </div>
      <div class="uc-network_problems_footer">
        <uc-btn-ui theme="primary" text="Retry" set="onclick: *on.retryNetwork"></uc-btn-ui>
      </div>
    </uc-presence-toggle>
    <div class="uc-viewport">
      <div class="uc-file_type_outer">
        <div class="uc-file_type">{{fileType}}</div>
      </div>
      <div class="uc-image_container" ref="img-container-el">
        <img src="${t_}" class="uc-image uc-image_visible_from_editor" ref="img-el" />
        <uc-editor-image-cropper ref="cropper-el"></uc-editor-image-cropper>
        <uc-editor-image-fader ref="fader-el"></uc-editor-image-fader>
      </div>
      <div class="uc-info_pan">{{msg}}</div>
    </div>
    <div class="uc-toolbar">
      <uc-line-loader-ui set="active: showLoader"></uc-line-loader-ui>
      <div class="uc-toolbar_content uc-toolbar_content__editor">
        <uc-editor-toolbar></uc-editor-toolbar>
      </div>
    </div>
  </div>
`,tA=class extends eA{ctxOwner=!0;static styleAttrs=["uc-cloud-image-editor"];_debouncedShowLoader=v(this._showLoader.bind(this),300);constructor(){super(),this.init$={...this.init$,...function(e){return{"*originalUrl":null,"*faderEl":null,"*cropperEl":null,"*imgEl":null,"*imgContainerEl":null,"*networkProblems":!1,"*imageSize":null,"*editorTransformations":{},"*cropPresetList":[],"*currentAspectRatio":null,"*tabList":H,"*tabId":z.CROP,entry:null,extension:null,editorMode:!1,modalCaption:"",isImage:!1,msg:"",src:t_,fileType:"",showLoader:!1,uuid:null,cdnUrl:null,cropPreset:"",tabs:y([...H]),"presence.networkProblems":!1,"presence.modalCaption":!0,"presence.editorToolbar":!1,"presence.viewerToolbar":!0,"*on.retryNetwork":()=>{for(let t of e.querySelectorAll("img")){let e=t.src;t.src=t_,t.src=e}e.$["*networkProblems"]=!1},"*on.apply":t=>{if(!t)return;let i=e.$["*originalUrl"],s=E(P(t),"preview"),r=S(i,s);e.dispatchEvent(new CustomEvent("apply",{detail:{originalUrl:i,cdnUrlModifiers:s,cdnUrl:r,transformations:t},bubbles:!0,composed:!0})),e.remove()},"*on.cancel":()=>{e.remove(),e.dispatchEvent(new CustomEvent("cancel",{bubbles:!0,composed:!0}))}}}(this)}}_showLoader(e){this.$.showLoader=e}_waitForSize(){return new Promise((e,t)=>{let i=window.setTimeout(()=>{t(Error("[cloud-image-editor] timeout waiting for non-zero container size"))},3e3),s=new ResizeObserver(t=>{let[r]=t;r&&r.contentRect.width>0&&r.contentRect.height>0&&(window.clearTimeout(i),s.disconnect(),window.setTimeout(()=>e(),0))});s.observe(this)})}initCallback(){super.initCallback(),this.$["*faderEl"]=this.ref["fader-el"],this.$["*cropperEl"]=this.ref["cropper-el"],this.$["*imgContainerEl"]=this.ref["img-container-el"],this.initEditor()}async updateImage(){if(this.isConnected){if(await this._waitForSize(),this.$.cdnUrl){let e=this.$.cdnUrl,t=$(e),i=O(e,t);if(i===this.$["*originalUrl"])return;this.$["*originalUrl"]=i;let s=N(I(e));this.$["*editorTransformations"]=s}else if(this.$.uuid){let e=O(this.cfg.cdnCname,this.$.uuid);if(e===this.$["*originalUrl"])return;this.$["*originalUrl"]=e,this.$["*editorTransformations"]={}}else throw Error("No UUID nor CDN URL provided");this.$["*tabId"]===z.CROP?this.$["*cropperEl"]?.deactivate({reset:!0}):this.$["*faderEl"]?.deactivate();try{let e=this.$["*originalUrl"],t=await this.proxyUrl(S(e,E("json"))),{width:i,height:s}=await fetch(t).then(e=>e.json());this.$["*imageSize"]={width:i,height:s},this.$["*tabId"]===z.CROP?this.$["*cropperEl"]?.activate(this.$["*imageSize"]):this.$["*faderEl"]?.activate({url:e})}catch(e){e&&(this.telemetryManager.sendEventError(e,"cloud editor image. Failed to load image info"),console.error("Failed to load image info",e))}}}async initEditor(){try{await this._waitForSize()}catch(e){this.isConnected&&console.error(e.message);return}this.ref["img-el"].addEventListener("load",()=>{this._debouncedShowLoader(!1),this.$.src!==t_&&(this.$["*networkProblems"]=!1)}),this.ref["img-el"].addEventListener("error",()=>{this._debouncedShowLoader(!1),this.$["*networkProblems"]=!0}),this.sub("src",e=>{let t=this.ref["img-el"];t.src!==e&&(t.src=e||t_)}),this.sub("tabs",e=>{this.$["*tabList"]=(e=>{if(!e)return H;let t=_(e).filter(tC);return 0===t.length?H:t})(e)}),this.sub("*tabId",e=>{this.ref["img-el"].className=tw("uc-image",{"uc-image_hidden_to_cropper":e===z.CROP,"uc-image_hidden_effects":e!==z.CROP})}),this.classList.add("uc-editor_ON"),this.sub("*networkProblems",e=>{this.$["presence.networkProblems"]=e,this.$["presence.modalCaption"]=!e}),this.sub("*editorTransformations",e=>{if(0===Object.keys(e).length)return;let t=this.$["*originalUrl"],i=E(P(e),"preview"),s=S(t,i);this.dispatchEvent(new CustomEvent("change",{detail:{originalUrl:t,cdnUrlModifiers:i,cdnUrl:s,transformations:e},bubbles:!0,composed:!0}))},!1),this.sub("uuid",e=>e&&this.updateImage()),this.sub("cdnUrl",e=>e&&this.updateImage()),this.sub("cropPreset",e=>{let t=eD(e),i=null;if(this.$.cdnUrl){let e=N(I(this.$.cdnUrl));if(Array.isArray(e?.crop?.dimensions)){let[s,r]=e.crop.dimensions;i=((e,t,i,s=.1)=>{let r=e/t,a=null,o=1/0;for(let e of i){let[t,i]=[e.width,e.height],s=Math.abs(r-t/i);s<o&&(o=s,a=e)}if(a){let[e,t]=[a.width,a.height],i=e/t;if(Math.abs(r-i)/i>s)return null}return a})(s,r,t,.1)}}this.$["*cropPresetList"]=t,this.$["*currentAspectRatio"]=i??t?.[0]??null})}};tA.template=tE,tA.bindAttributes({uuid:"uuid","cdn-url":"cdnUrl","crop-preset":"cropPreset",tabs:"tabs"});var t$=class extends eA{_handlePointerUp;_handlePointerMove;_handleSvgPointerMove;_backdropMaskId=`backdrop-mask-${r.V0.generate()}`;_backdropMask;_backdropMaskInner;_frameThumbs;_frameGuides;_draggingThumb;_hoverThumb;_dragStartPoint;_dragStartCrop;_frameImage;_guidesHidden=!1;constructor(){super(),this.init$={...this.init$,dragging:!1},this._handlePointerUp=this._handlePointerUp_.bind(this),this._handlePointerMove=this._handlePointerMove_.bind(this),this._handleSvgPointerMove=this._handleSvgPointerMove_.bind(this)}_shouldThumbBeDisabled(e){let t=this.$["*imageBox"];if(!t)return!1;if(""===e&&t.height<=1&&t.width<=1)return!0;let i=t.height<=1&&(e.includes("n")||e.includes("s")),s=t.width<=1&&(e.includes("e")||e.includes("w"));return i||s}_createBackdrop(){let e=this.$["*cropBox"];if(!e)return;let{x:t,y:i,width:s,height:r}=e,a=this.ref["svg-el"],o=eL("mask",{id:this._backdropMaskId}),l=eL("rect",{x:0,y:0,width:"100%",height:"100%",fill:"white"}),n=eL("rect",{x:t,y:i,width:s,height:r,fill:"black"});o.appendChild(l),o.appendChild(n);let c=eL("rect",{x:0,y:0,width:"100%",height:"100%",fill:"var(--color-image-background)","fill-opacity":.85,mask:`url(#${this._backdropMaskId})`});a.appendChild(c),a.appendChild(o),this._backdropMask=o,this._backdropMaskInner=n}_resizeBackdrop(){this._backdropMask&&(this._backdropMask.style.display="none",window.requestAnimationFrame(()=>{this._backdropMask&&(this._backdropMask.style.display="block")}))}_updateBackdrop(){let e=this.$["*cropBox"];if(!e)return;let{x:t,y:i,width:s,height:r}=e;this._backdropMaskInner&&eO(this._backdropMaskInner,{x:t,y:i,width:s,height:r})}_updateFrame(){let e=this.$["*cropBox"];if(e&&this._frameGuides&&this._frameThumbs){for(let t of Object.values(this._frameThumbs)){if(!t)continue;let{direction:i,pathNode:s,interactionNode:r,groupNode:a}=t,o=""===i,l=2===i.length,{x:n,y:c,width:d,height:h}=e;if(o)eO(r,{x:n,y:c,width:d,height:h});else{let t=eF(Math.min(d,h)/82/2,0,1),a=l?function(e,t,i){let{x:s,y:r,width:a,height:o}=e,l=+!t.includes("w"),n=+!t.includes("n"),c=0===l?-1:1,d=0===n?-1:1,h=[s+l*a+1.5*c,r+n*o+1.5*d-24*i*d],u=[s+l*a+1.5*c,r+n*o+1.5*d],p=[s+l*a-24*i*c+1.5*c,r+n*o+1.5*d];return{d:`M ${h[0]} ${h[1]} L ${u[0]} ${u[1]} L ${p[0]} ${p[1]}`,center:[u[0],u[1]]}}(e,i,t):function(e,t,i){let s,r,{x:a,y:o,width:l,height:n}=e,c="n"===t||"s"===t,d=c?.5:+("w"!==t),h="w"===t||"e"===t?.5:+("n"!==t),u="w"===t?-1:+("e"===t),p="n"===t?-1:+("s"===t);return c?(s=[a+d*l-34*i/2,o+h*n+1.5*p],r=[a+d*l+34*i/2,o+h*n+1.5*p]):(s=[a+d*l+1.5*u,o+h*n-34*i/2],r=[a+d*l+1.5*u,o+h*n+34*i/2]),{d:`M ${s[0]} ${s[1]} L ${r[0]} ${r[1]}`,center:[(s[0]+r[0])/2,(s[1]+r[1])/2]}}(e,i,t),o=a.center;if(!o)continue;let n=Math.max(24*eF(Math.min(d,h)/24/3,0,1),6);eO(r,{x:o[0]-n,y:o[1]-n,width:2*n,height:2*n}),eO(s,{d:a.d})}let u=this._shouldThumbBeDisabled(i);a.setAttribute("class",tw("uc-thumb",{"uc-thumb--hidden":u,"uc-thumb--visible":!u}))}eO(this._frameGuides,{x:e.x-.5,y:e.y-.5,width:e.width+1,height:e.height+1})}}_createThumb(e,t){let i=eL("g");i.classList.add("uc-thumb"),i.setAttribute("with-effects","");let s=eL("rect",{fill:"transparent"}),r=eL("path",{stroke:"currentColor",fill:"none","stroke-width":3});i.appendChild(r),i.appendChild(s),e[t]={direction:t,pathNode:r,interactionNode:s,groupNode:i},""===t&&(i.style.cursor="move"),s.addEventListener("pointerdown",this._handlePointerDown.bind(this,t))}_createThumbs(){let e={};for(let t=0;t<3;t++)for(let i=0;i<3;i++){let s=`${["n","","s"][t]}${["w","","e"][i]}`;""!==s&&this._createThumb(e,s)}return this._createThumb(e,""),e}_createGuides(){let e=eL("svg"),t=eL("rect",{x:0,y:0,width:"100%",height:"100%",fill:"none",stroke:"currentColor","stroke-width":1,"stroke-opacity":.5});e.appendChild(t);for(let t=1;t<=2;t++){let i=eL("line",{x1:`${eS*t}%`,y1:"0%",x2:`${eS*t}%`,y2:"100%",stroke:"currentColor","stroke-width":1,"stroke-opacity":.3});e.appendChild(i)}for(let t=1;t<=2;t++){let i=eL("line",{x1:"0%",y1:`${eS*t}%`,x2:"100%",y2:`${eS*t}%`,stroke:"currentColor","stroke-width":1,"stroke-opacity":.3});e.appendChild(i)}return e.classList.add("uc-guides","uc-guides--semi-hidden"),e}_createFrame(){let e=this.ref["svg-el"],t=document.createDocumentFragment(),i=this._createGuides();t.appendChild(i);let s=this._createThumbs();for(let{groupNode:e}of Object.values(s))t.appendChild(e);e.appendChild(t),this._frameThumbs=s,this._frameGuides=i}_handlePointerDown(e,t){if(!this._frameThumbs)return;let i=this._frameThumbs[e];if(!i||this._shouldThumbBeDisabled(e))return;let s=this.$["*cropBox"],{x:r,y:a}=this.ref["svg-el"].getBoundingClientRect(),o=t.x-r,l=t.y-a;this.$.dragging=!0,this._draggingThumb=i,this._dragStartPoint=[o,l],this._dragStartCrop={...s}}_handlePointerUp_(e){this._updateCursor(),this.$.dragging&&(e.stopPropagation(),e.preventDefault(),this.$.dragging=!1)}_handlePointerMove_(e){if(!this.$.dragging||!this._dragStartPoint||!this._draggingThumb)return;e.stopPropagation(),e.preventDefault();let{x:t,y:i}=this.ref["svg-el"].getBoundingClientRect(),s=e.x-t,r=e.y-i,a=s-this._dragStartPoint[0],o=r-this._dragStartPoint[1],{direction:l}=this._draggingThumb,n=this._calcCropBox(l,[a,o]);n&&(this.$["*cropBox"]=n)}_calcCropBox(e,t){let[i,s]=t,r=this.$["*imageBox"],a=this._dragStartCrop??this.$["*cropBox"],o=this.$["*currentAspectRatio"],l=o?o.width/o.height:void 0;return Object.values(a=""===e?function({rect:e,delta:[t,i],imageBox:s}){return eU({...e,x:e.x+t,y:e.y+i},s)}({rect:a,delta:[i,s],imageBox:r}):function({direction:e,...t}){switch(e){case"n":return function({rect:e,delta:t,aspectRatio:i,imageBox:s}){let[,r]=t,{y:a,width:o,height:l}=e;a+=r,l-=r,i&&(o=l*i);let n=e.x+e.width/2-o/2;return a<=s.y&&(a=s.y,l=e.y+e.height-a,i&&(o=l*i,n=e.x+e.width/2-o/2)),n<=s.x&&(n=s.x,a=e.y+e.height-l),n+o>=s.x+s.width&&(n=Math.max(s.x,s.x+s.width-o),o=s.x+s.width-n,i&&(l=o/i),a=e.y+e.height-l),l<1&&(l=1,i&&(o=l*i,n=e.x+e.width/2-o/2),a=e.y+e.height-l),o<1&&(o=1,i&&(l=o/i,n=e.x+e.width/2-o/2),a=e.y+e.height-l),{x:n,y:a,width:o,height:l}}(t);case"w":return function({rect:e,delta:t,aspectRatio:i,imageBox:s}){let[r]=t,{x:a,width:o,height:l}=e;a+=r,o-=r,i&&(l=o/i);let n=e.y+e.height/2-l/2;return a<=s.x&&(a=s.x,o=e.x+e.width-a,i&&(l=o/i,n=e.y+e.height/2-l/2)),n<=s.y&&(n=s.y,a=e.x+e.width-o),n+l>=s.y+s.height&&(n=Math.max(s.y,s.y+s.height-l),l=s.y+s.height-n,i&&(o=l*i),a=e.x+e.width-o),l<1&&(l=1,i&&(o=l*i),n=e.y+e.height/2-l/2,a=e.x+e.width-o),o<1&&(o=1,i&&(l=o/i),n=e.y+e.height/2-l/2,a=e.x+e.width-o),{x:a,y:n,width:o,height:l}}(t);case"s":return function({rect:e,delta:t,aspectRatio:i,imageBox:s}){let[,r]=t,{y:a,width:o,height:l}=e;l+=r,i&&(o=l*i);let n=e.x+e.width/2-o/2;return a+l>=s.y+s.height&&(l=s.y+s.height-a,i&&(o=l*i),n=e.x+e.width/2-o/2),n<=s.x&&(n=s.x,a=e.y),n+o>=s.x+s.width&&(n=Math.max(s.x,s.x+s.width-o),o=s.x+s.width-n,i&&(l=o/i),a=e.y),l<1&&(l=1,i&&(o=l*i),n=e.x+e.width/2-o/2),o<1&&(o=1,i&&(l=o/i),n=e.x+e.width/2-o/2),{x:n,y:a,width:o,height:l}}(t);case"e":return function({rect:e,delta:t,aspectRatio:i,imageBox:s}){let[r]=t,{x:a,width:o,height:l}=e;o+=r,i&&(l=o/i);let n=e.y+e.height/2-l/2;return a+o>=s.x+s.width&&(o=s.x+s.width-a,i&&(l=o/i),n=e.y+e.height/2-l/2),n<=s.y&&(n=s.y,a=e.x),n+l>=s.y+s.height&&(n=Math.max(s.y,s.y+s.height-l),l=s.y+s.height-n,i&&(o=l*i),a=e.x),l<1&&(l=1,i&&(o=l*i),n=e.y+e.height/2-l/2),o<1&&(o=1,i&&(l=o/i),n=e.y+e.height/2-l/2),{x:a,y:n,width:o,height:l}}(t);case"nw":return function({rect:e,delta:t,aspectRatio:i,imageBox:s}){let[r,a]=t,{x:o,y:l,width:n,height:c}=e;return o+r<s.x&&(r=s.x-o),l+a<s.y&&(a=s.y-l),o+=r,n-=r,l+=a,c-=a,i&&Math.abs(n/c)>i?(a=n/i-c,c+=a,(l-=a)<=s.y&&(c-=s.y-l,n=c*i,o=e.x+e.width-n,l=s.y)):i&&(r=c*i-n,n+=r,(o-=r)<=s.x&&(n-=s.x-o,c=n/i,o=s.x,l=e.y+e.height-c)),c<1&&(c=1,i&&(n=c*i),o=e.x+e.width-n,l=e.y+e.height-c),n<1&&(n=1,i&&(c=n/i),o=e.x+e.width-n,l=e.y+e.height-c),{x:o,y:l,width:n,height:c}}(t);case"ne":return function({rect:e,delta:t,aspectRatio:i,imageBox:s}){let[r,a]=t,{x:o,y:l,width:n,height:c}=e;return o+n+r>s.x+s.width&&(r=s.x+s.width-o-n),l+a<s.y&&(a=s.y-l),n+=r,l+=a,c-=a,i&&Math.abs(n/c)>i?(a=n/i-c,c+=a,(l-=a)<=s.y&&(c-=s.y-l,n=c*i,o=e.x,l=s.y)):i&&(r=c*i-n,o+(n+=r)>=s.x+s.width&&(c=(n=s.x+s.width-o)/i,o=s.x+s.width-n,l=e.y+e.height-c)),c<1&&(c=1,i&&(n=c*i),l=e.y+e.height-c),n<1&&(n=1,i&&(c=n/i),l=e.y+e.height-c),{x:o,y:l,width:n,height:c}}(t);case"sw":return function({rect:e,delta:t,aspectRatio:i,imageBox:s}){let[r,a]=t,{x:o,y:l,width:n,height:c}=e;return o+r<s.x&&(r=s.x-o),l+c+a>s.y+s.height&&(a=s.y+s.height-l-c),o+=r,n-=r,c+=a,i&&Math.abs(n/c)>i?(a=n/i-c,l+(c+=a)>=s.y+s.height&&(n=(c=s.y+s.height-l)*i,o=e.x+e.width-n,l=s.y+s.height-c)):i&&(r=c*i-n,n+=r,(o-=r)<=s.x&&(n-=s.x-o,c=n/i,o=s.x,l=e.y)),c<1&&(c=1,i&&(n=c*i),o=e.x+e.width-n),n<1&&(n=1,i&&(c=n/i),o=e.x+e.width-n),{x:o,y:l,width:n,height:c}}(t);case"se":return function({rect:e,delta:t,aspectRatio:i,imageBox:s}){let[r,a]=t,{x:o,y:l,width:n,height:c}=e;return o+n+r>s.x+s.width&&(r=s.x+s.width-o-n),l+c+a>s.y+s.height&&(a=s.y+s.height-l-c),n+=r,c+=a,i&&Math.abs(n/c)>i?(a=n/i-c,l+(c+=a)>=s.y+s.height&&(n=(c=s.y+s.height-l)*i,o=e.x,l=s.y+s.height-c)):i&&(r=c*i-n,o+(n+=r)>=s.x+s.width&&(c=(n=s.x+s.width-o)/i,o=s.x+s.width-n,l=e.y)),c<1&&(c=1,i&&(n=c*i)),n<1&&(n=1,i&&(c=n/i)),{x:o,y:l,width:n,height:c}}(t);default:return t.rect}}({rect:a,delta:[i,s],direction:e,aspectRatio:l,imageBox:r})).every(e=>Number.isFinite(e)&&e>=0)?eU(eP(a),r):void console.error("CropFrame is trying to create invalid rectangle",{payload:a})}_handleSvgPointerMove_(e){if(!this._frameThumbs)return;let t=Object.values(this._frameThumbs).find(t=>{if(!t||this._shouldThumbBeDisabled(t.direction))return!1;let i=t.interactionNode.getBoundingClientRect();return function(e,[t,i]){return e.x<=t&&t<=e.x+e.width&&e.y<=i&&i<=e.y+e.height}({x:i.x,y:i.y,width:i.width,height:i.height},[e.x,e.y])});this._hoverThumb=t,this._updateCursor()}_updateCursor(){var e;let t=this._hoverThumb;this.ref["svg-el"].style.cursor=t?""===(e=t.direction)?"move":["e","w"].includes(e)?"ew-resize":["n","s"].includes(e)?"ns-resize":["nw","se"].includes(e)?"nwse-resize":"nesw-resize":"initial"}_createMask(e){if(this._frameImage)return void this._frameImage.setAttribute("href",e);let t=this.ref["svg-el"],i=document.createDocumentFragment(),s=eL("image",{href:e});s.setAttribute("class","uc-cloud-mask"),i.appendChild(s),t.appendChild(i),this._frameImage=s}_updateMask(){let e=this.$["*cropBox"];if(!e||!this._frameImage)return;let{x:t,y:i,width:s,height:r}=e;eO(this._frameImage,{x:t,y:i,height:r,width:s})}_render(){this._updateBackdrop(),this._updateFrame(),this._updateMask()}toggleThumbs(e){if(this._frameThumbs)for(let t of Object.values(this._frameThumbs)){if(!t)continue;let{groupNode:i}=t;i.setAttribute("class",tw("uc-thumb",{"uc-thumb--hidden":!e,"uc-thumb--visible":e}))}}initCallback(){super.initCallback(),this._createBackdrop(),this._createFrame(),this.sub("*imageBox",()=>{this._resizeBackdrop(),window.requestAnimationFrame(()=>{this._render()})}),this.sub("*cropBox",e=>{e&&(this._guidesHidden=e.height<=1||e.width<=1,window.requestAnimationFrame(()=>{this._render()}))}),this.subConfigValue("cloudImageEditorMaskHref",e=>{e&&this._createMask(e)}),this.sub("dragging",e=>{this._frameGuides&&this._frameGuides.setAttribute("class",tw({"uc-guides--hidden":this._guidesHidden,"uc-guides--visible":!this._guidesHidden&&e,"uc-guides--semi-hidden":!this._guidesHidden&&!e}))}),this.ref["svg-el"].addEventListener("pointermove",this._handleSvgPointerMove,!0),document.addEventListener("pointermove",this._handlePointerMove,!0),document.addEventListener("pointerup",this._handlePointerUp,!0)}destroyCallback(){super.destroyCallback(),this.ref["svg-el"].removeEventListener("pointermove",this._handleSvgPointerMove,!0),document.removeEventListener("pointermove",this._handlePointerMove),document.removeEventListener("pointerup",this._handlePointerUp)}};t$.template=' <svg class="uc-svg" ref="svg-el" xmlns="http://www.w3.org/2000/svg"></svg> ';var tx=class extends eA{_titleEl;constructor(){super(),this.init$={...this.init$,active:!1,title:"",icon:"","on.click":null,"title-prop":""}}initCallback(){super.initCallback(),this._titleEl=this.ref["title-el"],this.sub("title",e=>{let t=this._titleEl;t&&(t.style.display=e?"block":"none")}),this.sub("active",e=>{this.className=tw({"uc-active":e,"uc-not_active":!e})}),this.sub("on.click",e=>{this.onclick=e??null})}};tx.template=`
  <button role="option" type="button" set="@aria-label:title-prop;" l10n="@title:title-prop;">
    <uc-icon ref="icon-el" set="@name: icon;"></uc-icon>
    <div class="uc-title" ref="title-el">{{title}}</div>
  </button>
`;var tI=class extends tx{initCallback(){super.initCallback(),this.$.icon="arrow-dropdown",this.$["on.click"]=this.handleClick.bind(this),this.sub("*currentAspectRatio",e=>{this.$.title=e.hasFreeform?this.l10n("freeform-crop"):this.l10n("crop-to-shape",{value:`${e.width}:${e.height}`}),this.bindL10n("title-prop",()=>this.$.title)})}handleClick(){this.$["*showListAspectRatio"]=!0}};tI.template=` 
  <button role="option" type="button" set="@aria-label:title-prop;" l10n="@title:title-prop;">
    <div class="uc-title" ref="title-el">{{title}}</div>
    <uc-icon ref="icon-el" set="@name: icon;"></uc-icon>
  </button> 
`;var tk=class extends tx{constructor(){super(),this.init$={...this.init$,active:!1,once:!1}}initCallback(){super.initCallback(),this.defineAccessor("aspectRatio",e=>{if(!e)return;let t=!!e.hasFreeform;this.$.title=t?this.l10n("custom"):`${e.width}:${e.height}`,t||this._renderRectBasedOnAspectRatio(e),t&&this.setAttribute("uc-aspect-ratio-freeform",""),this._aspectRatio=e,this.bindL10n("title-prop",()=>this.l10n("a11y-cloud-editor-apply-aspect-ratio",{name:t?this.l10n("custom").toLowerCase():this.l10n("crop-to-shape",{value:`${e.width}:${e.height}`}).toLowerCase(),value:""}))}),this.sub("*currentAspectRatio",e=>{this.$.active=e&&e.id===this._aspectRatio?.id||e?.width===this._aspectRatio?.width&&e?.height===this._aspectRatio?.height}),this.$["on.click"]=this.handleClick.bind(this)}handleClick(){let e=this.$["*currentAspectRatio"];e?.id!==this._aspectRatio?.id&&(this.$["*currentAspectRatio"]=this._aspectRatio)}_renderRectBasedOnAspectRatio(e){let t,i,{width:s,height:r}=(t=12,i=12,e.width/e.height>=1?(t=12,i=Math.round(12*e.height/e.width)):(i=12,t=Math.round(12*e.width/e.height)),{width:t,height:i}),a=eL("rect",{"stroke-linejoin":"round",fill:"none",stroke:"currentColor","stroke-width":1.2,"fill-rule":"evenodd",x:(16-s)/2,y:(16-r)/2,rx:2,width:s,height:r}),o=this.ref["icon-el"]?.ref?.svg;o&&(o.innerHTML="",o.appendChild(a))}_aspectRatio},tM=class extends tx{_operation=void 0;initCallback(){super.initCallback(),this.defineAccessor("operation",e=>{e&&(this._operation=e,this.$.icon=e,this.bindL10n("title-prop",()=>this.l10n("a11y-cloud-editor-apply-crop",{name:this.l10n(e).toLowerCase()})))}),this.$["on.click"]=e=>{if(!this._operation)return;let t=this.$["*cropperEl"],i=t.getValue(this._operation),s=function(e,t){if("rotate"===e){let e;return(e=("number"==typeof t?t:0)+90)>=360?0:e}if("mirror"===e||"flip"===e)return!t;throw Error(`Unsupported operation: ${e}`)}(this._operation,i);this.telemetryManager.sendEventCloudImageEditor(e,this.$["*tabId"],{operation:this._operation,next:s,prev:i}),t.setValue(this._operation,s)}}};function tT(e){let t=new Image;return{promise:new Promise((i,s)=>{t.src=e,t.onload=()=>i(),t.onerror=e=>s(e)}),image:t,cancel:()=>{0===t.naturalWidth&&(t.src=t_)}}}function tS(e){let t=[];for(let i of e){let e=tT(i);t.push(e)}let i=t.map(e=>e.image);return{promise:Promise.allSettled(t.map(e=>e.promise)),images:i,cancel:()=>{t.forEach(e=>{e.cancel()})}}}var tO="original",tL=class extends eA{_operation="filter";_filter;_originalUrl="";constructor(){super(),this.init$={...this.init$,disabled:!1,min:0,max:100,value:0,defaultValue:0,zero:0,"on.input":e=>{let t=this.$["*faderEl"];t?.set(e),this.$.value=e}}}setOperation(e,t){this._operation=e,this._filter=t,this._initializeValues();let i=this.$["*faderEl"],s=this._originalUrl||this.$["*originalUrl"];i&&s&&i.activate({url:s,operation:this._operation,value:this._filter===tO?void 0:this.$.value,filter:this._filter===tO?void 0:this._filter,fromViewer:!1})}_initializeValues(){let e=this._operation,{range:t,zero:i}=q[e],[s,r]=t;this.$.min=s,this.$.max=r,this.$.zero=i;let a=this.$["*editorTransformations"][e];if("filter"===e){let e=Number(r);if(a){let{name:t,amount:i}=a;e=t===this._filter?i:r}this.$.value=e,this.$.defaultValue=e;return}let o=void 0!==a?a:i;this.$.value=o,this.$.defaultValue=o}apply(){let e={...this.$["*editorTransformations"]};"filter"===this._operation?this._filter&&this._filter!==tO?e.filter={name:this._filter,amount:this.$.value}:delete e.filter:e[this._operation]=this.$.value,this.$["*editorTransformations"]=e}cancel(){let e=this.$["*faderEl"];e?.deactivate({hide:!1})}initCallback(){super.initCallback(),this.sub("*originalUrl",e=>{this._originalUrl=e}),this.sub("value",e=>{let t=`${this._filter??this._operation} ${e}`;this.$["*operationTooltip"]=t})}};function tU(e){let t=e.match(/^([A-Za-z]+)\s+(\d+)$/);if(!t)return null;let[,i,s]=t;return i&&void 0!==s?{filter:i,value:Number(s)}:null}tL.template=`
  <uc-slider-ui
    ref="slider-el"
    set="disabled: disabled; min: min; max: max; defaultValue: defaultValue; zero: zero; onInput: on.input;"
  ></uc-slider-ui>
`;var tV=class extends tx{_operation="";_filter="";_originalUrl="";_observer;_cancelPreload;constructor(){super(),this.init$={...this.init$,active:!1,title:"",icon:"",isOriginal:!1,iconSize:"20","on.click":null}}_previewSrc(){let e=parseInt(window.getComputedStyle(this).getPropertyValue("--l-base-min-width"),10),t=window.devicePixelRatio,i=Math.ceil(t*e),s={...this.$["*editorTransformations"]};return s[this._operation]=this._filter!==tO?{name:this._filter,amount:100}:void 0,S(this._originalUrl,E(F,P(s),`quality/${t>=2?"lightest":"normal"}`,`scale_crop/${i}x${i}/center`))}async _observerCallback(e,t){let i=e[0];if(i?.isIntersecting){let e=await this.proxyUrl(this._previewSrc()),i=this.ref["preview-el"],{promise:s,cancel:r}=tT(e);this._cancelPreload=r,s.catch(e=>{this.$["*networkProblems"]=!0,console.error("Failed to load image",{error:e})}).finally(()=>{i.style.backgroundImage=`url(${e})`,i.setAttribute("loaded",""),t.unobserve(this)})}else this._cancelPreload?.()}initCallback(){super.initCallback(),this.$["on.click"]=e=>{if(this.$.active)this.$.isOriginal||(this.$["*sliderEl"].setOperation(this._operation,this._filter),this.$["*showSlider"]=!0);else{let e=this.$["*sliderEl"];e.setOperation(this._operation,this._filter),e.apply()}this.telemetryManager.sendEventCloudImageEditor(e,this.$["*tabId"],{operation:tU(this.$["*operationTooltip"])}),this.$["*currentFilter"]=this._filter},this.defineAccessor("filter",e=>{this._operation="filter",this._filter=e,this.$.isOriginal=e===tO,this.$.icon=this.$.isOriginal?"original":"slider",this.bindL10n("title-prop",()=>this.l10n("a11y-cloud-editor-apply-filter",{name:e.toLowerCase()}))}),this._observer=new window.IntersectionObserver(this._observerCallback.bind(this),{threshold:[0,1]});let e=this.$["*originalUrl"];this._originalUrl=e,this.$.isOriginal?this.ref["icon-el"].classList.add("uc-original-icon"):this._observer.observe(this),this.sub("*currentFilter",e=>{this.$.active=e&&e===this._filter}),this.sub("isOriginal",e=>{this.$.iconSize=e?40:20}),this.sub("active",e=>{if(this.$.isOriginal)return;this.ref["icon-el"].style.opacity=e?"1":"0";let t=this.ref["preview-el"];e?t.style.opacity="0":t.style.backgroundImage&&(t.style.opacity="1")}),this.sub("*networkProblems",async e=>{if(!e){let e=await this.proxyUrl(this._previewSrc()),t=this.ref["preview-el"];t.style.backgroundImage&&(t.style.backgroundImage="none",t.style.backgroundImage=`url(${e})`)}})}destroyCallback(){super.destroyCallback(),this._observer?.disconnect(),this._cancelPreload?.()}};tV.template=`
  <button type="button" role="option" l10n="@title:title-prop;@aria-label:title-prop">
    <div class="uc-preview" ref="preview-el"></div>
    <uc-icon ref="icon-el" set="@name: icon; @size: iconSize;"></uc-icon>
  </button>
`;var tP=(e,t)=>{let i,s=!1,r=0,a=(...a)=>{s?(i&&clearTimeout(i),i=setTimeout(()=>{Date.now()-r>=t&&(e(...a),r=Date.now())},Math.max(t-(Date.now()-r),0))):(e(...a),r=Date.now(),s=!0)};return Object.defineProperty(a,"cancel",{configurable:!1,writable:!1,enumerable:!1,value:()=>{i&&clearTimeout(i)}}),a};function tF(e,t,i){let s=window.devicePixelRatio,r=Math.min(Math.ceil(t*s),3e3);return S(e,E(F,P(i),`quality/${s>=2?"lightest":"normal"}`,`stretch/off/-/resize/${r}x`,`@clib/${e_}/${ey}/uc-cloud-image-editor/`))}var tR=class extends eA{ctxOwner=!0;_commitDebounced;_handleResizeThrottled;_imageSize={width:0,height:0};_canvas;_ctx=null;_isActive=!1;_observer;_cancelPreload;constructor(){super(),this.init$={...this.init$,image:null,"*padding":20,"*operations":{rotate:0,mirror:!1,flip:!1},"*imageBox":{x:0,y:0,width:0,height:0},"*cropBox":{x:0,y:0,width:0,height:0}},this._commitDebounced=v(this._commit.bind(this),300),this._handleResizeThrottled=tP(this._handleResize.bind(this),100)}_handleResize(){this.isConnected&&this._isActive&&(this._initCanvas(),this._syncTransformations(),this._alignImage(),this._alignCrop(),this._draw())}_syncTransformations(){let e=function(e,t){let i={};for(let s of t){let t=e[s];(Object.hasOwn(e,s)||void 0!==t)&&(i[s]=t)}return i}(this.$["*editorTransformations"],Object.keys(this.$["*operations"])),t={...this.$["*operations"],...e};this.$["*operations"]=t}_initCanvas(){let e=this.ref["canvas-el"],t=e.getContext("2d"),i=this.offsetWidth,s=this.offsetHeight,r=window.devicePixelRatio;e.style.width=`${i}px`,e.style.height=`${s}px`,e.width=i*r,e.height=s*r,t?.scale(r,r),this._canvas=e,this._ctx=t}_alignImage(){let e;if(!this._isActive||!this.$.image)return;let t=this.$.image,i=this.$["*padding"],{rotate:s}=this.$["*operations"],r={width:this.offsetWidth,height:this.offsetHeight},a=eV({width:t.naturalWidth,height:t.naturalHeight},s);if(a.width>r.width-2*i||a.height>r.height-2*i){let t=a.width/a.height;if(t>r.width/r.height){let s=r.width-2*i,a=s/t;e={x:0+i,y:i+(r.height-2*i)/2-a/2,width:s,height:a}}else{let s=r.height-2*i,a=s*t;e={x:i+(r.width-2*i)/2-a/2,y:0+i,width:a,height:s}}}else{let{width:t,height:s}=a;e={x:i+(r.width-2*i)/2-t/2,y:i+(r.height-2*i)/2-s/2,width:t,height:s}}this.$["*imageBox"]=eP(e)}_alignCrop(){var e,t;let i=this.$["*cropBox"],s=this.$["*imageBox"],{rotate:r}=this.$["*operations"],a=this.$["*editorTransformations"].crop,{width:o,x:l,y:n}=s;if(a){let{dimensions:[e,t],coords:[c,d]}=a,{width:h}=eV(this._imageSize,r),u=o/h;i=eU(eP({x:l+c*u,y:n+d*u,width:e*u,height:t*u}),s)}let c=this.$["*currentAspectRatio"],d=c?c.width/c.height:void 0;if(!((e=i).x>=s.x)||!(e.y>=s.y)||!(e.x+e.width<=s.x+s.width)||!(e.y+e.height<=s.y+s.height)||d&&!(.1>Math.abs((t=i).width/t.height-d))){let e=s.width/s.height,t=s.width,r=s.height;d&&(e>d?t=Math.min(s.height*d,s.width):r=Math.min(s.width/d,s.height)),i={x:s.x+s.width/2-t/2,y:s.y+s.height/2-r/2,width:t,height:r}}this.$["*cropBox"]=eU(eP(i),s)}_drawImage(){let e=this._ctx;if(!e)return;let t=this.$.image,i=this.$["*imageBox"],{mirror:s,flip:r,rotate:a}=this.$["*operations"],o=eV({width:i.width,height:i.height},a);e.save(),e.translate(i.x+i.width/2,i.y+i.height/2),e.rotate(-(a*Math.PI*1)/180),e.scale(s?-1:1,r?-1:1),e.drawImage(t,-o.width/2,-o.height/2,o.width,o.height),e.restore()}_draw(){if(!this._isActive||!this.$.image||!this._canvas||!this._ctx)return;let e=this._canvas;this._ctx.clearRect(0,0,e.width,e.height),this._drawImage()}_animateIn({fromViewer:e}){this.$.image&&(this.ref["frame-el"].toggleThumbs(!0),this._transitionToImage(),setTimeout(()=>{this.className=tw({"uc-active_from_viewer":e,"uc-active_from_editor":!e,"uc-inactive_to_editor":!1})}))}_getCropDimensions(){let e=this.$["*cropBox"],t=this.$["*imageBox"],{rotate:i}=this.$["*operations"],{width:s,height:r}=t,{width:a,height:o}=eV(this._imageSize,i),{width:l,height:n}=e,c=r/o;return[eF(Math.round(l/(s/a)),1,a),eF(Math.round(n/c),1,o)]}_getCropTransformation(){let e=this.$["*cropBox"],t=this.$["*imageBox"],{rotate:i}=this.$["*operations"],{width:s,height:r,x:a,y:o}=t,{width:l,height:n}=eV(this._imageSize,i),{x:c,y:d}=e,h=this._getCropDimensions(),u={dimensions:h,coords:[eF(Math.round((c-a)/(s/l)),0,l-h[0]),eF(Math.round((d-o)/(r/n)),0,n-h[1])]};return!u||[({dimensions:e,coords:t})=>[...e,...t].every(e=>Number.isInteger(e)&&Number.isFinite(e)),({dimensions:e,coords:t})=>e.every(e=>e>0)&&t.every(e=>e>=0)].every(e=>e(u))?h[0]!==l||h[1]!==n?u:void 0:void console.error("Cropper is trying to create invalid crop object",{payload:u})}_commit(){if(!this.isConnected||!this._imageSize)return;let{rotate:e,mirror:t,flip:i}=this.$["*operations"],s=this._getCropTransformation(),r={...this.$["*editorTransformations"],crop:s,rotate:e,mirror:t,flip:i};this.$["*editorTransformations"]=r}setValue(e,t){this.$["*operations"]={...this.$["*operations"],[e]:t},this._isActive&&(this._alignImage(),this._alignCrop(),this._draw())}getValue(e){return this.$["*operations"][e]}async activate(e,{fromViewer:t}={}){if(!this._isActive){this._isActive=!0,this._imageSize=e,this.removeEventListener("transitionend",this._reset);try{let e=this.$["*originalUrl"],i=this.$["*editorTransformations"];this.$.image=await this._waitForImage(e,i),this._syncTransformations(),this._animateIn({fromViewer:t})}catch(e){console.error("Failed to activate cropper",{error:e}),this.telemetryManager.sendEventError(e,"cloud editor image. Failed to activate cropper")}this._observer=new ResizeObserver(e=>{let[t]=e;t&&t.contentRect.width>0&&t.contentRect.height>0&&this._isActive&&this.$.image&&this._handleResizeThrottled()}),this._observer.observe(this)}}deactivate({reset:e=!1}={}){this._isActive&&(e||this._commit(),this._isActive=!1,this._transitionToCrop(),this.className=tw({"uc-active_from_viewer":!1,"uc-active_from_editor":!1,"uc-inactive_to_editor":!0}),this.ref["frame-el"].toggleThumbs(!1),this.addEventListener("transitionend",this._reset,{once:!0}),this._observer?.disconnect())}_transitionToCrop(){let e=this._getCropDimensions(),t=this.$["*cropBox"],i=Math.min(Math.min(this.offsetWidth,e[0])/t.width,Math.min(this.offsetHeight,e[1])/t.height),s=t.x+t.width/2,r=t.y+t.height/2;this.style.transform=`scale(${i}) translate(${(this.offsetWidth/2-s)/i}px, ${(this.offsetHeight/2-r)/i}px)`,this.style.transformOrigin=`${s}px ${r}px`}_transitionToImage(){let e=this.$["*cropBox"],t=e.x+e.width/2,i=e.y+e.height/2;this.style.transform="scale(1)",this.style.transformOrigin=`${t}px ${i}px`}_reset(){this._isActive||(this.$.image=null)}async _waitForImage(e,t){let i=this.offsetWidth;t={...t,crop:void 0,rotate:void 0,flip:void 0,mirror:void 0};let s=await this.proxyUrl(tF(e,i,t)),{promise:r,cancel:a,image:o}=tT(s),l=this._handleImageLoading(s);return o.addEventListener("load",l,{once:!0}),o.addEventListener("error",l,{once:!0}),this._cancelPreload?.(),this._cancelPreload=a,r.then(()=>o).catch(e=>(console.error("Failed to load image",{error:e}),this.$["*networkProblems"]=!0,o))}_handleImageLoading(e){let t="crop",i=this.$["*loadingOperations"],s=i.get(t);return s||(s=new Map,i.set(t,s)),s.get(e)||(s.set(e,!0),this.$["*loadingOperations"]=i),()=>{let s=i.get(t);s?.has(e)&&(s.delete(e),this.$["*loadingOperations"]=i)}}initCallback(){super.initCallback(),this.sub("*imageBox",()=>{this._draw()}),this.sub("*cropBox",()=>{this.$.image&&this._commitDebounced()}),this.sub("*currentAspectRatio",()=>{this._alignCrop()}),setTimeout(()=>{this.sub("*networkProblems",e=>{!e&&this._isActive&&this.activate(this._imageSize,{fromViewer:!1})})},0)}destroyCallback(){super.destroyCallback(),this._observer?.disconnect()}};function tD(e,t,i){let s=i-1,r=Array(i);for(let i=s;i>=0;i-=1)r[i]=Math.ceil((i*t+(s-i)*e)/s);return r}function tB(e,t){let i=q[e].keypointsNumber,{range:s,zero:r}=q[e];return[...new Set([...tD(s[0],r,i+1),...tD(r,s[1],i+1),r,t])].sort((e,t)=>e-t)}tR.template=`
  <canvas class="uc-canvas" ref="canvas-el"></canvas>
  <uc-crop-frame ref="frame-el"></uc-crop-frame>
`;var tN=class extends eA{_isActive=!1;_hidden=!0;_operation="initial";_filter;_value;_transformations={};_keypoints=[];_container;_previewImage;_cancelLastImages;_cancelBatchPreload;_url;_fromViewer;_raf=0;_addKeypointDebounced=v(this._addKeypoint.bind(this),600);constructor(){super(),this.classList.add("uc-inactive_to_cropper")}_handleImageLoading(e){let t=this._operation,i=this.$["*loadingOperations"];i.has(t)||i.set(t,new Map);let s=i.get(t);return s&&!s.get(e)&&(s.set(e,!0),this.$["*loadingOperations"]=i),()=>{let s=i.get(t);s?.has(e)&&(s.delete(e),this.$["*loadingOperations"]=i)}}_flush(){window.cancelAnimationFrame(this._raf),this._raf=window.requestAnimationFrame(()=>{for(let e of this._keypoints){let{image:t}=e;t&&(t.style.opacity=e.opacity.toString(),t.style.zIndex=e.zIndex.toString())}})}_imageSrc({url:e=this._url,filter:t=this._filter??void 0,operation:i,value:s}={}){if(!e)throw Error("URL is not defined");let r={...this._transformations};i&&("filter"===i?t&&"number"==typeof s&&(r.filter={name:t,amount:s}):"number"==typeof s&&(r[i]=s));let a=this.offsetWidth;return this.proxyUrl(tF(e,a,r))}async _constructKeypoint(e,t){return{src:await this._imageSrc({operation:e,value:t}),image:void 0,opacity:0,zIndex:0,value:t}}_isSame(e,t){return this._operation===e&&this._filter===t}async _addKeypoint(e,t,i){let s=()=>!this._isSame(e,t)||this._value!==i||!!this._keypoints.find(e=>e.value===i);if(s())return;let r=await this._constructKeypoint(e,i),a=new Image;a.src=r.src;let o=this._handleImageLoading(r.src);a.addEventListener("load",o,{once:!0}),a.addEventListener("error",o,{once:!0}),r.image=a,a.classList.add("uc-fader-image"),a.addEventListener("load",()=>{if(s())return;let t=this._keypoints,o=t.findIndex(e=>e.value>i);-1===o&&(o=t.length);let l=t[o],n=l?.image,c=this._container;c&&(!n||c.contains(n))&&(t.splice(o,0,r),n&&c.insertBefore(a,n),this._update(e,i))},{once:!0}),a.addEventListener("error",()=>{this.$["*networkProblems"]=!0},{once:!0})}set(e){var t;let i="string"==typeof e?parseInt(e,10):e;"string"==typeof(t=this._operation)&&t in q&&Number.isFinite(i)&&(this._update(this._operation,i),this._addKeypointDebounced(this._operation,this._filter,i))}_update(e,t){this._operation=e,this._value=t;let{zero:i}=q[e],s=this._keypoints.map(e=>e.value),r=function(e,t,i){let s=(function(e){let t=[];for(let i=0;i<e.length-1;i+=1){let s=e[i],r=e[i+1];"number"==typeof s&&"number"==typeof r&&t.push([s,r])}return t})(e).find(([e,i])=>e<=t&&t<=i);if(!s)return e.map(()=>0);let[r,a]=s;return e.map(e=>{let s=Math.abs(r-a)||1,o=Math.abs(t-r)/s;return r===e?t>i?1:1-o:a===e?t>=i?o:1:0})}(s,t,i),a=s.map((e,t)=>e<i?s.length-t:t);this._keypoints.forEach((e,t)=>{let i=r[t],s=a[t];"number"==typeof i&&(e.opacity=i),"number"==typeof s&&(e.zIndex=s)}),this._flush()}_createPreviewImage(){let e=new Image;return e.classList.add("uc-fader-image","uc-fader-image--preview"),e.style.opacity="0",e}async _initNodes(){let e=document.createDocumentFragment();this._previewImage=this._previewImage||this._createPreviewImage();let t=this._previewImage;this.contains(t)||e.appendChild(t);let i=document.createElement("div");e.appendChild(i);let{images:s,promise:r,cancel:a}=tS(this._keypoints.map(e=>e.src));s.forEach(e=>{let t=this._handleImageLoading(e.src);e.addEventListener("load",t),e.addEventListener("error",t)}),this._cancelLastImages=()=>{a(),this._cancelLastImages=void 0};let o=this._operation,l=this._filter;await r,this._isActive&&this._isSame(o,l)&&(this._container?.remove(),this._container=i,this._keypoints.forEach((e,t)=>{let i=s[t];i&&(i.classList.add("uc-fader-image"),e.image=i,this._container?.appendChild(i))}),this.appendChild(e),this._flush())}async setTransformations(e){if(this._transformations=e,this._previewImage){let e=await this._imageSrc(),t=this._handleImageLoading(e);this._previewImage.src=e,this._previewImage.addEventListener("load",t,{once:!0}),this._previewImage.addEventListener("error",t,{once:!0}),this._previewImage.style.opacity="1",this._previewImage.addEventListener("error",()=>{this.$["*networkProblems"]=!0},{once:!0})}}async preload({url:e,filter:t,operation:i,value:s}){if(!i||"number"!=typeof s)return;this._cancelBatchPreload?.();let r=tB(i,s),{cancel:a}=tS(await Promise.all(r.map(s=>this._imageSrc({url:e,filter:t,operation:i,value:s}))));this._cancelBatchPreload=a}_setOriginalSrc(e){let t=this._previewImage||this._createPreviewImage();if(this.contains(t)||this.appendChild(t),this._previewImage=t,t.src===e){t.style.opacity="1",t.style.transform="scale(1)",this.className=tw({"uc-active_from_viewer":this._fromViewer,"uc-active_from_cropper":!this._fromViewer,"uc-inactive_to_cropper":!1});return}t.style.opacity="0";let i=this._handleImageLoading(e);t.addEventListener("error",i,{once:!0}),t.src=e,t.addEventListener("load",()=>{i(),t&&(t.style.opacity="1",t.style.transform="scale(1)",this.className=tw({"uc-active_from_viewer":this._fromViewer,"uc-active_from_cropper":!this._fromViewer,"uc-inactive_to_cropper":!1}))},{once:!0}),t.addEventListener("error",()=>{this.$["*networkProblems"]=!0},{once:!0})}async activate({url:e,operation:t,value:i,filter:s,fromViewer:r}){if(this._isActive=!0,this._hidden=!1,this._url=e,this._operation=t??"initial",this._value=i,this._filter=s,this._fromViewer=r,"number"!=typeof i&&!s){let e=await this._imageSrc({operation:t,value:i});this._setOriginalSrc(e),this._container?.remove();return}t&&"number"==typeof i&&(this._keypoints=await Promise.all(tB(t,i).map(e=>this._constructKeypoint(t,e))),this._update(t,i),this._initNodes())}deactivate({hide:e=!0}={}){this._isActive=!1,this._cancelLastImages?.(),this._cancelBatchPreload?.(),e&&!this._hidden?(this._hidden=!0,this._previewImage&&(this._previewImage.style.transform="scale(1)"),this.className=tw({"uc-active_from_viewer":!1,"uc-active_from_cropper":!1,"uc-inactive_to_cropper":!0}),this.addEventListener("transitionend",()=>{this._container?.remove()},{once:!0})):this._container?.remove()}},tz=class extends tx{_operation="";initCallback(){super.initCallback(),this.$["on.click"]=e=>{this.$["*sliderEl"].setOperation(this._operation),this.$["*showSlider"]=!0,this.$["*currentOperation"]=this._operation,this.telemetryManager.sendEventCloudImageEditor(e,this.$["*tabId"],{operation:tU(this.$["*operationTooltip"])})},this.defineAccessor("operation",e=>{e&&(this._operation=e,this.$.icon=e,this.bindL10n("title-prop",()=>this.l10n("a11y-cloud-editor-apply-tuning",{name:this.l10n(e).toLowerCase()})),this.bindL10n("title",()=>this.l10n(e)))}),this.sub("*editorTransformations",e=>{if(!this._operation)return;let{zero:t}=q[this._operation],i=e[this._operation];this.$.active=void 0!==i&&i!==t})}},tH=class extends eA{initCallback(){super.initCallback(),this.addEventListener("wheel",e=>{e.preventDefault();let{deltaY:t,deltaX:i}=e;Math.abs(i)>1?this.scrollLeft+=i:this.scrollLeft+=t},{passive:!1}),this.addEventListener("scroll",()=>{},{passive:!0})}};tH.template=" <slot></slot> ";var tj=class extends eA{_debouncedShowLoader;_cancelPreload;_updateInfoTooltip;constructor(){super(),this.init$={...this.init$,"*sliderEl":null,"*listAspectRatioEl":null,"*loadingOperations":new Map,"*showSlider":!1,"*showListAspectRatio":!1,hideSliderOrList:!1,"*currentFilter":tO,"*currentOperation":null,showLoader:!1,filters:G,colorOperations:j,cropOperations:Z,"*operationTooltip":null,"presence.mainToolbar":!0,"presence.subToolbar":!1,"presence.tabToggles":!0,"presence.tabContent.crop":!1,"presence.tabContent.tuning":!1,"presence.tabContent.filters":!1,"presence.tabToggle.crop":!0,"presence.tabToggle.tuning":!0,"presence.tabToggle.filters":!0,"presence.subTopToolbarStyles":{hidden:"uc-sub-toolbar--top-hidden",visible:"uc-sub-toolbar--visible"},"presence.subBottomToolbarStyles":{hidden:"uc-sub-toolbar--bottom-hidden",visible:"uc-sub-toolbar--visible"},"presence.tabContentStyles":{hidden:"uc-tab-content--hidden",visible:"uc-tab-content--visible"},"presence.tabToggleStyles":{hidden:"uc-tab-toggle--hidden",visible:"uc-tab-toggle--visible"},"presence.tabTogglesStyles":{hidden:"uc-tab-toggles--hidden",visible:"uc-tab-toggles--visible"},"on.cancel":e=>{this.telemetryManager.sendEventCloudImageEditor(e,this.$["*tabId"],{action:"cancel"}),this._cancelPreload?.(),(0,this.$["*on.cancel"])()},"on.apply":e=>{this.telemetryManager.sendEventCloudImageEditor(e,this.$["*tabId"],{action:"apply"}),(0,this.$["*on.apply"])(this.$["*editorTransformations"])},"on.applySlider":e=>{this.telemetryManager.sendEventCloudImageEditor(e,this.$["*tabId"],{action:"apply-slider",operation:tU(this.$["*operationTooltip"])}),this.ref["slider-el"].apply(),this._onSliderClose()},"on.cancelSlider":e=>{this.telemetryManager.sendEventCloudImageEditor(e,this.$["*tabId"],{action:"cancel-slider"}),this.ref["slider-el"].cancel(),this._onSliderClose()},"on.clickTab":e=>{let t=e.currentTarget,i=t?.getAttribute("data-id");i&&(this.telemetryManager.sendEventCloudImageEditor(e,i),this._activateTab(i,{fromViewer:!1}))},tab_role:"tab",[`tab_${z.TUNING}`]:`tab_${z.TUNING}`,[`tab_${z.CROP}`]:`tab_${z.CROP}`,[`tab_${z.FILTERS}`]:`tab_${z.FILTERS}`,cancel:"cancel",apply:"apply","a11y-editor-tab-filters":"a11y-editor-tab-filters","a11y-editor-tab-tuning":"a11y-editor-tab-tuning","a11y-editor-tab-crop":"a11y-editor-tab-crop"},this._debouncedShowLoader=v(this._showLoader.bind(this),500),this._updateInfoTooltip=v(this._updateInfoTooltipHandler.bind(this),0)}_onSliderClose(){this.$["*showSlider"]=!1,this.$["*tabId"]===z.CROP&&(this.$["*showListAspectRatio"]=!1),this.$["*tabId"]===z.TUNING&&this.ref["tooltip-el"].classList.toggle("uc-info-tooltip_visible",!1)}_createOperationControl(e){let t=new tz;return t.operation=e,t}_createFilterControl(e){let t=new tV;return t.filter=e,t}_createToggleControl(e){let t=new tM;return t.operation=e,t}_createAspectRatioControl(e){let t=new tk;return t.aspectRatio=e,t}_createFreeformControl(){return new tI}_clearListAspectRatio(){let e=this.$["*listAspectRatioEl"];e&&(e.innerHTML="")}_renderControlsList(e){let t=this.ref[`controls-list-${e}`],i=document.createDocumentFragment();if(this._clearListAspectRatio(),e===z.CROP){let e=this.$["*cropPresetList"],t=e.length>=3;if(t){let e=this._createFreeformControl();i.appendChild(e)}for(let s of e){let e=this._createAspectRatioControl(s);if(i.appendChild(e),t){let t=this.$["*listAspectRatioEl"];t?.appendChild(e)}}for(let e of this.$.cropOperations){let t=this._createToggleControl(e);i.appendChild(t)}}else if(e===z.FILTERS)[tO,...this.$.filters].forEach(e=>{let t=this._createFilterControl(e);i.appendChild(t)});else if(e===z.TUNING)for(let e of this.$.colorOperations){let t=this._createOperationControl(e);i.appendChild(t)}[...i.children].forEach((e,t)=>{t===i.childNodes.length-1&&e.classList.add("uc-controls-list_last-item")}),t.innerHTML="",t.appendChild(i)}_activateTab(e,{fromViewer:t}={}){this.$["*tabId"]=e;let i=this.$["*faderEl"],s=this.$["*cropperEl"];for(let r of(e===z.CROP?(i?.deactivate(),s?.activate(this.$["*imageSize"],{fromViewer:t})):(i?.activate({url:this.$["*originalUrl"],fromViewer:t}),s?.deactivate()),H)){let t=r===e;this.ref[`tab-toggle-${r}`].active=t,t?(this._renderControlsList(e),this._syncTabIndicator()):this._unmountTabControls(r),this.$[`presence.tabContent.${r}`]=t}}_unmountTabControls(e){let t=this.ref[`controls-list-${e}`];t&&(t.innerHTML="")}_syncTabIndicator(){let e=this.ref[`tab-toggle-${this.$["*tabId"]}`];this.ref["tabs-indicator"].style.transform=`translateX(${e.offsetLeft}px)`}async _preloadEditedImage(){if(this.$["*imgContainerEl"]&&this.$["*originalUrl"]){let e=this.$["*imgContainerEl"].offsetWidth,t=await this.proxyUrl(tF(this.$["*originalUrl"],e,this.$["*editorTransformations"]));this._cancelPreload?.();let{cancel:i}=tS([t]);this._cancelPreload=()=>{i(),this._cancelPreload=void 0}}}_showLoader(e){this.$.showLoader=e}_updateInfoTooltipHandler(){let e=this.$["*editorTransformations"],t=this.$["*currentOperation"],i="",s=!1;if(this.$["*tabId"]===z.FILTERS)if(s=!0,this.$["*currentFilter"]&&e?.filter?.name===this.$["*currentFilter"]){let t=e?.filter?.amount||100;i=`${this.$["*currentFilter"]} ${t}`}else i=this.l10n(tO);else if(this.$["*tabId"]===z.TUNING&&t){s=!0;let r=e?.[t]||q[t].zero;i=`${this.l10n(t)} ${r}`}s&&(this.$["*operationTooltip"]=i),this.ref["tooltip-el"].classList.toggle("uc-info-tooltip_visible",s)}initCallback(){super.initCallback(),this.$["*sliderEl"]=this.ref["slider-el"],this.$["*listAspectRatioEl"]=this.ref["list-el"],this.sub("*imageSize",e=>{e&&setTimeout(()=>{this._activateTab(this.$["*tabId"],{fromViewer:!0})},0)}),this.sub("*editorTransformations",e=>{let t=e?.filter?.name;this.$["*currentFilter"]!==t&&(this.$["*currentFilter"]=t)}),this.sub("*currentFilter",()=>{this._updateInfoTooltip()}),this.sub("*currentOperation",()=>{this._updateInfoTooltip()}),this.sub("*tabId",()=>{this._updateInfoTooltip()}),this.sub("*originalUrl",()=>{this.$["*faderEl"]?.deactivate()}),this.sub("*editorTransformations",e=>{this._preloadEditedImage(),this.$["*faderEl"]?.setTransformations(e)}),this.sub("*loadingOperations",e=>{let t=!1;for(let[,i]of e.entries()){if(t)break;for(let[,e]of i.entries())if(e){t=!0;break}}this._debouncedShowLoader(t)}),this.sub("*showSlider",e=>{this.$["presence.subToolbar"]=e,this.$["presence.mainToolbar"]=!e,this.$.hideSliderOrList=!0}),this.sub("*showListAspectRatio",e=>{this.$["presence.subToolbar"]=e,this.$["presence.mainToolbar"]=!e,this.$.hideSliderOrList=!1}),this.sub("*tabList",e=>{for(let t of(this.$["presence.tabToggles"]=e.length>1,H))this.$[`presence.tabToggle.${t}`]=e.includes(t),this.ref[`tab-toggle-${t}`].style.gridColumn=`${e.indexOf(t)+1}`;if(!e.includes(this.$["*tabId"])&&e.length>0){let[t]=e;t&&this._activateTab(t,{fromViewer:!1})}}),this._updateInfoTooltip()}destroyCallback(){this.$["*showSlider"]=!1,this.$["*showListAspectRatio"]=!1}};tj.template=`
  <uc-line-loader-ui set="active: showLoader"></uc-line-loader-ui>
  <div class="uc-info-tooltip_container">
    <div class="uc-info-tooltip_wrapper">
      <div ref="tooltip-el" class="uc-info-tooltip uc-info-tooltip_hidden">{{*operationTooltip}}</div>
    </div>
  </div>
  <div class="uc-toolbar-container">
    <uc-presence-toggle
      role="tablist"
      class="uc-sub-toolbar"
      set="visible: presence.mainToolbar; styles: presence.subTopToolbarStyles"
    >
      <div class="uc-tab-content-row">${H.map(function(e){return`
    <uc-presence-toggle
      id="tab_${e}"
      class="uc-tab-content"
      set="visible: presence.tabContent.${e}; styles: presence.tabContentStyles"
    >
      <uc-editor-scroller hidden-scrollbar>
        <div class="uc-controls-list_align">
          <div
            role="listbox"
            aria-orientation="horizontal"
            class="uc-controls-list_inner"
            ref="controls-list-${e}"
          ></div>
        </div>
      </uc-editor-scroller>
    </uc-presence-toggle>
  `}).join("")}</div>
      <div class="uc-controls-row">
        <uc-presence-toggle
          class="uc-tab-toggles"
          set="visible: presence.tabToggles; styles: presence.tabTogglesStyles"
        >
          <div ref="tabs-indicator" class="uc-tab-toggles_indicator"></div>
          ${H.map(function(e){return`
    <uc-presence-toggle
      class="uc-tab-toggle"
      set="visible: presence.tabToggle.${e}; styles: presence.tabToggleStyles;"
    >
      <uc-btn-ui
        theme="tab"
        ref="tab-toggle-${e}"
        data-id="${e}"
        icon="${e}"
        set="onclick: on.clickTab; aria-role:tab_role; aria-controls:tab_${e}; title-prop: a11y-editor-tab-${e}"
      >
      </uc-btn-ui>
    </uc-presence-toggle>
  `}).join("")}
        </uc-presence-toggle>
        <uc-btn-ui style="order: -1" theme="secondary-icon" icon="closeMax" set="onclick: on.cancel; title-prop:cancel">
        </uc-btn-ui>
        <uc-btn-ui theme="primary-icon" icon="done" set="onclick: on.apply; title-prop:apply"> </uc-btn-ui>
      </div>
    </uc-presence-toggle>
    <uc-presence-toggle
      class="uc-sub-toolbar"
      set="visible: presence.subToolbar; styles: presence.subBottomToolbarStyles"
    >
      <div class="uc-slider" set="@hidden:!hideSliderOrList">
        <uc-editor-slider ref="slider-el"></uc-editor-slider>
      </div>

      <div set="@hidden:hideSliderOrList" class="uc-list-aspect-ratio-container">
        <div class="uc-list-aspect-ratio" ref="list-el"></div>
      </div>
      <div class="uc-controls-row">
        <uc-btn-ui theme="secondary" set="onclick: on.cancelSlider" l10n="@text:cancel"> </uc-btn-ui>
        <uc-btn-ui theme="primary" set="onclick: on.applySlider" l10n="@text:apply"> </uc-btn-ui>
      </div>
    </uc-presence-toggle>
  </div>
`;var tG=class extends eA{_iconReversed=!1;_iconSingle=!1;_iconHidden=!1;constructor(){super(),this.init$={...this.init$,text:"",icon:"",iconCss:this._iconCss(),theme:null,"aria-role":"","aria-controls":"","title-prop":""},this.defineAccessor("active",e=>{e?this.setAttribute("active",""):this.removeAttribute("active")})}_iconCss(){return tw("uc-icon",{"uc-icon_left":!this._iconReversed,"uc-icon_right":this._iconReversed,"uc-icon_hidden":this._iconHidden,"uc-icon_single":this._iconSingle})}initCallback(){super.initCallback(),this.sub("icon",e=>{this._iconSingle=!this.$.text,this._iconHidden=!e,this.$.iconCss=this._iconCss()}),this.sub("theme",e=>{e&&"custom"!==e&&(this.className=`uc-${e}`)}),this.sub("text",()=>{this._iconSingle=!1}),this.hasAttribute("theme")||this.setAttribute("theme","default"),this.defineAccessor("aria-role",e=>{this.$["aria-role"]=e||""}),this.defineAccessor("aria-controls",e=>{this.$["aria-controls"]=e||""}),this.defineAccessor("title-prop",e=>{this.$["title-prop"]=e||""})}set reverse(e){this.hasAttribute("reverse")?(this.style.flexDirection="row-reverse",this._iconReversed=!0):(this._iconReversed=!1,this.style.flexDirection="")}};tG.bindAttributes({text:"text",icon:"icon",reverse:"reverse",theme:"theme"}),tG.template=`
  <button
    type="button"
    set="@role:aria-role; @aria-controls: aria-controls; @aria-label:title-prop"
    l10n="@title:title-prop;"
  >
    <uc-icon set="className: iconCss; @name: icon; @hidden: !icon"></uc-icon>
    <div class="uc-text">{{text}}</div>
  </button>
`;var tZ=class extends eA{_active=!1;_handleTransitionEndRight=()=>{let e=this.ref["line-el"];e.style.transition="initial",e.style.opacity="0",e.style.transform="translateX(-101%)",this._active&&this._start()};initCallback(){super.initCallback(),this.defineAccessor("active",e=>{"boolean"==typeof e&&(e?this._start():this._stop())})}_start(){this._active=!0;let{width:e}=this.getBoundingClientRect(),t=this.ref["line-el"];t.style.transition="transform 1s",t.style.opacity="1",t.style.transform=`translateX(${e}px)`,t.addEventListener("transitionend",this._handleTransitionEndRight,{once:!0})}_stop(){this._active=!1}};tZ.template=`
  <div class="uc-inner">
    <div class="uc-line" ref="line-el"></div>
  </div>
`;var tq={transition:"uc-transition",visible:"uc-visible",hidden:"uc-hidden"},tW=class extends eA{_visible=!1;_visibleStyle=tq.visible;_hiddenStyle=tq.hidden;_externalTransitions=!1;constructor(){super(),this.defineAccessor("styles",e=>{e&&(this._externalTransitions=!0,this._visibleStyle=e.visible??tq.visible,this._hiddenStyle=e.hidden??tq.hidden)}),this.defineAccessor("visible",e=>{"boolean"==typeof e&&(this._visible=e,this._handleVisible())})}_handleVisible(){this.style.visibility=this._visible?"inherit":"hidden",function(e,...t){let i=ty(...t);for(let t of Object.keys(i))e.classList.toggle(t,!!i[t])}(this,{[tq.transition]:!this._externalTransitions,[this._visibleStyle]:this._visible,[this._hiddenStyle]:!this._visible}),this.setAttribute("aria-hidden",this._visible?"false":"true")}initCallback(){super.initCallback(),this.classList.toggle("uc-initial",!0),this._externalTransitions||this.classList.add(tq.transition),this._handleVisible(),setTimeout(()=>{this.classList.toggle("uc-initial",!1)},0)}};tW.template="<slot></slot> ";var tK=class extends eA{_observer;_thumbSize=0;_zero=0;_zeroDotEl;_stepsCount;constructor(){super(),this.init$={...this.init$,disabled:!1,min:0,max:100,onInput:null,onChange:null,defaultValue:0,"on.sliderInput":()=>{let e=Number.parseInt(this._inputEl().value,10);this._updateValue(e),this.$.onInput?.(e)},"on.sliderChange":()=>{let e=Number.parseInt(this._inputEl().value,10);this.$.onChange?.(e)}},this.setAttribute("with-effects","")}initCallback(){super.initCallback(),this.defineAccessor("disabled",e=>{this.$.disabled=e}),this.defineAccessor("min",e=>{this.$.min=e}),this.defineAccessor("max",e=>{this.$.max=e}),this.defineAccessor("defaultValue",e=>{this.$.defaultValue=e,this._inputEl().value=String(e),this._updateValue(e)}),this.defineAccessor("zero",e=>{this._zero=e}),this.defineAccessor("onInput",e=>{e&&(this.$.onInput=e)}),this.defineAccessor("onChange",e=>{e&&(this.$.onChange=e)}),this._updateSteps(),this._observer=new ResizeObserver(()=>{this._updateSteps();let e=Number.parseInt(this._inputEl().value,10);this._updateValue(e)}),this._observer.observe(this),this._thumbSize=Number.parseInt(window.getComputedStyle(this).getPropertyValue("--l-thumb-size"),10),setTimeout(()=>{let e=Number.parseInt(this._inputEl().value,10);this._updateValue(e)},0),this.sub("disabled",e=>{let t=this._inputEl();e?t.setAttribute("disabled","disabled"):t.removeAttribute("disabled")});let e=this._inputEl();e.addEventListener("focus",()=>{this.style.setProperty("--color-effect","var(--hover-color-rgb)")}),e.addEventListener("blur",()=>{this.style.setProperty("--color-effect","var(--idle-color-rgb)")})}_inputEl(){return this.ref["input-el"]}_thumbEl(){return this.ref["thumb-el"]}_stepsEl(){return this.ref["steps-el"]}_updateValue(e){this._updateZeroDot(e);let{width:t}=this.getBoundingClientRect(),i=100/(this.$.max-this.$.min)*(e-this.$.min)*(t-this._thumbSize)/100;window.requestAnimationFrame(()=>{this._thumbEl().style.transform=`translateX(${i}px)`})}_updateZeroDot(e){if(!this._zeroDotEl)return;this._zeroDotEl.style.opacity=e===this._zero?"0":"1";let{width:t}=this.getBoundingClientRect(),i=100/(this.$.max-this.$.min)*(this._zero-this.$.min)*(t-this._thumbSize)/100;window.requestAnimationFrame(()=>{this._zeroDotEl&&(this._zeroDotEl.style.transform=`translateX(${i}px)`)})}_updateSteps(){let e=this._stepsEl(),{width:t}=e.getBoundingClientRect(),i=Math.ceil(Math.ceil(t/2)/15)-2;if(this._stepsCount===i)return;let s=document.createDocumentFragment(),r=document.createElement("div"),a=document.createElement("div");r.className="uc-minor-step",a.className="uc-border-step",s.appendChild(a);for(let e=0;e<i;e+=1)s.appendChild(r.cloneNode());s.appendChild(a.cloneNode());for(let e=0;e<i;e+=1)s.appendChild(r.cloneNode());s.appendChild(a.cloneNode());let o=document.createElement("div");o.className="uc-zero-dot",s.appendChild(o),this._zeroDotEl=o,e.innerHTML="",e.appendChild(s),this._stepsCount=i}destroyCallback(){super.destroyCallback(),this._observer?.disconnect()}};tK.template=`
  <div class="uc-steps" ref="steps-el"></div>
  <div ref="thumb-el" class="uc-thumb"></div>
  <input
    class="uc-input"
    type="range"
    ref="input-el"
    set="oninput: on.sliderInput; onchange: on.sliderChange; @min: min; @max: max; @value: defaultValue;"
  />
`;var tQ=class extends th{couldBeCtxOwner=!0;activityType=eI.activities.CLOUD_IMG_EDIT;_entry;_instance;get activityParams(){let e=super.activityParams;if("internalId"in e)return e;throw Error("Cloud Image Editor activity params not found")}initCallback(){super.initCallback(),this.registerActivity(this.activityType,{onActivate:()=>this.mountEditor(),onDeactivate:()=>this.unmountEditor()}),this.subConfigValue("cropPreset",e=>{this._instance&&this._instance.getAttribute("crop-preset")!==e&&this._instance.setAttribute("crop-preset",e)}),this.subConfigValue("cloudImageEditorTabs",e=>{this._instance&&this._instance.getAttribute("tabs")!==e&&this._instance.setAttribute("tabs",e)})}handleApply(e){if(!this._entry)return;let t=e.detail;this._entry.setMultipleValues({cdnUrl:t.cdnUrl,cdnUrlModifiers:t.cdnUrlModifiers}),this.modalManager?.close(eI.activities.CLOUD_IMG_EDIT),this.historyBack()}handleCancel(){this.modalManager?.close(eI.activities.CLOUD_IMG_EDIT),this.historyBack()}mountEditor(){let{internalId:e}=this.activityParams,t=this.uploadCollection.read(e);if(!t)throw Error(`Entry with internalId "${e}" not found`);this._entry=t;let i=this._entry.getValue("cdnUrl");if(!i)throw Error(`Entry with internalId "${e}" hasn't uploaded yet`);let s=new tA,r=this.cfg.cropPreset,a=this.cfg.cloudImageEditorTabs;s.setAttribute("ctx-name",this.ctxName),s.setAttribute("cdn-url",i),r&&s.setAttribute("crop-preset",r),a&&s.setAttribute("tabs",a),s.addEventListener("apply",e=>{this.handleApply(e),this.debugPrint('editor event "apply"',e.detail)}),s.addEventListener("cancel",e=>{this.handleCancel(),this.debugPrint('editor event "cancel"',e.detail)}),s.addEventListener("change",e=>{this.debugPrint('editor event "change"',e.detail)}),this.innerHTML="",this.appendChild(s),this._instance=s}unmountEditor(){this._instance=void 0,this._entry=void 0,this.innerHTML=""}},tY=e=>e.match(/[A-Z]{2,}(?=[A-Z][a-z]+[0-9]*|\b)|[A-Z]?[a-z]+[0-9]*|[A-Z]|[0-9]+/g)?.map(e=>e.toLowerCase()).join("-"),tX=[{test:e=>!!e.accept&&!!e.imgOnly,message:"There could be a mistake.\nBoth `accept` and `imgOnly` parameters are set.\nThe value of `accept` will be concatenated with the internal image mime types list."},{test:e=>null!==e.enableVideoRecording,message:"The `enableVideoRecording` parameter is deprecated and will be removed in the next major release.\nPlease use the `cameraModes` parameter instead."},{test:e=>null!==e.defaultCameraMode,message:"The `defaultCameraMode` parameter is deprecated and will be removed in the next major release.\nPlease use the `cameraModes` parameter instead."}],tJ=v(e=>{for(let{test:t,message:i}of tX)t(e)&&tn(i)},0),t0=e=>e instanceof Promise||!!(e&&"object"==typeof e&&"then"in e&&"function"==typeof e.then),t1=[{key:"cameraModes",deps:["enableVideoRecording"],fn:({cameraModes:e,enableVideoRecording:t})=>{if(null===t)return e;let i=_(e);return t&&!i.includes("video")?i=i.concat("video"):t||(i=i.filter(e=>"video"!==e)),y(i)}},{key:"cameraModes",deps:["defaultCameraMode"],fn:({cameraModes:e,defaultCameraMode:t})=>{if(null===t)return e;let i=_(e);return y(i=i.sort((e,i)=>e===t?-1:+(i===t)))}},{key:"cdnCname",deps:["pubkey","cdnCnamePrefixed"],fn:({pubkey:e,cdnCname:t,cdnCnamePrefixed:i})=>e&&(t===W||(0,u.i)(t,i))?(0,p.k)(e,i):t}],t5=({key:e,setValue:t,getValue:i,computationControllers:s})=>{for(let r of t1)if(r.deps.includes(e)){let e,a={[r.key]:i(r.key)};for(let e of r.deps)a[e]=i(e);let o=new AbortController;s.get(r.key)?.abort(),s.set(r.key,o);try{e=r.fn(a,{signal:o.signal})}catch(e){s.get(r.key)===o&&s.delete(r.key),console.error(`Failed to compute value for "${r.key}"`,e);return}t0(e)?e.then(e=>{o.signal.aborted||t(r.key,e)}).catch(e=>{o.signal.aborted||console.error(`Failed to compute value for "${r.key}"`,e)}).finally(()=>{s.get(r.key)===o&&s.delete(r.key)}):t(r.key,e)}},t2=e=>String(e),t3=e=>{let t=Number(e);if(Number.isNaN(t))throw Error(`Invalid number: "${e}"`);return t},t7=e=>{if(null==e)return!1;if("boolean"==typeof e)return e;if("true"===e||""===e)return!0;if("false"===e)return!1;throw Error(`Invalid boolean: "${e}"`)},t4=e=>{if("object"==typeof e)return e;throw Error("Invalid value. Must be an object.")},t8=e=>{if("function"==typeof e)return e;throw Error("Invalid value. Must be a function.")},t6=e=>{if(Array.isArray(e))return e;throw Error("Must be an array.")},t9={pubkey:t2,multiple:t7,multipleMin:t3,multipleMax:t3,confirmUpload:t7,imgOnly:t7,accept:t2,externalSourcesPreferredTypes:t2,externalSourcesEmbedCss:t2,store:e=>"auto"===e?e:t7(e),cameraMirror:t7,cameraCapture:e=>{let t=t2(e);if("user"!==t&&"environment"!==t&&""!==t)throw Error(`Invalid value: "${t}"`);return t},sourceList:t2,topLevelOrigin:t2,maxLocalFileSizeBytes:t3,thumbSize:t3,showEmptyList:t7,useLocalImageEditor:t7,useCloudImageEditor:t7,cloudImageEditorTabs:t2,removeCopyright:t7,cropPreset:t2,imageShrink:t2,modalScrollLock:t7,modalBackdropStrokes:t7,sourceListWrap:t7,remoteTabSessionKey:t2,cdnCname:t2,cdnCnamePrefixed:t2,baseUrl:t2,socialBaseUrl:t2,secureSignature:t2,secureExpire:t2,secureDeliveryProxy:t2,retryThrottledRequestMaxTimes:t3,retryNetworkErrorMaxTimes:t3,multipartMinFileSize:t3,multipartChunkSize:t3,maxConcurrentRequests:t3,multipartMaxConcurrentRequests:t3,multipartMaxAttempts:t3,checkForUrlDuplicates:t7,saveUrlForRecurrentUploads:t7,groupOutput:t7,userAgentIntegration:t2,debug:t7,localeName:t2,metadata:e=>{if("object"==typeof e&&!Array.isArray(e)||"function"==typeof e)return e;throw Error("Invalid metadata value. Must be an object or function.")},secureUploadsExpireThreshold:t3,localeDefinitionOverride:e=>t4(e),secureUploadsSignatureResolver:e=>t8(e),secureDeliveryProxyUrlResolver:e=>t8(e),iconHrefResolver:e=>t8(e),fileValidators:t6,collectionValidators:t6,validationTimeout:t3,validationConcurrency:t3,cameraModes:e=>{let t=t2(e),i=_(t);if(i.some(e=>!Object.values(ts).includes(e)))throw Error(`Invalid value: "${JSON.stringify(i)}"`);return t},defaultCameraMode:e=>{let t=t2(e);if(!Object.values(ts).includes(t))throw Error(`Invalid value: "${t}"`);return t},enableAudioRecording:t7,enableVideoRecording:t7,mediaRecorderOptions:t4,maxVideoRecordingDuration:t3,filesViewMode:e=>{let t=t2(e);if(["grid","list"].includes(t))return t;throw Error(`Invalid value: "${t}"`)},gridShowFileNames:t7,cloudImageEditorAutoOpen:t7,cloudImageEditorMaskHref:t2,testMode:t7,qualityInsights:t7},ie=[...new Set(["debug",...Object.keys(K)])],it=["metadata","localeDefinitionOverride","secureUploadsSignatureResolver","secureDeliveryProxyUrlResolver","iconHrefResolver","fileValidators","collectionValidators","mediaRecorderOptions"],ii=e=>it.includes(e),is=ie.filter(e=>!ii(e)),ir={...Object.fromEntries(is.map(e=>[tY(e),e])),...Object.fromEntries(is.map(e=>[e.toLowerCase(),e]))},ia={...Object.fromEntries(is.map(e=>[tY(e),eC(e)])),...Object.fromEntries(is.map(e=>[e.toLowerCase(),eC(e)]))},io=e=>`__${e}`,il=class extends eA{requireCtxName=!0;constructor(){super(),this.init$={...this.init$,...Object.fromEntries(Object.entries(K).map(([e,t])=>[eC(e),t])),computationControllers:new Map}}_flushValueToAttribute(e,t){if(!ii(e))for(let i of[...new Set([tY(e),e.toLowerCase()])])null==t?this.removeAttribute(i):this.getAttribute(i)!==t.toString()&&this.setAttribute(i,t.toString())}_flushValueToState(e,t){this.$[eC(e)]!==t&&(null==t?this.$[eC(e)]=K[e]:this.$[eC(e)]=t)}_setValue(e,t){let i=((e,t)=>{if(null!=t)try{return t9[e](t)}catch(t){return console.error(`Invalid value for config key "${e}".`,t),K[e]}})(e,t),s=io(e);this[s]!==i&&(this._assertSameValueDifferentReference(e,this[s],i),this[s]=i,this._flushValueToAttribute(e,i),this._flushValueToState(e,i),this.debugPrint(`[uc-config] "${e}"`,i),tJ(this.cfg))}_getValue(e){return this[io(e)]??this.$[eC(e)]}_assertSameValueDifferentReference(e,t,i){this.cfg.debug&&i!==t&&"object"==typeof i&&"object"==typeof t&&JSON.stringify(i)===JSON.stringify(t)&&(console.warn(`[uc-config] Option "${e}" value is the same as the previous one but the reference is different`),console.warn("[uc-config] You should avoid changing the reference of the object to prevent unnecessary calculations"),console.warn(`[uc-config] "${e}" previous value:`,t),console.warn(`[uc-config] "${e}" new value:`,i))}initCallback(){for(let e of(super.initCallback(),is))this.sub(eC(e),t=>{this._setValue(e,t)},!1);for(let e of ie){let t=this[e]??this.$[eC(e)];t!==K[e]&&this._setValue(e,t),Object.defineProperty(this,e,{set:t=>{this._setValue(e,t)},get:()=>this._getValue(e)})}for(let e of ie)this.sub(eC(e),()=>{t5({key:e,setValue:this._setValue.bind(this),getValue:this._getValue.bind(this),computationControllers:this.computationControllers})})}attributeChangedCallback(e,t,i){if(t===i)return;let s=ir[e];s&&(this[s]=i)}get computationControllers(){return this.$.computationControllers}};for(let e of(il.bindAttributes(ia),ie))il.prototype[e]=void 0;var ic=class extends eA{initCallback(){super.initCallback(),this.subConfigValue("removeCopyright",e=>{this.toggleAttribute("hidden",!!e)})}static template=`
    <a
      href="https://uploadcare.com/?utm_source=copyright&utm_medium=referral&utm_campaign=v4"
      target="_blank noopener"
      class="uc-credits"
      >Powered by Uploadcare</a
    >
  `},id=Object.freeze({ACTIVE:0,INACTIVE:1,NEAR:2,OVER:3}),ih=["focus"],iu=new Map;function ip(e){let t=0,i=document.body,s=new Set,r=id.INACTIVE,a=t=>{e.shouldIgnore()&&t!==id.INACTIVE||(r!==t&&s.forEach(e=>{e(t)}),r=t)};s.add(t=>e.onChange(t));let o=()=>{t=0,a(id.INACTIVE)},l=()=>{t+=1,r===id.INACTIVE&&a(id.ACTIVE)},n=()=>{(t-=1)>0||a(id.INACTIVE)},c=e=>{e.preventDefault(),t=0,a(id.INACTIVE)},d=i=>{if(e.shouldIgnore())return;t>0||(t+=1);let s=Math.floor(function(e,t){let i=Math.max(Math.min(e[0],t.x+t.width),t.x),s=Math.max(Math.min(e[1],t.y+t.height),t.y);return Math.sqrt((e[0]-i)*(e[0]-i)+(e[1]-s)*(e[1]-s))}([i.x,i.y],e.element.getBoundingClientRect())),r=s<100,o=i.composedPath().includes(e.element);iu.set(e.element,s);let l=Math.min(...iu.values())===s;o&&l?(i.preventDefault(),a(id.OVER)):r&&l?a(id.NEAR):a(id.ACTIVE)},h=async t=>{if(e.shouldIgnore())return;t.preventDefault();let{dataTransfer:i}=t;if(!i)return;let s=await function(e){let t=[],i=[];for(let s=0;s<e.items.length;s++){let r=e.items[s];if(r)if("file"===r.kind){let e=r.type;if("function"==typeof r.webkitGetAsEntry||"function"==typeof r.getAsEntry){let s="function"==typeof r.webkitGetAsEntry?r.webkitGetAsEntry():r.getAsEntry?.();s&&i.push((function(e,t){return new Promise(i=>{let s=0,r=[],a=e=>{if(!e){console.warn("Unexpectedly received empty content entry",{scope:"drag-and-drop"}),i(null);return}e.isFile?(s++,e.file(a=>{s--;let o=new File([a],a.name,{type:a.type||t});r.push({type:"file",file:o,fullPath:e.fullPath}),0===s&&i(r)})):e.isDirectory&&o(e.createReader())},o=e=>{s++,e.readEntries(e=>{for(let t of(s--,e))a(t);0===s&&i(r)})};a(e)})})(s,e).then(e=>{e&&t.push(...e)}));continue}let s=r.getAsFile();s&&i.push((function(e){return new Promise(t=>{"function"!=typeof window.FileReader&&t(!1);try{let i=new FileReader;i.onerror=()=>{t(!0)};let s=e=>{"loadend"!==e.type&&i.abort(),t(!1)};i.onloadend=s,i.onprogress=s,i.readAsDataURL(e)}catch{t(!1)}})})(s).then(e=>{e||t.push({type:"file",file:s})}))}else"string"===r.kind&&/^text\/uri-list/.test(r.type)&&i.push(new Promise(e=>{r.getAsString(i=>{t.push({type:"url",url:i}),e()})}))}return Promise.all(i).then(()=>t)}(i);e.onItems(s),a(id.INACTIVE)};return i.addEventListener("drop",c),i.addEventListener("dragleave",n),i.addEventListener("dragenter",l),i.addEventListener("dragover",d),e.element.addEventListener("drop",h),ih.forEach(e=>{window.addEventListener(e,o)}),()=>{iu.delete(e.element),i.removeEventListener("drop",c),i.removeEventListener("dragleave",n),i.removeEventListener("dragenter",l),i.removeEventListener("dragover",d),e.element.removeEventListener("drop",h),ih.forEach(e=>{window.removeEventListener(e,o)})}}var im="uc-drop-area",ig=`${im}/registry`,ib=class extends th{static styleAttrs=[...super.styleAttrs,"uc-drop-area"];_destroyDropzone=null;_destroyContentWrapperDropzone=null;_onAreaClicked=null;constructor(){super(),this.init$={...this.init$,state:id.INACTIVE,withIcon:!1,isClickable:!1,isFullscreen:!1,isEnabled:!0,isVisible:!0,isInitFlow:!1,text:"",[ig]:new Set}}isActive(){if(!this.$.isEnabled)return!1;let e=this.getBoundingClientRect(),t=e.width>0&&e.height>0,i=e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth),s=window.getComputedStyle(this),r="hidden"!==s.visibility&&"none"!==s.display;return t&&r&&i}initCallback(){super.initCallback(),this.bindL10n("text",()=>this.l10n("drop-files-here")),this.$[ig].add(this),this.defineAccessor("disabled",e=>{this.set$({isEnabled:!t7(e)})}),this.defineAccessor("clickable",e=>{this.set$({isClickable:t7(e)})}),this.defineAccessor("initflow",e=>{this.set$({isInitFlow:t7(e)})}),this.defineAccessor("with-icon",e=>{this.set$({withIcon:t7(e)})}),this.defineAccessor("fullscreen",e=>{this.set$({isFullscreen:t7(e)})}),this.defineAccessor("text",e=>{"string"==typeof e?this.bindL10n("text",()=>this.l10n(e)||e):this.bindL10n("text",()=>this.l10n("drop-files-here"))}),this._destroyDropzone=ip({element:this,shouldIgnore:()=>this._shouldIgnore(),onChange:e=>{this.$.state=e},onItems:e=>{e.length&&(e.forEach(e=>{"url"===e.type?this.api.addFileFromUrl(e.url,{source:ez.DROP_AREA}):"file"===e.type&&this.api.addFileFromObject(e.file,{source:ez.DROP_AREA,fullPath:e.fullPath})}),this.uploadCollection.size&&(this.modalManager?.open(eI.activities.UPLOAD_LIST),this.set$({"*currentActivity":eI.activities.UPLOAD_LIST})))}});let e=this.ref["content-wrapper"];if(e&&(this._destroyContentWrapperDropzone=ip({element:e,onChange:t=>{let i=Object.entries(id).find(([,e])=>e===t)?.[0].toLowerCase();i&&e.setAttribute("drag-state",i)},onItems:()=>{},shouldIgnore:()=>this._shouldIgnore()})),this.sub("state",e=>{let t=Object.entries(id).find(([,t])=>t===e)?.[0].toLowerCase();t&&this.setAttribute("drag-state",t)}),this.subConfigValue("sourceList",e=>{let t=L(e);this.$.isEnabled=t.includes(ez.LOCAL),this.$.isVisible=this.$.isEnabled||!this.querySelector("[data-default-slot]")}),this.sub("isVisible",e=>{this.toggleAttribute("hidden",!e)}),this.sub("isClickable",e=>{this.toggleAttribute("clickable",e)}),this.$.isClickable){let e=e=>{if(e instanceof KeyboardEvent){if("Space"===e.code||"Enter"===e.code){if(this.$.isInitFlow)return void this.api.initFlow();this.api.openSystemDialog()}}else if(e instanceof MouseEvent){if(this.$.isInitFlow)return void this.api.initFlow();this.api.openSystemDialog()}};this._onAreaClicked=e,this.addEventListener("keydown",e),this.addEventListener("click",e)}}_shouldIgnore(){if(!this.$.isEnabled||!this._couldHandleFiles())return!0;if(!this.$.isFullscreen)return!1;let e=this.$[ig];return 0!==e.size&&[...e].filter(e=>e!==this).filter(e=>e.isActive()).length>0}_couldHandleFiles(){let e=this.cfg.multiple,t=this.cfg.multipleMax,i=this.uploadCollection.size;return(!e||!t||!(i>=t))&&(!!e||!(i>0))}destroyCallback(){super.destroyCallback();let e=this.$[ig];e.delete(this),0===e.size&&r.B_.deleteCtx(im),this._destroyDropzone?.(),this._destroyContentWrapperDropzone?.(),this._onAreaClicked&&(this.removeEventListener("keydown",this._onAreaClicked),this.removeEventListener("click",this._onAreaClicked),this._onAreaClicked=null)}};ib.template=`
  <slot>
    <div data-default-slot hidden></div>
    <div ref="content-wrapper" class="uc-content-wrapper" set="@hidden: !isVisible">
      <div class="uc-icon-container" set="@hidden: !withIcon">
        <uc-icon name="default"></uc-icon>
        <uc-icon name="arrow-down"></uc-icon>
      </div>
      <span class="uc-text">{{text}}</span>
    </div>
  </slot>
`,ib.bindAttributes({"with-icon":null,clickable:null,text:null,fullscreen:null,disabled:null,initflow:null});var iv=e=>e.replace(/[\\-\\[]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),i_=(e,t="i")=>{let i=e.split("*").map(iv);return RegExp(`^${i.join(".+")}$`,t)},iy=["--uc-font-family","--uc-font-size","--uc-line-height","--uc-button-size","--uc-preview-size","--uc-input-size","--uc-padding","--uc-radius","--uc-transition","--uc-background","--uc-foreground","--uc-primary","--uc-primary-hover","--uc-primary-transparent","--uc-primary-foreground","--uc-secondary","--uc-secondary-hover","--uc-secondary-foreground","--uc-muted","--uc-muted-foreground","--uc-destructive","--uc-destructive-foreground","--uc-border"],iw=(e,t)=>window.getComputedStyle(e).getPropertyValue(t).trim(),iC=["selected-files-change","toolbar-state-change"],iE=class{_handlerMap=new Map;_context;_getTargetOrigin;constructor(e,t){this._context=e,this._getTargetOrigin=t,window.addEventListener("message",this._handleMessage)}_handleMessage=e=>{if(e.source!==this._context)return;let t=e.data;if(!(e=>{if(!e||"object"!=typeof e||!("type"in e))return!1;let t=e.type;return"string"==typeof t&&!!iC.includes(t)})(t))return;let i=this._handlerMap.get(t.type);if(i)for(let e of i)e(t)};on(e,t){let i=this._handlerMap.get(e)??new Set;this._handlerMap.has(e)||this._handlerMap.set(e,i),i.add(t)}send(e){let t=this._getTargetOrigin();this._context.postMessage(e,t)}destroy(){window.removeEventListener("message",this._handleMessage)}},iA={[eB.GDRIVE]:"ngdrive"},i$=class extends th{couldBeCtxOwner=!0;activityType=eI.activities.EXTERNAL;_messageBridge;constructor(){super(),this.init$={...this.init$,activityIcon:"",activityCaption:"",selectedList:[],total:0,isSelectionReady:!1,isDoneBtnEnabled:!1,couldSelectAll:!1,couldDeselectAll:!1,showSelectionStatus:!1,showDoneBtn:!1,counterText:"",doneBtnTextClass:"uc-hidden",toolbarVisible:!0,onDone:()=>{for(let e of this.$.selectedList){let t=this.extractUrlFromSelectedFile(e),{filename:i}=e,{externalSourceType:s}=this.activityParams;this.api.addFileFromUrl(t,{fileName:i,source:s})}this.$["*currentActivity"]=eI.activities.UPLOAD_LIST,this.modalManager?.open(eI.activities.UPLOAD_LIST)},onCancel:()=>{this.historyBack()},onSelectAll:()=>{this._messageBridge?.send({type:"select-all"})},onDeselectAll:()=>{this._messageBridge?.send({type:"deselect-all"})}}}get activityParams(){let e=super.activityParams;if("externalSourceType"in e)return e;throw Error("External Source activity params not found")}initCallback(){super.initCallback(),this.registerActivity(this.activityType,{onActivate:()=>{let{externalSourceType:e}=this.activityParams;if(!e){this.modalManager?.close(this.$["*currentActivity"]),this.$["*currentActivity"]=null,console.error(`Param "externalSourceType" is required for activity "${this.activityType}"`);return}this.set$({activityCaption:`${e[0]?.toUpperCase()}${e?.slice(1)}`,activityIcon:e}),this.mountIframe()}}),this.sub("*currentActivityParams",e=>{this.isActivityActive&&(this.unmountIframe(),this.mountIframe())}),this.sub("*currentActivity",e=>{e!==this.activityType&&this.unmountIframe()}),this.subConfigValue("multiple",e=>{this.$.showSelectionStatus=e}),this.subConfigValue("localeName",e=>{this.setupL10n()}),this.subConfigValue("externalSourcesEmbedCss",e=>{this.applyEmbedCss(e)})}extractUrlFromSelectedFile(e){if(e.alternatives)for(let t of L(this.cfg.externalSourcesPreferredTypes)){let i=i_(t);for(let[t,s]of Object.entries(e.alternatives))if(i.test(t))return s}return e.url}handleToolbarStateChange(e){this.set$({toolbarVisible:e.isVisible})}async handleSelectedFilesChange(e){if(this.cfg.multiple!==e.isMultipleMode)return void console.error("Multiple mode mismatch");this.bindL10n("counterText",()=>this.l10n("selected-count",{count:e.selectedCount,total:e.total})),this.set$({doneBtnTextClass:e.isReady?"":"uc-hidden",isSelectionReady:e.isReady,isDoneBtnEnabled:e.isReady&&e.selectedFiles.length>0,showSelectionStatus:e.isMultipleMode&&e.total>0,couldSelectAll:e.selectedCount<e.total,couldDeselectAll:e.selectedCount===e.total,selectedList:e.selectedFiles,showDoneBtn:e.total>0})}handleIframeLoad(){this.applyEmbedCss(this.cfg.externalSourcesEmbedCss),this.applyTheme(),this.setupL10n()}applyTheme(){this._messageBridge?.send({type:"set-theme-definition",theme:(e=>{let t={};for(let i of iy){let s=iw(e,i);s&&(t[i]=s)}return t})(this)})}applyEmbedCss(e){this._messageBridge?.send({type:"set-embed-css",css:e})}setupL10n(){this._messageBridge?.send({type:"set-locale-definition",localeDefinition:this.cfg.localeName})}remoteUrl(){let{pubkey:e,remoteTabSessionKey:t,socialBaseUrl:i,multiple:s}=this.cfg,{externalSourceType:r}=this.activityParams,a=iA[r]??r,o={lang:this.l10n("social-source-lang")?.split("-")?.[0]||"en",public_key:e,images_only:(!1).toString(),session_key:t,wait_for_theme:!0,multiple:s.toString(),origin:this.cfg.topLevelOrigin||(()=>{let e=globalThis.top??globalThis.parent??globalThis.self;try{return e.location.origin}catch(e){return console.warn("Unable to access top-level window location:",e),globalThis.location.origin}})(),debug:this.cfg.debug},l=new URL(`/window4/${a}`,i);return l.search=function(e){let t=[];for(let[i,s]of Object.entries(e))null!=s&&("string"!=typeof s||0!==s.length)&&t.push(`${i}=${encodeURIComponent(s)}`);return t.join("&")}(o),l.toString()}mountIframe(){let e=(0,r.vt)({tag:"iframe",attributes:{src:this.remoteUrl(),marginheight:0,marginwidth:0,frameborder:0,allowTransparency:!0}});e.addEventListener("load",this.handleIframeLoad.bind(this)),this.ref.iframeWrapper.innerHTML="",this.ref.iframeWrapper.appendChild(e),e.contentWindow&&(this._messageBridge?.destroy(),this._messageBridge=new iE(e.contentWindow,()=>this.cfg.socialBaseUrl),this._messageBridge.on("selected-files-change",this.handleSelectedFilesChange.bind(this)),this._messageBridge.on("toolbar-state-change",this.handleToolbarStateChange.bind(this)),this.resetSelectionStatus())}unmountIframe(){this._messageBridge?.destroy(),this._messageBridge=void 0,this.ref.iframeWrapper.innerHTML="",this.resetSelectionStatus()}resetSelectionStatus(){this.set$({selectedList:[],total:0,isDoneBtnEnabled:!1,couldSelectAll:!1,couldDeselectAll:!1,showSelectionStatus:!1,showDoneBtn:!1})}};i$.template=`
  <uc-activity-header>
    <button
      type="button"
      class="uc-mini-btn uc-close-btn"
      set="onclick: *historyBack"
      l10n="@title:a11y-activity-header-button-close;@aria-label:a11y-activity-header-button-close"
    >
      <uc-icon name="close"></uc-icon>
    </button>
  </uc-activity-header>
  <div class="uc-content">
    <div ref="iframeWrapper" class="uc-iframe-wrapper"></div>
    <div class="uc-toolbar" set="@hidden: !toolbarVisible">
      <button type="button" class="uc-cancel-btn uc-secondary-btn" set="onclick: onCancel" l10n="cancel"></button>
      <div set="@hidden: !showSelectionStatus" class="uc-selection-status-box">
        <span>{{counterText}}</span>
        <button type="button" set="onclick: onSelectAll; @hidden: !couldSelectAll" l10n="select-all"></button>
        <button type="button" set="onclick: onDeselectAll; @hidden: !couldDeselectAll" l10n="deselect-all"></button>
      </div>
      <button
        type="button"
        class="uc-done-btn uc-primary-btn"
        set="onclick: onDone; @disabled: !isDoneBtnEnabled; @hidden: !showDoneBtn"
      >
        <uc-spinner set="@hidden: isSelectionReady"></uc-spinner>
        <span l10n="done" set="@class: doneBtnTextClass"></span>
      </button>
    </div>
  </div>
`;var ix=/^([0-9]+)x([0-9]+)(?:\s+(\d{1,2}|100)%)?$/i,iI=class extends th{_entrySubs=new Set;_entry=null;_withEntry(e){return(...t)=>{let i=this._entry;return i?e(i,...t):void console.warn("No entry found")}}_subEntry(e,t){this._withEntry((e,t,i)=>{let s=e.subscribe(t,e=>{this.isConnected&&i(e)});this._entrySubs.add(s)})(e,t)}_reset(){for(let e of this._entrySubs)e.remove();this._entrySubs=new Set,this._entry=null}disconnectedCallback(){super.disconnectedCallback(),this._entrySubs=new Set}},ik=Object.freeze({FINISHED:Symbol("FINISHED"),FAILED:Symbol("FAILED"),UPLOADING:Symbol("UPLOADING"),VALIDATION:Symbol("VALIDATION"),QUEUED_UPLOADING:Symbol("QUEUED-UPLOADING"),QUEUED_VALIDATION:Symbol("QUEUED-VALIDATION"),IDLE:Symbol("IDLE")}),iM=class e extends iI{couldBeCtxOwner=!0;pauseRender=!0;_renderedOnce=!1;_observer;_isIntersecting=!1;_thumbRect;constructor(){super(),this.init$={...this.init$,uid:"",itemName:"",errorText:"",hint:"",thumbUrl:"",progressValue:0,progressVisible:!1,badgeIcon:"",isFinished:!1,isFailed:!1,isUploading:!1,isFocused:!1,isEditable:!1,showFileNames:!1,state:ik.IDLE,ariaLabelStatusFile:"",onEdit:this._withEntry(e=>{this.telemetryManager.sendEvent({eventType:g.ACTION_EVENT,payload:{metadata:{event:"edit-file",node:this.tagName}}}),this.$["*currentActivityParams"]={internalId:e.uid},this.modalManager?.open(eI.activities.CLOUD_IMG_EDIT),this.$["*currentActivity"]=eI.activities.CLOUD_IMG_EDIT}),onRemove:()=>{this.telemetryManager.sendEvent({eventType:g.ACTION_EVENT,payload:{metadata:{event:"remove-file",node:this.tagName}}}),this.uploadCollection.remove(this.$.uid)},onUpload:()=>{this.upload()}}}_calculateState=this._withEntry(e=>{let t=ik.IDLE;e.getValue("errors").length>0?t=ik.FAILED:e.getValue("isQueuedForUploading")?t=ik.QUEUED_UPLOADING:e.getValue("isQueuedForValidation")?t=ik.QUEUED_VALIDATION:e.getValue("isValidationPending")?t=ik.VALIDATION:e.getValue("isUploading")?t=ik.UPLOADING:e.getValue("fileInfo")&&(t=ik.FINISHED),this.$.state=t});_debouncedCalculateState=v(this._calculateState.bind(this),100);_updateHintAndProgress=this._withEntry(tP((e,t)=>{let i=e.getValue("errors")?.[0]?.message,s=e.getValue("source"),r=e.getValue("externalUrl"),a=t===ik.FINISHED,o=t===ik.UPLOADING,l=t===ik.QUEUED_UPLOADING,n=t===ik.QUEUED_VALIDATION,c=t===ik.VALIDATION,d=e.getValue("fileName"),h="";i?h="":!a&&r&&s&&Object.values(eB).includes(s)&&(h=this.l10n("waiting-for",{source:this.l10n(`src-type-${s}`)})),this.set$({hint:h,errorText:i,progressVisible:o||l||n||c,progressValue:n||c?0:e.getValue("uploadProgress"),ariaLabelStatusFile:d&&this.l10n("a11y-file-item-status",{fileName:d,status:this.l10n(t?.description?.toLocaleLowerCase()??"").toLocaleLowerCase()})})},100));_handleState=this._withEntry((e,t)=>{t===ik.FAILED?this.$.badgeIcon="badge-error":t===ik.FINISHED&&(this.$.badgeIcon="badge-success"),t===ik.UPLOADING&&(this.$.isFocused=!1),this.set$({isFailed:t===ik.FAILED,isUploading:t===ik.UPLOADING,isFinished:t===ik.FINISHED,isEditable:this.cfg.useCloudImageEditor&&e.getValue("isImage")&&e.getValue("cdnUrl")}),this._updateHintAndProgress(t)});_reset(){super._reset(),this._debouncedCalculateState.cancel()}_observerCallback(e){let[t]=e;t&&(this._isIntersecting=t.isIntersecting,this._thumbRect=t.boundingClientRect,t.isIntersecting&&!this._renderedOnce&&(this.render(),this._renderedOnce=!0))}_handleEntryId(e){this._reset();let t=this.uploadCollection?.read(e);this._entry=t,t&&(this._subEntry("isQueuedForValidation",()=>{this._debouncedCalculateState()}),this._subEntry("isValidationPending",()=>{this._debouncedCalculateState()}),this._subEntry("uploadProgress",()=>{this._debouncedCalculateState()}),this._subEntry("isQueuedForUploading",()=>{this._debouncedCalculateState()}),this._subEntry("fileName",e=>{this.$.itemName=e||t.getValue("externalUrl")||this.l10n("file-no-name"),this._debouncedCalculateState()}),this._subEntry("externalUrl",e=>{this.$.itemName=t.getValue("fileName")||e||this.l10n("file-no-name")}),this._subEntry("fileInfo",()=>{this._debouncedCalculateState()}),this._subEntry("errors",()=>this._debouncedCalculateState()),this._subEntry("isUploading",()=>this._debouncedCalculateState()),this._subEntry("fileSize",()=>this._debouncedCalculateState()),this._subEntry("mimeType",()=>this._debouncedCalculateState()),this._subEntry("isImage",()=>this._debouncedCalculateState()))}_updateShowFileNames(e){if("list"===this.cfg.filesViewMode){this.$.showFileNames=!0;return}this.$.showFileNames=e}initCallback(){super.initCallback(),this.sub("uid",e=>{this._handleEntryId(e)}),this.sub("state",e=>{this._handleState(e)}),this.subConfigValue("useCloudImageEditor",()=>this._debouncedCalculateState()),this.subConfigValue("filesViewMode",e=>{this._updateShowFileNames(this.cfg.gridShowFileNames),this.setAttribute("mode",e)}),this.subConfigValue("gridShowFileNames",e=>{this._updateShowFileNames(e)}),this.onclick=()=>{e.activeInstances.forEach(e=>{e===this?e.setAttribute("focused",""):e.removeAttribute("focused")})},this.sub("*uploadTrigger",e=>{(!this._entry||e.has(this._entry.uid))&&setTimeout(()=>this.isConnected&&this.upload())}),e.activeInstances.add(this)}destroyCallback(){super.destroyCallback(),e.activeInstances.delete(this),this._reset()}connectedCallback(){super.connectedCallback(),this._observer=new window.IntersectionObserver(this._observerCallback.bind(this),{threshold:[0,1]}),this._observer.observe(this)}disconnectedCallback(){super.disconnectedCallback(),this._observer?.disconnect()}_settingsOfShrink(){var e=this.cfg.imageShrink;if("string"!=typeof e)return!1;let t=ix.exec(e.toLocaleLowerCase())??[];if(0===t.length)return!1;let i=Number(t[1])*Number(t[2]);return i>0x10000000?(console.warn(`Shrinked size can not be larger than ${Math.floor(268.435456)}MP. You have set ${t[1]}x${t[2]} (${Math.ceil(i/1e3/100)/10}MP).`),!1):{quality:t[3]?Number(t[3])/100:void 0,size:i}}async _processShrink(e){let t=this._settingsOfShrink();return t?await (0,m._)(e,t):(console.warn("Image shrink settings are invalid, skipping shrinking"),e)}upload=this._withEntry(async e=>{if(!this.uploadCollection.read(e.uid)||e.getValue("fileInfo")||e.getValue("isUploading")||e.getValue("errors").length>0||e.getValue("isValidationPending"))return;let t=this.cfg.multiple?this.cfg.multipleMax:1;if(!t||!(this.uploadCollection.size>t)){e.setMultipleValues({isUploading:!0,errors:[],isQueuedForUploading:!0}),this._debouncedCalculateState();try{let t=new AbortController;e.setValue("abortController",t);let i=async()=>{e.setValue("isQueuedForUploading",!1);let i=e.getValue("file");if(i instanceof File&&this.cfg.imageShrink)try{i=await this._processShrink(i)}catch{}let s=i||e.getValue("externalUrl")||e.getValue("uuid");if(!s)throw Error("No file input");let r={...await this.getUploadClientOptions(),fileName:e.getValue("fileName")??void 0,source:e.getValue("source")??void 0,onProgress:t=>{if(t.isComputable){let i=100*t.value;e.setValue("uploadProgress",i)}},signal:t.signal,metadata:await this.getMetadataFor(e.uid)};return this.debugPrint("upload options",s,r),(0,a.QM)(s,r)},s=await this.$["*uploadQueue"].add(i);e.setMultipleValues({fileInfo:s,isQueuedForUploading:!1,isUploading:!1,fileName:s.originalFilename,fileSize:s.size,isImage:s.isImage??!1,mimeType:s.contentInfo?.mime?.mime??s.mimeType,uuid:s.uuid,cdnUrl:e.getValue("cdnUrl")??s.cdnUrl,cdnUrlModifiers:e.getValue("cdnUrlModifiers")??"",uploadProgress:100,source:e.getValue("source")??null}),e===this._entry&&this._debouncedCalculateState()}catch(t){this.telemetryManager.sendEventError(t,"file upload. Failed to upload file"),t instanceof a.p3&&t.isCancel?e.setMultipleValues({isUploading:!1,uploadProgress:0}):t instanceof a.Be?e.setMultipleValues({isUploading:!1,uploadProgress:0,uploadError:t}):(console.error("Unknown upload error",t),e.setMultipleValues({isUploading:!1,uploadProgress:0,uploadError:Error("Something went wrong",{cause:t})})),e===this._entry&&this._debouncedCalculateState()}}});static template=`
  <div class="uc-inner" set="@finished: isFinished; @uploading: isUploading; @failed: isFailed; @focused: isFocused">
    <uc-thumb set="uid:uid;badgeIcon:badgeIcon"></uc-thumb>

    <div aria-atomic="true" aria-live="polite" class="uc-file-name-wrapper" set="@aria-label:ariaLabelStatusFile;">
      <span class="uc-file-name" set="@hidden: !showFileNames">{{itemName}}</span>
      <span class="uc-file-error" set="@hidden: !errorText;">{{errorText}}</span>
      <span class="uc-file-hint" set="@hidden: !hint">{{hint}}</span>
    </div>
    <div class="uc-file-actions">
      <button
        type="button"
        l10n="@title:file-item-edit-button;@aria-label:file-item-edit-button"
        class="uc-edit-btn uc-mini-btn"
        set="onclick: onEdit; @hidden: !isEditable"
      >
        <uc-icon name="edit-file"></uc-icon>
      </button>
      <button
        type="button"
        l10n="@title:file-item-remove-button;@aria-label:file-item-remove-button"
        class="uc-remove-btn uc-mini-btn"
        set="onclick: onRemove;"
      >
        <uc-icon name="remove-file"></uc-icon>
      </button>
      <button type="button" class="uc-upload-btn uc-mini-btn" set="onclick: onUpload;">
        <uc-icon name="upload"></uc-icon>
      </button>
    </div>
    <uc-progress-bar
      class="uc-progress-bar"
      set="value: progressValue; visible: progressVisible; @hasFileName: showFileNames;"
    >
    </uc-progress-bar>
  </div>
`;static activeInstances=new Set},iT=class extends th{requireCtxName=!0;_validationInputElement=null;_dynamicInputsContainer=null;_createValidationInput(){let e=document.createElement("input");return e.type="text",e.name=this.ctxName,e.required=this.cfg.multipleMin>0,e.tabIndex=-1,(0,r.ZM)(e,{opacity:0,height:0,width:0}),e}initCallback(){super.initCallback(),this._validationInputElement=this._createValidationInput(),this.appendChild(this._validationInputElement),this.sub("*collectionState",e=>{{if(!this._dynamicInputsContainer){let e=document.createElement("div");this.appendChild(e),this._dynamicInputsContainer=e}if(!this._validationInputElement){let e=this._createValidationInput();this.appendChild(e),this._validationInputElement=e}if(this._dynamicInputsContainer.innerHTML="","uploading"===e.status||"idle"===e.status){this._validationInputElement.value="",this._validationInputElement.setCustomValidity("");return}if("failed"===e.status){let t=e.errors[0]?.message;this._validationInputElement.value="",this._validationInputElement.setCustomValidity(t??"");return}let t=e.group?e.group:null;if(t){this._validationInputElement.value=t.cdnUrl??"",this._validationInputElement.setCustomValidity("");return}let i=e.allEntries.map(e=>e.cdnUrl).filter(e=>"string"==typeof e);if(!this.cfg.multiple&&1===i.length&&i[0]){this._validationInputElement.value=i[0],this._validationInputElement.setCustomValidity("");return}this._validationInputElement.remove(),this._validationInputElement=null;let s=new DocumentFragment;for(let e of i){let t=document.createElement("input");t.type="hidden",t.name=`${this.ctxName}[]`,t.value=e,s.appendChild(t)}this._dynamicInputsContainer.replaceChildren(s)}},!1)}},iS=class extends eA{constructor(){super(),this.init$={...this.init$,name:"",href:""}}initCallback(){super.initCallback(),this.sub("name",e=>{if(!e)return;let t=`#uc-icon-${e}`;this.subConfigValue("iconHrefResolver",i=>{i&&(t=i(e)??t),this.$.href=t})}),this.setAttribute("aria-hidden","true")}};iS.template=`
  <svg ref="svg" xmlns="http://www.w3.org/2000/svg">
    <use set="@href: href;"></use>
  </svg>
`,iS.bindAttributes({name:"name"});var iO="--uc-img-",iL="unresolved",iU=!window.location.host.trim()||window.location.host.includes(":")||window.location.hostname.includes("localhost"),iV=Object.freeze({PREVIEW:"PREVIEW",MAIN:"MAIN"}),iP=Object.freeze({"dev-mode":{},pubkey:{},uuid:{},src:{},lazy:{default:1},intersection:{},breakpoints:{},"cdn-cname":{default:"https://ucarecdn.com"},"proxy-cname":{},"secure-delivery-proxy":{},"hi-res-support":{default:1},"ultra-res-support":{},format:{},"cdn-operations":{},progressive:{},quality:{},"is-background-for":{},"is-preview-blur":{default:1}}),iF=Object.create(null);for(let e in iP)iF[iO+e]=iP[e]?.default||"";var iR=class extends r.$G{cssInit$=iF;$$(e){return this.$[iO+e]}set$$(e){for(let t in e)this.$[iO+t]=e[t]}sub$$(e,t){this.sub(iO+e,e=>{null!==e&&""!==e&&t(e)})}analyticsParams(){return`-/@clib/${e_}/${ey}/uc-img/`}initAttributes(e){[...this.attributes].forEach(t=>{iP[t.name]||e.setAttribute(t.name,t.value)})}initIntersection(e,t){this._isnObserver=new IntersectionObserver(i=>{i.forEach(i=>{i.isIntersecting&&(t(),this._isnObserver.unobserve(e))})},{root:null,rootMargin:"0px"}),this._isnObserver.observe(e),this._observed||(this._observed=new Set),this._observed.add(e)}destroyCallback(){super.destroyCallback(),this._isnObserver&&(this._observed.forEach(e=>{this._isnObserver.unobserve(e)}),this._isnObserver=null),r.B_.deleteCtx(this)}static get observedAttributes(){return Object.keys(iP)}attributeChangedCallback(e,t,i){window.setTimeout(()=>{this.$[iO+e]=i})}},iD=class extends iR{_img=new Image;_imgPreview=new Image;_fmtAbs(e){return e.includes("//")||iU||(e=new URL(e,document.baseURI).href),e}_validateSize(e){if(e?.trim()!==""){let t=e.match(/\d+/)[0],i=e.match(/[a-zA-Z]+/)[0],s=parseInt(t,10);if(Number(s)>5e3&&this.hasFormatJPG)return 5e3+i;if(Number(s)>3e3&&!this.hasFormatJPG)return 3e3+i}return e}_getCdnModifiers(e,t){return E(...Object.entries({format:this.$$("format"),quality:this.$$("quality"),resize:this._validateSize(e),blur:t,"cdn-operations":this.$$("cdn-operations"),analytics:this.analyticsParams()}).filter(([e,t])=>void 0!==t&&""!==t).map(([e,t])=>"cdn-operations"===e||"analytics"===e?t:`${e}/${t}`))}_getUrlBase(e="",t=""){if(this.$$("src").startsWith("data:")||this.$$("src").startsWith("blob:"))return this.$$("src");if(iU&&this.$$("src")&&!this.$$("src").includes("//"))return this._proxyUrl(this.$$("src"));let i=this._getCdnModifiers(e,t);return this.$$("src").startsWith(this.$$("cdn-cname"))?S(this.$$("src"),i):this.$$("cdn-cname")&&this.$$("uuid")||this.$$("uuid")?this._proxyUrl(S(O(this.$$("cdn-cname"),this.$$("uuid")),i)):this.$$("proxy-cname")?this._proxyUrl(S(this.$$("proxy-cname"),i,this._fmtAbs(this.$$("src")))):this.$$("pubkey")?this._proxyUrl(S(`https://${this.$$("pubkey")}.ucr.io/`,i,this._fmtAbs(this.$$("src")))):void 0}_proxyUrl(e){return this.$$("secure-delivery-proxy")?J(this.$$("secure-delivery-proxy"),{previewUrl:e},{transform:e=>window.encodeURIComponent(e)}):e}_getElSize(e,t=1,i=!0){let s=e.getBoundingClientRect(),r=t*Math.round(s.width),a=i?"":t*Math.round(s.height);return r||a?`${r||""}x${a||""}`:null}_setupEventProxy(e){let t=e=>{e.stopPropagation();let t=new Event(e.type,e);this.dispatchEvent(t)};for(let i of["load","error"])e.addEventListener(i,t)}get img(){return this.hasPreviewImage||(this._setupConfigForImage({elNode:this._img}),this.appendChild(this._img)),this._img}get currentImg(){return this.hasPreviewImage?{type:iV.PREVIEW,img:this._imgPreview}:{type:iV.MAIN,img:this.img}}get hasPreviewImage(){return this.$$("is-preview-blur")}get bgSelector(){return this.$$("is-background-for")}get breakpoints(){return this.$$("breakpoints")?[...new Set(L(this.$$("breakpoints")).map(e=>parseInt(e,10)))]:null}get hasFormatJPG(){return"jpeg"===this.$$("format").toLowerCase()}renderBg(e){let t=new Set;t.add(`url("${this._getUrlBase(this._getElSize(e))}") 1x`),this.$$("hi-res-support")&&t.add(`url("${this._getUrlBase(this._getElSize(e,2))}") 2x`),this.$$("ultra-res-support")&&t.add(`url("${this._getUrlBase(this._getElSize(e,3))}") 3x`);let i=`image-set(${[...t].join(", ")})`;e.style.setProperty("background-image",i),e.style.setProperty("background-image","-webkit-"+i)}getSrcset(){let e=new Set;return this.breakpoints?this.breakpoints.forEach(t=>{e.add(this._getUrlBase(t+"x")+` ${this._validateSize(t+"w")}`),this.$$("hi-res-support")&&e.add(this._getUrlBase(2*t+"x")+` ${this._validateSize(2*t+"w")}`),this.$$("ultra-res-support")&&e.add(this._getUrlBase(3*t+"x")+` ${this._validateSize(3*t+"w")}`)}):(e.add(this._getUrlBase(this._getElSize(this.currentImg.img))+" 1x"),this.$$("hi-res-support")&&e.add(this._getUrlBase(this._getElSize(this.currentImg.img,2))+" 2x"),this.$$("ultra-res-support")&&e.add(this._getUrlBase(this._getElSize(this.currentImg.img,3))+" 3x")),[...e].join()}getSrc(){return this._getUrlBase()}get srcUrlPreview(){return this._getUrlBase("100x","100")}renderBackground(){[...document.querySelectorAll(this.bgSelector)].forEach(e=>{this.$$("intersection")?this.initIntersection(e,()=>{this.renderBg(e)}):this.renderBg(e)})}_appendURL({elNode:e,src:t,srcset:i}){t&&(e.src=t),i&&(e.srcset=i)}_setupConfigForImage({elNode:e}){this._setupEventProxy(e),this.initAttributes(e)}loaderImage({src:e,srcset:t,elNode:i}){return new Promise((s,r)=>{this._setupConfigForImage({elNode:i}),i.setAttribute(iL,""),i.addEventListener("load",()=>{i.removeAttribute(iL),s(i)}),i.addEventListener("error",()=>{r(!1)}),this._appendURL({elNode:i,src:e,srcset:t})})}async renderImage(){if(this.$$("intersection")){this.hasPreviewImage&&(this._setupConfigForImage({elNode:this._imgPreview}),this.appendChild(this._imgPreview)),this.initIntersection(this.currentImg.img,async()=>{this.hasPreviewImage&&(this._imgPreview.src=this.srcUrlPreview);try{await this.loaderImage({src:this.getSrc(),srcset:this.getSrcset(),elNode:this._img}),this.hasPreviewImage&&await this._imgPreview.remove(),this.appendChild(this._img)}catch(e){this.hasPreviewImage&&await this._imgPreview?.remove(),this.appendChild(this._img)}});return}try{this.hasPreviewImage&&(await this.loaderImage({src:this.srcUrlPreview,elNode:this._imgPreview}),this.appendChild(this._imgPreview)),await this.loaderImage({src:this.getSrc(),srcset:this.getSrcset(),elNode:this._img}),this.hasPreviewImage&&await this._imgPreview?.remove(),this.appendChild(this._img)}catch(e){this.hasPreviewImage&&await this._imgPreview?.remove(),this.appendChild(this._img)}}init(){this.bgSelector?this.renderBackground():this.renderImage()}},iB=class extends iD{initCallback(){super.initCallback(),this.sub$$("src",()=>{this.init()}),this.sub$$("uuid",()=>{this.init()}),this.sub$$("lazy",e=>{this.$$("is-background-for")||this.$$("is-preview-blur")||(this.img.loading=e?"lazy":"eager")})}},iN=null,iz=class extends eA{static styleAttrs=[...super.styleAttrs,"uc-modal"];static StateConsumerScope="modal";_mouseDownTarget;handleModalOpen;handleModalClose;handleModalCloseAll;constructor(){super(),this.init$={...this.init$,closeClicked:this._handleDialogClose}}_handleBackdropClick=()=>{this._closeDialog()};_closeDialog=()=>{this.modalManager?.close(this.id),this.modalManager?.hasActiveModals||(document.body.style.overflow="")};_handleDialogClose=()=>{this._closeDialog()};_handleDialogMouseDown=e=>{this._mouseDownTarget=e.target};_handleDialogMouseUp=e=>{let t=e.target;t===this.ref.dialog&&t===this._mouseDownTarget&&this._closeDialog()};show(){let e=this.ref.dialog;"function"==typeof e.showModal?(this.setAttribute("aria-modal","true"),e.showModal()):e.setAttribute("open",""),this.cfg.modalScrollLock&&(document.body.style.overflow="hidden")}hide(){let e=this.ref.dialog;"function"==typeof e.close?(this.setAttribute("aria-modal","false"),e.close()):e.removeAttribute("open")}_handleModalOpen({id:e}){e===this.id?(iN=e,this.show(),this.emit(b.MODAL_OPEN,{modalId:e},{debounce:!0})):this.hide()}_handleModalClose({id:e}){e===this.id&&(this.hide(),this.emit(b.MODAL_CLOSE,{modalId:e,hasActiveModals:this.modalManager?.hasActiveModals},{debounce:!0}))}_handleModalCloseAll(e){this.hide(),iN===this.id&&this.emit(b.MODAL_CLOSE,{modalId:iN,hasActiveModals:this.modalManager?.hasActiveModals},{debounce:!0})}initCallback(){super.initCallback(),this.modalManager?.registerModal(this.id,this);let e=this.ref.dialog;e.addEventListener("close",this._handleDialogClose),e.addEventListener("mousedown",this._handleDialogMouseDown),e.addEventListener("mouseup",this._handleDialogMouseUp),this.subConfigValue("modalBackdropStrokes",e=>{e?this.setAttribute("strokes",""):this.removeAttribute("strokes")}),this.handleModalOpen=this._handleModalOpen.bind(this),this.handleModalClose=this._handleModalClose.bind(this),this.handleModalCloseAll=this._handleModalCloseAll.bind(this),this.modalManager?.subscribe(ef.OPEN,this.handleModalOpen),this.modalManager?.subscribe(ef.CLOSE,this.handleModalClose),this.modalManager?.subscribe(ef.CLOSE_ALL,this.handleModalCloseAll)}destroyCallback(){super.destroyCallback(),document.body.style.overflow="",this._mouseDownTarget=void 0;let e=this.ref.dialog;e.removeEventListener("close",this._handleDialogClose),e.removeEventListener("mousedown",this._handleDialogMouseDown),e.removeEventListener("mouseup",this._handleDialogMouseUp),this.modalManager?.unsubscribe(ef.OPEN,this.handleModalOpen),this.modalManager?.unsubscribe(ef.CLOSE,this.handleModalClose),this.modalManager?.unsubscribe(ef.CLOSE_ALL,this.handleModalCloseAll)}};iz.template=`
  <dialog ref="dialog">
    <slot></slot>
  </dialog>
`;var iH=class extends eA{_value=0;_visible=!0;constructor(){super(),this.init$={...this.init$,width:0,opacity:0}}initCallback(){super.initCallback();let e=()=>{let e=this.ref.fakeProgressLine;if(!this._visible)return void e.classList.add("uc-fake-progress--hidden");this._value>0&&e.classList.add("uc-fake-progress--hidden")};this.ref.fakeProgressLine.addEventListener("animationiteration",e),this.defineAccessor("value",e=>{null!=e&&(this._value=e,this._visible&&this.style.setProperty("--l-progress-value",this._value.toString()))}),this.defineAccessor("visible",e=>{this._visible=e,this.classList.toggle("uc-progress-bar--hidden",!e)})}};iH.template=`
  <div ref="fakeProgressLine" class="uc-fake-progress"></div>
  <div ref="realProgressLine" class="uc-progress"></div>
`;var ij=class extends th{_unobserveCollectionCb;constructor(){super(),this.init$={...this.init$,visible:!1,value:0,"*commonProgress":0}}initCallback(){super.initCallback(),this._unobserveCollectionCb=this.uploadCollection.observeProperties(()=>{let e=this.uploadCollection.items().some(e=>{let t=this.uploadCollection.read(e);return t?.getValue("isUploading")??!1});this.$.visible=e}),this.sub("visible",e=>{e?this.setAttribute("active",""):this.removeAttribute("active")}),this.sub("*commonProgress",e=>{this.$.value=e})}destroyCallback(){super.destroyCallback(),this._unobserveCollectionCb?.(),this._unobserveCollectionCb=void 0}};ij.template=' <uc-progress-bar set="visible: visible; value: value"></uc-progress-bar> ';var iG=class extends eA{constructor(){super(),this.init$={...this.init$,currentText:"",options:[],selectHtml:"",onSelect:e=>{e.preventDefault(),e.stopPropagation();let t=this.ref.select;this.value=t.value,this.$.currentText=this.$.options.find(e=>e.value===this.value)?.text||"",this.dispatchEvent(new Event("change"))}}}initCallback(){super.initCallback(),this.sub("options",e=>{this.$.currentText=e?.[0]?.text||"";let t="";e?.forEach(e=>{t+=`<option value="${e.value}">${e.text}</option>`}),this.$.selectHtml=t})}};iG.template=' <select ref="select" set="innerHTML: selectHtml; onchange: onSelect"></select> ';var iZ=class extends th{static styleAttrs=[...super.styleAttrs,"uc-simple-btn"];couldBeCtxOwner=!0;constructor(){super(),this.init$={...this.init$,withDropZone:!0,onClick:()=>{this.api.initFlow()},"button-text":""}}initCallback(){super.initCallback(),this.defineAccessor("dropzone",e=>{void 0!==e&&(this.$.withDropZone=t7(e))}),this.subConfigValue("multiple",e=>{this.$["button-text"]=e?"upload-files":"upload-file"})}};iZ.template=`
  <uc-drop-area set="@disabled: !withDropZone">
    <button type="button" set="onclick: onClick">
      <uc-icon name="upload"></uc-icon>
      <span l10n="button-text"></span>
      <slot></slot>
      <div class="uc-visual-drop-area" l10n="drop-files-here"></div>
    </button>
  </uc-drop-area>
`,iZ.bindAttributes({dropzone:null});var iq=class extends th{couldBeCtxOwner=!0;type=void 0;_registeredTypes={};constructor(){super(),this.init$={...this.init$,iconName:"default","src-type":""}}initTypes(){for(let e of(this.registerType({type:ez.LOCAL,activate:()=>(this.api.openSystemDialog(),!1)}),this.registerType({type:ez.URL,activity:eI.activities.URL,textKey:"from-url"}),this.registerType({type:ez.CAMERA,activity:eI.activities.CAMERA,activate:()=>{let e=eK.htmlMediaCapture;return e&&this.api.openSystemDialog({captureCamera:!0}),!e}}),this.registerType({type:"draw",activity:eI.activities.DRAW,icon:"edit-draw"}),Object.values(eN)))this.registerType({type:e,activity:eI.activities.CAMERA,activate:()=>{let t=eK.htmlMediaCapture;return t&&this.api.openSystemDialog({captureCamera:!0,modeCamera:"mobile-photo-camera"===e?ts.PHOTO:ts.VIDEO}),!t}});for(let e of Object.values(eB))this.registerType({type:e,activity:eI.activities.EXTERNAL,activityParams:{externalSourceType:e}})}initCallback(){super.initCallback(),this.initTypes(),this.defineAccessor("type",e=>{e&&this.applyType(e)})}registerType(e){this._registeredTypes[e.type]=e}getType(e){return this._registeredTypes[e]}activate(){if(!this.type)return;let e=this._registeredTypes[this.type];if(!e)return;let{activity:t,activate:i,activityParams:s={}}=e;(i?i():!!t)&&t&&(this.modalManager?.open(t),this.set$({"*currentActivityParams":s,"*currentActivity":t}))}applyType(e){let t=this._registeredTypes[e];if(!t)return void console.warn(`Unsupported source type: ${e}`);let{textKey:i=e,icon:s=e}=t;this.$["src-type"]=`src-type-${i}`,this.$.iconName=s,this.onclick=()=>{this.activate()}}};iq.template=`
  <button type="button">
    <uc-icon set="@name: iconName"></uc-icon>
    <div class="uc-txt" l10n="src-type"></div>
  </button>
`,iq.bindAttributes({type:null});var iW=class extends eA{initCallback(){super.initCallback(),this.subConfigValue("sourceList",e=>{let t=L(e),i="";t.forEach(e=>"instagram"===e?void console.error("Instagram source was removed because the Instagram Basic Display API hasn't been available since December 4, 2024. Official statement, see here:https://developers.facebook.com/blog/post/2024/09/04/update-on-instagram-basic-display-api/?locale=en_US"):"camera"===e&&eK.htmlMediaCapture?void this.subConfigValue("cameraModes",e=>{let t=_(e);t.forEach(e=>{i+=`<uc-source-btn role="listitem" type="mobile-${e}-camera"></uc-source-btn>`}),0===t.length&&(i+='<uc-source-btn role="listitem" type="mobile-photo-camera"></uc-source-btn>')}):void(i+=`<uc-source-btn role="listitem" type="${e}"></uc-source-btn>`)),this.cfg.sourceListWrap?this.innerHTML=i:this.outerHTML=i})}},iK=class extends r.$G{};iK.template=' <div class="uc-spinner"></div> ';var iQ=class extends eI{historyTracked=!0;activityType=eI.activities.START_FROM;initCallback(){super.initCallback(),this.registerActivity(this.activityType??"")}};function iY(e,t=40){if("image/svg+xml"===e.type)return URL.createObjectURL(e);let i=document.createElement("canvas"),s=i.getContext("2d");if(!s)return Promise.reject(Error("Canvas context not supported"));let r=new Image,a=new Promise((e,a)=>{r.onload=()=>{let o=r.height/r.width;o>1?(i.width=t,i.height=t*o):(i.height=t,i.width=t/o),s.fillStyle="rgb(240, 240, 240)",s.fillRect(0,0,i.width,i.height),s.drawImage(r,0,0,i.width,i.height),i.toBlob(t=>{if(!t)return void a();e(URL.createObjectURL(t))})},r.onerror=e=>{a(e)}});return r.src=URL.createObjectURL(e),a}function iX(e="hsl(209, 21%, 65%)",t=32,i=32){let s=new Blob([`
  <svg width="${t}" height="${i}" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path fill-rule="evenodd" fill="${e}" d="M9.68848 8.70068C9.68848 8.42454 9.91233 8.20068 10.1885 8.20068H15.0885C15.2211 8.20068 15.3483 8.25336 15.442 8.34713L20.342 13.2471C20.4358 13.3409 20.4885 13.4681 20.4885 13.6007V21.3007C20.4885 21.5768 20.2646 21.8007 19.9885 21.8007H10.1885C9.91233 21.8007 9.68848 21.5768 9.68848 21.3007V8.70068ZM10.6885 9.20068V20.8007H19.4885V14.1007L15.0885 14.1007C14.8123 14.1007 14.5885 13.8768 14.5885 13.6007L14.5885 9.20068H10.6885ZM15.5885 9.90779L18.7814 13.1007L15.5885 13.1007L15.5885 9.90779Z"/>
  </svg>
  `],{type:"image/svg+xml"});return URL.createObjectURL(s)}iQ.template=' <div class="uc-content"><slot></slot></div> ';var iJ=class extends iI{_renderedGridOnce=!1;_thumbRect=null;_isIntersecting=!1;_firstViewMode=this.cfg.filesViewMode;_observer;constructor(){super(),this.init$={...this.init$,thumbUrl:"",badgeIcon:"",uid:""}}_calculateThumbSize(e=!1){e&&(this._thumbRect=this.getBoundingClientRect());let t=Math.max(parseInt(String(this?._thumbRect?.height||0),10),parseInt(String(this?._thumbRect?.width||0),10),this.cfg.thumbSize);return window.devicePixelRatio>1&&(t*=window.devicePixelRatio),Math.min(t,3e3)}_generateThumbnail=this._withEntry(async(e,t=!1)=>{let i=e.getValue("fileInfo"),s=e.getValue("isImage"),r=e.getValue("uuid"),a=e.getValue("thumbUrl"),o=this._calculateThumbSize(t);if(i&&s&&r){let t=await this.proxyUrl(S(O(this.cfg.cdnCname,r),E(e.getValue("cdnUrlModifiers"),"stretch/off",`scale_crop/${o}x${o}/center`)));if(a===t)return;let{promise:i}=tT(t);i.then(()=>{e.setValue("thumbUrl",t),a?.startsWith("blob:")&&URL.revokeObjectURL(a)}).catch(async()=>{if(!a?.startsWith("blob:"))try{let t=e.getValue("file");if(!t)return;let i=await iY(t,o);e.setValue("thumbUrl",i)}catch(i){this.telemetryManager.sendEventError(i,"thumbnail generation. Failed to generate thumb from file");let t=window.getComputedStyle(this).getPropertyValue("--uc-muted-foreground");e.setValue("thumbUrl",iX(t))}});return}if(e.getValue("thumbUrl"))return;let l=e.getValue("file");if(l?.type.includes("image"))try{let t=await iY(l,o);e.setValue("thumbUrl",t)}catch(i){this.telemetryManager.sendEventError(i,"thumbnail generation. Failed to generate thumb from file");let t=window.getComputedStyle(this).getPropertyValue("--uc-muted-foreground");e.setValue("thumbUrl",iX(t))}else{let t=window.getComputedStyle(this).getPropertyValue("--uc-muted-foreground");e.setValue("thumbUrl",iX(t))}});_debouncedGenerateThumb=v(this._generateThumbnail.bind(this),100);_observerCallback(e){let[t]=e;t&&(this._isIntersecting=t.isIntersecting,t.isIntersecting&&(this._thumbRect=t.boundingClientRect,this._debouncedGenerateThumb(),this._observer?.disconnect()),0===t.intersectionRatio&&this._debouncedGenerateThumb.cancel())}_reset(){super._reset(),this._debouncedGenerateThumb.cancel()}_handleEntryId(e){this._reset();let t=this.uploadCollection?.read(e);this._entry=t,t&&(this._subEntry("fileInfo",e=>{e?.isImage&&this._isIntersecting&&this._debouncedGenerateThumb()}),this._subEntry("thumbUrl",e=>{this.$.thumbUrl=e?`url(${e})`:""}),this._subEntry("cdnUrlModifiers",()=>{this._isIntersecting&&this._debouncedGenerateThumb()}),this._isIntersecting&&this._debouncedGenerateThumb())}initCallback(){super.initCallback(),this.defineAccessor("badgeIcon",e=>{this.$.badgeIcon=e}),this.defineAccessor("uid",e=>{this.set$({uid:e})}),this.sub("uid",e=>{this._handleEntryId(e)}),this.subConfigValue("filesViewMode",e=>{"grid"!==e||this._renderedGridOnce||("list"===this._firstViewMode&&this._debouncedGenerateThumb(!0),this._renderedGridOnce=!0)}),this.setAttribute("role","img")}connectedCallback(){super.connectedCallback(),this._observer=new window.IntersectionObserver(this._observerCallback.bind(this),{threshold:.1}),this._observer.observe(this)}disconnectedCallback(){super.disconnectedCallback(),this._entrySubs=new Set,this._debouncedGenerateThumb.cancel(),this._observer?.disconnect()}};iJ.template=`
  <div class="uc-thumb" set="style.backgroundImage: thumbUrl">
    <div class="uc-badge">
      <uc-icon set="@name: badgeIcon"></uc-icon>
    </div>
  </div>
`,iJ.bindAttributes({badgeIcon:null,uid:null});var i0=class extends th{static styleAttrs=["uc-wgt-common"];static EventType=b;requireCtxName=!0;initCallback(){super.initCallback(),this.$["*eventEmitter"].bindTarget(this)}destroyCallback(){super.destroyCallback(),this.$["*eventEmitter"].unbindTarget(this)}},i1=class extends th{couldBeCtxOwner=!0;historyTracked=!0;activityType=eI.activities.UPLOAD_LIST;constructor(){super(),this.init$={...this.init$,doneBtnVisible:!1,doneBtnEnabled:!1,uploadBtnVisible:!1,addMoreBtnVisible:!1,addMoreBtnEnabled:!1,headerText:"",commonErrorMessage:"",hasFiles:!1,onAdd:()=>{this.telemetryManager.sendEvent({eventType:g.ACTION_EVENT,payload:{metadata:{event:"add-more",node:this.tagName}}}),this.api.initFlow(!0)},onUpload:()=>{this.emit(b.UPLOAD_CLICK),this.api.uploadAll(),this._throttledHandleCollectionUpdate()},onDone:()=>{this.emit(b.DONE_CLICK,this.api.getOutputCollectionState()),this.api.doneFlow()},onCancel:()=>{this.telemetryManager.sendEvent({eventType:g.ACTION_EVENT,payload:{metadata:{event:"clear-all",node:this.tagName}}}),this.uploadCollection.clearAll()}}}_throttledHandleCollectionUpdate=tP(()=>{this.isConnected&&(this._updateUploadsState(),this.couldOpenActivity||this.$["*currentActivity"]!==this.activityType||this.historyBack(),this.cfg.confirmUpload||this.api.uploadAll())},300);_updateUploadsState(){let e=this.api.getOutputCollectionState(),t={total:e.totalCount,succeed:e.successCount,uploading:e.uploadingCount,failed:e.failedCount,validatingBeforeUploading:e.idleEntries.filter(e=>e.isValidationPending).length},i=!e.errors.some(e=>"TOO_MANY_FILES"===e.type||"TOO_FEW_FILES"===e.type),s=e.errors.some(e=>"TOO_MANY_FILES"===e.type),r=e.totalCount===(this.cfg.multiple?this.cfg.multipleMax:1),a=e.allEntries.some(e=>e.isValidationPending),o=0===t.failed&&0===e.errors.length&&!a,l=!1,n=!1,c=!1;if(t.total-t.succeed-t.uploading-t.failed>0&&i&&o)l=!0;else{n=!0;let s=!this.cfg.groupOutput||!!e.group;c=t.total===t.succeed&&i&&o&&s}this.set$({doneBtnVisible:n,doneBtnEnabled:c,uploadBtnVisible:l,addMoreBtnEnabled:0===t.total||!s&&!r,addMoreBtnVisible:!r||this.cfg.multiple,hasFiles:t.total>0}),this.bindL10n("headerText",()=>this._getHeaderText(t))}_getHeaderText(e){let t=t=>{let i=e[t];return"uploading"===t&&(i+=e.validatingBeforeUploading),this.l10n(`header-${t}`,{count:i})};return t(e.uploading>0||e.validatingBeforeUploading>0?"uploading":e.failed>0?"failed":e.succeed>0?"succeed":"total")}get couldOpenActivity(){return this.cfg.showEmptyList||this.uploadCollection.size>0}initCallback(){super.initCallback(),this.registerActivity(this.activityType),this.subConfigValue("multiple",this._throttledHandleCollectionUpdate),this.subConfigValue("multipleMin",this._throttledHandleCollectionUpdate),this.subConfigValue("multipleMax",this._throttledHandleCollectionUpdate),this.sub("*groupInfo",e=>{e&&this._throttledHandleCollectionUpdate()}),this.subConfigValue("filesViewMode",e=>{this.setAttribute("mode",e)}),this.sub("*currentActivity",e=>{this.couldOpenActivity||e!==this.activityType||(this.$["*currentActivity"]=this.initActivity)}),this.uploadCollection.observeProperties(this._throttledHandleCollectionUpdate),this.uploadCollection.observeCollection(this._throttledHandleCollectionUpdate),this.sub("*collectionErrors",e=>{let t=e.filter(e=>"SOME_FILES_HAS_ERRORS"!==e.type)[0];if(!t)return void this.set$({commonErrorMessage:null});this.set$({commonErrorMessage:t.message})})}destroyCallback(){super.destroyCallback(),this.uploadCollection.unobserveProperties(this._throttledHandleCollectionUpdate),this.uploadCollection.unobserveCollection(this._throttledHandleCollectionUpdate)}};i1.template=`
  <uc-activity-header>
    <span aria-live="polite" class="uc-header-text">{{headerText}}</span>
    <button
      type="button"
      class="uc-mini-btn uc-close-btn"
      set="onclick: *closeModal"
      l10n="@title:a11y-activity-header-button-close;@aria-label:a11y-activity-header-button-close"
    >
      <uc-icon name="close"></uc-icon>
    </button>
  </uc-activity-header>

  <div class="uc-no-files" set="@hidden: hasFiles">
    <slot name="empty"><span l10n="no-files"></span></slot>
  </div>

  <div class="uc-files">
    <div class="uc-files-wrapper" repeat="*uploadList" repeat-item-tag="uc-file-item"></div>
    <button
      type="button"
      class="uc-add-more-btn uc-secondary-btn"
      set="onclick: onAdd; @disabled: !addMoreBtnEnabled; @hidden: !addMoreBtnVisible"
    >
      <uc-icon name="add"></uc-icon><span l10n="add-more"></span>
    </button>
  </div>

  <div class="uc-common-error" set="@hidden: !commonErrorMessage; textContent: commonErrorMessage;"></div>

  <div class="uc-toolbar">
    <button type="button" class="uc-cancel-btn uc-secondary-btn" set="onclick: onCancel;" l10n="clear"></button>
    <div class="uc-toolbar-spacer"></div>
    <button
      type="button"
      class="uc-add-more-btn uc-secondary-btn"
      set="onclick: onAdd; @disabled: !addMoreBtnEnabled; @hidden: !addMoreBtnVisible"
    >
      <uc-icon name="add"></uc-icon><span l10n="add-more"></span>
    </button>
    <button
      type="button"
      class="uc-upload-btn uc-primary-btn"
      set="@hidden: !uploadBtnVisible; onclick: onUpload;"
      l10n="upload"
    ></button>
    <button
      type="button"
      class="uc-done-btn uc-primary-btn"
      set="@hidden: !doneBtnVisible; onclick: onDone;  @disabled: !doneBtnEnabled"
      l10n="done"
    ></button>
  </div>

  <uc-drop-area ghost></uc-drop-area>
`;var i5=class extends th{couldBeCtxOwner=!0;activityType=eI.activities.URL;constructor(){super(),this.init$={...this.init$,importDisabled:!0,onUpload:e=>{e.preventDefault(),this.telemetryManager.sendEvent({eventType:g.ACTION_EVENT,payload:{metadata:{event:"upload-from-url",node:this.tagName}}});let t=this.ref.input.value;this.api.addFileFromUrl(t,{source:ez.URL}),this.modalManager?.open(eI.activities.UPLOAD_LIST),this.$["*currentActivity"]=eI.activities.UPLOAD_LIST},onCancel:()=>{this.historyBack()},onInput:e=>{let t=e.target?.value??"";this.set$({importDisabled:!t})}}}initCallback(){super.initCallback(),this.registerActivity(this.activityType??"",{onActivate:()=>{let e=this.ref.input;e.value="",e.focus()}})}};i5.template=`
  <uc-activity-header>
    <button type="button" class="uc-mini-btn" set="onclick: *historyBack" l10n="@title:back;@aria-label:back">
      <uc-icon name="back"></uc-icon>
    </button>
    <div>
      <uc-icon name="url"></uc-icon>
      <span l10n="caption-from-url"></span>
    </div>
    <button
      type="button"
      class="uc-mini-btn uc-close-btn"
      set="onclick: *closeModal"
      l10n="@title:a11y-activity-header-button-close;@aria-label:a11y-activity-header-button-close"
    >
      <uc-icon name="close"></uc-icon>
    </button>
  </uc-activity-header>
  <form class="uc-content">
    <label>
      <input placeholder="https://" class="uc-url-input" type="text" ref="input" set="oninput: onInput" />
    </label>
    <button
      type="submit"
      class="uc-url-upload-btn uc-primary-btn"
      set="onclick: onUpload; @disabled: importDisabled"
      l10n="upload-url"
    ></button>
  </form>
`;var i2=class extends tA{static styleAttrs=[...super.styleAttrs,"uc-wgt-common"];constructor(){super(),this.init$={...this.init$,"*solution":this.tagName}}initCallback(){super.initCallback(),this.telemetryManager.sendEvent({eventType:g.INIT_SOLUTION}),this.a11y?.registerBlock(this)}},i3=class extends eT{static styleAttrs=[...super.styleAttrs,"uc-file-uploader-inline"];constructor(){super(),this.init$={...this.init$,couldCancel:!1,"*solution":this.tagName,cancel:()=>{if(this.couldHistoryBack){let e=this.$["*historyBack"];e?.();return}this.couldShowList&&(this.$["*currentActivity"]=eI.activities.UPLOAD_LIST)}}}get couldHistoryBack(){let e=this.$["*history"];return!!e&&!(e.length<=1)&&e[e.length-1]!==eI.activities.START_FROM}get couldShowList(){let e=this.$["*uploadList"];return this.cfg.showEmptyList||Array.isArray(e)&&e.length>0}initCallback(){super.initCallback(),this.telemetryManager.sendEvent({eventType:g.INIT_SOLUTION});let e=this.ref.uBlock;e&&(this.sub("*currentActivity",t=>{t||(this.$["*currentActivity"]=e.initActivity||eI.activities.START_FROM)}),this.sub("*uploadList",t=>{Array.isArray(t)&&t.length>0&&this.$["*currentActivity"]===(e.initActivity||eI.activities.START_FROM)&&(this.$["*currentActivity"]=eI.activities.UPLOAD_LIST)}),this.sub("*history",()=>{this.$.couldCancel=this.couldHistoryBack||this.couldShowList}))}};i3.template=`
  <uc-start-from>
    <uc-drop-area with-icon clickable></uc-drop-area>
    <uc-source-list role="list" wrap></uc-source-list>
    <button
      type="button"
      l10n="start-from-cancel"
      class="uc-cancel-btn uc-secondary-btn"
      set="onclick: cancel; @hidden: !couldCancel"
    ></button>
    <uc-copyright></uc-copyright>
  </uc-start-from>
  <uc-upload-list ref="uBlock"></uc-upload-list>
  <uc-camera-source></uc-camera-source>
  <uc-url-source></uc-url-source>
  <uc-external-source></uc-external-source>
  <uc-cloud-image-editor-activity></uc-cloud-image-editor-activity>
`;var i7="active",i4=class extends eT{static styleAttrs=[...super.styleAttrs,"uc-file-uploader-minimal"];handleModalOpen;handleModalClose;constructor(){super(),this.init$={...this.init$,singleUpload:!1,isHiddenStartFrom:!1,classUploadList:"",classStartFrom:"","*solution":this.tagName}}_handleModalOpen(e){e.id===eI.activities.CLOUD_IMG_EDIT&&this.set$({classUploadList:i7}),this.$["*currentActivity"]===eI.activities.UPLOAD_LIST&&this.set$({classUploadList:i7,isHiddenStartFrom:!0});let t=this.$["*uploadList"];(!t||t.length<=0)&&this.set$({classStartFrom:i7})}_handleModalClose(e){e.id===this.$["*currentActivity"]&&(this.$["*currentActivity"]=eI.activities.UPLOAD_LIST,this.set$({isHiddenStartFrom:!1})),e.id===eI.activities.CLOUD_IMG_EDIT&&(this.$["*currentActivity"]=eI.activities.UPLOAD_LIST)}initCallback(){super.initCallback(),this.telemetryManager.sendEvent({eventType:g.INIT_SOLUTION});let e=this.ref.uBlock;e&&(this.sub("*currentActivity",t=>{t===eI.activities.UPLOAD_LIST&&this.modalManager?.closeAll(),t||(this.$["*currentActivity"]=e.initActivity||eI.activities.START_FROM)}),this.sub("*uploadList",t=>{Array.isArray(t)&&t.length>0?(this.$["*currentActivity"]=eI.activities.UPLOAD_LIST,this.set$({classStartFrom:""})):(this.set$({classUploadList:"",isHiddenStartFrom:!1}),this.$["*currentActivity"]=e.initActivity||eI.activities.START_FROM)}),this.subConfigValue("confirmUpload",e=>{!1!==e&&(this.cfg.confirmUpload=!1)}),this.subConfigValue("filesViewMode",e=>{this.setAttribute("mode",e),this.subConfigValue("multiple",t=>{"grid"===e?(t?this.style.removeProperty("--uc-grid-col"):this.style.setProperty("--uc-grid-col","1"),this.$.singleUpload=!t):(this.style.removeProperty("--uc-grid-col"),this.$.singleUpload=!1)})}),this.handleModalOpen=e=>{this._handleModalOpen(e)},this.handleModalClose=e=>{this._handleModalClose(e)},this.modalManager?.subscribe(ef.OPEN,this.handleModalOpen),this.modalManager?.subscribe(ef.CLOSE,this.handleModalClose))}destroyCallback(){super.destroyCallback(),this.modalManager?.unsubscribe(ef.OPEN,this.handleModalOpen),this.modalManager?.unsubscribe(ef.CLOSE,this.handleModalClose)}};i4.template=`
  <uc-start-from set="@hidden: isHiddenStartFrom; @class:classStartFrom">
    <uc-drop-area set="@single:singleUpload;" initflow clickable tabindex="0" l10n="choose-file"></uc-drop-area>
    <uc-copyright></uc-copyright>
  </uc-start-from>
  <uc-upload-list set="@class:classUploadList" ref="uBlock"></uc-upload-list>

  <uc-modal id="start-from" strokes block-body-scrolling>
    <uc-start-from>
      <uc-drop-area with-icon clickable></uc-drop-area>
      <uc-source-list role="list" wrap></uc-source-list>
      <button type="button" l10n="start-from-cancel" class="uc-secondary-btn" set="onclick: *historyBack"></button>
    </uc-start-from>
  </uc-modal>

  <uc-modal id="camera" strokes block-body-scrolling>
    <uc-camera-source></uc-camera-source>
  </uc-modal>

  <uc-modal id="url" strokes block-body-scrolling>
    <uc-url-source></uc-url-source>
  </uc-modal>

  <uc-modal id="external" strokes block-body-scrolling>
    <uc-external-source></uc-external-source>
  </uc-modal>

  <uc-modal id="cloud-image-edit" strokes block-body-scrolling>
    <uc-cloud-image-editor-activity></uc-cloud-image-editor-activity>
  </uc-modal>
`;var i8=class extends eT{static styleAttrs=[...super.styleAttrs,"uc-file-uploader-regular"];constructor(){super();let e={...this.init$,isHidden:!1,"*solution":this.tagName};this.init$=e}initCallback(){super.initCallback(),this.telemetryManager.sendEvent({eventType:g.INIT_SOLUTION}),this.defineAccessor("headless",e=>{this.set$({isHidden:t7(e)})})}};i8.template=`
  <uc-simple-btn set="@hidden: isHidden"></uc-simple-btn>

  <uc-modal id="start-from" strokes block-body-scrolling>
    <uc-start-from>
      <uc-drop-area with-icon clickable></uc-drop-area>
      <uc-source-list role="list" wrap></uc-source-list>
      <button type="button" l10n="start-from-cancel" class="uc-secondary-btn" set="onclick: *historyBack"></button>
      <uc-copyright></uc-copyright>
    </uc-start-from>
  </uc-modal>

  <uc-modal id="upload-list" strokes block-body-scrolling>
    <uc-upload-list></uc-upload-list>
  </uc-modal>

  <uc-modal id="camera" strokes block-body-scrolling>
    <uc-camera-source></uc-camera-source>
  </uc-modal>

  <uc-modal id="url" strokes block-body-scrolling>
    <uc-url-source></uc-url-source>
  </uc-modal>

  <uc-modal id="external" strokes block-body-scrolling>
    <uc-external-source></uc-external-source>
  </uc-modal>

  <uc-modal id="cloud-image-edit" strokes block-body-scrolling>
    <uc-cloud-image-editor-activity></uc-cloud-image-editor-activity>
  </uc-modal>
`,i8.bindAttributes({headless:null})}}]);