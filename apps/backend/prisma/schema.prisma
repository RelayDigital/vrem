generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id             String               @id @default(uuid())
  email          String               @unique
  name           String
  password       String
  role           Role                 @default(AGENT)
  createdAt      DateTime             @default(now())
  updatedAt      DateTime             @updatedAt
  messages       Message[]
  organizations  OrganizationMember[]
  agentProjects  Project[]            @relation("AgentProjects")
  editorProjects Project[]            @relation("EditorProjects")
  techProjects   Project[]            @relation("TechProjects")
}

model Organization {
  id          String               @id @default(uuid())
  name        String
  createdAt   DateTime             @default(now())
  invitations Invitation[]
  members     OrganizationMember[]
  projects    Project[]
}

model OrganizationMember {
  id           String       @id @default(uuid())
  userId       String
  orgId        String
  role         OrgRole
  createdAt    DateTime     @default(now())
  organization Organization @relation(fields: [orgId], references: [id])
  user         User         @relation(fields: [userId], references: [id])

  @@unique([userId, orgId])
}

model Media {
  id        String    @id @default(cuid())
  projectId String
  key       String
  cdnUrl    String?
  filename  String
  size      Int
  type      MediaType
  createdAt DateTime  @default(now())
  project   Project   @relation(fields: [projectId], references: [id])
}

model Message {
  id        String   @id @default(uuid())
  projectId String
  userId    String
  content   String
  timestamp DateTime @default(now())
  project   Project  @relation(fields: [projectId], references: [id])
  user      User     @relation(fields: [userId], references: [id])
}

model Project {
  id            String         @id @default(uuid())
  agentId       String
  address       String
  notes         String?
  scheduledTime DateTime
  status        ProjectStatus  @default(BOOKED)
  technicianId  String?
  editorId      String?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  orgId         String
  calendarEvent CalendarEvent?
  media         Media[]
  messages      Message[]
  agent         User           @relation("AgentProjects", fields: [agentId], references: [id])
  editor        User?          @relation("EditorProjects", fields: [editorId], references: [id])
  organization  Organization   @relation(fields: [orgId], references: [id])
  technician    User?          @relation("TechProjects", fields: [technicianId], references: [id])
}

model Inquiry {
  id        String        @id @default(uuid())
  name      String
  email     String
  phone     String?
  address   String?
  message   String?
  status    InquiryStatus @default(PENDING)
  createdAt DateTime      @default(now())
}

model CalendarEvent {
  id             String   @id @default(uuid())
  projectId      String   @unique
  cronofyEventId String
  calendarId     String
  createdAt      DateTime @default(now())
  project        Project  @relation(fields: [projectId], references: [id])
}

model Invitation {
  id           String       @id @default(uuid())
  email        String
  orgId        String
  role         OrgRole
  token        String       @unique
  accepted     Boolean      @default(false)
  createdAt    DateTime     @default(now())
  organization Organization @relation(fields: [orgId], references: [id])
}

enum Role {
  ADMIN
  PROJECT_MANAGER
  TECHNICIAN
  EDITOR
  AGENT
}

enum OrgRole {
  ADMIN
  PROJECT_MANAGER
  TECHNICIAN
  EDITOR
  AGENT
}

enum MediaType {
  PHOTO
  VIDEO
  FLOORPLAN
  DOCUMENT
}

enum ProjectStatus {
  BOOKED
  SHOOTING
  EDITING
  DELIVERED
}

enum InquiryStatus {
  PENDING
  REVIEWED
  APPROVED
  REJECTED
  CONVERTED_TO_PROJECT
}
